"use strict";(self.webpackChunkopen_ziti=self.webpackChunkopen_ziti||[]).push([[3116],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var i=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=i.createContext({}),p=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},h=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),h=r,m=d["".concat(s,".").concat(h)]||d[h]||u[h]||a;return n?i.createElement(m,o(o({ref:t},c),{},{components:n})):i.createElement(m,o({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<a;p++)o[p]=n[p];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}h.displayName="MDXCreateElement"},65471:(e,t,n)=>{n.d(t,{Z:()=>_});var i=n(87462),r=n(67294),a=n(86010),o=n(72389),l=n(86043);const s={details:"details_lb9f",isBrowser:"isBrowser_bmU9",collapsibleContent:"collapsibleContent_i85q"};function p(e){return!!e&&("SUMMARY"===e.tagName||p(e.parentElement))}function c(e,t){return!!e&&(e===t||c(e.parentElement,t))}function d(e){let{summary:t,children:n,...d}=e;const u=(0,o.Z)(),h=(0,r.useRef)(null),{collapsed:m,setCollapsed:_}=(0,l.u)({initialState:!d.open}),[k,T]=(0,r.useState)(d.open),R=r.isValidElement(t)?t:r.createElement("summary",null,t??"Details");return r.createElement("details",(0,i.Z)({},d,{ref:h,open:k,"data-collapsed":m,className:(0,a.Z)(s.details,u&&s.isBrowser,d.className),onMouseDown:e=>{p(e.target)&&e.detail>1&&e.preventDefault()},onClick:e=>{e.stopPropagation();const t=e.target;p(t)&&c(t,h.current)&&(e.preventDefault(),m?(_(!1),T(!0)):_(!0))}}),R,r.createElement(l.z,{lazy:!1,collapsed:m,disableSSRStyle:!0,onCollapseTransitionEnd:e=>{_(e),T(!e)}},r.createElement("div",{className:s.collapsibleContent},n)))}const u={details:"details_b_Ee"},h="alert alert--info";function m(e){let{...t}=e;return r.createElement(d,(0,i.Z)({},t,{className:(0,a.Z)(h,u.details,t.className)}))}function _(e){const t=r.Children.toArray(e.children),n=t.find((e=>r.isValidElement(e)&&"summary"===e.props?.mdxType)),a=r.createElement(r.Fragment,null,t.filter((e=>e!==n)));return r.createElement(m,(0,i.Z)({},e,{summary:n}),a)}},2986:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var i=n(87462),r=(n(67294),n(3905)),a=n(65471);const o={title:"BrowZer"},l=void 0,s={unversionedId:"learn/quickstarts/browzer/index",id:"learn/quickstarts/browzer/index",title:"BrowZer",description:"BrowZer is a set of technologies which is capable of bootstrapping zero trust connectivity entirely in a browser,",source:"@site/docs/learn/quickstarts/browzer/index.md",sourceDirName:"learn/quickstarts/browzer",slug:"/learn/quickstarts/browzer/",permalink:"/docs/learn/quickstarts/browzer/",draft:!1,editUrl:"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/learn/quickstarts/browzer/index.md",tags:[],version:"current",frontMatter:{title:"BrowZer"},sidebar:"docsSidebar",previous:{title:"Console",permalink:"/docs/learn/quickstarts/zac/"},next:{title:"Chrome Origin Trials",permalink:"/docs/learn/quickstarts/browzer/chrome-origin-trials"}},p={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"OIDC Prerequisites",id:"oidc-prerequisites",level:3},{value:"Configuring the Network",id:"configuring-the-network",level:2},{value:"Creating the External JWT Signer",id:"creating-the-external-jwt-signer",level:3},{value:"Creating the Authentication Policy",id:"creating-the-authentication-policy",level:3},{value:"Associate Identities to the Authentication Policy",id:"associate-identities-to-the-authentication-policy",level:3},{value:"Running the Ziti BrowZer Bootstrapper",id:"running-the-ziti-browzer-bootstrapper",level:2},{value:"Cloning From GitHub",id:"cloning-from-github",level:2},{value:"Running via Docker",id:"running-via-docker",level:2},{value:"Example Docker Command",id:"example-docker-command",level:3},{value:"Enabling BrowZer with Systemd",id:"enabling-browzer-with-systemd",level:2}],d={toc:c},u="wrapper";function h(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,i.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"BrowZer is a set of technologies which is capable of bootstrapping zero trust connectivity entirely in a browser,\nand without the need to install any client-side software! To enable BrowZer on your network the ",(0,r.kt)("inlineCode",{parentName:"p"},"ziti-browzer-bootstrapper"),"\nwill need to be deployed. This pages outlines the steps needed to deploy BrowZer to your own overlay. For an example\nof enabling BrowZer, see the ",(0,r.kt)("a",{parentName:"p",href:"/docs/learn/quickstarts/browzer/example/"},"Example Enabling BrowZer")," subpage showing the steps in more detail."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"To deploy and enable BrowZer on your network, you will need to have:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"an OpenZiti Overlay Network is available and has been configured with alternative server certs"),(0,r.kt)("li",{parentName:"ul"},"an OIDC Provider and the ability to define applications/clients for the provider"),(0,r.kt)("li",{parentName:"ul"},"a wildcard certificate from a 3rd party verifiable CA"),(0,r.kt)("li",{parentName:"ul"},'you have signed up with Chrome\'s "origin trials" to allow the BrowZer bootstrapper to automatically enable\n',(0,r.kt)("a",{parentName:"li",href:"https://v8.dev/blog/jspi"},"JSPI")," for your BrowZer users. See ",(0,r.kt)("a",{parentName:"li",href:"/docs/learn/quickstarts/browzer/chrome-origin-trials"},"the chrome-origin-trials"),"\nfor more detail ")),(0,r.kt)("h3",{id:"oidc-prerequisites"},"OIDC Prerequisites"),(0,r.kt)("p",null,"Enabling BrowZer will require configuring the network to delegate authentication to an OIDC provider. Every OIDC\nprovider is different and understanding OIDC flows is beyond this guide. There are\n",(0,r.kt)("a",{parentName:"p",href:"https://www.oauth.com/oauth2-servers/client-registration/client-id-secret/"},"numerous"),",\n",(0,r.kt)("a",{parentName:"p",href:"https://developer.okta.com/blog/2019/10/21/illustrated-guide-to-oauth-and-oidc"},"excellent"),"\n",(0,r.kt)("a",{parentName:"p",href:"https://developers.google.com/identity/openid-connect/openid-connect"},"posts")," to find and read about OIDC. The OIDC\nconcepts you will want to understand are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"how to create/obtain the client id the network will use"),(0,r.kt)("li",{parentName:"ul"},"how to learn/find/discover the OIDC discovery endpoint"),(0,r.kt)("li",{parentName:"ul"},"what ",(0,r.kt)("inlineCode",{parentName:"li"},"audience")," the OIDC provider will add to the bearer token"),(0,r.kt)("li",{parentName:"ul"},"what field or ",(0,r.kt)("inlineCode",{parentName:"li"},"claim")," the OIDC provider will add to the bearer token which will be used to locate matching identities")),(0,r.kt)("h2",{id:"configuring-the-network"},"Configuring the Network"),(0,r.kt)("p",null,"With the OIDC information in hand, the next step is to actually configure OpenZiti to allow the delegation of authentication.\nTo do this you will need to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"create an ",(0,r.kt)("a",{parentName:"li",href:"/docs/learn/core-concepts/security/authentication/external-jwt-signers"},"external jwt signer")),(0,r.kt)("li",{parentName:"ul"},"create an ",(0,r.kt)("a",{parentName:"li",href:"../../../../docs/learn/core-concepts/security/authentication/authentication-policies"},"authentication policy"),"\nand associate the external jwt signer"),(0,r.kt)("li",{parentName:"ul"},"associate identities with the authentication policy delegating the authentication to the specified OIDC provider")),(0,r.kt)("h3",{id:"creating-the-external-jwt-signer"},"Creating the External JWT Signer"),(0,r.kt)("p",null,"To create the external jwt signer, you will need to have the OIDC discovery endpoint and the ",(0,r.kt)("inlineCode",{parentName:"p"},"audience")," values handy.\nUsing the OIDC discovery endpoint, discover the ",(0,r.kt)("inlineCode",{parentName:"p"},"issuer")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"jwks_uri")," from the discovery endpoint. Using the ",(0,r.kt)("inlineCode",{parentName:"p"},"ziti"),"\nCLI, create the external jwt. Shown below is a ",(0,r.kt)("inlineCode",{parentName:"p"},"bash")," example. Replace the values accordingly. Capture the returned\nidentity, it will be necessary after creating the external jwt signer:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'issuer="__issuer_id_here__"\njwks_uri="__jwks_uri_here__"\naudience="__audience_here__"\nclaims_property="email"\nziti edge create ext-jwt-signer \\\n  "ext-jwt-signer-name-here" "${issuer}" \\\n  --jwks-endpoint "${jwks_uri}" \\\n  --audience "${audience}" \\\n  --claims-property ${claims_property}\n')),(0,r.kt)("h3",{id:"creating-the-authentication-policy"},"Creating the Authentication Policy"),(0,r.kt)("p",null,"Authentication policies configure the network to delegate authentication one or more OIDC providers. To\ncreate the authentication policy you only need the id of the external jwt signer (from above). Shown below is a ",(0,r.kt)("inlineCode",{parentName:"p"},"bash"),"\nexample. Replace the values accordingly. Capture the returned identity, it will be necessary after creating the external\njwt signer:"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Shown below is an example creating a ",(0,r.kt)("strong",{parentName:"p"},"new")," authentication policy and allowing it to be used for ",(0,r.kt)("strong",{parentName:"p"},"primary"),"\nauthentication. This means the associated external jwt signer (OIDC provider) is allowed to provide a document that\nOpenZiti will validate, and use for authentication. You can also choose to modify the ",(0,r.kt)("strong",{parentName:"p"},"default")," policy if you decide\nto. You do not need to create a ",(0,r.kt)("strong",{parentName:"p"},"new")," policy. If this is your first time using BrowZer it is recommended you start\nwith a new authentication policy, as shown. Once you understand how authentication policies work and how BrowZer works,\nthen you can make an informed decision if you want to modify the default authentication policy or not")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'ext_jwt_signer="__ext_jwt_signer_id_from_above__"\nziti edge create auth-policy \\\n  "auth-policy-name-here" \\\n  --primary-ext-jwt-allowed \\\n  --primary-ext-jwt-allowed-signers ${ext_jwt_signer}\n')),(0,r.kt)("h3",{id:"associate-identities-to-the-authentication-policy"},"Associate Identities to the Authentication Policy"),(0,r.kt)("p",null,"With an auth policy created and associated to the external jwt signer, you are now ready to create or modify identities\nto use this new authentication policy. To allow a given identity to be enabled for BrowZer, you will need to first\nupdate (or create) the identity with an ",(0,r.kt)("inlineCode",{parentName:"p"},"externalId")," and you will need to associate the identity with the authentication\npolicy."),(0,r.kt)("p",null,"In this example, a new identity will be created and the associated OIDC provider will be expected to provide a bearer\ntoken which has an ",(0,r.kt)("inlineCode",{parentName:"p"},"email")," claim with the value ",(0,r.kt)("inlineCode",{parentName:"p"},"ziggy@openziti.io")," and names the identity ",(0,r.kt)("inlineCode",{parentName:"p"},"openziti_ziggy"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'identity_name="openziti_ziggy"\nauth_policy="__auth_policy_id_from_above__"\nexternal_id="ziggy@openziti.io"\nziti edge create identity user "${identity_name}" \\\n  --auth-policy ${auth_policy} \\\n  --external-id "${external_id}" \\\n  -a docker.whale.dialers\n')),(0,r.kt)("h2",{id:"running-the-ziti-browzer-bootstrapper"},"Running the Ziti BrowZer Bootstrapper"),(0,r.kt)("p",null,"Running the Ziti BrowZer Bootstrapper can be done directly using NodeJS or with a container engine such as Docker. Either\nway you choose to run it, you will need to establish some environment variables. If you are using NodeJS, you'll ",(0,r.kt)("inlineCode",{parentName:"p"},"export"),"\nthem. To run using Docker, you can either reference the environment variables (shown below) or use an ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"NODE_ENV"),": controls if the environment is ",(0,r.kt)("inlineCode",{parentName:"li"},"production")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"development")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ZITI_BROWZER_RUNTIME_LOGLEVEL"),": the log level for the Ziti BrowZer Runtime (ZBR) to use. ",(0,r.kt)("inlineCode",{parentName:"li"},"trace|debug|info|warn|error")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ZITI_BROWZER_RUNTIME_HOTKEY"),": the hotkey to activate the BrowZer settings dialog modal. default: alt+F12"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ZITI_CONTROLLER_HOST"),': the "alternative" address for the OpenZiti controller. example: ',(0,r.kt)("inlineCode",{parentName:"li"},"ctrl.openziti.io")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ZITI_CONTROLLER_PORT"),": the port to find the OpenZiti controller at. example: ",(0,r.kt)("inlineCode",{parentName:"li"},"8441")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ZITI_BROWZER_BOOTSTRAPPER_LOGLEVEL"),": the log level for the ziti-browzer-bootstrapper to log at. ",(0,r.kt)("inlineCode",{parentName:"li"},"silly|debug|info|warn|error")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ZITI_BROWZER_BOOTSTRAPPER_HOST"),": the address the ziti-browzer-bootstrapper is available at. example: ",(0,r.kt)("inlineCode",{parentName:"li"},"browzer.openziti.io")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ZITI_BROWZER_BOOTSTRAPPER_LISTEN_PORT"),": the port the ziti-browzer-bootstrapper is available at. example: ",(0,r.kt)("inlineCode",{parentName:"li"},"443")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ZITI_BROWZER_BOOTSTRAPPER_SCHEME"),": the scheme to use to access the ziti-browzer-bootstrapper. ",(0,r.kt)("inlineCode",{parentName:"li"},"http|https")," (https by default)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ZITI_BROWZER_BOOTSTRAPPER_CERTIFICATE_PATH"),": the path to the certificate the ziti-browzer-bootstrapper presents to clients"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ZITI_BROWZER_BOOTSTRAPPER_KEY_PATH"),": the associated key for the ZITI_BROWZER_BOOTSTRAPPER_CERTIFICATE_PATH"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ZITI_BROWZER_RUNTIME_ORIGIN_TRIAL_TOKEN"),": the token obtained from the origin trials prerequisite"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ZITI_BROWZER_BOOTSTRAPPER_TARGETS"),": A json block representing the services to enable BrowZer for.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"      NODE_ENV: production\n      ZITI_BROWZER_RUNTIME_LOGLEVEL: debug\n      ZITI_BROWZER_RUNTIME_HOTKEY: alt+F12\n      ZITI_CONTROLLER_HOST: ${ZITI_CTRL_EDGE_ALT_ADVERTISED_ADDRESS}\n      ZITI_CONTROLLER_PORT: ${ZITI_CTRL_EDGE_ADVERTISED_PORT}\n      ZITI_BROWZER_BOOTSTRAPPER_LOGLEVEL: debug\n      ZITI_BROWZER_BOOTSTRAPPER_HOST: ${ZITI_BROWZER_HTTP_AGENT_ADDRESS}\n      ZITI_BROWZER_BOOTSTRAPPER_LISTEN_PORT: ${ZITI_BROWZER_BOOTSTRAPPER_LISTEN_PORT}\n      ZITI_BROWZER_BOOTSTRAPPER_SCHEME: https\n      ZITI_BROWZER_BOOTSTRAPPER_CERTIFICATE_PATH: /etc/letsencrypt/live/your.fqdn.here/fullchain.pem\n      ZITI_BROWZER_BOOTSTRAPPER_KEY_PATH: /etc/letsencrypt/live/your.fqdn.here/privkey.pem\n      ZITI_BROWZER_RUNTIME_ORIGIN_TRIAL_TOKEN=__the_token_you_received_from_the_jspi_orgin_trial_prerequisite__\n      ZITI_BROWZER_BOOTSTRAPPER_TARGETS: __more on this below__\n")),(0,r.kt)("p",null,"Set these values accordingly. Also shown is the reuse of certificates provisioned in this case by LetsEncrypt. BrowZer\nrequires a wildcard certificate to be provisioned that aligns to the ",(0,r.kt)("inlineCode",{parentName:"p"},"ZITI_BROWZER_BOOTSTRAPPER_HOST")," value used. For example, if you had\nset ",(0,r.kt)("inlineCode",{parentName:"p"},"ZITI_BROWZER_BOOTSTRAPPER_HOST=my.custom.network"),", the certificate must be valid for ",(0,r.kt)("inlineCode",{parentName:"p"},"*.my.custom.network")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"If you use Certbot/LetsEncrypt, the certificate created is likely to be accessible by root only.\nYou will need to modify the folder/files accordingly.\naccordingly.")),(0,r.kt)("h2",{id:"cloning-from-github"},"Cloning From GitHub"),(0,r.kt)("p",null,"Once the environment variables are set, to start the Ziti BrowZer Bootstrapper perform the following:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"clone the repository and checkout the desired tag/version. ",(0,r.kt)("inlineCode",{parentName:"li"},"main")," should be fine:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"git clone https://github.com/openziti/ziti-browzer-bootstrapper.git $ZITI_HOME/ziti-browzer-bootstrapper\n"))),(0,r.kt)("li",{parentName:"ul"},"cd to the cloned location: ",(0,r.kt)("inlineCode",{parentName:"li"},"cd $ZITI_HOME/ziti-browzer-bootstrapper")),(0,r.kt)("li",{parentName:"ul"},"ensure the proper version of node and yarn are installed and run yarn install: ",(0,r.kt)("inlineCode",{parentName:"li"},"yarn install")),(0,r.kt)("li",{parentName:"ul"},"start the node server:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"NODE_EXTRA_CA_CERTS=node_modules/node_extra_ca_certs_mozilla_bundle/ca_bundle/ca_intermediate_root_bundle.pem node index.js\n")))),(0,r.kt)("h2",{id:"running-via-docker"},"Running via Docker"),(0,r.kt)("p",null,"Running the Ziti BrowZer Bootstrapper using Docker is similar to running with NodeJS. Establish the environment variables\nthen run the agent with a command as shown. Note that this is running in the foreground. It's up to you to decide to put\nthis into daemon mode, to use ",(0,r.kt)("inlineCode",{parentName:"p"},"docker compose"),", etc."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"To work around the LetsEncrypt issue mentioned above (the certs only visible to root), this example explicitly sets the\n--user the container runs as to a group id of 2171. Not shown was the creation of this group prior to running in Docker.\nIn the Docker host OS, a group was added using a command such as: ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo groupadd -g 2171 zitiweb"),". Then the\nLetsEncrypt folder containing the certificates/keys was chown'ed: ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo chown -R root:zitiweb /etc/letsencrypt/"),".\nThis allows the Docker container that will run the bootstrapper to access the files"),(0,r.kt)("p",{parentName:"admonition"},"Understanding the exact mechanics of why/how this works is beyond the scope of this page and is more relevant to Linux/Docker\nsystem administration.")),(0,r.kt)("h3",{id:"example-docker-command"},"Example Docker Command"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'docker run \\\n  --name ziti-browzer-bootstrapper \\\n  --rm -v /etc/letsencrypt:/etc/letsencrypt \\\n  --user "${UID}:2171" \\\n  -p ${ZITI_BROWZER_BOOTSTRAPPER_LISTEN_PORT}:${ZITI_BROWZER_BOOTSTRAPPER_LISTEN_PORT} \\\n  -e NODE_ENV="${NODE_ENV}" \\\n  -e ZITI_BROWZER_BOOTSTRAPPER_LOGLEVEL="${ZITI_BROWZER_BOOTSTRAPPER_LOGLEVEL}" \\\n  -e ZITI_BROWZER_RUNTIME_LOGLEVEL="${ZITI_BROWZER_RUNTIME_LOGLEVEL}" \\\n  -e ZITI_BROWZER_RUNTIME_HOTKEY="${ZITI_BROWZER_RUNTIME_HOTKEY}" \\\n  -e ZITI_CONTROLLER_HOST="${ZITI_CONTROLLER_HOST}" \\\n  -e ZITI_CONTROLLER_PORT="${ZITI_CONTROLLER_PORT}" \\\n  -e ZITI_BROWZER_BOOTSTRAPPER_HOST="${ZITI_BROWZER_BOOTSTRAPPER_HOST}" \\\n  -e ZITI_BROWZER_BOOTSTRAPPER_SCHEME="${ZITI_BROWZER_BOOTSTRAPPER_SCHEME}" \\\n  -e ZITI_BROWZER_BOOTSTRAPPER_CERTIFICATE_PATH="${ZITI_BROWZER_BOOTSTRAPPER_CERTIFICATE_PATH}" \\\n  -e ZITI_BROWZER_BOOTSTRAPPER_KEY_PATH="${ZITI_BROWZER_BOOTSTRAPPER_KEY_PATH}" \\\n  -e ZITI_BROWZER_BOOTSTRAPPER_LISTEN_PORT="${ZITI_BROWZER_BOOTSTRAPPER_LISTEN_PORT}" \\\n  -e ZITI_BROWZER_RUNTIME_ORIGIN_TRIAL_TOKEN="${ZITI_BROWZER_RUNTIME_ORIGIN_TRIAL_TOKEN}" \\\n  -e ZITI_BROWZER_BOOTSTRAPPER_TARGETS="${ZITI_BROWZER_BOOTSTRAPPER_TARGETS}" \\\n  ghcr.io/openziti/ziti-browzer-bootstrapper:latest\n')),(0,r.kt)("h2",{id:"enabling-browzer-with-systemd"},"Enabling BrowZer with Systemd"),(0,r.kt)("p",null,"If you want the BrowZer Bootstrap Agent to start when the machine starts or if the process fails for some reason\nand you have ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Systemd"},"systemd")," on your system, you can enable the BrowZer Bootstrap Agent\nto start automatically on failure or reboot."),(0,r.kt)("p",null,"If you have used the ",(0,r.kt)("a",{parentName:"p",href:"/docs/learn/quickstarts/network/local-no-docker"},"Local - No Docker")," or the\n",(0,r.kt)("a",{parentName:"p",href:"/docs/learn/quickstarts/network/hosted"},'"host it anywhere" quickstart')," quickstarts, you would have sourced the",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"ziti-cli-function.sh")," helper script. If not, you can add the function to your shell or inspect the function and\nreplicate the output it produces. Find the function here: ",(0,r.kt)("a",{parentName:"p",href:"https://get.openziti.io/ziti-cli-functions.sh"},"https://get.openziti.io/ziti-cli-functions.sh")),(0,r.kt)("p",null,"As with any script hosted on the internet, you are encouraged to download or preview the script from a browser\nbefore sourcing it. Once you are comfortable with the script, you can source it directly if you wish by running:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'source /dev/stdin <<< "$(wget -qO- https://get.openziti.io/ziti-cli-functions.sh)"\n')),(0,r.kt)("p",null,"You should also ensure you have the appropriate environment variable (",(0,r.kt)("inlineCode",{parentName:"p"},"$ZITI_HOME"),") in your shell before running\nthe function as it's used when creating the file or you'll see:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"  * ERROR: ZITI_HOME is not set\n")),(0,r.kt)("p",null,"Also, if ",(0,r.kt)("inlineCode",{parentName:"p"},"node")," is not on the path you'll see:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"ERROR: missing executable 'node'\n")),(0,r.kt)("p",null,"You can file: ",(0,r.kt)("inlineCode",{parentName:"p"},"createBrowZerSystemdFile"),". Execute this now and you'll see something like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Ziti BrowZer Bootstrapper systemd file written to: /home/ubuntu/.ziti/quickstart/ip-172-31-47-200/browzer-bootstrapper.service\n")),(0,r.kt)("p",null,"Once created, you can copy that file and ",(0,r.kt)("inlineCode",{parentName:"p"},"enable")," the unit with systemd:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'createBrowZerSystemdFile\nsudo cp "${ZITI_HOME}/browzer-bootstrapper.service" /etc/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable --now browzer-bootstrapper\n')),(0,r.kt)(a.Z,{mdxType:"Details"},(0,r.kt)("summary",null,"Verify BrowZer Started"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"systemctl status browzer-bootstrapper --no-pager --lines 0\n")),(0,r.kt)(a.Z,{mdxType:"Details"},(0,r.kt)("summary",null,"Example systemctl Output"),(0,r.kt)("p",null,'You should see output that looks similar to this. Notice the "Active" status is (running) and not failed/restarting etc:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"\u25cf browzer-bootstrapper.service - A systemd unit file for the Ziti BrowZer Bootstrapper\n     Loaded: loaded (/etc/systemd/system/browzer-bootstrapper.service; enabled; vendor preset: enabled)\n     Active: active (running) since Fri 2023-08-18 12:52:54 UTC; 1min 24s ago\n   Main PID: 54770 (node)\n      Tasks: 11 (limit: 2316)\n     Memory: 42.9M\n        CPU: 2.269s\n     CGroup: /system.slice/browzer-bootstrapper.service\n             \u2514\u250054770 /usr/local/bin/node /home/ubuntu/.ziti/quickstart/ip-172-31-47-200/ziti-browzer-bootstra\u2026\n")))))}h.isMDXComponent=!0}}]);