"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[9071],{75637:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"learn/core-concepts/security/sessions","title":"Session Types","description":"Ziti has API Session and Session types.","source":"@site/docs/learn/core-concepts/security/sessions.md","sourceDirName":"learn/core-concepts/security","slug":"/learn/core-concepts/security/sessions","permalink":"/docs/learn/core-concepts/security/sessions","draft":false,"unlisted":false,"editUrl":"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/learn/core-concepts/security/sessions.md","tags":[],"version":"current","lastUpdatedAt":1754933799000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Enrollment","permalink":"/docs/learn/core-concepts/security/enrollment"},"next":{"title":"PKI","permalink":"/docs/learn/core-concepts/pki"}}');var t=i(74848),a=i(28453);const r={},o="Session Types",c={},l=[{value:"API Session",id:"api-session",level:2},{value:"Full vs Partial Authentication",id:"full-vs-partial-authentication",level:4},{value:"Authentication Queries",id:"authentication-queries",level:5},{value:"Associated Data &amp; Removal",id:"associated-data--removal",level:4},{value:"Timeout",id:"timeout",level:4},{value:"Administrative Removal",id:"administrative-removal",level:4},{value:"Client Removal (Logout)",id:"client-removal-logout",level:4},{value:"Session",id:"session",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h4:"h4",h5:"h5",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"session-types",children:"Session Types"})}),"\n",(0,t.jsx)(n.p,{children:"Ziti has API Session and Session types."}),"\n",(0,t.jsx)(n.h2,{id:"api-session",children:"API Session"}),"\n",(0,t.jsx)(n.p,{children:"API Sessions represent a client that is either partially or fully authenticated as a specific identity.\nThey are used to:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["scope ",(0,t.jsx)(n.a,{href:"/docs/learn/core-concepts/security/authentication/auth",children:"authentication"})," and ",(0,t.jsx)(n.a,{href:"authorization/posture-checks",children:"Posture Data"})]}),"\n",(0,t.jsxs)(n.li,{children:["to make ",(0,t.jsx)(n.a,{href:"/docs/learn/core-concepts/security/authorization/auth",children:"authorization"})," decisions."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Clients interact with API Sessions via an opaque security token value and is received during authentication via ",(0,t.jsx)(n.code,{children:"/edge/client|management/v1/authenticate"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["API Sessions are represented by opaque strings and are provided in the HTTP header ",(0,t.jsx)(n.code,{children:"zt-session"})," and in Edge Router\nconnection requests initiated by Ziti SDKs. API Sessions remain valid as long they have not timed out."]}),"\n",(0,t.jsx)(n.p,{children:"An API Sessions:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["can and are represented by a JSON data structure returned from the client and management APIs","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["returned from:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"POST /edge/management/v1/authenticate"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"GET /edge/management/v1/current-api-session"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"POST /edge/client/v1/authenticate"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"GET /edge/client/v1/current-api-session"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["can be referenced by an internal ",(0,t.jsx)(n.code,{children:"id"})," and a security token that is in the format of a UUID","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["the ",(0,t.jsx)(n.code,{children:"id"})," can be used on the following endpoints:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"GET /edge/management/v1/api-sessions/<id>"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"DELETE /edge/management/v1/api-sessions/<id>"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["API Sessions are defined in the client and management Open API 2.0 specifications under ",(0,t.jsx)(n.code,{children:"currentApiSessionDetail"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Example ",(0,t.jsx)(n.code,{children:"POST /edge/management/v1/authenticate"})," response:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'{\n  "data": {\n    "_links": {\n      "self": {\n        "href": "./api-sessions/cl4zptpgqcrinn0hhgm7ek5ve"\n      },\n      "sessions": {\n        "href": "./api-sessions/cl4zptpgqcrinn0hhgm7ek5ve/sessions"\n      }\n    },\n    "createdAt": "2022-06-29T14:51:07.946Z",\n    "id": "cl4zptpgqcrinn0hhgm7ek5ve",\n    "tags": {},\n    "updatedAt": "2022-06-29T14:51:07.946Z",\n    "authQueries": [\n      {\n        "format": "alphaNumeric",\n        "httpMethod": "POST",\n        "httpUrl": "./authenticate/mfa",\n        "maxLength": 6,\n        "minLength": 4,\n        "provider": "ziti",\n        "typeId": "MFA"\n      }\n    ],\n    "authenticatorId": "vxtlfvUj6",\n    "cachedLastActivityAt": "2022-06-29T14:51:07.945Z",\n    "configTypes": [],\n    "identity": {\n      "_links": {\n        "auth-policies": {\n          "href": "./auth-policies/default"\n        },\n        "authenticators": {\n          "href": "./identities/vxtlfvUj6/authenticators"\n        },\n        "edge-router-policies": {\n          "href": "./identities/vxtlfvUj6/edge-routers"\n        },\n        "enrollments": {\n          "href": "./identities/vxtlfvUj6/enrollments"\n        },\n        "failed-service-requests": {\n          "href": "./identities/vxtlfvUj6/failed-service-requests"\n        },\n        "posture-data": {\n          "href": "./identities/vxtlfvUj6/posture-data"\n        },\n        "self": {\n          "href": "./identities/vxtlfvUj6"\n        },\n        "service-policies": {\n          "href": "./identities/vxtlfvUj6/service-policies"\n        }\n      },\n      "entity": "identities",\n      "id": "vxtlfvUj6",\n      "name": "Default Admin"\n    },\n    "identityId": "vxtlfvUj6",\n    "ipAddress": "127.0.0.1",\n    "isMfaComplete": false,\n    "isMfaRequired": true,\n    "lastActivityAt": "2022-06-29T14:51:07.945Z",\n    "token": "44a20395-1a0e-469d-ad9b-80df8dbbf8c4",\n    "expirationSeconds": 1800,\n    "expiresAt": "2022-06-29T15:21:07.945Z"\n  },\n  "meta": {}\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"full-vs-partial-authentication",children:"Full vs Partial Authentication"}),"\n",(0,t.jsx)(n.p,{children:"API Sessions may exist in two states:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Partially Authenticated - limited API access"}),"\n",(0,t.jsx)(n.li,{children:"Fully Authenticated - full API access"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Partial authentication occurs when a primary authentication method has been passed, but secondary Authentication Queries\nremain outstanding. Ziti Edge models MFA challenges as Authentication Queries. Authentication Queries include information\nthat can be used to display user prompts or direct users to integrating websites for SSO. If no outstanding\nAuthentication Queries are present for an API Session it is considered fully authenticated."}),"\n",(0,t.jsx)(n.p,{children:"While partially authenticated, the API Session can only be used for a reduced set of operations:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"answering Authentication Queries"}),"\n",(0,t.jsx)(n.li,{children:"enrolling in MFA TOTP"}),"\n"]}),"\n",(0,t.jsx)(n.h5,{id:"authentication-queries",children:"Authentication Queries"}),"\n",(0,t.jsxs)(n.p,{children:["Authentication Queries are represented on an API Session the property ",(0,t.jsx)(n.code,{children:"authQueries"})," which is an array. An example\nMFA challenge represented as an Authentication Query is provided below."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'{\n  "authQueries": [\n    {\n      "format": "alphaNumeric",\n      "httpMethod": "POST",\n      "httpUrl": "./authenticate/mfa",\n      "maxLength": 6,\n      "minLength": 4,\n      "provider": "ziti",\n      "typeId": "MFA"\n    }\n  ]\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The existence of any Authentication Query on an API Session represents a partial authentication state. API Sessions\nin this state will have reduced access to their target API. The data structure for Authentication Queries is defined\nin the client and management Open API 2.0 specifications under the label ",(0,t.jsx)(n.code,{children:"authQueryDetail"}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"associated-data--removal",children:"Associated Data & Removal"}),"\n",(0,t.jsxs)(n.p,{children:["API Sessions, may be used to create ephemeral certificates called ",(0,t.jsx)(n.a,{href:"/docs/learn/core-concepts/security/authentication/api-session-certificates",children:"API Session Certificates"}),"\nand sessions for service access. Additionally, API Sessions are used to scope ",(0,t.jsx)(n.a,{href:"/docs/learn/core-concepts/security/authorization/posture-checks#posture-data",children:"Posture Data"}),".\nWhen an API Session is removed for any reason, all associated data is also removed. As an example, when removing an\nAPI Session used to create a ",(0,t.jsx)(n.a,{href:"#session",children:"Session"})," the ",(0,t.jsx)(n.a,{href:"#session",children:"Session"})," will also be removed. Removing a ",(0,t.jsx)(n.a,{href:"#session",children:"Session"})," will also terminate any\nexisting connections that used the security token associated with that ",(0,t.jsx)(n.a,{href:"#session",children:"Session"})," and prevent it from being used to\nestablish new connections."]}),"\n",(0,t.jsx)(n.p,{children:"Removal of an API Session occurs in the following scenarios:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"timeout"}),"\n",(0,t.jsx)(n.li,{children:"administrative removal"}),"\n",(0,t.jsx)(n.li,{children:"client removal (logout)"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"timeout",children:"Timeout"}),"\n",(0,t.jsx)(n.p,{children:"The controller maintains a last accessed at timestamp for every API Session. This timestamp is used to determine whether\nthe timeout has been reached, signaling an API Session removal. Activities that update the timestamp include:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Any maintained edge router connection"}),"\n",(0,t.jsx)(n.li,{children:"Any valid client or management API interaction"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The API Session timeout defaults to 30 minutes and can be configured in ",(0,t.jsx)(n.code,{children:"edge.api.sessionTimeout"})," in the controller\nconfiguration file."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"edge:\n  api:\n  ...\n    # sessionTimeout - optional, default 30m\n    # The number of minutes before an Edge API session will time out. Timeouts are reset by\n    # API requests and connections that are maintained to Edge Routers\n    sessionTimeout: 30m\n    ...\n"})}),"\n",(0,t.jsx)(n.h4,{id:"administrative-removal",children:"Administrative Removal"}),"\n",(0,t.jsxs)(n.p,{children:["Through the ",(0,t.jsx)(n.a,{href:"/docs/reference/developer/api/#edge-management-api",children:"edge management API"})," any API Session may be forcefully removed\nby calling ",(0,t.jsx)(n.code,{children:"DELETE /edge/management/v1/api-sessions<id>"})," with an empty body."]}),"\n",(0,t.jsx)(n.h4,{id:"client-removal-logout",children:"Client Removal (Logout)"}),"\n",(0,t.jsxs)(n.p,{children:["A client may terminate its own API Session at any time by calling: ",(0,t.jsx)(n.code,{children:"DELETE /edge/client/v1/current-api-session"})]}),"\n",(0,t.jsx)(n.h2,{id:"session",children:"Session"}),"\n",(0,t.jsxs)(n.p,{children:["A Session represents access to a specific service for dialing or binding. They are scoped to the\n",(0,t.jsx)(n.a,{href:"#api-session",children:"API Session"})," that was used to create them. They are requested from the\ncontroller by a client through the edge client API. The result of that request is a security token representing\nthe Session and a list of Edge Routers that the client may use to dial or bind the target service through."]}),"\n",(0,t.jsxs)(n.p,{children:["Sessions are removed when the parent ",(0,t.jsx)(n.a,{href:"/docs/learn/core-concepts/security/authentication/auth#api-sessions",children:"API Session"})," is removed,\n",(0,t.jsx)(n.a,{href:"/docs/learn/core-concepts/security/authorization/policies/overview",children:"policies"})," are changed to deny access, or when ",(0,t.jsx)(n.a,{href:"/docs/learn/core-concepts/security/authorization/posture-checks",children:"Posture\nChecks"})," enter an invalid state for the target service."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>o});var s=i(96540);const t={},a=s.createContext(t);function r(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);