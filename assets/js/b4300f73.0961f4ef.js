"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[668],{80235:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"guides/troubleshooting/pki-troubleshooting/troubleshoot-expired-certs","title":"Expired Certs","description":"The following are examples of how an invalid server cert will present itself on a running network. There are certs","source":"@site/docs/guides/troubleshooting/pki-troubleshooting/troubleshoot-expired-certs.md","sourceDirName":"guides/troubleshooting/pki-troubleshooting","slug":"/guides/troubleshooting/pki-troubleshooting/troubleshoot-expired-certs","permalink":"/docs/guides/troubleshooting/pki-troubleshooting/troubleshoot-expired-certs","draft":false,"unlisted":false,"editUrl":"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/guides/troubleshooting/pki-troubleshooting/troubleshoot-expired-certs.md","tags":[],"version":"current","lastUpdatedAt":1747058214000,"frontMatter":{"title":"Expired Certs","id":"troubleshoot-expired-certs"},"sidebar":"docsSidebar","previous":{"title":"Renewed Certs","permalink":"/docs/guides/troubleshooting/pki-troubleshooting/renew-cert"}}');var r=o(74848),n=o(28453);const s={title:"Expired Certs",id:"troubleshoot-expired-certs"},l=void 0,c={},a=[{value:"Behavior",id:"behavior",level:2},{value:"Verification",id:"verification",level:2},{value:"Example Output",id:"example-output",level:3},{value:"Resolution",id:"resolution",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,n.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"The following are examples of how an invalid server cert will present itself on a running network. There are certs\nfor the edge API and the control plane, so it's important to check for both as they will likely share the same expiry\ndate."}),"\n",(0,r.jsx)(t.h2,{id:"behavior",children:"Behavior"}),"\n",(0,r.jsx)(t.p,{children:"An expired cert will manifest behavior in a few expected ways."}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["From an edge client or tunneler, an identity will show as ",(0,r.jsx)(t.code,{children:"unavailable"}),". Reviewing the logs will generally indicate\nsome sort of certificate error. Something along the lines of ",(0,r.jsx)(t.code,{children:"failed to verify certificate"}),", ",(0,r.jsx)(t.code,{children:"certificate has expired"}),",\nor something mentioning an error relating to ",(0,r.jsx)(t.code,{children:"x509"})]}),"\n",(0,r.jsxs)(t.li,{children:["From a browser, if you attempt to access your controller, for example, by visiting\n",(0,r.jsx)(t.code,{children:"https://controller-ip:1234/edge/client/v1/version"})," you may see an indication of a certificate error from the browser.\nUltimately, the controller is not accessible despite being online.\n",(0,r.jsx)(t.img,{alt:"img.png",src:o(21245).A+"",width:"321",height:"380"}),"\n",(0,r.jsx)(t.img,{alt:"img.png",src:o(29414).A+"",width:"543",height:"666"})]}),"\n",(0,r.jsxs)(t.li,{children:["From the ",(0,r.jsx)(t.code,{children:"ziti"})," CLI, if you attempt to log into the controller you will get an error to the effect of\n",(0,r.jsx)(t.code,{children:"certificate is expired or invalid"}),", ",(0,r.jsx)(t.code,{children:"unable to retrieve certificate authority"}),", or ",(0,r.jsx)(t.code,{children:"bad certificate"})]}),"\n",(0,r.jsxs)(t.li,{children:["Viewing the controller logs, you may see errors similar to ",(0,r.jsx)(t.code,{children:"TLS handshake error"}),", ",(0,r.jsx)(t.code,{children:"bad certificate"}),", or\n",(0,r.jsx)(t.code,{children:"certificate failure"}),"."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"verification",children:"Verification"}),"\n",(0,r.jsx)(t.p,{children:"The following commands are useful in viewing the status of the current certs for the control and edge/API planes."}),"\n",(0,r.jsx)(t.p,{children:"Substitute the address and port as necessary."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'# Example for edge/API plane\nopenssl s_client -connect 150.136.141.199:8441 | grep "NotBefore"\n\n# Example for control plane\nopenssl s_client -connect localhost:6262 | grep "NotBefore"\n'})}),"\n",(0,r.jsx)(t.h3,{id:"example-output",children:"Example Output"}),"\n",(0,r.jsx)(t.p,{children:"As shown, the start and end dates for all certificates in the chain will be displayed."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"v:NotBefore: Sep 12 13:36:59 2023 GMT; NotAfter: Sep 11 13:37:55 2024 GMT\nv:NotBefore: Aug 22 13:29:51 2022 GMT; NotAfter: Aug 19 13:30:41 2032 GMT\n"})}),"\n",(0,r.jsx)(t.h2,{id:"resolution",children:"Resolution"}),"\n",(0,r.jsxs)(t.p,{children:["If you determine that your certs have expired. Check out the ",(0,r.jsx)(t.a,{href:"/docs/guides/troubleshooting/pki-troubleshooting/renew-cert",children:"Renew Client/Server Certs"})," guide."]})]})}function h(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},29414:(e,t,o)=>{o.d(t,{A:()=>i});const i=o.p+"assets/images/browser-cert-viewer-invalid-a9c537986010cd5832eaf14a7df7cf1f.png"},21245:(e,t,o)=>{o.d(t,{A:()=>i});const i=o.p+"assets/images/invalid-certificate-67dad26e375ef43274ca871d8bd57333.png"},28453:(e,t,o)=>{o.d(t,{R:()=>s,x:()=>l});var i=o(96540);const r={},n=i.createContext(r);function s(e){const t=i.useContext(n);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(n.Provider,{value:t},e.children)}}}]);