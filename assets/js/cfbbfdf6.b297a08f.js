"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[6610],{4426:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>l,contentTitle:()=>d,default:()=>c,frontMatter:()=>s,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"guides/external-auth/extAuthOidc","title":"Configuring OIDC","description":"click here to see a list of guides to help you configure your selected Identity Provider","source":"@site/docs/guides/external-auth/README.md","sourceDirName":"guides/external-auth","slug":"/guides/external-auth/","permalink":"/docs/guides/external-auth/","draft":false,"unlisted":false,"editUrl":"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/guides/external-auth/README.md","tags":[],"version":"current","lastUpdatedAt":1743027933000,"sidebarPosition":100,"frontMatter":{"id":"extAuthOidc","title":"Configuring OIDC","sidebar_position":100},"sidebar":"docsSidebar","previous":{"title":"Router","permalink":"/docs/guides/deployments/cloud/router"},"next":{"title":"BrowZer","permalink":"/docs/guides/external-auth/browzer"}}');var n=t(74848),o=t(28453);const s={id:"extAuthOidc",title:"Configuring OIDC",sidebar_position:100},d="Configuring for OIDC",l={},h=[{value:"The OIDC Provider Endpoint",id:"the-oidc-provider-endpoint",level:2},{value:"Callback / Redirect URL Configuration",id:"callback--redirect-url-configuration",level:3},{value:"Information from the OIDC Provider",id:"information-from-the-oidc-provider",level:2},{value:"The Authorization Request",id:"the-authorization-request",level:3}];function a(e){const i={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.header,{children:(0,n.jsx)(i.h1,{id:"configuring-for-oidc",children:"Configuring for OIDC"})}),"\n",(0,n.jsx)(i.admonition,{type:"note",children:(0,n.jsx)(i.p,{children:(0,n.jsxs)(i.em,{children:["click here to see a list of guides to help you configure your selected ",(0,n.jsx)(i.a,{href:"/docs/guides/external-auth/identity-providers/",children:"Identity Provider"})]})})}),"\n",(0,n.jsxs)(i.p,{children:["OpenZiti utilizes and implements the ",(0,n.jsx)(i.a,{href:"https://oauth.net/2/pkce/",children:"Authorization Code Flow with PKCE or PKCE flow"}),"\r\nfor authentication. This flow is well-known and numerous excellent resources on the internet explain what PKCE is\r\nand what it entails. The guides here focuses on correctly configuring an OpenZiti\r\n",(0,n.jsx)(i.a,{href:"/docs/learn/core-concepts/security/authentication/external-jwt-signers",children:"external JWT signer"})," for use with an OIDC\r\nprovider."]}),"\n",(0,n.jsx)(i.p,{children:"Correctly configuring an external jwt signer requires the careful attention. The fields below all correspond to fields\r\nwithin the JWT returned from the OIDC provider and must be exactly correct."}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Field"}),(0,n.jsx)(i.th,{children:"Description"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Issuer"})}),(0,n.jsxs)(i.td,{children:["The issuer field is a unique HTTPS URL that identifies the OpenID Provider. It must match the ",(0,n.jsx)(i.code,{children:"iss"})," claim provided in the JWT"]})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Audience"})}),(0,n.jsxs)(i.td,{children:["The audience, specified as the ",(0,n.jsx)(i.code,{children:"aud"})," field in the JWT, used to verify the JWT is intended for the OpenZiti Controller"]})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Claims Property"})}),(0,n.jsx)(i.td,{children:"The property within the JWT returned from the OIDC provider that will map to the external ID field of an identity"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Client ID"})}),(0,n.jsx)(i.td,{children:"The unique value provided by the OIDC provider used to identity the application within the provider to use"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"External Auth URL"})}),(0,n.jsx)(i.td,{children:"For OIDC, this is the same value as the issuer and should be the base url of the OIDC discovery endpoint (.well-known/openid-configuration)"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Scopes"})}),(0,n.jsx)(i.td,{children:"The set of scopes to request when generating the authentication request to the OIDC provider"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"JWKS Endpoint"})}),(0,n.jsxs)(i.td,{children:["A url the OpenZiti Controller can use to retrieve a ",(0,n.jsx)(i.a,{href:"https://en.wikipedia.org/wiki/JSON_Web_Token",children:"JSON Web Key Set"}),", used to verify JWTs"]})]})]})]}),"\n",(0,n.jsx)(i.h2,{id:"the-oidc-provider-endpoint",children:"The OIDC Provider Endpoint"}),"\n",(0,n.jsxs)(i.p,{children:["OIDC Providers will often provide an OIDC discovery endpoint. Generally, this will be a URl accessible at the well-known\r\nlocation ",(0,n.jsx)(i.code,{children:"./.well-known/openid-discovery"})," appended to the OIDC provider issuer URL. For example, if the OIDC provider\r\nis a Keycloak server and the Keycloak server has a realm named ",(0,n.jsx)(i.code,{children:"example"})," the provider will likely be located at\r\n",(0,n.jsx)(i.a,{href:"https://example.keycloak.openziti.io/realms/example",children:"https://example.keycloak.openziti.io/realms/example"}),". The openid discovery endpoint for this server would be\r\nlocated at ",(0,n.jsx)(i.a,{href:"https://example.keycloak.openziti.io/realms/example/.well-known/openid-configuration",children:"https://example.keycloak.openziti.io/realms/example/.well-known/openid-configuration"}),"."]}),"\n",(0,n.jsx)(i.p,{children:"Using the discovery endpoint, gather the following information:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["issuer - use the ",(0,n.jsx)(i.code,{children:"issuer"})," field"]}),"\n",(0,n.jsxs)(i.li,{children:["external auth url - use the ",(0,n.jsx)(i.code,{children:"issuer"})," field"]}),"\n",(0,n.jsxs)(i.li,{children:["jwks endpoint - use the ",(0,n.jsx)(i.code,{children:"jwsk_uri"})," field"]}),"\n"]}),"\n",(0,n.jsx)(i.admonition,{title:"IMPORTANT!",type:"note",children:(0,n.jsxs)(i.p,{children:["The issuer ",(0,n.jsx)(i.strong,{children:"must"})," be exactly correct. It is very easy to add an extra slash ",(0,n.jsx)(i.code,{children:"/"})," at the end of the issuer or remove\r\na ",(0,n.jsx)(i.code,{children:"/"})," when it is required. The issuer must be ",(0,n.jsx)(i.strong,{children:"exactly"})," correct. It is recommended to inspect the oidc discovery\r\nendpoint for the correct values. Copy and paste this value exactly."]})}),"\n",(0,n.jsxs)(i.p,{children:["The ",(0,n.jsx)(i.code,{children:"issuer"})," and ",(0,n.jsx)(i.code,{children:"external auth url"})," are expected to be the same value and should be the same value as\r\nthe OIDC provider URL itself. The ",(0,n.jsx)(i.code,{children:"jwks endpoint"})," (along with the ",(0,n.jsx)(i.code,{children:"issuer"}),") is available from the\r\n",(0,n.jsx)(i.a,{href:"https://openid.net/specs/openid-connect-discovery-1_0.html",children:"oidc discovery endpoint"}),". Remember, when configuring\r\nthe ext-jwt-signer for use with an OIDC flow, the ",(0,n.jsx)(i.code,{children:"issuer"})," and ",(0,n.jsx)(i.code,{children:"external auth url"})," will be the same value."]}),"\n",(0,n.jsx)(i.p,{children:"The remaining fields will need to be returned from the OIDC provider itself and there is no standard way to\r\ndetermine the fields. The values supplied will be driven entirely from the configuration of the OIDC provider."}),"\n",(0,n.jsx)(i.h3,{id:"callback--redirect-url-configuration",children:"Callback / Redirect URL Configuration"}),"\n",(0,n.jsxs)(i.p,{children:["When configuring the OIDC provider, a callback URL is necessary. This URL specifies to the OIDC provider and the\r\nsubsequent clients what URL the OIDC provider will allow redirecting the client to in order to continue the PKCE\r\nflow. Different pieces of the OpenZiti overlay network will require different redirect URLs to be specified. The\r\nOpenZiti tunnelers expect to have ",(0,n.jsx)(i.code,{children:"http://localhost:20314/auth/callback"})," specified as a valid callback URL. Ensure\r\nthe OIDC provider is configured to allow this URL callback."]}),"\n",(0,n.jsx)(i.h2,{id:"information-from-the-oidc-provider",children:"Information from the OIDC Provider"}),"\n",(0,n.jsx)(i.p,{children:"The following fields are obtained directly from the OIDC provider configuration. Every provider provides this\r\ninformation in different ways. See the specific providers list for more information as to configuring a specific\r\nprovider. The following fields are obtained from the OIDC provider:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"client id"}),"\n",(0,n.jsx)(i.li,{children:"scopes"}),"\n",(0,n.jsx)(i.li,{children:"audience"}),"\n",(0,n.jsx)(i.li,{children:"claims property"}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"the-authorization-request",children:"The Authorization Request"}),"\n",(0,n.jsxs)(i.p,{children:["The ",(0,n.jsx)(i.code,{children:"client_id"})," is a unique id assigned by the OIDC provider for a given application. This id will be sent to\r\nclients and used when initiating the PKCE flow, It is public and not considered a secret. It is used by the OIDC\r\nprovider to locate the proper application within the provider in order to generate a correct security token."]}),"\n",(0,n.jsxs)(i.p,{children:["The ",(0,n.jsx)(i.code,{children:"scopes"})," field is also used during the authorization request. The ",(0,n.jsx)(i.code,{children:"openid"})," scope will be applied to all\r\nauthorization requests. However, if the OIDC provider supports additional scopes, they may be requested by adding to\r\nthe ",(0,n.jsx)(i.code,{children:"scopes"})," field. For example, if the OIDC provider allows ",(0,n.jsx)(i.a,{href:"https://oauth.net/2/grant-types/refresh-token/",children:"refresh tokens"}),",\r\nthe ",(0,n.jsx)(i.code,{children:"offline_access"}),"scope could be configured. Some OIDC providers will also require additional ",(0,n.jsx)(i.code,{children:"scopes"})," to be\r\nrequested in order to generate a token with the expected fields within it."]}),"\n",(0,n.jsxs)(i.p,{children:["The ",(0,n.jsx)(i.code,{children:"claims property"})," defines the field contained within the security token\r\ngenerated by the OIDC provider that the OpenZiti Controller will use to match a particular token with an identity\r\nconfigured in the OpenZiti overlay. As such, it's often necessary to add other scopes to the authorization request.\r\nFor example, if the user's email address is expected to be the field contained within the security token, some OIDC\r\nproviders will require various scopes to be requested during the authorization request such as: ",(0,n.jsx)(i.code,{children:"profile"}),", ",(0,n.jsx)(i.code,{children:"email"}),",\r\n",(0,n.jsx)(i.code,{children:"user:email"})," etc. Some OIDC providers may not require additional scopes be requested and may simply allow the OIDC\r\nprovider to be configured to always return the email address."]}),"\n",(0,n.jsxs)(i.p,{children:["The ",(0,n.jsx)(i.code,{children:"audience"})," field is used when making an authorization request to the OIDC provider and is also used by the\r\nOpenZiti Controller to validate the token presented during authentication is intended for the OpenZiti controller.\r\nThe audience ",(0,n.jsx)(i.strong,{children:"must"})," be included in the token and the value of the token must match this field exactly. This field\r\ncannot be empty or validation of the security token will never succeed. Some OIDC providers will also require this field\r\nbe specified in the authorization request in order to generate a security token at all."]})]})}function c(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(a,{...e})}):a(e)}},28453:(e,i,t)=>{t.d(i,{R:()=>s,x:()=>d});var r=t(96540);const n={},o=r.createContext(n);function s(e){const i=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function d(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),r.createElement(o.Provider,{value:i},e.children)}}}]);