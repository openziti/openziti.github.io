"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[8391],{36949:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"learn/core-concepts/security/authorization/posture-checks","title":"Posture Checks","description":"Posture Checks represent environmental state (posture) that an endpoint must be in, in order for a Service Policy to","source":"@site/docs/learn/core-concepts/security/authorization/posture-checks.md","sourceDirName":"learn/core-concepts/security/authorization","slug":"/learn/core-concepts/security/authorization/posture-checks","permalink":"/docs/learn/core-concepts/security/authorization/posture-checks","draft":false,"unlisted":false,"editUrl":"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/learn/core-concepts/security/authorization/posture-checks.md","tags":[],"version":"current","lastUpdatedAt":1743527291000,"frontMatter":{"uid":"zitiSecurityPostureChecks"},"sidebar":"docsSidebar","previous":{"title":"creating-service-policies","permalink":"/docs/learn/core-concepts/security/authorization/policies/creating-service-policies"},"next":{"title":"Session Diagram","permalink":"/docs/learn/core-concepts/security/SessionsAndConnections"}}');var t=i(74848),r=i(28453);const a={uid:"zitiSecurityPostureChecks"},c="Posture Checks",o={},d=[{value:"Posture Data",id:"posture-data",level:2},{value:"Evaluation",id:"evaluation",level:2},{value:"Access",id:"access",level:2},{value:"Associating",id:"associating",level:2},{value:"Types",id:"types",level:2},{value:"Operating System",id:"os-os-version",level:3},{value:"Semver Examples",id:"semver-examples",level:3},{value:"Creating",id:"creating",level:3},{value:"Ziti CLI",id:"ziti-cli",level:4},{value:"Edge Management API",id:"edge-management-api",level:4},{value:"MAC Address",id:"mac-address",level:2},{value:"Creating",id:"creating-1",level:3},{value:"Ziti CLI",id:"ziti-cli-1",level:4},{value:"Edge Management API",id:"edge-management-api-1",level:4},{value:"MFA",id:"mfa",level:2},{value:"Creating",id:"creating-2",level:3},{value:"Ziti CLI",id:"ziti-cli-2",level:4},{value:"Edge Management API",id:"edge-management-api-2",level:4},{value:"Multi Process",id:"multi-process",level:2},{value:"Creating",id:"creating-3",level:3},{value:"Ziti CLI",id:"ziti-cli-3",level:4},{value:"Edge Management API",id:"edge-management-api-3",level:4},{value:"Windows Domain",id:"windows-domain",level:2},{value:"Creating",id:"creating-4",level:3},{value:"Ziti CLI",id:"ziti-cli-4",level:4},{value:"Edge Management API",id:"edge-management-api-4",level:4},{value:"Viewing Identity Posture Data",id:"viewing-identity-posture-data",level:2},{value:"Request",id:"request",level:4},{value:"Response",id:"response",level:4},{value:"Viewing Failed Service Requests",id:"viewing-failed-service-requests",level:2},{value:"Request",id:"request-1",level:4},{value:"Response",id:"response-1",level:4}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"posture-checks",children:"Posture Checks"})}),"\n",(0,t.jsx)(n.p,{children:"Posture Checks represent environmental state (posture) that an endpoint must be in, in order for a Service Policy to\ngrant access to a service as either a client or host. Posture Checks are defined separately from Service Policies and\nassigned to them via attributes on the Posture Checks and attribute selectors on the Service Policy."}),"\n",(0,t.jsx)(n.h2,{id:"posture-data",children:"Posture Data"}),"\n",(0,t.jsx)(n.p,{children:"Environmental state is saved as Posture Data - a set of values describing environmental state. Posture Data is provided\nto the controller via Posture Response sent from the client. Posture Responses are constructed from Posture Queries\nwhich are reported to the client per service from the controller."}),"\n",(0,t.jsx)(n.mermaid,{value:"sequenceDiagram\n    Client->>+Controller: ListServices()\n    Controller->>-Client: []Services\n    Client->>+Client: Create []PostureResponses\n    Client->>+Controller: Submit([]PostureResponses)\n    Controller->>-Controller: ValidatePosture()"}),"\n",(0,t.jsx)(n.h2,{id:"evaluation",children:"Evaluation"}),"\n",(0,t.jsxs)(n.p,{children:["Posture Checks are event based and are evaluated as events are encountered. Once evaluated failure states begin\nto restrict access as Service Policies being to fail their associated Posture Checks. One exception to this\nis the ",(0,t.jsx)(n.a,{href:"#mfa",children:"MFA Posture Check"})," which has grace periods for some scenarios."]}),"\n",(0,t.jsx)(n.h2,{id:"access",children:"Access"}),"\n",(0,t.jsx)(n.p,{children:"A single Service may be granted to a client through multiple Service Policies. Only one of those policies needs to be\nin a passing state for access to be granted. For example creating two Service Policies, one with Posture Checks and\none without, to the same service and client will result in the client always having access. This is because one\nService Policy lacking Posture Checks will always result as passing."}),"\n",(0,t.jsx)(n.h2,{id:"associating",children:"Associating"}),"\n",(0,t.jsxs)(n.p,{children:["Posture Checks are associated to ",(0,t.jsx)(n.a,{href:"/docs/learn/core-concepts/security/authorization/policies/overview",children:"Service Policies"})," through\n",(0,t.jsx)(n.a,{href:"/docs/learn/core-concepts/security/authorization/policies/overview#roles-and-role-attributes",children:"Roles and Role Attributes"}),". Attributes on each Posture Check created\nwill be selected for on Service Policies via the ",(0,t.jsx)(n.code,{children:"postureCheckRoles"})," as an array of selected roles. Service Policies are\nassociated to Identities in the same fashion via ",(0,t.jsx)(n.code,{children:"identityRoles"})," and the attributes on Identities."]}),"\n",(0,t.jsx)(n.h2,{id:"types",children:"Types"}),"\n",(0,t.jsx)(n.p,{children:"The following Posture Check types are currently defined:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#os-os-version",children:"OS / OS Version"})," - requires a specific operating system and optionally a specific version or versions"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#mac-address",children:"MAC Address"})," - requires the client has a specific MAC address associated with its hardware"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#mfa",children:"MFA"})," - requires the client currently has MFA TOTP enabled"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#multi-process",children:"Multi Process"})," - requires a client be running one or more applications"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#windows-domain",children:"Windows Domain"})," - requires the client be a member of a specific domain"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"os-os-version",children:"Operating System"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"OS"})," Posture Check type is used to verify a client's operating system and optionally version"]}),"\n",(0,t.jsx)(n.p,{children:"Supported OS Types"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Windows"}),"\n",(0,t.jsx)(n.li,{children:"Windows Server"}),"\n",(0,t.jsx)(n.li,{children:"Linux"}),"\n",(0,t.jsx)(n.li,{children:"MacOS"}),"\n",(0,t.jsx)(n.li,{children:"iOS"}),"\n",(0,t.jsx)(n.li,{children:"Android"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Versions may be validated with any valid ",(0,t.jsx)(n.a,{href:"https://semver.org/",children:"Semver 2.0"})," statement. This includes the ability to\nspecify ranges by major, minor, and patch levels. Operating systems that do not have an explicit patch level, their\nbuild number will be used instead."]}),"\n",(0,t.jsx)(n.h3,{id:"semver-examples",children:"Semver Examples"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:">=1.2.7 <1.3.0"})," would match the versions 1.2.7, 1.2.8, and 1.2.99, but not the versions 1.2.6, 1.3.0, or 1.1.0"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:">=1.2.7"})," would match the versions 1.2.7, 1.2.8, 2.5.3, and 1.3.9, but not the versions 1.2.6 or 1.1.0"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"1.2.7 || >=1.2.9 <2.0.0"})," would match the versions 1.2.7, 1.2.9, and 1.4.6, but not the versions 1.2.8 or 2.0.0"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"creating",children:"Creating"}),"\n",(0,t.jsx)(n.h4,{id:"ziti-cli",children:"Ziti CLI"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:' ziti edge create posture-check os windows-and-android -o "WINDOWS:>10.0.0,ANDROID:>6.0.0" -a check-attribute1'})}),"\n",(0,t.jsx)(n.h4,{id:"edge-management-api",children:"Edge Management API"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"POST /edge/management/v1/posture-checks"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'{\n  "typeId": "OS",\n  "name": "windows-and-android",\n  "operatingSystems": [\n    {\n      "type": "WINDOWS",\n      "versions": [">10.0.0"]\n      \n    },\n    {\n      "type": "ANDROID",\n      "versions": [">6.0.0"]\n    }\n  ],\n  "attributes": ["check-attribute1"]\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"mac-address",children:"MAC Address"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"MAC"})," Posture Check type is used to verify a client's network interface cards MAC addresses. MAC Addresses\nthat are not specified will fail the check."]}),"\n",(0,t.jsx)(n.h3,{id:"creating-1",children:"Creating"}),"\n",(0,t.jsx)(n.h4,{id:"ziti-cli-1",children:"Ziti CLI"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:'ziti edge create posture-check mac mac-lsit =m "14-B2-2C-E5-F0-61" -m "D5-22-E8-B7-FF-48" -m "..."  -a check-attribute1'})}),"\n",(0,t.jsx)(n.h4,{id:"edge-management-api-1",children:"Edge Management API"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"POST /edge/management/v1/posture-checks"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'{\n  "typeId": "MAC",\n  "name": "mac-list",\n  "macAddresses": ["14-B2-2C-E5-F0-61", "D5-22-E8-B7-FF-48", "..."],\n  "attributes": ["check-attribute1"]\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"mfa",children:"MFA"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"MFA"})," Posture Check type is used to enforce ",(0,t.jsx)(n.a,{href:"/docs/learn/core-concepts/security/authentication/totp",children:"MFA TOTP"})," configuration on a client. Posture\nChecks enforce access authorization. For authentication enforcement, see\n",(0,t.jsx)(n.a,{href:"/docs/learn/core-concepts/security/authentication/authentication-policies#secondary",children:"Authentication Policies"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"creating-2",children:"Creating"}),"\n",(0,t.jsx)(n.p,{children:"MFA Posture Checks also support forcing a client to re-submit a valid TOTP on timeout, after locking/unlocking a\ndevice, or waking a device from sleep."}),"\n",(0,t.jsxs)(n.p,{children:["Timeouts are set through the ",(0,t.jsx)(n.code,{children:"timeoutSeconds"})," property. Where values ",(0,t.jsx)(n.code,{children:"0"})," and ",(0,t.jsx)(n.code,{children:"-1"})," represent no timeout."]}),"\n",(0,t.jsxs)(n.p,{children:["Forcing submission on lock/unlock is set through ",(0,t.jsx)(n.code,{children:"promptOnUnlock"})," as ",(0,t.jsx)(n.code,{children:"true"})," or ",(0,t.jsx)(n.code,{children:"false"}),". After an unlock event the client\nis given a five-minute grace period before the posture check begins to fail."]}),"\n",(0,t.jsxs)(n.p,{children:["Forcing submission on wake is set through ",(0,t.jsx)(n.code,{children:"promptOnWake"})," as ",(0,t.jsx)(n.code,{children:"true"})," or ",(0,t.jsx)(n.code,{children:"false"}),". After a wake event the client\nis given a five-minute grace period before the posture check begins to fail."]}),"\n",(0,t.jsx)(n.h4,{id:"ziti-cli-2",children:"Ziti CLI"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"ziti edge create posture-check mfa my-mfa-check -s 3600 -w -u -a check-attribute1"})}),"\n",(0,t.jsx)(n.h4,{id:"edge-management-api-2",children:"Edge Management API"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"POST /edge/management/v1/posture-checks"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'{\n  "typeId": "MFA",\n  "timeoutSeconds": 3600,\n  "promptOnWake": false,\n  "promptOnUnlock": false,\n  "attributes": ["check-attribute1"]\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"multi-process",children:"Multi Process"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"MULTI_PROCESS"})," Posture Check is used to verify that one or more programs are running on the client. It can\noptionally check sha256 hash as well as digital signers on Window."]}),"\n",(0,t.jsx)(n.h3,{id:"creating-3",children:"Creating"}),"\n",(0,t.jsxs)(n.p,{children:["Multi Process Posture Checks allow multiple processes to be defined which either all of must be running or one of must\nbe running. The ",(0,t.jsx)(n.code,{children:"semantic"})," of the check determines how the processes are evaluated. ",(0,t.jsx)(n.code,{children:"AllOf"})," requires that all\nprocesses define in the check must be running. ",(0,t.jsx)(n.code,{children:"OneOf"})," requires only one of the processes to be valid."]}),"\n",(0,t.jsxs)(n.p,{children:["All processes are checked to be running from the binary provided in the ",(0,t.jsx)(n.code,{children:"path"})," setting."]}),"\n",(0,t.jsxs)(n.p,{children:["Valid sha256 hashes of a binary may be provided in the ",(0,t.jsx)(n.code,{children:"hashes"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["If the file is digital signed (Windows only) the ",(0,t.jsx)(n.code,{children:"signerFingerprints"})," may be provided. Signer fingerprints are the\nsha1 fingerprints (thumbprints) of valid signing certificates."]}),"\n",(0,t.jsx)(n.h4,{id:"ziti-cli-3",children:"Ziti CLI"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:'ziti edge create posture-check process-multi my-proc-multi AnyOf "Windows,Linux", "C:\\\\program1.exe,/usr/local/program1" -a check-attribute1'})}),"\n",(0,t.jsx)(n.h4,{id:"edge-management-api-3",children:"Edge Management API"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"POST /edge/management/v1/posture-checks"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'{\n  "typeId": "PROCESS_MULTI",\n  "name": "my-proc-multi",\n  "semantic": "OneOf",\n  "processes": [\n    {\n      "os": "WINDOWS",\n      "path": "C:\\\\program1.exe",\n      "hashes": ["421c76d77563afa1914846b010bd164f395bd34c2102e5e99e0cb9cf173c1d87"],\n      "signerFingerprints": ["79437f5edda13f9c0669b978dd7a9066dd2059f1"]\n    },\n    {\n      "os": "LINUX",\n      "path": "/usr/local/program1",\n      "hashes": ["b16d66911a4657945bf1929bc1a9d743168b819d9b19d1519eb29ffb3db140a4"],\n      "signerFingerprints": ["882106ca75dc47a5ffd055e640b30c2e01789521"]\n    }\n  ],\n  "attributes": ["check-attribute1"]\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"windows-domain",children:"Windows Domain"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"DOMAIN"})," Posture Check is used to verify that a Windows client has joined a specific Windows Domain."]}),"\n",(0,t.jsx)(n.h3,{id:"creating-4",children:"Creating"}),"\n",(0,t.jsx)(n.h4,{id:"ziti-cli-4",children:"Ziti CLI"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:'ziti edge create posture-check domain domain-list -d domain1 -d "domain2"  -a check-attribute1'})}),"\n",(0,t.jsx)(n.h4,{id:"edge-management-api-4",children:"Edge Management API"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"POST /edge/management/v1/posture-checks"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'{\n  "typeId": "DOMAIN",\n  "name": "domain-list",\n  "macAddresses": ["domain1", "domain2"],\n  "attributes": ["check-attribute1"]\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"viewing-identity-posture-data",children:"Viewing Identity Posture Data"}),"\n",(0,t.jsx)(n.p,{children:"For troubleshooting purposes it is possible to view an identity's current Posture Data."}),"\n",(0,t.jsx)(n.h4,{id:"request",children:"Request"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"GET /edge/management/v1/identities/<id>/posture-data"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"<empty body>\n"})}),"\n",(0,t.jsx)(n.h4,{id:"response",children:"Response"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'{\n  "data": {\n    "apiSessionPostureData": {},\n    "domain": {\n      "lastUpdatedAt": "2022-08-03T11:03:29.451Z",\n      "postureCheckId": "-GIxFATMg",\n      "timedOut": false,\n      "domain": "MYDOMAIN"\n    },\n    "mac": {\n      "lastUpdatedAt": null,\n      "postureCheckId": "",\n      "timedOut": false,\n      "addresses": null\n    },\n    "os": {\n      "lastUpdatedAt": "2022-08-03T11:03:29.375Z",\n      "postureCheckId": "OZimG0oGR",\n      "timedOut": false,\n      "build": null,\n      "type": "windows",\n      "version": "10.0.19044"\n    },\n    "processes": [\n      {\n        "lastUpdatedAt": "2022-08-03T11:03:49.803Z",\n        "postureCheckId": "62yttIAeJ",\n        "timedOut": false,\n        "signerFingerprints": []\n      },\n      {\n        "lastUpdatedAt": "2022-08-03T11:03:49.986Z",\n        "postureCheckId": "Gh5DOegtE",\n        "timedOut": false,\n        "signerFingerprints": []\n      }\n    ]\n  },\n  "meta": {}\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"viewing-failed-service-requests",children:"Viewing Failed Service Requests"}),"\n",(0,t.jsx)(n.p,{children:"For troubleshooting purposes it is possible to view the last fifty failed service requests due to Posture Check failure."}),"\n",(0,t.jsx)(n.h4,{id:"request-1",children:"Request"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"GET /edge/management/v1/identities/<id>/failed-service-requests"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"<empty body>\n"})}),"\n",(0,t.jsx)(n.h4,{id:"response-1",children:"Response"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'{\n  "meta": {},\n  "data": [\n    {\n      "apiSessionId": "ckytwv9811tqz15mzoyfi1uvb",\n      "policyFailures": [\n        {\n          "policyId": "Nk43EwJKE",\n          "policyName": "TestPolicy1",\n          "checks": [\n            {\n              "actualValue": {\n                "passedMfa": false,\n                "passedOnUnlock": false\n              },\n              "expectedValue": {\n                "passedMfa": true,\n                "passedOnWake": true\n              },\n              "postureCheckId": "5Ucbw.tjo0",\n              "postureCheckName": "TestCheck1",\n              "postureCheckType": "MFA"\n            }\n          ]\n        }\n      ],\n      "serviceId": "iGoRLhrx0",\n      "serviceName": "TestService1",\n      "sessionType": "Dial",\n      "when": "2022-01-25T10:18:45.257Z"\n    }\n  ]\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>c});var s=i(96540);const t={},r=s.createContext(t);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);