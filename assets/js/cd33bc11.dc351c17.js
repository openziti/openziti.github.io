"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[11187],{71351:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var s=n(13126),r=n(74848),t=n(28453);const i={title:"The NodeJS zrok SDK",seoTitle:"The NodeJS zrok SDK",date:new Date("2024-05-06T20:51:11.000Z"),cuid:"clvvfsgjz00040ak37yl2b0xf",slug:"the-nodejs-zrok-sdk",authors:["CurtTudor"],image:"@site/blogs/openziti/v1712869619931/10e487f3-ddb6-4d9e-ab48-0774a3bbfb2a.jpeg",imageDark:"@site/blogs/openziti/v1712869619931/10e487f3-ddb6-4d9e-ab48-0774a3bbfb2a.jpeg",tags:["web-development","security","nodejs","zrok"]},a=void 0,l={authorsImageUrls:[void 0]},c=[{value:"Expanding into NodeJS",id:"expanding-into-nodejs",level:2},{value:"Why <strong>Though</strong>?",id:"why-though",level:2},{value:"Coming Attractions (zrok+BrowZer)",id:"coming-attractions-zrokbrowzer",level:2},{value:"Moving Forward",id:"moving-forward",level:2}];function d(e){const o={a:"a",br:"br",code:"code",em:"em",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.p,{children:["You may be familiar with ",(0,r.jsx)(o.code,{children:"zrok"}),", the open-source solution built on ",(0,r.jsx)(o.a,{href:"https://openziti.io",children:"OpenZiti"}),", which makes it very\neasy to securely share resources over the internet. If you are already a ",(0,r.jsx)(o.code,{children:"zrok"})," fan, that's great news -- Thank you for\nbeing part of our community!"]}),"\n",(0,r.jsxs)(o.p,{children:["If ",(0,r.jsx)(o.code,{children:"zrok"})," is new to you, please check out this post ",(0,r.jsxs)(o.a,{href:"/docs/openziti/blog/introducing-zrok",children:[(0,r.jsx)(o.strong,{children:"introducing"}),(0,r.jsx)(o.code,{children:"zrok"})]}),"."]}),"\n",(0,r.jsxs)(o.p,{children:[(0,r.jsx)(o.code,{children:"zrok"})," is built to enable developers to seamlessly and securely share their applications (we previously released our ",(0,r.jsxs)(o.a,{href:"/docs/openziti/blog/the-zrok-sdk",children:[(0,r.jsx)(o.code,{children:"zrok"})," Golang SDK"]}),", and our ",(0,r.jsxs)(o.a,{href:"./the-python-zrok-sdk",children:[(0,r.jsx)(o.code,{children:"zrok"})," Python SDK"]}),"). Using just a little code enables you to share your app through ",(0,r.jsx)(o.code,{children:"zrok"}),"'s robust network."]}),"\n",(0,r.jsxs)(o.p,{children:["Today we are excited to expand our ",(0,r.jsx)(o.code,{children:"zrok"})," SDK philosophy by introducing a NodeJS SDK (available as of ",(0,r.jsx)(o.code,{children:"zrok"})," ",(0,r.jsx)(o.code,{children:"0.4.30"}),"), and that is what we'll discuss in this article."]}),"\n",(0,r.jsxs)(o.p,{children:["The package is published as ",(0,r.jsx)(o.a,{href:"https://www.npmjs.com/package/@openziti/zrok",children:(0,r.jsx)(o.code,{children:"@openziti/zrok"})})]}),"\n",(0,r.jsxs)(o.p,{children:["We will be spinning up a local HTTP server to be served via ",(0,r.jsx)(o.code,{children:"zrok"}),"!"]}),"\n",(0,r.jsxs)(o.p,{children:["If you want to follow along you'll need to have a ",(0,r.jsx)(o.code,{children:"zrok"})," environment set up. If you don't want to self-host you can sign up for a free account at ",(0,r.jsx)(o.a,{href:"https://zrok.io/",children:(0,r.jsx)(o.strong,{children:"https://zrok.io"})}),"."]}),"\n",(0,r.jsxs)(o.p,{children:["Check out the ",(0,r.jsx)(o.a,{href:"https://docs.zrok.io/docs/getting-started/",children:(0,r.jsx)(o.strong,{children:"Getting Started"})})," guide for more information."]}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.img,{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/d/d9/Node.js_logo.svg/2560px-Node.js_logo.svg.png",alt:"File.js logo.svg - Wikipedia"})}),"\n",(0,r.jsx)(o.h2,{id:"expanding-into-nodejs",children:"Expanding into NodeJS"}),"\n",(0,r.jsxs)(o.p,{children:["Here is all it takes to spin up a ",(0,r.jsx)(o.code,{children:"zrok"}),"-enabled web server using Express:"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-typescript",children:"let root = zrok.Load()\n\nawait zrok.init( root ).catch(( err: Error ) => \n    { console.error(err); return process.exit(1) });\n\nlet shr = await zrok.CreateShare(root, \n    new zrok.ShareRequest(\n        zrok.PROXY_BACKEND_MODE, zrok.PRIVATE_SHARE_MODE, \n        \"http-server\", [\"public\"])\n);\nconsole.log(`access remotely using: 'zrok access private ${shr.Token}'`)\n\nlet app = zrok.express( shr.Token );\n\napp.get('/', function(_: Request, res: any){\n  res.write(`Hello zrok!`)\n  res.end()\n});\n\napp.listen(undefined, () => {\n  console.log(\n    `private HTTP Server is now listening for incoming requests`\n  )\n})\n"})}),"\n",(0,r.jsx)(o.p,{children:"Let's quickly go over what's happening here:"}),"\n",(0,r.jsxs)(o.p,{children:["First, we use the ",(0,r.jsx)(o.code,{children:"zrok"})," object to load the root config and initialize, and then we're off to the races."]}),"\n",(0,r.jsxs)(o.p,{children:["We create a private ",(0,r.jsx)(o.code,{children:"zrok"})," share, and then we call ",(0,r.jsx)(o.code,{children:"zrok.express"})," using the share token we just created."]}),"\n",(0,r.jsxs)(o.p,{children:["This ",(0,r.jsx)(o.code,{children:"zrok.express"})," call spins up a NodeJS Express server, ",(0,r.jsx)(o.em,{children:(0,r.jsx)(o.strong,{children:"however"})}),", the Express server is transparently instrumented by the ",(0,r.jsx)(o.code,{children:"zrok"})," SDK (and its embedded ",(0,r.jsx)(o.a,{href:"./securing-nodejs-applications",children:"Ziti SDK for NodeJS"}),') to enable the Express web server to "bind" (i.e. host) the Ziti Service represented by the ',(0,r.jsx)(o.code,{children:"zrok"})," share."]}),"\n",(0,r.jsxs)(o.p,{children:["In other words, the NodeJS Express web server does ",(0,r.jsx)(o.em,{children:(0,r.jsx)(o.strong,{children:"NOT"})})," listen on an open TCP port as traditional NodeJS Express servers do (",(0,r.jsx)(o.em,{children:"because that's way too insecure"}),")."]}),"\n",(0,r.jsxs)(o.p,{children:["Instead, a ",(0,r.jsx)(o.code,{children:"zrok"}),"-enabled NodeJS Express server listens ",(0,r.jsx)(o.em,{children:(0,r.jsx)(o.strong,{children:"ONLY"})})," for incoming Ziti connections to the private ",(0,r.jsx)(o.code,{children:"zrok"})," share (",(0,r.jsx)(o.em,{children:"because zero-trust connections are now considered best practice, and this is how the most robust security is done these days"}),")."]}),"\n",(0,r.jsxs)(o.p,{children:["The ",(0,r.jsx)(o.code,{children:"SIGINT"})," handler at the end just handles a CTRL-C event, and tears down the ",(0,r.jsx)(o.code,{children:"zrok"})," share."]}),"\n",(0,r.jsxs)(o.p,{children:["The above example employs a ",(0,r.jsx)(o.code,{children:"private"})," share. You can opt to use a ",(0,r.jsx)(o.code,{children:"public"})," share if you like; in that case, you can find it ",(0,r.jsx)(o.a,{href:"./the-zrok-oauth-public-frontend",children:"here"}),"."]}),"\n",(0,r.jsx)(o.p,{children:"To expand this example from here you would simply declare any routes your app wants to expose and it's just like producing a typical Express server. No additional complications!"}),"\n",(0,r.jsxs)(o.h2,{id:"why-though",children:["Why ",(0,r.jsx)(o.strong,{children:"Though"}),"?"]}),"\n",(0,r.jsx)(o.p,{children:"The primary reason is we want this to be easy."}),"\n",(0,r.jsxs)(o.p,{children:["Sharing what you make should be painless. You develop the application -- let ",(0,r.jsx)(o.code,{children:"zrok"})," handle all the security complications."]}),"\n",(0,r.jsxs)(o.p,{children:["Plus you can deploy your application anywhere. As long as the environment can reach the ",(0,r.jsx)(o.code,{children:"zrok"})," host controller, it can run wherever you want it to."]}),"\n",(0,r.jsx)(o.p,{children:"It can live in a container, cloud-hosted, or even run nicely on a home server, or dev laptop."}),"\n",(0,r.jsx)(o.h2,{id:"coming-attractions-zrokbrowzer",children:"Coming Attractions (zrok+BrowZer)"}),"\n",(0,r.jsxs)(o.p,{children:["Since the above example talks about sharing an Express web server over ",(0,r.jsx)(o.code,{children:"zrok"}),", I would be remiss if I didn't mention something exciting we will release soon that will alleviate a few friction points."]}),"\n",(0,r.jsxs)(o.p,{children:["To illustrate, today if you want to spin up a web server on your laptop and then ",(0,r.jsx)(o.a,{href:"https://docs.zrok.io/docs/getting-started/#private-shares",children:"share it privately with someone"}),", the person you are sharing it with will need to:"]}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:["\n",(0,r.jsxs)(o.p,{children:["download the ",(0,r.jsx)(o.code,{children:"zrok"})," binary, then"]}),"\n"]}),"\n",(0,r.jsxs)(o.li,{children:["\n",(0,r.jsxs)(o.p,{children:["execute a specific ",(0,r.jsx)(o.code,{children:"zrok"})," command (which starts a local HTTP listener), then"]}),"\n"]}),"\n",(0,r.jsxs)(o.li,{children:["\n",(0,r.jsxs)(o.p,{children:["point their browser at that HTTP listener (typically running at ",(0,r.jsx)(o.code,{children:"http://127.0.0.1:9191"}),")"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(o.p,{children:"The above technology certainly works in many scenarios, but there are use cases where it may not..."}),"\n",(0,r.jsxs)(o.p,{children:["For example, it's possible that the person you are sharing your local web server with is not tech-savvy (e.g. my grandmother) and they can't successfully obtain and/or run the ",(0,r.jsx)(o.code,{children:"zrok"})," commands on their client."]}),"\n",(0,r.jsx)(o.p,{children:"Another use case is when the remote person can't install new tooling on their machine due to a lack of permission (e.g. IT restrictions). Or they can, but they elect not to."}),"\n",(0,r.jsxs)(o.p,{children:["Another use case is when you want to share your web app with someone who wants to access it on their mobile phone (where ",(0,r.jsx)(o.code,{children:"zrok"})," binaries simply can't be installed)."]}),"\n",(0,r.jsxs)(o.p,{children:["The above use cases could be supported perfectly if only you could share a (",(0,r.jsx)(o.em,{children:"magic"}),") URL with the people you want to share your private web server with. This is because every laptop and mobile phone already has a ubiquitous web browser, so your friends, family, and colleagues already have what they need...except the URL..."]}),"\n",(0,r.jsx)(o.p,{children:'So what\'s this magic URL, and what makes it "magic"?'}),"\n",(0,r.jsxs)(o.p,{children:["The URL you will share with people will resemble this: ",(0,r.jsx)(o.code,{children:"https://<SOME_SHARE_TOKEN>/zrok.browzer.cloudziti.io"})]}),"\n",(0,r.jsxs)(o.p,{children:["(",(0,r.jsx)(o.code,{children:"SOME_SHARE_TOKEN"})," is produced by your ",(0,r.jsx)(o.code,{children:"zrok share private"})," command)"]}),"\n",(0,r.jsxs)(o.p,{children:[(0,r.jsx)(o.a,{href:"/docs/openziti/blog/introducing-openziti-browzer",children:"OpenZiti BrowZer provides the magic"})," that ties everything together. We are currently testing this new ",(0,r.jsx)(o.code,{children:"zrok+BrowZer"})," functionality and we will release it soon."]}),"\n",(0,r.jsx)(o.p,{children:"Once it has been shipped, we will be back here posting articles that discuss all the details, so be sure to subscribe to this blog's newsletter so you don't miss the announcements."}),"\n",(0,r.jsx)(o.h2,{id:"moving-forward",children:"Moving Forward"}),"\n",(0,r.jsxs)(o.p,{children:["Moving forward we want ",(0,r.jsx)(o.code,{children:"zrok"})," to be as accessible as possible, both in options and ease of use. Support for more languages is coming! If you want to talk about languages to support or friction points, please reach out on ",(0,r.jsx)(o.a,{href:"https://openziti.discourse.group/c/zrok/24",children:"Discourse"}),"!"]}),"\n",(0,r.jsxs)(o.p,{children:[(0,r.jsxs)(o.a,{href:"https://openziti.discourse.group/c/zrok/24",children:[(0,r.jsx)(o.br,{}),"\n"]}),"Also if you like ",(0,r.jsx)(o.code,{children:"zrok"})," or OpenZiti and want to support it, we would very much appreciate you dropping a star on both ",(0,r.jsx)(o.a,{href:"https://github.com/openziti/zrok",children:"Github (zrok)"})," / ",(0,r.jsx)(o.a,{href:"https://github.com/openziti/ziti",children:"Github (OpenZiti)"}),"."]}),"\n",(0,r.jsx)(o.p,{children:"It means a lot!"})]})}function h(e={}){const{wrapper:o}={...(0,t.R)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,o,n)=>{n.d(o,{R:()=>i,x:()=>a});var s=n(96540);const r={},t=s.createContext(r);function i(e){const o=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function a(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(t.Provider,{value:o},e.children)}},13126:e=>{e.exports=JSON.parse('{"permalink":"/docs/openziti/blog/the-nodejs-zrok-sdk","source":"@site/blog/the-nodejs-zrok-sdk.md","title":"The NodeJS zrok SDK","description":"You may be familiar with zrok, the open-source solution built on OpenZiti, which makes it very","date":"2024-05-06T20:51:11.000Z","tags":[{"inline":false,"label":"Web Development","permalink":"/docs/openziti/blog/tags/web-development","description":"Web development content"},{"inline":false,"label":"Security","permalink":"/docs/openziti/blog/tags/security","description":"Security-related posts"},{"inline":false,"label":"NodeJS","permalink":"/docs/openziti/blog/tags/nodejs","description":"NodeJS content"},{"inline":false,"label":"zrok","permalink":"/docs/openziti/blog/tags/zrok","description":"zrok related content"}],"readingTime":5.39,"hasTruncateMarker":true,"authors":[{"name":"Curt Tudor","title":"Author","url":"https://github.com/rentallect","imageURL":"https://avatars.githubusercontent.com/rentallect","key":"CurtTudor","page":null}],"frontMatter":{"title":"The NodeJS zrok SDK","seoTitle":"The NodeJS zrok SDK","date":"2024-05-06T20:51:11.000Z","cuid":"clvvfsgjz00040ak37yl2b0xf","slug":"the-nodejs-zrok-sdk","authors":["CurtTudor"],"image":"@site/blogs/openziti/v1712869619931/10e487f3-ddb6-4d9e-ab48-0774a3bbfb2a.jpeg","imageDark":"@site/blogs/openziti/v1712869619931/10e487f3-ddb6-4d9e-ab48-0774a3bbfb2a.jpeg","tags":["web-development","security","nodejs","zrok"]},"unlisted":false,"prevItem":{"title":"Signing Executables From GitHub Actions","permalink":"/docs/openziti/blog/signing-executables-from-github-actions"},"nextItem":{"title":"No Listening Ports?","permalink":"/docs/openziti/blog/no-listening-ports"}}')}}]);