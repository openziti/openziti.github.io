"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[3996],{92675:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"learn/quickstarts/services/kubernetes-service","title":"Kubernetes Service","description":"This is a tutorial for tunneling a Kubernetes workload with OpenZiti.","source":"@site/docs/learn/quickstarts/services/kubernetes-service.md","sourceDirName":"learn/quickstarts/services","slug":"/learn/quickstarts/services/kubernetes-service","permalink":"/docs/learn/quickstarts/services/kubernetes-service","draft":false,"unlisted":false,"editUrl":"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/learn/quickstarts/services/kubernetes-service.md","tags":[],"version":"current","lastUpdatedAt":1747833564000,"frontMatter":{"title":"Kubernetes Service"},"sidebar":"docsSidebar","previous":{"title":"Starting With Services","permalink":"/docs/learn/quickstarts/services/"},"next":{"title":"Your First Service","permalink":"/docs/learn/quickstarts/services/ztha"}}');var s=n(74848),r=n(28453);const l={title:"Kubernetes Service"},o=void 0,c={},a=[{value:"Steps",id:"steps",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"This is a tutorial for tunneling a Kubernetes workload with OpenZiti."}),"\n",(0,s.jsx)(t.h2,{id:"steps",children:"Steps"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Deploy the Hello Toy chart. This provides a simple web server target that's only reachable inside cluster. We'll use OpenZiti to tunnel it to your client outside the cluster."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:'helm install "hello-toy" openziti/hello-toy \\\n    --namespace hello-toy --create-namespace \\\n    --set serviceDomainName=hello\n'})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Ensure you have a OpenZiti router in the cluster with a tunnel binding. You can use this command to find eligible routers."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"ziti edge list edge-routers 'isTunnelerEnabled=true'\n"})}),"\n",(0,s.jsxs)(t.p,{children:["If none of the routers shown are in your cluster, then refer to ",(0,s.jsx)(t.a,{href:"/docs/guides/deployments/kubernetes/kubernetes-router",children:"the router deployment guide"})," for more information on how to deploy a router."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Add a role to the tunneler identity of the router you selected from the list above, e.g. \"router1.\" This step adds a role to the router's identity that we'll use later to grant it permission to bind the service."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:'ziti edge update identity "router1" \\\n    --role-attributes hello-hosts\n'})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Enroll an identity for your client device. Add the identity to any tunneler so you can access ",(0,s.jsx)(t.code,{children:"http://hello.ziti.internal"})," when you finish the steps."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:'ziti edge create identity "hello-client" \\\n    --role-attributes hello-clients \\\n    --jwt-output-file hello-client.jwt\n'})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Create the service."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:'ziti edge create config "hello-intercept-config" intercept.v1 \\\n    \'{"protocols":["tcp"],"addresses":["hello.ziti.internal"], "portRanges":[{"low":80, "high":80}]}\'\n\nziti edge create config "hello-host-config" host.v1 \\\n    \'{"protocol":"tcp", "address":"hello.hello-toy.svc","port":80}\'\n\nziti edge create service "hello-service" \\\n    --configs hello-intercept-config,hello-host-config\n\n'})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Ensure you have router policies for your identities and services."}),"\n",(0,s.jsx)(t.p,{children:"Create a router policy for each if needed."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"ziti edge create edge-router-policy \"default\" \\\n    --edge-router-roles '#all' --identity-roles '#all'\n\nziti edge create service-edge-router-policy \"default\" \\\n    --edge-router-roles '#all' --service-roles '#all'\n"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Create the service policies for the client and host identities."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"ziti edge create service-policy \"hello-dial-policy\" Dial \\\n    --service-roles '@hello-service' --identity-roles '#hello-clients'\n\nziti edge create service-policy \"hello-bind-policy\" Bind \\\n    --service-roles '@hello-service' --identity-roles '#hello-hosts'\n"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Ensure your client identity has dial permission, and the router's identity has bind permission."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"ziti edge policy-advisor services hello-service -q       \n"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-buttonless",metastring:"title=Output",children:"OKAY : router1 (1) -> hello-service (1) Common Routers: (1/1) Dial: N Bind: Y \nOKAY : hello-client (1) -> hello-service (1) Common Routers: (1/1) Dial: Y Bind: N \n"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Visit the Hello Demo page in your browser: ",(0,s.jsx)(t.a,{href:"http://hello.ziti.internal/",children:"http://hello.ziti.internal/"})]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>o});var i=n(96540);const s={},r=i.createContext(s);function l(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);