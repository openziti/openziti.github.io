"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[5394],{46902:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"learn/core-concepts/identities/enrolling","title":"Enrolling","description":"Enrolling an Identity","source":"@site/docs/learn/core-concepts/identities/20-enrolling.md","sourceDirName":"learn/core-concepts/identities","slug":"/learn/core-concepts/identities/enrolling","permalink":"/docs/learn/core-concepts/identities/enrolling","draft":false,"unlisted":false,"editUrl":"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/learn/core-concepts/identities/20-enrolling.md","tags":[],"version":"current","lastUpdatedAt":1751293248000,"sidebarPosition":20,"frontMatter":{"title":"Enrolling"},"sidebar":"docsSidebar","previous":{"title":"Creating","permalink":"/docs/learn/core-concepts/identities/creating"},"next":{"title":"Services","permalink":"/docs/learn/core-concepts/services/overview"}}');var r=n(74848),o=n(28453);const l={title:"Enrolling"},s=void 0,a={},c=[{value:"Enrolling an Identity",id:"enrolling-an-identity",level:2},{value:"Overview",id:"overview",level:3},{value:"One Time Token Enrollment - Internal PKI",id:"one-time-token-enrollment---internal-pki",level:3},{value:"3rd Party CA - One Time Token",id:"3rd-party-ca---one-time-token",level:3},{value:"3rd Party CA - Auto",id:"3rd-party-ca---auto",level:3}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{id:"enrolling-an-identity",children:"Enrolling an Identity"}),"\n",(0,r.jsxs)(t.p,{children:["All connections made to the Ziti network leverage ",(0,r.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Mutual_authentication",children:"mutual TLS"}),'\r\nwhich means every client needs a valid X509 certificate which it will present to the Ziti network during the connection\r\nprocess. The process of obtaining a key/certificate pair and presenting it securely to the controller is called\r\n"Enrollment".']}),"\n",(0,r.jsx)(t.h3,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(t.p,{children:["All identities need to be enrolled with the controller so the controller can authenticate the incoming connection.\r\nThis process is slightly different for each type of identity and is complex. The easiest way to enroll an identity is to\r\nuse either the Ziti Desktop Edge/Ziti Mobile Edge for your operating system. Alternatively, you may perform the enrollment separate\r\nwith the ",(0,r.jsx)(t.code,{children:"ziti"})," CLI which can be downloaded from the ",(0,r.jsx)(t.a,{href:"https://github.com/openziti/ziti/releases/latest",children:"GitHub releases page"})]}),"\n",(0,r.jsx)(t.h3,{id:"one-time-token-enrollment---internal-pki",children:"One Time Token Enrollment - Internal PKI"}),"\n",(0,r.jsxs)(t.p,{children:["Perhaps the easiest path to an enrolled identity is by using the one-time token enrollment flow. This flow leverages the\r\nPKI configured in the controller.  Using the one-time token flow - the ",(0,r.jsx)(t.code,{children:"ziti"})," CLI will generate a private key\r\nand a certificate signing request for the controller's built-in certificate authority to fulfill."]}),"\n",(0,r.jsx)(t.p,{children:"Follow these steps to enroll an identity with a one-time token:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"./creating",children:"create the Identity"})}),"\n",(0,r.jsx)(t.li,{children:"download or copy the JWT - this file contains the single use token"}),"\n",(0,r.jsxs)(t.li,{children:["run the ",(0,r.jsx)(t.code,{children:"ziti"})," CLI:"]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Example Usage:"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"ziti edge enroll \\\r\n    --jwt ${jwt_file} \\\r\n    --out ${identity_config_file}\n"})}),"\n",(0,r.jsx)(t.admonition,{type:"caution",children:(0,r.jsxs)(t.p,{children:["The output from the ",(0,r.jsx)(t.code,{children:"ziti"})," CLI is a permanent identity configuration file which\r\nmust be stored securely. This file contains within it the private key that backs\r\nthe certificate issued by the controller.  This file should not be\r\ntransferred or shared and should not be moved from the machine unless you are\r\nconfident you understand the risks involved in doing so."]})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsxs)(t.strong,{children:["Example Usage for ",(0,r.jsx)(t.code,{children:"ziti-edge-tunnel"})," CLI"]})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"# enroll from a token file\r\n./ziti-edge-tunnel enroll --jwt ./myTunneler.jwt --identity ./myTunneler.json\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"# enroll from stdin\r\n./ziti-edge-tunnel enroll --jwt - --identity ./myTunneler.json < ./myTunneler.jwt\n"})}),"\n",(0,r.jsx)(t.h3,{id:"3rd-party-ca---one-time-token",children:"3rd Party CA - One Time Token"}),"\n",(0,r.jsxs)(t.p,{children:["This flow allows you to pre-create identities for a 3rd party CA with distinct role attributes. This flow is similar to the One Time Token flow from above except that it expects that a private key and certificate have\r\nalready been created on or distributed to the machine that is about to enroll and that the certificate presented is\r\nissued by a validated, ",(0,r.jsx)(t.a,{href:"/docs/learn/core-concepts/pki#third-party-ca-optional",children:"third party CA"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"Follow these steps to enroll a 3rd Party CA - one-time token identity:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"./creating",children:"create the Identity"})}),"\n",(0,r.jsx)(t.li,{children:"download or copy the JWT - this file contains the one-time token"}),"\n",(0,r.jsxs)(t.li,{children:["run the ",(0,r.jsx)(t.code,{children:"ziti"})," CLI. Notice you can provide the filename of the identity config JSON file to output:"]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Example Usage:"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"ziti edge enroll \\\r\n    --cert ${user_certificate} \\\r\n    --key ${user_private_key} \\\r\n    --jwt ${one_time_jwt_file} \\\r\n    --out ${identity_config_file}\n"})}),"\n",(0,r.jsx)(t.h3,{id:"3rd-party-ca---auto",children:"3rd Party CA - Auto"}),"\n",(0,r.jsx)(t.p,{children:"When using a third party CA identity creation process in the controller is\r\nautomatic. Enrolling the identity will create it with the default role attributes that were specified when the 3rd party CA was created."}),"\n",(0,r.jsxs)(t.p,{children:['Like "3rd Party CA - One Time Token" - this flow expects that a private key and certificate have\r\nalready been created on or distributed to the machine that is about to enroll.\r\nThe certificate presented to the controller must be issued by a ',(0,r.jsx)(t.a,{href:"/docs/learn/core-concepts/pki#third-party-ca-optional",children:"third\r\nparty CA"})," that was already\r\nimported and verified in the controller with the\r\n",(0,r.jsx)(t.code,{children:"isAutoCaEnrollmentEnabled"})," property set to true."]}),"\n",(0,r.jsxs)(t.p,{children:["Using the ",(0,r.jsx)(t.code,{children:"ziti"})," CLI will also require the re-use of a permanent JWT that is unique to the external CA. The JWT\r\ncan be downloaded from the controller from:  ",(0,r.jsx)(t.code,{children:"${controller_uri}/cas/${id}/jwt"})," where ",(0,r.jsx)(t.code,{children:"${controller_uri}"})," represents\r\nthe fully qualified address of the controller api and ",(0,r.jsx)(t.code,{children:"${id}"})," represents the identifier for the given third party CA."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Example Usage:"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"ziti edge enroll \\\r\n    --cert ${user_certificate} \\\r\n    --key ${user_private_key} \\\r\n    --jwt ${reusable_ca_jwt_file} \\\r\n    --out ${identity_config_file}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["If supplied, the argument to option ",(0,r.jsx)(t.code,{children:"--idname"})," will be used as the name for the identity created. The default name of auto-created identities is generated from a template that uses values from the user certificate i.e. ",(0,r.jsx)(t.code,{children:"[caName]-[commonName]"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>s});var i=n(96540);const r={},o=i.createContext(r);function l(e){const t=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(o.Provider,{value:t},e.children)}}}]);