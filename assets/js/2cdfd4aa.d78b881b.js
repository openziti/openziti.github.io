"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[7934],{43286:(e,n,t)=>{t.d(n,{Ay:()=>l,RM:()=>r});var i=t(74848),s=t(28453);const r=[{value:"For Tunnelers",id:"for-tunnelers",level:4},{value:"For BrowZer",id:"for-browzer",level:4},{value:"For Ziti Admin Console (ZAC)",id:"for-ziti-admin-console-zac",level:4}];function a(e){const n={a:"a",code:"code",h4:"h4",p:"p",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.a,{href:"https://oauth.net/2/pkce/",children:"Authorization Code Flow with PKCE or PKCE flow"})," requires configuring callback URLs the\r\nIdentity Provider (IdP) will allow redirecting to. If the URL for a specific client is not specifically listed, the IdP\r\nwill deny the authentication request. Depending on the technology used to authenticate to the OpenZiti Network,\r\ndifferent URLs need to be specified. More than one URL is allowed to be configured. Decide if you are configuring the\r\nIdP for use with tunnelers, with BrowZer or with both and add the appropriate callback urls."]}),"\n",(0,i.jsx)(n.p,{children:'In the Auth0 dashboard, with the application selected, choose the "Settings" tab and scroll down to the "Application\r\nURIs" section and add the URLs.'}),"\n",(0,i.jsx)(n.h4,{id:"for-tunnelers",children:"For Tunnelers"}),"\n",(0,i.jsxs)(n.p,{children:["Tunnelers require an allowed callback URL of: ",(0,i.jsx)(n.code,{children:"http://localhost:20314/auth/callback"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"for-browzer",children:"For BrowZer"}),"\n",(0,i.jsxs)(n.p,{children:["The URL to configure for BrowZer will vary depending on the BrowZer configuration. BrowZer requires a wildcard\r\ncertificate in order to be deployed and all services are delivered from this wildcard domain. You will need to add\r\nthe configured ",(0,i.jsx)(n.a,{href:"/docs/learn/quickstarts/browzer/example/#get-a-wildcard-certificate",children:"wildcard domain"})," as the\r\ncallback url."]}),"\n",(0,i.jsx)(n.h4,{id:"for-ziti-admin-console-zac",children:"For Ziti Admin Console (ZAC)"}),"\n",(0,i.jsxs)(n.p,{children:["The URL to configure an IdP for so that ZAC will be able to authenticate will depend on how you deploy your ZAC. The\r\ncurrent method recommended to deploy ZAC will deploy it on the same URL as the controller. For example:\r\n",(0,i.jsx)(n.a,{href:"https://controller.example.com/zac/callback",children:"https://controller.example.com/zac/callback"})]})]})}function l(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},85249:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"guides/external-auth/identity-providers/keycloak","title":"Keycloak","description":"The following fields are necessary in order to configure an external JWT signer with OpenZiti. This configuration will","source":"@site/docs/guides/external-auth/identity-providers/keycloak.md","sourceDirName":"guides/external-auth/identity-providers","slug":"/guides/external-auth/identity-providers/keycloak","permalink":"/docs/guides/external-auth/identity-providers/keycloak","draft":false,"unlisted":false,"editUrl":"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/guides/external-auth/identity-providers/keycloak.md","tags":[],"version":"current","lastUpdatedAt":1743027973000,"frontMatter":{"title":"Keycloak","sidebar_label":"Keycloak","hide_table_of_contents":true},"sidebar":"docsSidebar","previous":{"title":"Google","permalink":"/docs/guides/external-auth/identity-providers/google"},"next":{"title":"Microsoft Entra ID","permalink":"/docs/guides/external-auth/identity-providers/msentra"}}');var s=t(74848),r=t(28453),a=t(43286);const l={title:"Keycloak",sidebar_label:"Keycloak",hide_table_of_contents:!0},o="Keycloak",c={},d=[{value:"Create a Realm",id:"create-a-realm",level:2},{value:"Create a Client",id:"create-a-client",level:2},{value:"Create Client - General Settings",id:"create-client---general-settings",level:2},{value:"Create Client - Capability Config",id:"create-client---capability-config",level:2},{value:"Create Client - Login Settings",id:"create-client---login-settings",level:2},{value:"Callback URLs",id:"callback-urls",level:3},...a.RM,{value:"Assign an Audience",id:"assign-an-audience",level:2},{value:"Verifying Tokens in Keycloak",id:"verifying-tokens-in-keycloak",level:3}];function h(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"keycloak",children:"Keycloak"})}),"\n",(0,s.jsx)("img",{src:"/icons/logo-keycloak.svg",alt:"Keycloak logo",height:"100px"}),"\n",(0,s.jsxs)(n.p,{children:["The following fields are necessary in order to configure an external JWT signer with OpenZiti. This configuration will\nenable authentication via JWTs obtained through an\n",(0,s.jsx)(n.a,{href:"https://oauth.net/2/pkce/",children:"Authorization Code Flow with PKCE or PKCE flow"}),". These values are all found in the\nKeycloak realm Clients page on the specified client settings page or via the discovery endpoint. For Keycloak\nservers the discovery endpoint is generally at ",(0,s.jsx)(n.code,{children:"https://${keycloak.server}/${realm}/.well-known/openid-configuration"}),"."]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Where to Find the Value in the Keycloak UI"}),(0,s.jsx)(n.th,{children:"Example"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Issuer"})}),(0,s.jsx)(n.td,{children:"The Keycloak realm URL"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://keycloak.example.com/realms/zitirealm",children:"https://keycloak.example.com/realms/zitirealm"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Client ID"})}),(0,s.jsx)(n.td,{children:"Set when creating the client, also on the Clients list page"}),(0,s.jsx)(n.td,{children:"openziti-client"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Audience"})}),(0,s.jsxs)(n.td,{children:["From the Client Details->Client Scopes tab->Evaluate tab, pick a user and view the ",(0,s.jsx)(n.strong,{children:"Generated access token"})]}),(0,s.jsx)(n.td,{children:"openziti-client"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"External Auth URL"})}),(0,s.jsx)(n.td,{children:"The Keycloak realm URL"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://keycloak.example.com/realms/zitirealm",children:"https://keycloak.example.com/realms/zitirealm"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"JWKS Endpoint"})}),(0,s.jsx)(n.td,{children:"Found using the OpenID configuration URL. Often the realm URL + '.well-known/openid-configuration'"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://keycloak.example.com/realms/zitirealm/.well-known/openid-configuration",children:"https://keycloak.example.com/realms/zitirealm/.well-known/openid-configuration"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Claims Property"})}),(0,s.jsxs)(n.td,{children:["Often ",(0,s.jsx)(n.code,{children:"email"}),", but can also be ",(0,s.jsx)(n.code,{children:"sub"})," or any other claim contained in the JWT"]}),(0,s.jsx)(n.td,{children:"email"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Scopes"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"openid"})," included by default then any other standard or custom scope such as ",(0,s.jsx)(n.code,{children:"email"}),", ",(0,s.jsx)(n.code,{children:"profile"}),"etc."]}),(0,s.jsx)(n.td,{children:"profile offline_access"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"create-a-realm",children:"Create a Realm"}),"\n",(0,s.jsxs)(n.p,{children:["A dedicated realm in Keycloak ensures ",(0,s.jsx)(n.strong,{children:"isolation, security, and better management"})," of users and applications. The",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"master realm"})," is generally used for admin tasks, not hosting apps. Creating a separate realm reduces security risks,\nsimplifies maintenance, and allows custom authentication, roles, and policies tailored to your needs. It is\nrecommended (but not mandatory) you create a dedicated realm."]}),"\n",(0,s.jsxs)(n.p,{children:["Click the dropdown in the upper left and choose ",(0,s.jsx)(n.strong,{children:"Create realm"}),". From the ",(0,s.jsx)(n.strong,{children:"Create realm"})," page enter a ",(0,s.jsx)(n.strong,{children:"Realm name"}),"\nand click the ",(0,s.jsx)(n.strong,{children:"Create"})," button."]}),"\n",(0,s.jsx)(n.admonition,{title:"Create a Realm",type:"info",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Auth0 Applications",src:t(16923).A+"",width:"1350",height:"648"})})}),"\n",(0,s.jsx)(n.h2,{id:"create-a-client",children:"Create a Client"}),"\n",(0,s.jsxs)(n.p,{children:["From the dedicated realm, click ",(0,s.jsx)(n.strong,{children:"Clients"})," and then choose ",(0,s.jsx)(n.strong,{children:"Create client"})]}),"\n",(0,s.jsx)(n.admonition,{title:"Create a Client",type:"info",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Auth0 Applications",src:t(66641).A+"",width:"1001",height:"326"})})}),"\n",(0,s.jsx)(n.h2,{id:"create-client---general-settings",children:"Create Client - General Settings"}),"\n",(0,s.jsxs)(n.p,{children:["Under ",(0,s.jsx)(n.strong,{children:"General Settings"}),", ensure the ",(0,s.jsx)(n.strong,{children:"Client type"})," is set to ",(0,s.jsx)(n.strong,{children:"OpenID Connect"}),", enter a ",(0,s.jsx)(n.strong,{children:"Client ID"})," name and\nclick the ",(0,s.jsx)(n.strong,{children:"Next"})," button."]}),"\n",(0,s.jsx)(n.admonition,{title:"General Settings",type:"info",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Auth0 Applications",src:t(93419).A+"",width:"1206",height:"664"})})}),"\n",(0,s.jsx)(n.h2,{id:"create-client---capability-config",children:"Create Client - Capability Config"}),"\n",(0,s.jsxs)(n.p,{children:["On the ",(0,s.jsx)(n.strong,{children:"Capability Config"})," screen, ensure the ",(0,s.jsx)(n.strong,{children:"Authentication flow"})," has at a minimum the ",(0,s.jsx)(n.strong,{children:"Standard flow"})," selected.\nIt is the only flow that is required to be checked. Click ",(0,s.jsx)(n.strong,{children:"Next"}),"."]}),"\n",(0,s.jsx)(n.admonition,{title:"Capability Config",type:"info",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Auth0 Applications",src:t(39920).A+"",width:"1122",height:"672"})})}),"\n",(0,s.jsx)(n.h2,{id:"create-client---login-settings",children:"Create Client - Login Settings"}),"\n",(0,s.jsxs)(n.p,{children:["Finish creating the client by adding ",(0,s.jsx)(n.strong,{children:"Valid redirect URIs"}),", ",(0,s.jsx)(n.strong,{children:"Valid post logout redirect URIs"})," and ",(0,s.jsx)(n.strong,{children:"Web\norigins"})," as necessary."]}),"\n",(0,s.jsx)(n.h3,{id:"callback-urls",children:"Callback URLs"}),"\n",(0,s.jsx)(a.Ay,{}),"\n",(0,s.jsx)(n.admonition,{title:"Login settings",type:"info",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Auth0 Applications",src:t(20473).A+"",width:"1198",height:"828"})})}),"\n",(0,s.jsx)(n.h2,{id:"assign-an-audience",children:"Assign an Audience"}),"\n",(0,s.jsxs)(n.p,{children:["Access tokens are expected generated for a specific audience. This requires the access token to have an ",(0,s.jsx)(n.code,{children:"aud"}),"\nclaim that is targeted for the API it's being sent to. To customize the access token's audience in Keycloak, after\ncreating a client, ensure you're on the ",(0,s.jsx)(n.strong,{children:"Client details"})," screen then click the ",(0,s.jsx)(n.strong,{children:"Client scopes"})," tab and select it. On\nthe details page, find the predefined ",(0,s.jsx)(n.strong,{children:"${clientName}-dedicated"})," scope and click it."]}),"\n",(0,s.jsx)(n.admonition,{title:"Open Dedicated Client Scope",type:"info",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Auth0 Applications",src:t(59224).A+"",width:"1300",height:"450"})})}),"\n",(0,s.jsxs)(n.p,{children:["On the next page, click ",(0,s.jsx)(n.strong,{children:"Configure a new mapper"})]}),"\n",(0,s.jsx)(n.admonition,{title:"Configure a new Mapper",type:"info",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Auth0 Applications",src:t(42159).A+"",width:"1306",height:"490"})})}),"\n",(0,s.jsxs)(n.p,{children:["On the ",(0,s.jsx)(n.strong,{children:"Configure a new mapper"})," screen, select the ",(0,s.jsx)(n.strong,{children:"Audience"})," mapper."]}),"\n",(0,s.jsx)(n.admonition,{title:"Configure a new Mapper",type:"info",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Auth0 Applications",src:t(65758).A+"",width:"813",height:"325"})})}),"\n",(0,s.jsxs)(n.p,{children:["On the ",(0,s.jsx)(n.strong,{children:"Add mapper"})," screen, fill out the ",(0,s.jsx)(n.strong,{children:"Name"})," field and add your desired audience to the ",(0,s.jsx)(n.strong,{children:"Included Custom\nAudience"})," field. Ensure the audience is added to the access token and optionally, add it to the ID token as well."]}),"\n",(0,s.jsx)(n.admonition,{title:"Add Mapper",type:"info",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Auth0 Applications",src:t(2485).A+"",width:"1302",height:"809"})})}),"\n",(0,s.jsx)(n.h3,{id:"verifying-tokens-in-keycloak",children:"Verifying Tokens in Keycloak"}),"\n",(0,s.jsxs)(n.p,{children:["Keycloak has a very useful feature to allow you to view the tokens that will be generated. While on the client\ndetail screen and ",(0,s.jsx)(n.strong,{children:"Client scopes"})," tab a somewhat hard to see sub-tab is available titled ",(0,s.jsx)(n.strong,{children:"Evaluate"}),", click on this tab."]}),"\n",(0,s.jsxs)(n.p,{children:["From the next screen, choose any extra scopes you want to see applied to the token request, choose a user to view the\ntoken for and then click on the corresponding token to view, for example the ",(0,s.jsx)(n.strong,{children:"Generated access token"})," as shown below."]}),"\n",(0,s.jsx)(n.admonition,{title:"Evaluate Tokens",type:"info",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Auth0 Applications",src:t(82397).A+"",width:"1286",height:"811"})})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},65758:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/configure-aud-mapper-1-36444fa58dd1dd38d974367dd9941d19.png"},2485:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/configure-aud-mapper-2-46198fd5f434c69b4cb6c9937bbf0c97.png"},42159:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/configure-mapper-5cd267bbf81a0b3fb69035c99bdd072c.png"},59224:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/create-audience-1-fe51a056d4edb7d86d2f0d566d2c6bf8.png"},93419:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/create-client-1-8364eeb226b6732c38cea2f39a99c877.png"},39920:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/create-client-2-17374543fdda64d9bd297ff43450fcfc.png"},20473:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/create-client-3-2ac7de80a19f3105f6c61be9eafb7444.png"},66641:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/create-client-1e3afcdfa1d228c2c013de3909543707.png"},16923:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/create-realm-d4f9d192150a6077d9405804c905088c.png"},82397:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/evaluate-tokens-73e303621e77bef4216f3b065b0011a3.png"},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>l});var i=t(96540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);