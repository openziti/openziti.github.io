"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[7626],{4383:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"reference/ha/topology","title":"Controller Topology","description":"This document discusses cluster size and member placement.","source":"@site/docs/reference/ha/topology.md","sourceDirName":"reference/ha","slug":"/reference/ha/topology","permalink":"/docs/reference/ha/topology","draft":false,"unlisted":false,"editUrl":"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/reference/ha/topology.md","tags":[],"version":"current","lastUpdatedAt":1744208051000,"sidebarPosition":60,"frontMatter":{"sidebar_label":"Topology","sidebar_position":60},"sidebar":"docsSidebar","previous":{"title":"Operations","permalink":"/docs/reference/ha/operations"},"next":{"title":"Data Model","permalink":"/docs/reference/ha/data-model"}}');var i=o(74848),s=o(28453);const l={sidebar_label:"Topology",sidebar_position:60},r="Controller Topology",a={},d=[{value:"Number of Controllers",id:"number-of-controllers",level:2},{value:"Management",id:"management",level:3},{value:"Clients",id:"clients",level:3},{value:"Voting vs Non-Voting Members",id:"voting-vs-non-voting-members",level:2},{value:"Example",id:"example",level:3}];function c(e){const n={h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"controller-topology",children:"Controller Topology"})}),"\n",(0,i.jsx)(n.p,{children:"This document discusses cluster size and member placement."}),"\n",(0,i.jsx)(n.h2,{id:"number-of-controllers",children:"Number of Controllers"}),"\n",(0,i.jsx)(n.h3,{id:"management",children:"Management"}),"\n",(0,i.jsx)(n.p,{children:"The first consideration is how many controllers the network should be able to lose without losing\nfunctionality. A cluster of size N needs (N/2) + 1 voting members connected to be able\nto take model updates, such as provisioning identities, adding/changes services and updating policies."}),"\n",(0,i.jsx)(n.p,{children:"Since a two node cluster will lose some functionality if either node becomes unavailable, a minimum\nof 3 nodes is recommended."}),"\n",(0,i.jsx)(n.h3,{id:"clients",children:"Clients"}),"\n",(0,i.jsx)(n.p,{children:"The functionality that controllers provide to clients doesn't require any specific number of controllers.\nA network manager will want to scale the number controllers based on client demand and may want to\nplace additional controllers geographically close to clients for better performance."}),"\n",(0,i.jsx)(n.h2,{id:"voting-vs-non-voting-members",children:"Voting vs Non-Voting Members"}),"\n",(0,i.jsx)(n.p,{children:"Because every model update must be approved by a quorum of voting members, adding a large number of voting\nmembers can add a lot of latency to model changes. A three node cluster in the same data center would\nlikely need a few 10s of milliseconds. A cluster with a quorum on a single continent might take a hundred\nmilliseconds, and one that had to traverse large portions of the globe might take half a second."}),"\n",(0,i.jsx)(n.p,{children:"If the network has enough voting members to meet availability needs, then additional controllers added\nfor performance reasons should be added as non-voting members."}),"\n",(0,i.jsx)(n.p,{children:"Additionally, having a quorum of controllers be geographically close will reduce latency without necessarily\nreducing availability."}),"\n",(0,i.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Requirements"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"The network should be able to withstand the loss of one voting member."}),"\n",(0,i.jsx)(n.li,{children:"Controllers should exist in the US, EU and Asia, with two in each region."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"To be able to lose one voting member, we need three voting nodes, with six nodes total."}),"\n",(0,i.jsx)(n.p,{children:"We should place 2 voting members in the same region, but in different availability zones/data centers.\nThe third voting member should be in a different region. The rest of the controllers should be non-voting."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Proposed Layout"})}),"\n",(0,i.jsx)(n.p,{children:"So, using AWS regions, the network might have:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"One in us-east-1 (voting)"}),"\n",(0,i.jsx)(n.li,{children:"One in us-west-2 (voting)"}),"\n",(0,i.jsx)(n.li,{children:"One in eu-west-3 (voting)"}),"\n",(0,i.jsx)(n.li,{children:"One in eu-south-1 (non-voting)"}),"\n",(0,i.jsx)(n.li,{children:"One in ap-southeast-4 (non-voting)"}),"\n",(0,i.jsx)(n.li,{children:"One in ap-south-2 (non-voting)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Assuming the leader is one of us-east-1 or us-west-2, model updates will only need to be accepted by\none relatively close node before being accepted. All other controllers will recieve the updates as well,\nbut updates won't be gated on communications with all of them."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Alternate"})}),"\n",(0,i.jsx)(n.p,{children:"For even faster updates at the cost of an extra controller, two controllers could be in the US Eastern DC: one in us-east-1\nand one in us-east-2. The third member could be in the EU. Updates would now only need to be approved by two\nvery close controllers. If one of them went down, updates would slow down, since updates would need to be done\nover longer latencies, but they would still work."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"One in us-east-1 (voting)"}),"\n",(0,i.jsx)(n.li,{children:"One in us-east-2 (voting)"}),"\n",(0,i.jsx)(n.li,{children:"One in us-west-2 (non-voting)"}),"\n",(0,i.jsx)(n.li,{children:"One in eu-west-3 (voting)"}),"\n",(0,i.jsx)(n.li,{children:"One in eu-south-1 (non-voting)"}),"\n",(0,i.jsx)(n.li,{children:"One in ap-southeast-4 (non-voting)"}),"\n",(0,i.jsx)(n.li,{children:"One in ap-south-2 (non-voting)"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,n,o)=>{o.d(n,{R:()=>l,x:()=>r});var t=o(96540);const i={},s=t.createContext(i);function l(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);