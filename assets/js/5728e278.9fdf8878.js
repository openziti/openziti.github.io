"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[9393],{20110:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"learn/quickstarts/network/help/quickstart-walkthrough","title":"Quickstart Walkthrough","description":"The following explains the steps that happen automatically when the expressInstall function is executed.","source":"@site/docs/learn/quickstarts/network/help/quickstart-walkthrough.md","sourceDirName":"learn/quickstarts/network/help","slug":"/learn/quickstarts/network/help/quickstart-walkthrough","permalink":"/docs/learn/quickstarts/network/help/quickstart-walkthrough","draft":false,"unlisted":false,"editUrl":"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/learn/quickstarts/network/help/quickstart-walkthrough.md","tags":[],"version":"current","lastUpdatedAt":1754504182000,"frontMatter":{"title":"Quickstart Walkthrough","id":"quickstart-walkthrough"},"sidebar":"docsSidebar","previous":{"title":"Change Password","permalink":"/docs/learn/quickstarts/network/help/change-admin-password"},"next":{"title":"Reset the Quickstart","permalink":"/docs/learn/quickstarts/network/help/reset-quickstart"}}');var i=n(74848),o=n(28453);const s={title:"Quickstart Walkthrough",id:"quickstart-walkthrough"},a=void 0,l={},c=[{value:"The General Process",id:"the-general-process",level:2},{value:"General Environment Setup",id:"general-environment-setup",level:2},{value:"Obtain the OpenZiti Binary",id:"obtain-the-openziti-binary",level:3},{value:"Create a PKI",id:"create-a-pki",level:3},{value:"Update the CA Bundle",id:"update-the-ca-bundle",level:3},{value:"Controller Creation and Configuration",id:"controller-creation-and-configuration",level:3},{value:"Default Policies",id:"default-policies",level:3},{value:"Router Creating and Configuration",id:"router-creating-and-configuration",level:3},{value:"Customization",id:"customization",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["The following explains the steps that happen automatically when the expressInstall function is executed.\nThe ",(0,i.jsx)(t.a,{href:"../local-no-docker",children:"Local - No Docker"}),", ",(0,i.jsx)(t.a,{href:"../local-with-docker",children:"Local - With Docker"}),",\n",(0,i.jsx)(t.a,{href:"../local-docker-compose",children:"Local - Docker Compose"}),", and ",(0,i.jsx)(t.a,{href:"/docs/learn/quickstarts/network/hosted",children:"Host OpenZiti Anywhere"})," quickstarts all run\nthe ",(0,i.jsx)(t.code,{children:"expressInstall"})," function. Each version varies slightly. This page will focus on the\n",(0,i.jsx)(t.a,{href:"../local-no-docker",children:"Local - No Docker"})," quickstart."]}),"\n",(0,i.jsx)(t.h2,{id:"the-general-process",children:"The General Process"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Obtain the OpenZiti binary"}),"\n",(0,i.jsx)(t.li,{children:"Create a PKI"}),"\n",(0,i.jsx)(t.li,{children:"Create a Controller configuration"}),"\n",(0,i.jsx)(t.li,{children:"Initialize the Controller"}),"\n",(0,i.jsx)(t.li,{children:"Start the Controller"}),"\n",(0,i.jsx)(t.li,{children:"Create a Router configuration"}),"\n",(0,i.jsx)(t.li,{children:"Create a Router entity on the network (via the Controller)"}),"\n",(0,i.jsx)(t.li,{children:"Enroll the Router previously created"}),"\n",(0,i.jsx)(t.li,{children:"Add default edge router and Service edge router policies."}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"general-environment-setup",children:"General Environment Setup"}),"\n",(0,i.jsx)(t.h3,{id:"obtain-the-openziti-binary",children:"Obtain the OpenZiti Binary"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"expressInstall"})," function will call ",(0,i.jsx)(t.code,{children:"getZiti"})," to obtain the Ziti binary. The ",(0,i.jsx)(t.code,{children:"getZiti"})," function detects your\nOS type and architecture to craft the specific download URL for the binary. The binary is downloaded, and extracted to\na directory within the network directory."]}),"\n",(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsxs)(t.p,{children:["The quickstart script isn't limited to ",(0,i.jsx)(t.code,{children:"expressInstall"}),". You can source the ",(0,i.jsx)(t.code,{children:"ziti-cli-function.sh"})," file and run any of\nthe many helpful functions. For example, you can run ",(0,i.jsx)(t.code,{children:"getZiti"})," to get the latest version of OpenZiti downloaded quickly\nand easily."]})}),"\n",(0,i.jsx)(t.h3,{id:"create-a-pki",children:"Create a PKI"}),"\n",(0,i.jsxs)(t.p,{children:["As part of the ",(0,i.jsx)(t.code,{children:"expressInstall"})," a PKI is generated automatically. The PKI consists of a root CA, four intermediate\nCAs; one for each of the controller's config sections (control, edge/API, identity) and an arbitrary CA. Additionally,\nan extra intermediate CA is created on the signing cert chain to demonstrate that arbitrary cert chain lengths\nare acceptable."]}),"\n",(0,i.jsx)(t.p,{children:"Once the CAs are generated, a key, server cert, and client cert are generated for each of the controller's config\nsections. The following image represents the overall PKI architecture."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"quickstart-pki-full.png",src:n(29984).A+"",width:"616",height:"301"})}),"\n",(0,i.jsx)(t.h3,{id:"update-the-ca-bundle",children:"Update the CA Bundle"}),"\n",(0,i.jsx)(t.p,{children:"The latest tunnelers require full and complete PKIs, not arbitrary trust anchors. Therefore, the root and intermediate\nCAs must be added to the CA bundle. Additionally, the file is copied for the Edge/API CA bundle."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'cat "${ZITI_PKI}/my.root.ca/certs/my.root.ca.cert" > "${ZITI_PKI}/${ZITI_NETWORK}-network-components/cas.pem"\ncat "${ZITI_PKI}/my.root.ca/certs/intermediate.from.external.ca.cert" >> "${ZITI_PKI}/${ZITI_NETWORK}-network-components/cas.pem"\ncp "${ZITI_PKI}/${ZITI_NETWORK}-network-components/cas.pem" "${ZITI_PKI}/${ZITI_NETWORK}-edge/edge.cas.pem"\n'})}),"\n",(0,i.jsx)(t.h3,{id:"controller-creation-and-configuration",children:"Controller Creation and Configuration"}),"\n",(0,i.jsx)(t.p,{children:"A controller configuration file is generated using the OpenZiti CLI binary. After the configuration is created, the\ncontroller is initialized. The process of initialization also initializes the database."}),"\n",(0,i.jsx)(t.p,{children:"The controller is then started and the quickstart waits for the controller to finish starting up before continuing as\nthe controller is necessary to create the edge router which happens in the next steps."}),"\n",(0,i.jsx)(t.h3,{id:"default-policies",children:"Default Policies"}),"\n",(0,i.jsxs)(t.p,{children:["Two policies are generated to simplify the process of getting started with the network.\nAn ",(0,i.jsx)(t.a,{href:"../../../core-concepts/security/authorization/policies/overview#edge-router-policies",children:"Edge Router Policy"}),"\nis created to allow all identities to connect to a router with a ",(0,i.jsx)(t.code,{children:"#public"})," attribute. The router created during the\n",(0,i.jsx)(t.code,{children:"expressInstall"})," is populated with this attribute.\nA ",(0,i.jsx)(t.a,{href:"../../../core-concepts/security/authorization/policies/overview#service-edge-router-policies",children:"Service edge router policy"}),"\nis also created, allowing all services to use routers with the ",(0,i.jsx)(t.code,{children:"#public"})," attribute."]}),"\n",(0,i.jsx)(t.h3,{id:"router-creating-and-configuration",children:"Router Creating and Configuration"}),"\n",(0,i.jsx)(t.p,{children:"Just as with the controller, a config file is generated for the router. The router also needs to be created through the\ncontroller. This will generate a one-time token (OTT) to be used during router enrollment."}),"\n",(0,i.jsx)(t.p,{children:"The router is then enrolled using the router configuration along with the router's OTT."}),"\n",(0,i.jsx)(t.h2,{id:"customization",children:"Customization"}),"\n",(0,i.jsx)(t.p,{children:"The quickstart offers numerous environment variables for use in customizing your unique situation. Here is a list of\nthe most commonly used environment variables and their descriptions."}),"\n",(0,i.jsxs)(t.p,{children:["By default, the quickstart PKI is set up with ",(0,i.jsx)(t.code,{children:"127.0.0.1"})," as the default IP. The ",(0,i.jsx)(t.code,{children:"*_IP_OVERRIDE"})," variables allow you\nto add an IP the PKI will be valid for."]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"ZITI_CTRL_EDGE_IP_OVERRIDE"})," an additional IP for the controller. This value is added to the PKI SANs IP\nfield for\nthe controller's edge PKI trust chain."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"ZITI_ROUTER_IP_OVERRIDE"})," is a custom IP for the router."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Here are a few more common variables."}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"ZITI_CTRL_EDGE_ADVERTISED_ADDRESS"})," is the valid name for the Controller address used in the PKI."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"ZITI_ROUTER_ADVERTISED_ADDRESS"})," is the advertised address of the router. This defaults to the value in\n",(0,i.jsx)(t.code,{children:"EXTERNAL_DNS"})," if set. Otherwise, the value in ",(0,i.jsx)(t.code,{children:"EXTERNAL_IP"})," is used."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"ZITI_CTRL_ADVERTISED_PORT"})," is the port used for the Controller's control plane address."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"ZITI_CTRL_EDGE_ADVERTISED_PORT"})," is the port used for the Controller's Edge/API plane address."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"ZITI_ROUTER_PORT"})," is the port used for the Router's advertised address."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"The following are PKI related customization variables"}),"\n",(0,i.jsx)(t.admonition,{title:"PKI Generation Only Happens Once",type:"caution",children:(0,i.jsx)(t.p,{children:"It is extremely important that quickstart has the relevant information to set up your PKI. This generation is only\nperformed once so, if it is incorrect, the entire PKI needs to be regenerated."})}),"\n",(0,i.jsx)(t.admonition,{title:"DNS is Preferred Over IP",type:"caution",children:(0,i.jsx)(t.p,{children:"It is highly recommended to use DNS over IP as this is a one time setup, if your IP changes, then your PKI is rendered\nuseless."})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'export EXTERNAL_DNS="acme.example.com"\nexport EXTERNAL_IP="$(curl -s eth0.me)"\nexport ZITI_CTRL_EDGE_IP_OVERRIDE="${EXTERNAL_IP}"\nexport ZITI_ROUTER_IP_OVERRIDE="${EXTERNAL_IP}"\nexport ZITI_CTRL_EDGE_ADVERTISED_ADDRESS="${EXTERNAL_DNS:-${EXTERNAL_IP}}"\nexport ZITI_ROUTER_ADVERTISED_ADDRESS="${EXTERNAL_DNS:-${EXTERNAL_IP}}"\nexport ZITI_CTRL_ADVERTISED_PORT=8440\nexport ZITI_CTRL_EDGE_ADVERTISED_PORT=8441\nexport ZITI_ROUTER_PORT=8442\n'})})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},29984:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/quickstart-pki-full-5878dcc1b50e32965b0673f30292b6ff.png"},28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>a});var r=n(96540);const i={},o=r.createContext(i);function s(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);