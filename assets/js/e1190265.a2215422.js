"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[3918],{11976:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>u,default:()=>p,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"guides/deployments/linux/router/router-configuration","title":"Router Configuration","description":"This article expands on the Linux router deployment article with configuration concepts and examples.","source":"@site/docs/guides/deployments/10-linux/20-router/30-configuration.mdx","sourceDirName":"guides/deployments/10-linux/20-router","slug":"/guides/deployments/linux/router/router-configuration","permalink":"/docs/guides/deployments/linux/router/router-configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/guides/deployments/10-linux/20-router/30-configuration.mdx","tags":[],"version":"current","lastUpdatedAt":1743427822000,"sidebarPosition":30,"frontMatter":{"id":"router-configuration","title":"Router Configuration","sidebar_label":"Configuration","hide_table_of_contents":false},"sidebar":"docsSidebar","previous":{"title":"Router Deployment","permalink":"/docs/guides/deployments/linux/router/deploy"},"next":{"title":"CLI Mgmt","permalink":"/docs/guides/deployments/linux/router/cli-mgmt"}}');var i=t(74848),o=t(28453),s=t(65537),a=t(79329);const l={id:"router-configuration",title:"Router Configuration",sidebar_label:"Configuration",hide_table_of_contents:!1},u=void 0,c={},d=[{value:"Config Management",id:"config-management",level:2},{value:"Identity",id:"identity",level:2},{value:"Private Key",id:"private-key",level:3},{value:"Optional Capabilities",id:"optional-capabilities",level:2},{value:"Examples",id:"examples",level:2},{value:"Public Router config.yml",id:"public-router-configyml",level:3},{value:"Private Router with Tunneler config.yml",id:"private-router-with-tunneler-configyml",level:3}];function h(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["This article expands on the ",(0,i.jsx)(n.a,{href:"/docs/guides/deployments/linux/router/deploy",children:"Linux router deployment"})," article with configuration concepts and examples."]}),"\n",(0,i.jsx)(n.h2,{id:"config-management",children:"Config Management"}),"\n",(0,i.jsxs)(n.p,{children:["Edit the generated configuration YAML file or run ",(0,i.jsx)(n.code,{children:"ziti create config router"})," to generate one from scratch. Run ",(0,i.jsx)(n.code,{children:"ziti create config environment"})," for descriptions of the environment variables that influence the generated output."]}),"\n",(0,i.jsx)(n.h2,{id:"identity",children:"Identity"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"identity"})," configuration section defines the paths to the router's identity files: certs, keys, and a bundle of trusted root CA certificates. All of the files will be created in the specified paths at the time of router enrollment. The router will automatically renew its certificates if the path remains writable."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"identity:\n    cert:                 /var/lib/ziti-router/client.cert\n    server_cert:          /var/lib/ziti-router/server.chain.cert\n    key:                  /var/lib/ziti-router/private.key\n    ca:                   /var/lib/ziti-router/trusted-root.cas\n"})}),"\n",(0,i.jsx)(n.h3,{id:"private-key",children:"Private Key"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.a,{href:"/docs/reference/configuration/conventions#identity",children:(0,i.jsx)(n.code,{children:"identity"})})," configuration section is common to routers and controllers, but the ",(0,i.jsx)(n.code,{children:"key"})," sub-property behaves differently for routers. If a private key exists in the path, then it will be used to sign router enrollment certificate requests. If it does not exist, then a private key will be locally generated and stored in that path."]}),"\n",(0,i.jsxs)(n.p,{children:["If present, the ",(0,i.jsx)(n.code,{children:"server_key"})," signs the router's server certificate request. Otherwise, the ",(0,i.jsx)(n.code,{children:"key"})," sub-property is used for both client and server certificate."]}),"\n",(0,i.jsxs)(n.p,{children:["The private keys' values are assumed to be ",(0,i.jsx)(n.code,{children:"file://"})," URLs if unspecified. Alternatives include ",(0,i.jsx)(n.code,{children:"pkcs11://"})," and ",(0,i.jsx)(n.code,{children:"parsec://"})," URLs for ",(0,i.jsx)(n.a,{href:"/docs/guides/hsm/",children:"hardware keys"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"optional-capabilities",children:"Optional Capabilities"}),"\n",(0,i.jsxs)(n.p,{children:["You may enable or disable capabilities of the router by including or omitting their sections in the configuration file. These are a few of the most relevant configuration sections. Refer to ",(0,i.jsx)(n.a,{href:"/docs/reference/configuration/router",children:"the router configuration reference"})," for more complete information."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/reference/configuration/router#edge",children:(0,i.jsx)(n.code,{children:"edge"})}),' - Most routers include this section which configures the router to listen for connections from endpoint identities. This is what makes a router an "edge router." Without this section, the router is a "fabric router" and communicates only with other routers and the control plane.']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/reference/configuration/router#link",children:(0,i.jsx)(n.code,{children:"link.listeners"})})," - The ",(0,i.jsx)(n.code,{children:"link"})," section configures the router to dial and listen for other routers that are dialing in to create mesh links. Omitting the ",(0,i.jsx)(n.code,{children:"listeners"}),' sub-section makes a router "private." "Public" routers are presumed reachable and listening for other routers.']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/reference/configuration/router#listeners",children:(0,i.jsx)(n.code,{children:"listeners[?binding == 'tunnel']"})})," - the ",(0,i.jsx)(n.code,{children:"listeners"})," section may contain a special type of binding that configures the router's built-in tunneling capabilities: ",(0,i.jsx)(n.code,{children:"binding: tunnel"}),". The tunnel's ",(0,i.jsx)(n.code,{children:"mode"})," property may be set to ",(0,i.jsx)(n.code,{children:"tproxy"}),", ",(0,i.jsx)(n.code,{children:"proxy"}),", or ",(0,i.jsx)(n.code,{children:"host"}),". Requires ",(0,i.jsx)(n.code,{children:"edge"}),".","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tproxy"})," mode requires the ",(0,i.jsx)(n.code,{children:"CAP_NET_ADMIN"})," capability and that the host's DNS resolver is set to use the nameserver provided by the router. The ",(0,i.jsx)(n.code,{children:"tproxy"})," mode is useful for transparently proxying services and providing Ziti DNS to non-Ziti applications."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsxs)(s.A,{groupId:"routerType",children:[(0,i.jsxs)(a.A,{value:"Public-Edge",label:"Public Router",children:[(0,i.jsxs)(n.p,{children:["This is an example of generating a public router configuration with the ",(0,i.jsx)(n.code,{children:"ziti"})," CLI."]}),(0,i.jsx)("br",{}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"#!/usr/bin/env bash\n\n# working directory for the router\nexport ZITI_HOME=/var/lib/ziti-router\n\n# address and port of control plane endpoint\nexport  ZITI_CTRL_ADVERTISED_ADDRESS=ctrl.ziti.example.org \\\n        ZITI_CTRL_ADVERTISED_PORT=1280\n\n# address and port of this router\nexport  ZITI_ROUTER_ADVERTISED_ADDRESS=router1.ziti.example.org \\\n        ZITI_ROUTER_PORT=3022 \\\n        ZITI_ROUTER_LISTENER_BIND_PORT=3022\n\nziti create config router edge \\\n    --routerName router1 \\\n    --tunnelerMode none\n"})}),(0,i.jsx)(n.h3,{id:"public-router-configyml",children:"Public Router config.yml"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'v: 3\n\nidentity:\n  cert:             "/var/lib/ziti-router/router1.cert"\n  server_cert:      "/var/lib/ziti-router/router1.server.chain.cert"\n  key:              "/var/lib/ziti-router/router1.key"\n  ca:               "/var/lib/ziti-router/router1.cas"\n\nctrl:\n  endpoint:             tls:ctrl.ziti.example.org:1280\n\nlink:\n  dialers:\n    - binding: transport\n  listeners:\n    - binding:          transport\n      bind:             tls:0.0.0.0:3022\n      advertise:        tls:router1.ziti.example.org:3022\n      options:\n        outQueueSize:   4\n\nlisteners:\n  - binding: edge\n    address: tls:0.0.0.0:3022\n    options:\n      advertise: router1.ziti.example.org:3022\n      connectTimeoutMs: 5000\n      getSessionTimeout: 60\n\nedge:\n  csr:\n    country: US\n    province: NC\n    locality: Charlotte\n    organization: NetFoundry\n    organizationalUnit: Ziti\n    sans:\n      dns:\n        - localhost\n        - router1.ziti.example.org\n      ip:\n        - "127.0.0.1"\n\nforwarder:\n  latencyProbeInterval: 0\n  xgressDialQueueLength: 1000\n  xgressDialWorkerCount: 128\n  linkDialQueueLength: 1000\n  linkDialWorkerCount: 32\n'})})]}),(0,i.jsxs)(a.A,{value:"Gateway",label:"Private Router with Tunneler",children:[(0,i.jsxs)(n.p,{children:["This is an example of generating a private router configuration with the ",(0,i.jsx)(n.code,{children:"ziti"})," CLI."]}),(0,i.jsx)("br",{}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"#!/usr/bin/env bash\n\n# working directory for the router\nexport ZITI_HOME=/var/lib/ziti-router\n\n# address and port of control plane endpoint\nexport  ZITI_CTRL_ADVERTISED_ADDRESS=ctrl.ziti.example.org \\\n        ZITI_CTRL_ADVERTISED_PORT=1280\n\n# address and port of this router\nexport  ZITI_ROUTER_ADVERTISED_ADDRESS=router2.ziti.example.org \\\n        ZITI_ROUTER_PORT=3022 \\\n        ZITI_ROUTER_LISTENER_BIND_PORT=3022\n\nziti create config router edge \\\n    --routerName router2 \\\n    --tunnelerMode tproxy \\\n    --private\n"})}),(0,i.jsx)("br",{}),(0,i.jsxs)(n.p,{children:["Public routers dial and listen for other routers dialing mesh links. Private routers dial for mesh links but do not listen. The ",(0,i.jsx)(n.code,{children:"edge"})," capability is independent of the ",(0,i.jsx)(n.code,{children:"link"})," capability, and so both private and public routers may listen for and advertise edge connections from endpoints."]}),(0,i.jsx)("br",{}),(0,i.jsx)(n.h3,{id:"private-router-with-tunneler-configyml",children:"Private Router with Tunneler config.yml"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'v: 3\n\nidentity:\n  cert:             "/var/lib/ziti-router/router2.cert"\n  server_cert:      "/var/lib/ziti-router/router2.server.chain.cert"\n  key:              "/var/lib/ziti-router/router2.key"\n  ca:               "/var/lib/ziti-router/router2.cas"\n\nctrl:\n  endpoint:             tls:ctrl.ziti.example.org:1280\n\nlink:\n  dialers:\n    - binding: transport\n\nlisteners:\n  - binding: edge\n    address: tls:0.0.0.0:3022\n    options:\n      advertise: router2.ziti.example.org:3022\n      connectTimeoutMs: 5000\n      getSessionTimeout: 60\n  - binding: tunnel\n    options:\n      mode: tproxy\n      resolver: udp://127.0.0.1:53\n      lanIf: \n\nedge:\n  csr:\n    country: US\n    province: NC\n    locality: Charlotte\n    organization: NetFoundry\n    organizationalUnit: Ziti\n    sans:\n      dns:\n        - localhost\n        - router2.ziti.example.org\n      ip:\n        - "127.0.0.1"\n\n\nforwarder:\n  latencyProbeInterval: 0\n  xgressDialQueueLength: 1000\n  xgressDialWorkerCount: 128\n  linkDialQueueLength: 1000\n  linkDialWorkerCount: 32\n\n'})})]})]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},79329:(e,n,t)=>{t.d(n,{A:()=>s});t(96540);var r=t(34164);const i={tabItem:"tabItem_Ymn6"};var o=t(74848);function s(e){let{children:n,hidden:t,className:s}=e;return(0,o.jsx)("div",{role:"tabpanel",className:(0,r.A)(i.tabItem,s),hidden:t,children:n})}},65537:(e,n,t)=>{t.d(n,{A:()=>T});var r=t(96540),i=t(34164),o=t(65627),s=t(56347),a=t(50372),l=t(30604),u=t(11861),c=t(78749);function d(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return d(e).map((e=>{let{props:{value:n,label:t,attributes:r,default:i}}=e;return{value:n,label:t,attributes:r,default:i}}))}(t);return function(e){const n=(0,u.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function f(e){let{queryString:n=!1,groupId:t}=e;const i=(0,s.W6)(),o=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,l.aZ)(o),(0,r.useCallback)((e=>{if(!o)return;const n=new URLSearchParams(i.location.search);n.set(o,e),i.replace({...i.location,search:n.toString()})}),[o,i])]}function g(e){const{defaultValue:n,queryString:t=!1,groupId:i}=e,o=h(e),[s,l]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=t.find((e=>e.default))??t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:o}))),[u,d]=f({queryString:t,groupId:i}),[g,m]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[i,o]=(0,c.Dv)(t);return[i,(0,r.useCallback)((e=>{t&&o.set(e)}),[t,o])]}({groupId:i}),x=(()=>{const e=u??g;return p({value:e,tabValues:o})?e:null})();(0,a.A)((()=>{x&&l(x)}),[x]);return{selectedValue:s,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),m(e)}),[d,m,o]),tabValues:o}}var m=t(9136);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=t(74848);function v(e){let{className:n,block:t,selectedValue:r,selectValue:s,tabValues:a}=e;const l=[],{blockElementScrollPositionUntilNextRender:u}=(0,o.a_)(),c=e=>{const n=e.currentTarget,t=l.indexOf(n),i=a[t].value;i!==r&&(u(n),s(i))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;n=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;n=l[t]??l[l.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":t},n),children:a.map((e=>{let{value:n,label:t,attributes:o}=e;return(0,b.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>{l.push(e)},onKeyDown:d,onClick:c,...o,className:(0,i.A)("tabs__item",x.tabItem,o?.className,{"tabs__item--active":r===n}),children:t??n},n)}))})}function y(e){let{lazy:n,children:t,selectedValue:o}=e;const s=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=s.find((e=>e.props.value===o));return e?(0,r.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:s.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==o})))})}function j(e){const n=g(e);return(0,b.jsxs)("div",{className:(0,i.A)("tabs-container",x.tabList),children:[(0,b.jsx)(v,{...n,...e}),(0,b.jsx)(y,{...n,...e})]})}function T(e){const n=(0,m.A)();return(0,b.jsx)(j,{...e,children:d(e.children)},String(n))}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var r=t(96540);const i={},o=r.createContext(i);function s(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);