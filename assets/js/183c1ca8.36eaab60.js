"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[4357],{65804:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"reference/ha/migrating","title":"Migrating Controllers","description":"A controller can be moved from standalone mode to HA mode. It can also be returned","source":"@site/docs/reference/ha/migrating.md","sourceDirName":"reference/ha","slug":"/reference/ha/migrating","permalink":"/docs/reference/ha/migrating","draft":false,"unlisted":false,"editUrl":"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/reference/ha/migrating.md","tags":[],"version":"current","lastUpdatedAt":1743027677000,"sidebarPosition":80,"frontMatter":{"sidebar_label":"Migrating","sidebar_position":80},"sidebar":"docsSidebar","previous":{"title":"Data Model","permalink":"/docs/reference/ha/data-model"},"next":{"title":"Tunnelers","permalink":"/docs/reference/tunnelers/"}}');var a=t(74848),i=t(28453);const o={sidebar_label:"Migrating",sidebar_position:80},s="Migrating Controllers",d={},l=[{value:"Always Backup First!",id:"always-backup-first",level:2},{value:"Standalone to HA",id:"standalone-to-ha",level:2},{value:"Requirements",id:"requirements",level:3},{value:"Data Model Migration",id:"data-model-migration",level:3},{value:"HA to Standalone",id:"ha-to-standalone",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"migrating-controllers",children:"Migrating Controllers"})}),"\n",(0,a.jsx)(n.p,{children:"A controller can be moved from standalone mode to HA mode. It can also be returned\nfrom HA mode back to standalone mode."}),"\n",(0,a.jsx)(n.h2,{id:"always-backup-first",children:"Always Backup First!"}),"\n",(0,a.jsx)(n.admonition,{type:"warning",children:(0,a.jsx)(n.p,{children:"Always back up controller configuration and create a database snapshot before attempting\na migration."})}),"\n",(0,a.jsx)(n.h2,{id:"standalone-to-ha",children:"Standalone to HA"}),"\n",(0,a.jsx)(n.h3,{id:"requirements",children:"Requirements"}),"\n",(0,a.jsx)(n.p,{children:"First, ensure that the controller's certificates and configuration meet the requirements."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["For certificate requirements see ",(0,a.jsx)(n.a,{href:"./bootstrapping/certificates",children:"Bootstrapping/Certificates"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["For configuration requirements see ",(0,a.jsx)(n.a,{href:"./bootstrapping/configuration",children:"Bootstrapping/Configuration"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"data-model-migration",children:"Data Model Migration"}),"\n",(0,a.jsxs)(n.p,{children:["The controller's data can be imported by using the ",(0,a.jsx)(n.code,{children:"db:"})," setting in the config file."]}),"\n",(0,a.jsxs)(n.p,{children:["Leave the ",(0,a.jsx)(n.code,{children:"db: </path/to/ctrl.db/>"})," setting in the controller config. When the controller\nstarts up, it will see that it's running in HA mode, but isn't initialized yet. It will\ntry to use the database in the configuration to initialize its data model."]}),"\n",(0,a.jsxs)(n.p,{children:["Once the controller is initialized, it should start up as normal and be usable.\nThe cluster can now be expanded as explained in\n",(0,a.jsx)(n.a,{href:"/docs/reference/ha/operations#growing-the-cluster",children:"Operations/Growing the Cluster"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"ha-to-standalone",children:"HA to Standalone"}),"\n",(0,a.jsxs)(n.p,{children:["This assumes that you have a database snapshot from an HA cluster. This could either\nbe the ctrl-ha.db from the ",(0,a.jsx)(n.code,{children:"dataDir"}),", or a snapshot created using the snapshot\nCLI command."]}),"\n",(0,a.jsxs)(n.p,{children:["To revert back to standalone mode, the ",(0,a.jsx)(n.code,{children:"raft"})," section would be removed from the\nconfig file and the ",(0,a.jsx)(n.code,{children:"db:"})," section would be added back, pointing at the snapshot\nfrom the HA cluster. Now when started, it should come up in standalone mode."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>s});var r=t(96540);const a={},i=r.createContext(a);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);