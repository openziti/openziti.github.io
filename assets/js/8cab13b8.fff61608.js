"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[47675],{63371:(e,t,n)=>{n.d(t,{Ay:()=>l,RM:()=>s});var i=n(74848),r=n(28453);const s=[{value:"Steps",id:"steps",level:2}];function d(e){const t={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"steps",children:"Steps"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Create and validate your certificates (for example with Let's Encrypt Certbot)"}),"\n",(0,i.jsx)(t.li,{children:"Alter the controller configuration using example below as a guide"}),"\n",(0,i.jsxs)(t.li,{children:["Restart the ",(0,i.jsx)(t.code,{children:"ziti-controller"})," service"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"See the example configuration here:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:'web:\n  - name: client-management\n    identity:\n      ...\n      alt_server_certs:\n      - server_cert: "/etc/letsencrypt/live/<YOUR_DOMAIN_NAME>/fullchain.pem"\n        server_key:  "/etc/letsencrypt/live/<YOUR_DOMAIN_NAME>/privkey.pem"\n'})}),"\n",(0,i.jsx)(t.p,{children:'At this point, the controller service should use the certificates for the ZAC, removing any "Potential Security\nRisk" warnings.'})]})}function l(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},61556:(e,t,n)=>{n.d(t,{Ay:()=>l,RM:()=>s});var i=n(74848),r=n(28453);const s=[];function d(e){const t={a:"a",admonition:"admonition",p:"p",strong:"strong",...(0,r.R)(),...e.components};return(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsxs)(t.p,{children:["See ",(0,i.jsx)(t.a,{href:"/docs/openziti/guides/deployments/console",children:(0,i.jsx)(t.strong,{children:"The Console and Alternative Server Certificates"})}),"\nfor more details on how to use public certificates within your enviromment."]})})}function l(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},91359:(e,t,n)=>{n.d(t,{Ay:()=>l,RM:()=>s});var i=n(74848),r=n(28453);const s=[{value:"Using Public Certificates",id:"using-public-certificates",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",p:"p",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"using-public-certificates",children:"Using Public Certificates"}),"\n",(0,i.jsx)(t.p,{children:"It is possible to remove certificate based security warnings."}),"\n",(0,i.jsx)(t.p,{children:"By default, the OpenZiti Controller is configured with a certificate issued by its self-signed PKI. Unless\nyou've specifically added this certificate to all your web browsers, this will result in modern browsers showing\na warning when accessing the console UI."}),"\n",(0,i.jsxs)(t.p,{children:["Although not strictly a security issue, it's convenient to use certificates from a widely trusted CA such\nas ",(0,i.jsx)(t.a,{href:"https://letsencrypt.org/",children:"Let's Encrypt"}),", ",(0,i.jsx)(t.a,{href:"https://zerossl.com/",children:"ZeroSSL"}),", etc. Using a certificate from\na widely trusted CA will very likely ensure any console user does not receive this warning."]}),"\n",(0,i.jsxs)(t.p,{children:["Assuming you are serving the console from the controller, you can configure the OpenZiti Controller to serve\nan alternate server certificate using the ",(0,i.jsx)(t.code,{children:"alt_server_certs"})," configuration stanza."]})]})}function l(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},94058:(e,t,n)=>{n.d(t,{Ay:()=>l,RM:()=>s});var i=n(74848),r=n(28453);const s=[];function d(e){const t={a:"a",code:"code",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Enroll an admin identity. ",(0,i.jsx)(t.a,{href:"/docs/openziti/reference/command-line/login",children:"Link to instructions"})]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Unwrap the JSON file to obtain the certificate and private key."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-text",children:"ziti ops unwrap admin2.json\n"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Compose a keystore from the certificate and private key. The ",(0,i.jsx)(t.code,{children:"-legacy"})," flag is necessary when importing the keystore into some versions of macOS Keychain Access."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-text",children:"openssl pkcs12 -export -in admin2.cert -inkey admin2.key -out admin2.p12 -name \"admin2\" -legacy -password 'pass:mypassword'\n"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Import the keystore:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"macOS: Import into System Keychain via Keychain Access application for Google Chrome. You can run a terminal command or double-click the keystore file or drag it onto the login keychain to import it."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-text",children:"security import admin2.p12 -k ~/Library/Keychains/login.keychain -T /Applications/Google\\ Chrome.app -P 'mypass'\n"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Windows: Import into the Windows Certificate Store (Personal store) via certmgr.msc."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Linux: Import into your browser's certificate store or system certificate store (e.g., Chrome Settings > Privacy and Security > Security > Manage certificates)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Visit the console in your web browser. The browser will prompt with a list of imported client certificates. Select the one you imported in the previous step."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:'Press the "LOGIN" button without entering a password.'}),"\n"]}),"\n"]})}function l(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},57963:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>j,contentTitle:()=>x,default:()=>m,frontMatter:()=>h,metadata:()=>i,toc:()=>u});const i=JSON.parse('{"id":"reference/tunnelers/windows/add-ids/ext-providers/index","title":"External Providers","description":"The Ziti Desktop Edge for Windows (ZDEW) 2.5.2+ supports integrating with external identity providers such","source":"@site/docs/reference/tunnelers/02-windows/add-ids/ext-providers/index.mdx","sourceDirName":"reference/tunnelers/02-windows/add-ids/ext-providers","slug":"/reference/tunnelers/windows/add-ids/ext-providers/","permalink":"/docs/openziti/reference/tunnelers/windows/add-ids/ext-providers/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Third-Party CA","permalink":"/docs/openziti/reference/tunnelers/windows/add-ids/third-party-ca"},"next":{"title":"By JWT","permalink":"/docs/openziti/reference/tunnelers/windows/add-ids/ext-providers/ext-jwt"}}');var r=n(74848),s=n(28453),d=(n(79662),n(84971));n(73150),n(63253);function l(e){const t={code:"code",h2:"h2",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{id:"configuring-external-auth-in-openziti",children:"Configuring External Auth in OpenZiti"}),"\n",(0,r.jsxs)(t.p,{children:["To configure an External Provider for use with an OpenZiti tunneler, create an ",(0,r.jsx)(t.code,{children:"ext-jwt-signer"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["This can be accomplished using the ",(0,r.jsx)(t.code,{children:"ziti"})," CLI or through the Ziti Admin Console (ZAC). Properly configuring the external\r\njwt signer will require careful attention, as even one stray character can prevent authentication from working. It is\r\nvery easy to add an extra slash or remove an important slash. Remember, the fields all must match exactly or authentication\r\nwill fail."]}),"\n",(0,r.jsx)(t.p,{children:"The following fields are used creating an external JWT signer:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"issuer - the issuer (iss) to expect"}),"\n",(0,r.jsxs)(t.li,{children:["audience - the audience (aud) the JWT is expected to be for, for example: ",(0,r.jsx)(t.code,{children:"openziti"})]}),"\n",(0,r.jsx)(t.li,{children:"client-id - a string assigned by the provider, used when performing the Auth Flow with PKCE process"}),"\n",(0,r.jsx)(t.li,{children:"jwks-endpoint - a URL used by the OpenZiti Controller to verify the provided JWT"}),"\n",(0,r.jsxs)(t.li,{children:["claims-property to match (often ",(0,r.jsx)(t.code,{children:"email"}),"). The JWT must contain a claim with the provided value"]}),"\n",(0,r.jsxs)(t.li,{children:["scopes - additional scopes to request from the provider. Often ",(0,r.jsx)(t.code,{children:"email"})," or ",(0,r.jsx)(t.code,{children:"profile"})]}),"\n",(0,r.jsx)(t.li,{children:"external-auth-url - the URL users are directed to for authentication with the external provider"}),"\n"]})]})}function c(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}function o(e){const t={code:"code",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h3,{id:"a-practical-example",children:"A Practical Example"}),"\n",(0,r.jsx)(t.p,{children:"Locate the provider's OpenID discovery endpoint. For example, for Keycloak, the OpenID discovery endpoint is generally\r\nlocated at:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"https://${keycloak.domain.name}:${keycloak.port}/realms/${realm-name}/.well-known/openid-configuration\n"})}),"\n",(0,r.jsxs)(t.p,{children:["The OpenID discovery endpoint returns three important fields necessary for the ",(0,r.jsx)(t.code,{children:"ext-jwt-signer"}),". The discovery endpoint\r\ncontains the ",(0,r.jsx)(t.code,{children:"issuer"}),", ",(0,r.jsx)(t.code,{children:"external-auth-url"})," (within the json, this will be the ",(0,r.jsx)(t.code,{children:"authorization_endpoint"})," value), and the\r\n",(0,r.jsx)(t.code,{children:"jwks-endpoint"})," (",(0,r.jsx)(t.code,{children:"jwks_uri"})," from the discovery endpoint). Copy and paste these values ",(0,r.jsx)(t.strong,{children:"exactly"})," as they are\r\nshown into either the ",(0,r.jsx)(t.code,{children:"ziti"})," CLI command, or into the Ziti Admin Console."]}),"\n",(0,r.jsx)(t.p,{children:"After capturing the necessary fields from the discovery endpoint, determine:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["the audience the JWT will present. This can be whatever the IdP is configured for, but it would make sense to have the\r\naudience set to something like ",(0,r.jsx)(t.code,{children:"openziti"})]}),"\n",(0,r.jsx)(t.li,{children:"the client id assigned by the IdP"}),"\n",(0,r.jsx)(t.li,{children:"the claims property that should be mapped from the JWT to an OpenZiti identity"}),"\n",(0,r.jsx)(t.li,{children:"any scopes that the OpenZiti client should request"}),"\n"]}),"\n",(0,r.jsxs)(d.A,{children:[(0,r.jsx)("summary",{children:"Example Configuring OpenZiti for External Auth"}),(0,r.jsxs)(t.h3,{id:"using-the-ziti-cli",children:["Using the ",(0,r.jsx)(t.code,{children:"ziti"})," CLI:"]}),(0,r.jsxs)(t.p,{children:["With the values collected, create an ",(0,r.jsx)(t.code,{children:"ext-jwt-signer"})," with the CLI. Replace the placeholder variables with the appropriate\r\ncontent and execute:"]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"ziti edge create ext-jwt-signer example-ext-jwt-signer $issuer \\\r\n    --external-auth-url $ext_jwt_auth_url \\\r\n    --jwks-endpoint $jwks_uri \\\r\n    --audience $ext_jwt_audience \\\r\n    --client-id $ext_jwt_client_id \\\r\n    --claims-property $ext_jwt_claims_prop \\\r\n    --scopes $ext_jwt_scopes\n"})}),(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"ziti"})," CLI will indicate success/failure of the opeation."]})]}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h3,{id:"using-the-ziti-admin-console",children:"Using the Ziti Admin Console"}),"\n",(0,r.jsx)(t.h4,{id:"add-external-jwt-signer",children:"Add External JWT Signer"}),"\n",(0,r.jsxs)(t.p,{children:["Navigate to the Authentication page, choose JWT Signers and click the plus in the upper right",(0,r.jsx)("br",{})]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"Add External JWT Signer",src:n(98809).A+"",width:"1240",height:"810"})}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h4,{id:"initial-fields",children:"Initial Fields"}),"\n",(0,r.jsxs)(t.p,{children:['Fill out the Name, Issuer, Audience, Claims Property and toggle "Use External Id" to on. Then, add the JWKS endpoint\r\non the right side of the screen.',(0,r.jsx)("br",{})]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"Initial Fields",src:n(86173).A+"",width:"1477",height:"928"})}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h4,{id:"more-option-fields",children:"More Option Fields"}),"\n",(0,r.jsxs)(t.p,{children:['Toggle the "Show More Options" and fill out the Client ID, External Auth URL and add scopes. When done click "Save" in\r\nthe top right corner.',(0,r.jsx)("br",{})]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"More Option Fields",src:n(70611).A+"",width:"1425",height:"799"})})]})}function a(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}const h={},x="External Providers",j={},u=[{value:"Configuring External Auth in OpenZiti",id:"configuring-external-auth-in-openziti",level:2},{value:"A Practical Example",id:"a-practical-example",level:3},{value:"Using the <code>ziti</code> CLI:",id:"using-the-ziti-cli",level:3},{value:"Using the Ziti Admin Console",id:"using-the-ziti-admin-console",level:3},{value:"Add External JWT Signer",id:"add-external-jwt-signer",level:4},{value:"Initial Fields",id:"initial-fields",level:4},{value:"More Option Fields",id:"more-option-fields",level:4},{value:"Add an Externally Authenticated Identity",id:"add-an-externally-authenticated-identity",level:2}];function p(e){const t={a:"a",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"external-providers",children:"External Providers"})}),"\n",(0,r.jsxs)(t.p,{children:["The Ziti Desktop Edge for Windows (ZDEW) 2.5.2+ supports integrating with external identity providers such\r\n",(0,r.jsx)(t.a,{href:"/docs/openziti/guides/external-auth/identity-providers/auth0",children:"Auth0"}),",\r\n",(0,r.jsx)(t.a,{href:"/docs/openziti/guides/external-auth/identity-providers/okta",children:"Okta"}),",\r\n",(0,r.jsx)(t.a,{href:"/docs/openziti/guides/external-auth/identity-providers/zitadel",children:"Zitadel"})," and others.\r\nThe OpenZiti Controller has an authentication system utilizing JWTs as authentication tokens.\r\nThe ",(0,r.jsx)(t.a,{href:"/docs/openziti/learn/core-concepts/security/authentication/external-jwt-signers",children:"External JWT Signers"}),"\r\nfunctionality allows an OpenZiti operator to configure the OpenZiti overlay to use external providers as sources of\r\nauthentication."]}),"\n",(0,r.jsx)(t.p,{children:"External providers can now be used for primary authentication with the Ziti Desktop Edge for Windows. The default authorization\r\npolicy for an OpenZiti controller will allow external authentication by default. If preferred, a new auth-policy can be\r\ndeclared and assigned to identities, restricting those identities from using other authentication mechanisms and\r\nexclusively rely on external authentication providers."}),"\n",(0,r.jsx)(c,{}),"\n",(0,r.jsxs)(d.A,{children:[(0,r.jsx)("summary",{children:"Example Configuring OpenZiti for External Auth"}),(0,r.jsx)(a,{})]}),"\n",(0,r.jsx)(t.h2,{id:"add-an-externally-authenticated-identity",children:"Add an Externally Authenticated Identity"}),"\n",(0,r.jsx)(t.p,{children:"After configuring the OpenZiti Controller with an external JWT signer, the ZDEW can be used to add an identity using the\r\nexternal provider."}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"/docs/openziti/reference/tunnelers/windows/add-ids/ext-providers/ext-jwt",children:"External JWT Provider - JWT"})," - Add an identity using the configured provider and network JWT"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"/docs/openziti/reference/tunnelers/windows/add-ids/ext-providers/ext-jwt-url",children:"External JWT Provider - URL"})," - Add an identity using the configured provider and URL"]}),"\n"]})]})}function m(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},63253:(e,t,n)=>{n.d(t,{Tl:()=>I,Wg:()=>v,NP:()=>a.Ay,lh:()=>x.Ay,oL:()=>j.Ay,M0:()=>A,pA:()=>h.Ay,$f:()=>g,zu:()=>o,OY:()=>L,e9:()=>l,F5:()=>p,uX:()=>N,ps:()=>P,FV:()=>E,Ch:()=>y,EK:()=>D,id:()=>k});var i=n(96540),r=n(74848),s=n(28453);function d(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"run-ziti-router-in-docker",children:"Run Ziti Router in Docker"})}),"\n",(0,r.jsx)(t.p,{children:"You can use this container image to run a Ziti Router in a Docker container."}),"\n",(0,r.jsx)(t.h2,{id:"container-image",children:"Container Image"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"openziti/ziti-router"})," image is thin and is based on the ",(0,r.jsx)(t.code,{children:"openziti/ziti-cli"})," image, which only provides the ",(0,r.jsx)(t.code,{children:"ziti"}),"\nCLI. This ",(0,r.jsx)(t.code,{children:"ziti-router"})," image adds an entrypoint that provides router bootstrapping when ",(0,r.jsx)(t.code,{children:"ZITI_BOOTSTRAP=true"})," and uses\nthe same defaults and options as the Linux package."]}),"\n",(0,r.jsx)(t.h2,{id:"docker-compose",children:"Docker Compose"}),"\n",(0,r.jsxs)(t.p,{children:["The included ",(0,r.jsx)(t.code,{children:"compose.yml"})," demonstrates how to bootstrap a router and documents the most relevant environment variables\nthat influence bootstrapping."]}),"\n",(0,r.jsx)(t.h3,{id:"standalone-example",children:"Standalone Example"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:'# create the router, saving the enrollment token to a file\nziti edge create edge-router "router1" \\\n   --jwt-output-file=./router1.jwt\n\n# fetch the compose file for the ziti-router image\nwget https://get.openziti.io/dist/docker-images/ziti-router/compose.yml\n\nZITI_ENROLL_TOKEN="$(<./router1.jwt)" \\\nZITI_CTRL_ADVERTISED_ADDRESS=ctrl.127.21.71.0.sslip.io \\\nZITI_CTRL_ADVERTISED_PORT=1280 \\\nZITI_ROUTER_ADVERTISED_ADDRESS=router1.127.0.0.1.sslip.io \\\nZITI_ROUTER_PORT=3022 \\\n    docker compose up\n'})}),"\n",(0,r.jsx)(t.h3,{id:"sidecar-example",children:"Sidecar Example"}),"\n",(0,r.jsx)(t.p,{children:"You can use this image as a sidecar container that provides Ziti DNS and TPROXY interception to another container. This\ncontrived example provides a web server that listens on port 8000 and a client that waits for the webserver to be\navailable. The client container shares a network interface with the router container and waits for the router to be\nhealthy before running."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"# fetch the compose file for the ziti-router image\nwget -O ./compose.router.yml https://get.openziti.io/dist/docker-images/ziti-router/compose.yml\n# fetch the router tproxy compose overrides files\nwget -O ./compose.tproxy.yml https://get.openziti.io/dist/docker-images/ziti-router/compose.override.yml\n# fetch the all-in-one quickstart compose file\nwget -O ./compose.quickstart.yml https://get.openziti.io/dock/all-in-one/compose.yml\n"})}),"\n",(0,r.jsx)(t.p,{children:"Patch the Compose project to use the quickstart network and provide a web server to test the hello service."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"cat <<EOF >>./compose.tproxy.yml\n    # link the router to the quickstart network so it can reach the Ziti controller\n    networks:\n      - quickstart\n\n  # add a hello web server to use for a Ziti service target\n  hello:\n    image: openziti/hello-world\n    expose:\n      - 8000\n    networks:\n      - quickstart\n\n  # add a web client that waits for a healthy tproxy router\n  tproxy-demo-client:\n    image: busybox\n    network_mode: service:ziti-router\n    depends_on:\n      ziti-router:\n        condition: service_healthy\n    command: wget --output-document=- http://hello.internal/\nEOF\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Your ",(0,r.jsx)(t.code,{children:"compose.tproxy.yml"})," should look like this."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"services:\n  ziti-router:\n    dns:\n      - 127.0.0.1\n      - 1.1.1.1\n    user: root\n    cap_add:\n      - NET_ADMIN\n    networks:\n      - quickstart\n\n  hello:\n    image: openziti/hello-world\n    expose:\n      - 8000\n    networks:\n      - quickstart\n\n  tproxy-demo-client:\n    image: busybox\n    network_mode: service:ziti-router\n    depends_on:\n      ziti-router:\n        condition: service_healthy\n    command: wget --output-document=- http://hello.internal/\n"})}),"\n",(0,r.jsx)(t.p,{children:"Define the Compose project files."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"export COMPOSE_FILE=compose.router.yml:compose.tproxy.yml:compose.quickstart.yml\n"})}),"\n",(0,r.jsx)(t.p,{children:"Run the Ziti controller in the background with the all-in-one quickstart container."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"docker compose up quickstart-check\n"})}),"\n",(0,r.jsx)(t.p,{children:"Start the hello web server listening on 8000."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"docker compose up hello --detach\n"})}),"\n",(0,r.jsx)(t.p,{children:"Log in to the Ziti controller"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"ziti edge login 127.0.0.1:1280 -y -u admin -p admin\n"})}),"\n",(0,r.jsx)(t.p,{children:"Create a Ziti service for the hello web server."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:'ziti edge create config "hello-intercept-config" intercept.v1 \\\n  \'{"portRanges":[{"high":80,"low":80}],"addresses":["hello.internal"],"protocols":["tcp"]}\'\nziti edge create config "hello-host-config" host.v1 \\\n  \'{"address":"hello","port":8000,"forwardProtocol":true,"allowedProtocols":["tcp"]}\'\nziti edge create service "hello" \\\n  --configs "hello-intercept-config,hello-host-config" \\\n  --role-attributes \'hello.services\'\nziti edge create service-policy "hello-dial-policy" Dial \\\n  --semantic AnyOf \\\n  --service-roles \'#hello.services\' \\\n  --identity-roles \'#hello.clients\'\nziti edge create service-policy "hello-bind-policy" Bind \\\n  --semantic AnyOf \\\n  --service-roles \'#hello.services\' \\\n  --identity-roles \'#hello.servers\'\n'})}),"\n",(0,r.jsx)(t.p,{children:"Grant the quickstart router permission to bind (provide) the hello service."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"ziti edge update identity quickstart-router \\\n    --role-attributes=hello.servers\n"})}),"\n",(0,r.jsx)(t.p,{children:"Create a second Ziti router to use as a tproxy client."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:'ziti edge create edge-router "tproxy-router" \\\n   --jwt-output-file=./tproxy-router.jwt \\\n   --tunneler-enabled\n'})}),"\n",(0,r.jsx)(t.p,{children:"Grant the tproxy client permission to dial (consume) the hello service"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"ziti edge update identity tproxy-router \\\n    --role-attributes=hello.clients\n"})}),"\n",(0,r.jsx)(t.p,{children:"Simulate policies to check for authorization problems"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"ziti edge policy-advisor services -q\n"})}),"\n",(0,r.jsx)(t.p,{children:"Run the demo client which triggers the run of the tproxy router because it is a dependency."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:'ZITI_ENROLL_TOKEN="$(<./tproxy-router.jwt)" \\\nZITI_ROUTER_MODE=tproxy \\\nZITI_CTRL_ADVERTISED_ADDRESS=quickstart \\\nZITI_CTRL_ADVERTISED_PORT=1280 \\\nZITI_ROUTER_PORT=3023 \\\nZITI_ROUTER_ADVERTISED_ADDRESS=ziti-router \\\n    docker compose up tproxy-demo-client\n'})})]})}function l(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}function c(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"run-ziti-controller-in-docker",children:"Run Ziti Controller in Docker"})}),"\n",(0,r.jsx)(t.p,{children:"You can use this container image to run a Ziti Controller in a Docker container."}),"\n",(0,r.jsx)(t.h2,{id:"container-image",children:"Container Image"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"openziti/ziti-controller"})," image is thin and is based on the ",(0,r.jsx)(t.code,{children:"openziti/ziti-cli"})," image, which only provides the\n",(0,r.jsx)(t.code,{children:"ziti"})," CLI. The ",(0,r.jsx)(t.code,{children:"ziti-controller"})," image adds an entrypoint that provides controller bootstrapping when\n",(0,r.jsx)(t.code,{children:"ZITI_BOOTSTRAP=true"})," and uses the same defaults and options as the Linux package."]}),"\n",(0,r.jsx)(t.h2,{id:"docker-compose",children:"Docker Compose"}),"\n",(0,r.jsxs)(t.p,{children:["The included ",(0,r.jsx)(t.code,{children:"compose.yml"})," demonstrates how to bootstrap a controller container."]}),"\n",(0,r.jsx)(t.h3,{id:"example",children:"Example"}),"\n",(0,r.jsx)(t.p,{children:"At a minimum, you must set the address and password options in the parent env or set every recurrence in the compose file."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:'# fetch the compose file for the ziti-router image\nwget https://get.openziti.io/dist/docker-images/ziti-controller/compose.yml\n\nZITI_PWD="mypass" \\\nZITI_CTRL_ADVERTISED_ADDRESS=ctrl.127.21.71.0.sslip.io \\\n    docker compose up\n'})}),"\n",(0,r.jsxs)(t.p,{children:["After a few seconds, ",(0,r.jsx)(t.code,{children:"docker compose ps"}),' will show a "healthy" status for the controller.']}),"\n",(0,r.jsxs)(t.p,{children:["Then, you may log in to the controller using the ",(0,r.jsx)(t.code,{children:"ziti"})," CLI."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"ziti edge login ctrl.127.21.71.0.sslip.io:1280 -u admin -p mypass\n"})})]})}function o(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}var a=n(94058),h=n(91359),x=n(63371),j=n(61556);function u(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"ziti-host",children:"ziti-host"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.img,{src:"https://img.shields.io/badge/Version-1.2.1-informational?style=flat-square",alt:"Version: 1.2.1"})," ",(0,r.jsx)(t.img,{src:"https://img.shields.io/badge/Type-application-informational?style=flat-square",alt:"Type: application"})," ",(0,r.jsx)(t.img,{src:"https://img.shields.io/badge/AppVersion-1.7.19-informational?style=flat-square",alt:"AppVersion: 1.7.19"})]}),"\n",(0,r.jsx)(t.p,{children:"Reverse proxy cluster services with an OpenZiti tunneler pod"}),"\n",(0,r.jsx)(t.h2,{id:"requirements",children:"Requirements"}),"\n",(0,r.jsxs)(t.p,{children:["Kubernetes: ",(0,r.jsx)(t.code,{children:">= 1.20.0-0"})]}),"\n",(0,r.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(t.p,{children:["You may use this chart to publish cluster services to your Ziti network. For example, if you create a Ziti service with a server address of ",(0,r.jsx)(t.code,{children:"tcp:kubernetes.default.svc:443"})," and write a Bind Service Policy assigning the service to the Ziti identity used with this chart, then your Ziti network's authorized clients will be able access this cluster's apiserver. You could do the same thing for any cluster service's domain name."]}),"\n",(0,r.jsx)(t.h2,{id:"how-this-chart-works",children:"How this Chart Works"}),"\n",(0,r.jsxs)(t.p,{children:["This chart deploys a pod running ",(0,r.jsx)(t.code,{children:"ziti-edge-tunnel"}),", ",(0,r.jsx)(t.a,{href:"https://docs.openziti.io/docs/reference/tunnelers/linux/",children:"the OpenZiti Linux tunneler"}),", in service hosting mode. The chart uses container image ",(0,r.jsx)(t.code,{children:"docker.io/openziti/ziti-host"})," which runs ",(0,r.jsx)(t.code,{children:"ziti-edge-tunnel run-host"}),'. This puts the Linux tunneler in "hosting" mode which is useful for binding Ziti services without any need for elevated permissions and without any Ziti nameserver or intercepting proxy. You\'ll be able to publish any server that is known by an IP address or domain name that is reachable from the pod deployed by this chart.']}),"\n",(0,r.jsx)(t.p,{children:"The enrolled Ziti identity JSON is persisted in a volume, and the chart will migrate the identity from a secret to the volume if the legacy secret exists."}),"\n",(0,r.jsx)(t.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"helm repo add openziti https://docs.openziti.io/helm-charts/\n"})}),"\n",(0,r.jsxs)(t.p,{children:["After adding the charts repo to Helm then you may enroll the identity and install the chart. You may supply a Ziti identity JSON file when you install the chart. This approach enables you to use any option available to the ",(0,r.jsx)(t.code,{children:"ziti edge enroll"})," command."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"ziti edge enroll --jwt /tmp/k8s-tunneler.jwt --out /tmp/k8s-tunneler.json\nhelm install ziti-host openziti/ziti-host --set-file zitiIdentity=/tmp/k8s-tunneler.json\n"})}),"\n",(0,r.jsx)(t.p,{children:"Alternatively, you may supply the JWT directly to the chart. In this case, a private key will be generated on first run and the identity will be enrolled."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"helm install ziti-host openziti/ziti-host --set-file zitiEnrollToken=/tmp/k8s-tunneler.jwt\n"})}),"\n",(0,r.jsx)(t.h3,{id:"installation-using-an-existing-secret",children:"Installation using an existing secret"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Warning:"})," this approach does not allow the tunneler to autonomously renew its identity certificate, so you must renew the identity certificate out of band and supply it as an existing secret."]}),"\n",(0,r.jsx)(t.p,{children:"Create the secret:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"kubectl create secret generic k8s-tunneler-identity --from-file=persisted-identity=k8s-tunneler.json\n"})}),"\n",(0,r.jsx)(t.p,{children:"Deploy the Helm chart, referring to the existing secret:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"helm install ziti-host openziti/ziti-host --set secret.existingSecretName=k8s-tunneler-identity\n"})}),"\n",(0,r.jsxs)(t.p,{children:["If desired, change the key name ",(0,r.jsx)(t.code,{children:"persisted-identity"})," with ",(0,r.jsx)(t.code,{children:"--set secret.keyName=myKeyName"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"identity-directory-and-volume",children:"Identity Directory and Volume"}),"\n",(0,r.jsx)(t.p,{children:"The Ziti identity is stored in a directory inside the container, which is backed by a PersistentVolumeClaim (PVC) by default. This ensures that identity renewals and updates are preserved across pod restarts. If you use an existing secret instead, the identity directory will be read-only, and renewals will not be persisted."}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Warning:"})," If the identity directory is not writable or not backed by a persistent volume, identity renewals and updates will NOT be preserved across container restarts."]}),"\n",(0,r.jsx)(t.h2,{id:"values-reference",children:"Values Reference"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Key"}),(0,r.jsx)(t.th,{children:"Type"}),(0,r.jsx)(t.th,{children:"Default"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"additionalVolumes"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"additional volumes to mount to ziti-host container"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"affinity"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"pod affinity"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"dnsPolicy"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"ClusterFirstWithHostNet"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fullnameOverride"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"override full name for the Helm Release"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"hostNetwork"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"bool: host network mode"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.args"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:'additional container command arguments, e.g., ["--verbose"]'})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.pullPolicy"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"IfNotPresent"'})}),(0,r.jsx)(t.td,{children:"container image pull policy"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.repository"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"openziti/ziti-host"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.tag"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"overrides the image tag whose default is the chart appversion."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"imagePullSecrets"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"secrets containing OCI registry credentials for image pull"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"nameOverride"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"override name for the Helm Release"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"nodeSelector"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"node selector for pod scheduling"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"podAnnotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"podSecurityContext.fsGroup"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"65534"})}),(0,r.jsx)(t.td,{children:"int: fsGroup for podSecurityContext (default: nogroup)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"podSecurityContext.runAsGroup"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"65534"})}),(0,r.jsx)(t.td,{children:"int: GID to run the container as (default: nogroup)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"podSecurityContext.runAsUser"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"65534"})}),(0,r.jsx)(t.td,{children:"int: UID to run the container as (default: nobody)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ports"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"additional ports to expose"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"replicas"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"1"})}),(0,r.jsx)(t.td,{children:"number of replicas"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"resources"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"We usually recommend not to specify default resources and to leave this as a conscious choice for the user. This also increases chances charts run on environments with little resources, such as Minikube. If you do want to specify resources, uncomment the following lines, adjust them as necessary, and remove the curly braces after 'resources:'. limits:   cpu: 100m   memory: 128Mi requests:   cpu: 100m   memory: 128Mi"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"secret.existingSecretName"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"existing secret name to use"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"securityContext.capabilities.add"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:'capabilities to add to the container, e.g., ["NET_BIND_SERVICE"]'})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"serviceAccount.annotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"Annotations to add to the service account"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"serviceAccount.create"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"Specifies whether a service account should be created"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"serviceAccount.name"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"The name of the service account to use. If not set and create is true, a name is generated using the fullname template"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"spireAgent"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'{"enabled":false,"spireSocketMnt":"/run/spire/sockets"}'})}),(0,r.jsx)(t.td,{children:"spire agent configuration"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"spireAgent.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"if you are running a container with the spire-agent binary installed then this will allow you to add the hostpath necessary for connecting to the spire socket"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"spireAgent.spireSocketMnt"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"/run/spire/sockets"'})}),(0,r.jsx)(t.td,{children:"file path of the spire socket mount"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"tolerations"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"tolerations for pod scheduling"})]})]})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"helm upgrade {release} {source dir}\n"})})]})}function p(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}function m(e){const t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"ziti-controller",children:"ziti-controller"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.img,{src:"https://img.shields.io/badge/Version-2.1.0-informational?style=flat-square",alt:"Version: 2.1.0"})," ",(0,r.jsx)(t.img,{src:"https://img.shields.io/badge/Type-application-informational?style=flat-square",alt:"Type: application"})," ",(0,r.jsx)(t.img,{src:"https://img.shields.io/badge/AppVersion-1.7.0-informational?style=flat-square",alt:"AppVersion: 1.7.0"})]}),"\n",(0,r.jsx)(t.p,{children:"Host an OpenZiti controller in Kubernetes"}),"\n",(0,r.jsx)(t.h2,{id:"requirements",children:"Requirements"}),"\n",(0,r.jsx)(t.p,{children:"Add the OpenZiti Charts Repo with Helm."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"helm repo add openziti https://docs.openziti.io/helm-charts/\n"})}),"\n",(0,r.jsx)(t.p,{children:"This chart runs a Ziti controller in Kubernetes."}),"\n",(0,r.jsx)(t.h3,{id:"mutual-tls",children:"Mutual TLS"}),"\n",(0,r.jsx)(t.p,{children:"Ziti's TLS server ports must be published with a TLS passthrough to allow the controller to validate the client certificates from routers and identities. This may be done with a Traefik IngressRouteTCP, Gateway API TLSRoute, Ingress, NodePort, LoadBalancer, etc. The ctrl plane and management API share the client API's TLS listener by default, so there's one TCP port by default that must be published with TLS passthrough enabled."}),"\n",(0,r.jsx)(t.h3,{id:"certificates",children:"Certificates"}),"\n",(0,r.jsxs)(t.p,{children:["It is not normally necessary to obtain publicly trusted certificates for Ziti's TLS servers. Ziti manages the trust relationships between the controller and routers and clients independent of the web's root authorities. See the ",(0,r.jsx)(t.a,{href:"#alternative-web-server-certificates",children:"Alternative Web Server Certificates"})," section for more information."]}),"\n",(0,r.jsx)(t.h3,{id:"deployment",children:"Deployment"}),"\n",(0,r.jsx)(t.p,{children:"The deployment must have exactly one replica."}),"\n",(0,r.jsx)(t.h3,{id:"custom-resources",children:"Custom Resources"}),"\n",(0,r.jsxs)(t.p,{children:["This chart requires the custom resources provided by ",(0,r.jsx)(t.a,{href:"https://cert-manager.io/docs/installation/",children:"cert-manager"})," and ",(0,r.jsx)(t.a,{href:"https://cert-manager.io/docs/projects/trust-manager/#installation",children:"trust-manager"}),", i.e., Issuer, Certificate, and Bundle. It is a limitation of Trust Manager to have one instance per cluster and one namespace from which trust Bundle inputs may be sourced, so a single Ziti controller may occupy the cluster unless your use case allows for controllers from multiple networks to share a namespace. You must set the Trust Manager's \"trust namespace\" to the namespace of the Ziti controller so that it will be able to compose a trust Bundle resource from Ziti's root CA cert(s)."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"helm repo add jetstack https://charts.jetstack.io\n\nhelm upgrade --install cert-manager jetstack/cert-manager \\\n    --namespace cert-manager --create-namespace \\\n    --set crds.enabled=true\n\nkubectl create namespace ziti\nhelm upgrade --install trust-manager jetstack/trust-manager \\\n    --namespace cert-manager \\\n    --set crds.keep=false \\\n    --set app.trust.namespace=ziti\n"})}),"\n",(0,r.jsx)(t.h3,{id:"breaking-change",children:"Breaking Change"}),"\n",(0,r.jsx)(t.p,{children:"Version 2 of this chart introduces a breaking change. You must decouple cert-manager and trust-manager from the Ziti controller chart if they were previously installed as subcharts. This allows them to be upgraded and configured independently of the Ziti controller chart."}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Symptom"})}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:'Error: Unable to continue with install: CustomResourceDefinition "certificaterequests.cert-manager.io" in namespace "" exists and cannot be imported into the current release: invalid ownership metadata; label validation error: missing key "app.kubernetes.io/managed-by": must be set to "Helm"; annotation validation error: missing key "meta.helm.sh/release-name": must be set to "cert-manager"; annotation validation error: missing key "meta.helm.sh/release-namespace": must be set to "cert-manager"'}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Cause"})}),"\n",(0,r.jsx)(t.p,{children:"Cert Manager and Trust Manager are no longer included as subcharts, so upgrading the Ziti controller chart will delete the cert-manager and trust-manager Operators along with their respective CRDs and associated resources which are critical for the Ziti controller."}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Solution"})}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"As with any controller upgrade, you are advised to back up the database before proceeding so that you will have the option to roll back to a snapshot prior to any irreversible database schema migrations that may occur during an upgrade."}),"\n",(0,r.jsx)(t.li,{children:"Upgrade the Ziti controller Helm release to chart v2. This will temporarily uninstall the CM and TM Helm releases if they were originally installed as dependencies of the Ziti controller chart."}),"\n",(0,r.jsxs)(t.li,{children:["Install or upgrade as desired the cert-manager and trust-manager Helm releases (see ",(0,r.jsx)(t.a,{href:"#custom-resources",children:"Custom Resources"})," section above for an example that is compatible with this upgrade path)."]}),"\n",(0,r.jsxs)(t.li,{children:['If the cert-manager or trust-manager charts fail to install with the "symptom" above, then run the provided BASH script (',(0,r.jsx)(t.code,{children:"chown-cert-manager.bash"}),") to set the owner labels and annotations on existing cert-manager and trust-manager CRDs and resources."]}),"\n",(0,r.jsx)(t.li,{children:"Retry installing cert-manager and trust-manager Helm charts. When they are installed successfully, their respective Helm releases will own the CRDs that were annotated and labeled by the provided BASH script."}),"\n"]}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"[!IMPORTANT]\nYou must use the same values for CM and TM Helm release names and namespaces when you run the provided script and when you re-install the cert-manager and trust-manager Helm charts."}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:'Assuming your future CM release will be named "cert-manager," your future TM release will be named "trust-manager," and both will be installed in namespace "cert-manager," and your Ziti controller is installed in namespace "ziti," you can use these example values to run the provided script to pave the way to installing the version 2 ziti-controller chart, which will delete the cert-manager and trust-manager Operators, preserving the CRDs and their associated resources.'}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"helm pull openziti/ziti-controller\ntar -xvf ziti-controller-*.tgz\nCM_NAMESPACE=cert-manager \\\nCM_RELEASE_NAME=cert-manager \\\nTM_NAMESPACE=cert-manager \\\nTM_RELEASE_NAME=trust-manager \\\nZITI_NAMESPACE=ziti \\\n./ziti-controller/files/chown-cert-manager.bash\n"})}),"\n",(0,r.jsx)(t.h2,{id:"nodeport-service-example",children:"NodePort Service Example"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Value"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.advertisedHost"}),(0,r.jsx)(t.td,{children:"the address that clients and routers will use to reach this controller"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.advertisedPort"}),(0,r.jsx)(t.td,{children:"the TCP port associated with the advertisedHost"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.service.type"}),(0,r.jsx)(t.td,{children:"the service type for the client API and router control plane"})]})]})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"helm upgrade ziti-controller openziti/ziti-controller \\\n    --install \\\n    --namespace ziti \\\n    --create-namespace \\\n    --set clientApi.advertisedHost=ctrl1.ziti.example.com \\\n    --set clientApi.advertisedPort=32171 \\\n    --set clientApi.service.type=NodePort\n"})}),"\n",(0,r.jsx)(t.p,{children:"Here's the YAML representation of the same set of input values."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"clientApi:\n    advertisedHost: ctrl1.ziti.example.com\n    advertisedPort: 32171\n    service:\n        type: NodePort\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Visit the Ziti Administration Console (ZAC): ",(0,r.jsx)(t.a,{href:"https://ctrl1.ziti.example.com:32171/zac/",children:"https://ctrl1.ziti.example.com:32171/zac/"})]}),"\n",(0,r.jsxs)(t.p,{children:["Log in with the ",(0,r.jsx)(t.code,{children:"ziti"})," CLI."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"ziti edge login ctrl1.ziti.example.com:32171 --yes --username admin --password $(\n    kubectl -n ziti get secrets ziti-controller-admin-secret -o go-template='{{index .data \"admin-password\" | base64decode }}'\n)\n"})}),"\n",(0,r.jsx)(t.h2,{id:"nginx-ingress-example",children:"Nginx Ingress Example"}),"\n",(0,r.jsxs)(t.p,{children:["Here's an example of using ",(0,r.jsxs)(t.a,{href:"https://docs.nginx.com/nginx-ingress-controller/installation/installing-nic/installation-with-helm/",children:["the community ",(0,r.jsx)(t.code,{children:"ingress-nginx"})," chart"]})," to provision ingresses for the controller's ",(0,r.jsx)(t.code,{children:"ClusterIP"})," services."]}),"\n",(0,r.jsxs)(t.p,{children:["Ensure you have the ",(0,r.jsx)(t.code,{children:"ingress-nginx"})," chart installed with ",(0,r.jsx)(t.code,{children:"controller.extraArgs.enable-ssl-passthrough=true"}),". You can verify this feature is enabled by running ",(0,r.jsx)(t.code,{children:"kubectl describe pods {ingress-nginx-controller pod}"})," and checking the args for ",(0,r.jsx)(t.code,{children:"--enable-ssl-passthrough=true"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["If necessary, patch the ",(0,r.jsx)(t.code,{children:"ingress-nginx"})," deployment to enable TLS passthrough."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'kubectl patch deployment "ingress-nginx-controller" \\\n    --namespace ingress-nginx \\\n    --type json \\\n    --patch \'[{"op": "add",\n        "path": "/spec/template/spec/containers/0/args/-",\n        "value":"--enable-ssl-passthrough"\n    }]\'\n'})}),"\n",(0,r.jsx)(t.p,{children:"Create a Helm chart values file like this."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'# ziti-controller-values.yml\nclientApi:\n    advertisedHost: ctrl1.ziti.example.com\n    advertisedPort: 443\n    service:\n        type: ClusterIP\n    ingress:\n        enabled: true\n        ingressClassName: nginx\n        annotations:\n            kubernetes.io/ingress.allow-http: "false"\n            nginx.ingress.kubernetes.io/ssl-passthrough: "true"\n'})}),"\n",(0,r.jsx)(t.p,{children:"Now install or upgrade this controller chart with your values file."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"helm upgrade ziti-controller openziti/ziti-controller \\\n    --install \\\n    --namespace ziti \\\n    --values ziti-controller-values.yml\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Visit the Ziti Administration Console (ZAC): ",(0,r.jsx)(t.a,{href:"https://ctrl1.ziti.example.com/zac/",children:"https://ctrl1.ziti.example.com/zac/"})]}),"\n",(0,r.jsxs)(t.p,{children:["Log in with the ",(0,r.jsx)(t.code,{children:"ziti"})," CLI."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"ziti edge login ctrl1.ziti.example.com:443 --yes --username admin --password $(\n    kubectl -n ziti get secrets ziti-controller-admin-secret -o go-template='{{index .data \"admin-password\" | base64decode }}'\n)\n"})}),"\n",(0,r.jsx)(t.h2,{id:"traefik-ingressroutetcp-example",children:"Traefik IngressRouteTCP Example"}),"\n",(0,r.jsx)(t.p,{children:"This will create a Traefik IngressRouteTCP with TLS passthrough for the client API's ClusterIP service."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"helm upgrade ziti-controller openziti/ziti-controller \\\n    --install \\\n    --namespace ziti \\\n    --create-namespace \\\n    --set clientApi.advertisedHost=ctrl1.ziti.example.com \\\n    --set clientApi.advertisedPort=443 \\\n    --set clientApi.service.type=ClusterIP \\\n    --set clientApi.traefikTcpRoute.enabled=true\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Visit the Ziti Administration Console (ZAC): ",(0,r.jsx)(t.a,{href:"https://ctrl1.ziti.example.com/zac/",children:"https://ctrl1.ziti.example.com/zac/"})]}),"\n",(0,r.jsxs)(t.p,{children:["Log in with the ",(0,r.jsx)(t.code,{children:"ziti"})," CLI."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"ziti edge login ctrl1.ziti.example.com:443 --yes --username admin --password $(\n    kubectl -n ziti get secrets ziti-controller-admin-secret -o go-template='{{index .data \"admin-password\" | base64decode }}'\n)\n"})}),"\n",(0,r.jsx)(t.h2,{id:"admin-user-and-password",children:"Admin User and Password"}),"\n",(0,r.jsx)(t.p,{children:"A default admin user and password will be generated and saved to a secret during installation. The credentials can be retrieved using this command."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'kubectl get secret \\\n    -n ziti ziti-controller-admin-secret \\\n    -o go-template=\'{{range $k,$v := .data}}{{printf "%s: " $k}}{{if not $v}}{{$v}}{{else}}{{$v | base64decode}}{{end}}{{"\\n"}}{{end}}\'\n'})}),"\n",(0,r.jsx)(t.h2,{id:"extra-security-for-the-management-api",children:"Extra Security for the Management API"}),"\n",(0,r.jsxs)(t.p,{children:["You can split the client and management APIs into separate cluster services by setting ",(0,r.jsx)(t.code,{children:"managementApi.service.enabled=true"}),". With this configuration, you'll have an additional cluster service named ",(0,r.jsx)(t.code,{children:"{release}-mgmt"})," that is the management API, and the client API will not have management features."]}),"\n",(0,r.jsxs)(t.p,{children:["This Helm chart's values allow for both operational scenarios: combined and split. The default choice is to expose the combined client and management APIs as the cluster service named ",(0,r.jsx)(t.code,{children:"{release}-client"}),", which is convenient because you can use the ",(0,r.jsx)(t.code,{children:"ziti"})," CLI immediately. For additional security, you may shelter the management API by splitting these two sets of features, exposing them as separate API servers. After the split, you can access the management API in several ways:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["deploy a tunneler to bind a Ziti service targeting ",(0,r.jsx)(t.code,{children:"{release}-mgmt.{namespace}.svc:{port}"}),"."]}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"kubectl -n {namespace} port-forward deployments/{release}-mgmt 8443:{port}"})}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["The web console (ZAC) is always bound to the same web listener as the management API, so you can access it at that ",(0,r.jsx)(t.code,{children:"/zac/"})," path on the same URL."]}),"\n",(0,r.jsx)(t.h2,{id:"advanced-pki",children:"Advanced PKI"}),"\n",(0,r.jsx)(t.p,{children:"The default configuration generates a singular PKI root of trust for all the controller's servers and the edge signer CA. Optionally, you may provide the name of a cert-manager Issuer or ClusterIssuer to become the root of trust for the Ziti controller's identity."}),"\n",(0,r.jsx)(t.p,{children:"Merge this with your Helm chart values file before installing or upgrading."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"ctrlPlane:\n    issuer:\n        kind: ClusterIssuer\n        name: my-alternative-cluster-issuer\n"})}),"\n",(0,r.jsx)(t.p,{children:"You may also configure the Ziti controller to use separate PKI roots of trust for its three main identities: control plane, edge signer, and web bindings."}),"\n",(0,r.jsx)(t.p,{children:"For example, to use a separate CA for the edge signer function, merge this with your Helm chart values file before installing or upgrading."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"edgeSignerPki:\n    enabled: true\n"})}),"\n",(0,r.jsx)(t.h2,{id:"prometheus-monitoring",children:"Prometheus Monitoring"}),"\n",(0,r.jsxs)(t.p,{children:["This chart provides a default disabled ",(0,r.jsx)(t.code,{children:"ziti-controller-prometheus"})," k8s service for prometheus,\nwhich can be enabled with ",(0,r.jsx)(t.code,{children:"prometheus.service.enabled"}),". Enabling it will create a prometheus ServiceMonitor\nfor configuring the prometheus endpoint. It is also important that you enable\n",(0,r.jsx)(t.code,{children:"fabric.events.enabled"})," for getting a full set of metrics."]}),"\n",(0,r.jsxs)(t.p,{children:["For more information, please check ",(0,r.jsx)(t.a,{href:"https://openziti.io/docs/learn/core-concepts/metrics/prometheus/",children:"here"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"values-reference",children:"Values Reference"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Key"}),(0,r.jsx)(t.th,{children:"Type"}),(0,r.jsx)(t.th,{children:"Default"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"additionalConfigs"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'{"ctrl":{},"events":{},"healthChecks":{},"network":{},"web":{}}'})}),(0,r.jsx)(t.td,{children:"Append additional config blocks in specific top-level keys: edge, web, network, ctrl. If events are defined here, they replace the default events section entirely."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"additionalVolumes"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"additional volumes to mount to ziti-controller container"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"affinity"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"deployment template spec affinity"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ca.clusterDomain"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"cluster.local"'})}),(0,r.jsx)(t.td,{children:"Set a custom cluster domain if other than cluster.local"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ca.duration"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"87840h"'})}),(0,r.jsx)(t.td,{children:"Go time.Duration string format"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ca.renewBefore"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"720h"'})}),(0,r.jsx)(t.td,{children:"Go time.Duration string format"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"cert.duration"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"87840h"'})}),(0,r.jsx)(t.td,{children:"server certificate duration as Go time.Duration string format"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"cert.renewBefore"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"720h"'})}),(0,r.jsx)(t.td,{children:"rewnew server certificates before expiry as Go time.Duration string format"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.advertisedHost"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"global DNS name by which routers can resolve a reachable IP for this service"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.advertisedPort"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"443"})}),(0,r.jsx)(t.td,{children:"cluster service, node port, load balancer, and ingress port"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.altDnsNames"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"besides advertisedHost and dnsNames, add these DNS SANs to any ingresses but not the web identity"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.containerPort"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"1280"})}),(0,r.jsx)(t.td,{children:"cluster service target port on the container"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.dnsNames"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"besides advertisedHost, add these DNS SANs to the web identity and any ingresses"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.ingress.annotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"ingress annotations, e.g., to configure ingress-nginx"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.ingress.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"create a TLS-passthrough ingress for the client API's ClusterIP service"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.ingress.ingressClassName"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:'ingress class name, e.g., "nginx"'})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.ingress.labels"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"ingress labels"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.ingress.tls"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"deprecated: tls passthrough is required"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.service.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"create a cluster service for the deployment"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.service.type"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"LoadBalancer"'})}),(0,r.jsx)(t.td,{children:"expose the service as a ClusterIP, NodePort, or LoadBalancer"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.traefikTcpRoute.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"enable Traefik IngressRouteTCP"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.traefikTcpRoute.entryPoints"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'["websecure"]'})}),(0,r.jsx)(t.td,{children:"IngressRouteTCP entrypoints"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"clientApi.traefikTcpRoute.labels"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"IngressRouteTCP labels"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"consoleAltIngress"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"override the address printed in Helm release notes if you configured an alternative DNS SAN for the console"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrlPlane.advertisedHost"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"{{ .Values.clientApi.advertisedHost }}"'})}),(0,r.jsx)(t.td,{children:"global DNS name by which routers can resolve a reachable IP for this service: default is cluster service DNS name which assumes all routers are inside the same cluster"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrlPlane.advertisedPort"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"{{ .Values.clientApi.advertisedPort }}"'})}),(0,r.jsx)(t.td,{children:"cluster service, node port, load balancer, and ingress port"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrlPlane.alternativeIssuer"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"obtain the ctrl plane identity from an existing issuer instead of generating a new PKI"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrlPlane.containerPort"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"{{ .Values.clientApi.containerPort }}"'})}),(0,r.jsx)(t.td,{children:"cluster service target port on the container"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrlPlane.dnsNames"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"besides advertisedHost, add these DNS SANs to the ctrl plane identity and any ctrl plane ingresses"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrlPlane.ingress.annotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"ingress annotations, e.g., to configure ingress-nginx"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrlPlane.ingress.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"create an ingress for the cluster service"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrlPlane.ingress.ingressClassName"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:'ingress class name, e.g., "nginx"'})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrlPlane.ingress.labels"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"ingress labels"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrlPlane.ingress.tls"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"deprecated: tls passthrough is required"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrlPlane.service.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"create a separate cluster service for the ctrl plane; enabling this requires you to also set the host and port for a separate ctrl plane TLS listener"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrlPlane.service.type"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"ClusterIP"'})}),(0,r.jsx)(t.td,{children:"expose the service as a ClusterIP, NodePort, or LoadBalancer"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrlPlane.traefikTcpRoute.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"enable Traefik IngressRouteTCP"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrlPlane.traefikTcpRoute.entryPoints"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'["websecure"]'})}),(0,r.jsx)(t.td,{children:"IngressRouteTCP entrypoints"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrlPlane.traefikTcpRoute.labels"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"IngressRouteTCP labels"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrlPlaneCasBundle.namespaceSelector"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"namespaces where trust-manager will create the Bundle resource containing Ziti's trusted CA certs (default: empty means all namespaces)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"customAdminSecretName"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"set the admin user and password from a custom secret The custom admin secret must be of the following format: apiVersion: v1 kind: Secret metadata:   name: myCustomAdminSecret type: Opaque data:   admin-user:   admin-password:"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"dbFile"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"ctrl.db"'})}),(0,r.jsx)(t.td,{children:"name of the BoltDB file"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edgeSignerPki.admin_client_cert"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'{"duration":"8760h","enabled":false,"renewBefore":"720h"}'})}),(0,r.jsx)(t.td,{children:"metadata name of the alternative issuer name:"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edgeSignerPki.admin_client_cert.duration"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"8760h"'})}),(0,r.jsx)(t.td,{children:"admin client certificate duration as Go time.Duration"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edgeSignerPki.admin_client_cert.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"create a client certificate for the admin user"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edgeSignerPki.admin_client_cert.renewBefore"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"720h"'})}),(0,r.jsx)(t.td,{children:"renew admin client certificate before expiry as Go time.Duration"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edgeSignerPki.alternativeIssuer"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"obtain the edge signer intermediate CA from an existing issuer instead of generating a new PKI"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edgeSignerPki.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"generate a separate PKI root of trust for the edge signer CA"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"env"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"set name to value in containers' environment"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"envSecrets"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"set secrets as environment variables in the container"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"enable fabric event logger and file handler"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.fileName"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"fabric-events.json"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.mountDir"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"/var/run/ziti"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.network.intervalAgeThreshold"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"5s"'})}),(0,r.jsx)(t.td,{children:"matching interval age and reporting interval ensures coherent metrics from fabric events"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.network.metricsReportInterval"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"5s"'})}),(0,r.jsx)(t.td,{children:"matching interval age and reporting interval ensures coherent metrics from fabric events"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.subscriptions[0].type"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"fabric.circuits"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.subscriptions[1].type"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"fabric.links"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.subscriptions[2].type"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"fabric.routers"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.subscriptions[3].type"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"fabric.terminators"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.subscriptions[4].metricFilter"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'".*"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.subscriptions[4].sourceFilter"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'".*"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.subscriptions[4].type"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"metrics"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.subscriptions[5].type"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"edge.sessions"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.subscriptions[6].type"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"edge.apiSessions"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.subscriptions[7].type"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"fabric.usage"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.subscriptions[7].version"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"3"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.subscriptions[8].type"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"services"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.subscriptions[9].interval"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"5s"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.events.subscriptions[9].type"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"edge.entityCounts"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"highAvailability.mode"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"standalone"'})}),(0,r.jsx)(t.td,{children:"Ziti controller HA mode"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"highAvailability.replicas"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"1"})}),(0,r.jsx)(t.td,{children:"Ziti controller HA swarm replicas"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.additionalArgs"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"additional arguments can be passed directly to the container to modify ziti runtime arguments"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.args"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'["{{ include \\"configMountDir\\" . }}/ziti-controller.yaml"]'})}),(0,r.jsx)(t.td,{children:"args for the entrypoint command"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.command"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'["ziti","controller","run"]'})}),(0,r.jsx)(t.td,{children:"container entrypoint command"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.homeDir"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"/home/ziggy"'})}),(0,r.jsx)(t.td,{children:"homeDir for admin login shell must align with container image's ~/.bashrc for ziti CLI auto-complete to work"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.pullPolicy"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"IfNotPresent"'})}),(0,r.jsx)(t.td,{children:"deployment image pull policy"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.repository"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"docker.io/openziti/ziti-controller"'})}),(0,r.jsx)(t.td,{children:"container image repository for app deployment"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.tag"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"override the container image tag specified in the chart"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"managementApi"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'{"advertisedHost":"{{ .Values.clientApi.advertisedHost }}","advertisedPort":"{{ .Values.clientApi.advertisedPort }}","altDnsNames":[],"containerPort":1281,"dnsNames":[],"ingress":{"annotations":{},"enabled":false,"ingressClassName":"","labels":{},"tls":{}},"service":{"enabled":false,"type":"ClusterIP"},"traefikTcpRoute":{"enabled":false,"entryPoints":["websecure"],"labels":{}}}'})}),(0,r.jsx)(t.td,{children:"by default, there's no need for a separate cluster service, ingress, or load balancer for the management API because it shares a TLS listener with the client API, and is reachable at the same address and presents the same web identity cert; you may configure a separate service, ingress, load balancer, etc.  for the management API by setting managementApi.service.enabled=true"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"managementApi.advertisedHost"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"{{ .Values.clientApi.advertisedHost }}"'})}),(0,r.jsx)(t.td,{children:"global DNS name by which routers can resolve a reachable IP for this service"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"managementApi.advertisedPort"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"{{ .Values.clientApi.advertisedPort }}"'})}),(0,r.jsx)(t.td,{children:"cluster service, node port, load balancer, and ingress port"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"managementApi.altDnsNames"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"besides advertisedHost and dnsNames, add these DNS SANs to any mgmt api ingresses, but not the web identity"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"managementApi.containerPort"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"1281"})}),(0,r.jsx)(t.td,{children:"cluster service target port on the container"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"managementApi.dnsNames"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"besides advertisedHost, add these DNS SANs to the web identity and any mgmt api ingresses"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"managementApi.ingress.annotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"ingress annotations, e.g., to configure ingress-nginx"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"managementApi.ingress.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"create a TLS-passthrough ingress for the client API's ClusterIP service"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"managementApi.ingress.ingressClassName"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:'ingress class name, e.g., "nginx"'})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"managementApi.ingress.labels"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"ingress labels"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"managementApi.ingress.tls"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"deprecated: tls passthrough is required"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"managementApi.service.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"create a cluster service for the deployment"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"managementApi.service.type"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"ClusterIP"'})}),(0,r.jsx)(t.td,{children:"expose the service as a ClusterIP, NodePort, or LoadBalancer"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"managementApi.traefikTcpRoute.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"enable Traefik IngressRouteTCP"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"managementApi.traefikTcpRoute.entryPoints"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'["websecure"]'})}),(0,r.jsx)(t.td,{children:"IngressRouteTCP entrypoints"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"managementApi.traefikTcpRoute.labels"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"IngressRouteTCP labels"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"network.createCircuitRetries"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"2"})}),(0,r.jsx)(t.td,{children:"createCircuitRetries controls the number of retries that will be attempted to create a path (and terminate it) for new circuits."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"network.cycleSeconds"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"15"})}),(0,r.jsx)(t.td,{children:"Defines the period that the controller re-evaluates the performance of all of the circuits running on the network."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"network.initialLinkLatency"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"65s"'})}),(0,r.jsx)(t.td,{children:"Sets the latency of link when it's first created. Will be overwritten as soon as latency from the link is actually reported from the routers. Defaults to 65 seconds."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"network.minRouterCost"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"10"})}),(0,r.jsx)(t.td,{children:"Sets router minimum cost. Defaults to 10"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"network.pendingLinkTimeoutSeconds"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"10"})}),(0,r.jsx)(t.td,{children:"pendingLinkTimeoutSeconds controls how long we'll wait before creating a new link between routers where there isn't an established link, but a link request has been sent"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"network.routeTimeoutSeconds"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"10"})}),(0,r.jsx)(t.td,{children:"routeTimeoutSeconds controls the number of seconds the controller will wait for a route attempt to succeed."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"network.routerConnectChurnLimit"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"1m"'})}),(0,r.jsx)(t.td,{children:"Sets how often a new control channel connection can take over for a router with an existing control channel connection Defaults to 1 minute"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"network.smart.rerouteCap"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"4"})}),(0,r.jsxs)(t.td,{children:["Defines the hard upper limit of underperforming circuits that are candidates to be re-routed. If smart routing detects 100 circuits that are underperforming, and ",(0,r.jsx)(t.code,{children:"smart.rerouteCap"})," is set to ",(0,r.jsx)(t.code,{children:"1"}),", and ",(0,r.jsx)(t.code,{children:"smart.rerouteFraction"})," is set to ",(0,r.jsx)(t.code,{children:"0.02"}),", then the upper limit of circuits that will be re-routed in this ",(0,r.jsx)(t.code,{children:"cycleSeconds"})," period will be limited to 1."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"network.smart.rerouteFraction"}),(0,r.jsx)(t.td,{children:"float"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"0.02"})}),(0,r.jsxs)(t.td,{children:["Defines the fractional upper limit of underperforming circuits that are candidates to be re-routed. If smart routing detects 100 circuits that are underperforming, and ",(0,r.jsx)(t.code,{children:"smart.rerouteFraction"})," is set to ",(0,r.jsx)(t.code,{children:"0.02"}),", then the upper limit of circuits that will be re-routed in this ",(0,r.jsx)(t.code,{children:"cycleSeconds"})," period will be limited to 2 (2% of 100)."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"nodeSelector"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"deployment template spec node selector"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"persistence.VolumeName"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"PVC volume name"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"persistence.accessMode"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"ReadWriteOnce"'})}),(0,r.jsx)(t.td,{children:"PVC access mode: ReadWriteOnce (concurrent mounts not allowed), ReadWriteMany (concurrent allowed)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"persistence.annotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"annotations for the PVC"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"persistence.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"required: place a storage claim for the BoltDB persistent volume"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"persistence.existingClaim"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"A manually managed Persistent Volume and Claim Requires persistence.enabled=true. If defined, PVC must be created manually before volume will be bound."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"persistence.size"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"2Gi"'})}),(0,r.jsx)(t.td,{children:"2GiB is enough for tens of thousands of entities, but feel free to make it larger"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"persistence.storageClass"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"Storage class of PV to bind. By default it looks for the default storage class. If the PV uses a different storage class, specify that here."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"podAnnotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"annotations to apply to all pods deployed by this chart"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"podSecurityContext"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'{"fsGroup":2171}'})}),(0,r.jsx)(t.td,{children:"deployment template spec security context"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"podSecurityContext.fsGroup"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"2171"})}),(0,r.jsx)(t.td,{children:"the GID of the group that should own any files created by the container, especially the BoltDB file"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.advertisedHost"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"DNS name to advertise in place of the default internal cluster name built from the Helm release name"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.advertisedPort"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"443"})}),(0,r.jsx)(t.td,{children:"cluster service, node port, load balancer, and ingress port"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.containerPort"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"9090"})}),(0,r.jsx)(t.td,{children:"cluster service target port on the container"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.maxTLSVersion"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"TLS1.3"'})}),(0,r.jsx)(t.td,{children:"maximum TLS version to offer to clients"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.minTLSVersion"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"TLS1.2"'})}),(0,r.jsx)(t.td,{children:"minimum TLS version to offer to clients"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.service.annotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.service.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"create a cluster service for the deployment"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.service.labels"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'{"app":"prometheus"}'})}),(0,r.jsx)(t.td,{children:"extra labels for matching only this service, ie. serviceMonitor"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.service.type"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"ClusterIP"'})}),(0,r.jsx)(t.td,{children:"expose the service as a ClusterIP, NodePort, or LoadBalancer"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.serviceMonitor.annotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"ServiceMonitor annotations"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.serviceMonitor.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"If enabled, and prometheus service is enabled, ServiceMonitor resources for Prometheus Operator are created"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.serviceMonitor.interval"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"nil"})}),(0,r.jsx)(t.td,{children:"ServiceMonitor scrape interval"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.serviceMonitor.labels"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"Additional ServiceMonitor labels"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.serviceMonitor.metricRelabelings"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsxs)(t.td,{children:["ServiceMonitor relabel configs to apply to samples as the last step before ingestion (",(0,r.jsx)(t.a,{href:"https://prometheus.io/docs/prometheus/latest/configuration/configuration",children:"reference"}),")"]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.serviceMonitor.namespace"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"nil"})}),(0,r.jsx)(t.td,{children:"Alternative namespace for ServiceMonitor resources"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.serviceMonitor.namespaceSelector"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"Namespace selector for ServiceMonitor resources"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.serviceMonitor.relabelings"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsxs)(t.td,{children:["ServiceMonitor relabel configs to apply to samples before scraping (defines ",(0,r.jsx)(t.code,{children:"relabel_configs"}),";  ",(0,r.jsx)(t.a,{href:"https://prometheus.io/docs/prometheus/latest/configuration/configuration",children:"reference"}),")"]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.serviceMonitor.scheme"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"https"'})}),(0,r.jsx)(t.td,{children:"ServiceMonitor will use http by default, but you can pick https as well"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.serviceMonitor.scrapeTimeout"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"nil"})}),(0,r.jsx)(t.td,{children:"ServiceMonitor scrape timeout in Go duration format (e.g. 15s)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.serviceMonitor.targetLabels"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsxs)(t.td,{children:["ServiceMonitor will add labels from the service to the Prometheus metric (",(0,r.jsx)(t.a,{href:"https://prometheus.io/docs/prometheus/latest/configuration/configuration",children:"reference"}),")"]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.serviceMonitor.tlsConfig"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'{"insecureSkipVerify":true}'})}),(0,r.jsx)(t.td,{children:"ServiceMonitor will use these tlsConfig settings to make the health check requests"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"prometheus.serviceMonitor.tlsConfig.insecureSkipVerify"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"set TLS skip verify, because the SAN will not match with the pod IP"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"resources"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"deployment container resources"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"securityContext"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"deployment container security context"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"spireAgent.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"if you are running a container with the spire-agent binary installed then this will allow you to add the hostpath necessary for connecting to the spire socket"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"spireAgent.spireSocketMnt"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"/run/spire/sockets"'})}),(0,r.jsx)(t.td,{children:"file path of the spire socket mount"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"tolerations"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"deployment template spec tolerations"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"trustDomain"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"permanent SPIFFE ID to use for this controller's trust domain (default: random, fixed for the life of the chart release)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"useCustomAdminSecret"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"allow for using a custom admin secret, which has to be created beforehand if enabled, the admin secret will not be generated by this Helm chart"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"webBindingPki.altServerCerts"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"webBindingPki.alternativeIssuer"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"obtain the web identity from an existing issuer instead of generating a new PKI"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"webBindingPki.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"generate a separate PKI root of trust for web bindings, i.e., client, management, and prometheus APIs"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"webBindingPki.maxTLSVersion"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"TLS1.3"'})}),(0,r.jsx)(t.td,{children:"maximum TLS version to offer to clients"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"webBindingPki.minTLSVersion"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"TLS1.2"'})}),(0,r.jsx)(t.td,{children:"minimum TLS version to offer to clients"})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"todos",children:"TODO's"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"High availability clustered mode"}),"\n",(0,r.jsxs)(t.li,{children:["Deploy Prometheus scraper configuration when ",(0,r.jsx)(t.code,{children:"prometheus.enabled = true"})]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"alternative-web-server-certificates",children:"Alternative Web Server Certificates"}),"\n",(0,r.jsxs)(t.p,{children:["The purpose of the ",(0,r.jsx)(t.code,{children:"alt_server_certs"})," feature is to bind a publicly trusted server certificate to the controller's web listener. This is useful for publishing the controller's client API with a different DNS name for BrowZer and console clients that must verify the controller's identity with their OS trusted root store."]}),"\n",(0,r.jsx)(t.h3,{id:"request-an-alternative-server-certificate-from-a-cert-manager-issuer",children:"Request an alternative server certificate from a cert-manager issuer"}),"\n",(0,r.jsx)(t.p,{children:'The most automatic way to bind an alt cert is the certManager mode provided by this chart. This example implies you have separately created a cert-manager ClusterIssuer named "cloudflare-dns01-issuer" that is able to obtain a certificate for the specified DNS name. If publishing the client API\'s alternative DNS name as a separate Ingress, you may reference that advertised host when requesting the alternative server certificate as shown here with an inline template to ensure they match.'}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'clientApi:\n    advertisedHost: edge.ziti.example.com\n    ingress:\n        enabled: true\n        ingressClassName: nginx\n        annotations:\n            kubernetes.io/ingress.allow-http: "false"\n            nginx.ingress.kubernetes.io/ssl-passthrough: "true"\n    service:\n        enabled: true\n        type: ClusterIP\n    altDnsNames:\n        - "alt-edge.ziti.example.com"\n\nwebBindingPki:\n    enabled: true\n    altServerCerts:\n        - mode: certManager\n            secretName: my-alt-server-cert\n            dnsNames:\n                - "{{ .Values.clientApi.altDnsNames[0] }}"\n            issuerRef:\n                group: cert-manager.io\n                kind: ClusterIssuer\n                name: cloudflare-dns01-issuer\n            mountPath: /etc/ziti/alt-server-cert\n'})}),"\n",(0,r.jsx)(t.h3,{id:"use-an-alternative-certificate-and-key-from-a-tls-secret",children:"Use an alternative certificate and key from a tls secret"}),"\n",(0,r.jsx)(t.p,{children:"The alternative server certificate and key may also be provided from a Kubernetes TLS secret. Declare the tls secret in the additionalVolumes section and reference it in the altServerCerts section."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"additionalVolumes:\n    - name: my-alt-server-cert\n      volumeType: secret\n      mountPath: /etc/ziti/my-alt-server-cert\n      secretName: my-alt-server-cert\n\nwebBindingPki:\n    altServerCerts:\n        - mode: secret\n          secretName: my-alt-server-cert\n"})})]})}function g(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(m,{...e})}):m(e)}function f(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"ziti-router",children:"ziti-router"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.img,{src:"https://img.shields.io/badge/Version-1.6.0-informational?style=flat-square",alt:"Version: 1.6.0"})," ",(0,r.jsx)(t.img,{src:"https://img.shields.io/badge/Type-application-informational?style=flat-square",alt:"Type: application"})," ",(0,r.jsx)(t.img,{src:"https://img.shields.io/badge/AppVersion-1.7.0-informational?style=flat-square",alt:"AppVersion: 1.7.0"})]}),"\n",(0,r.jsx)(t.p,{children:"Host an OpenZiti router in Kubernetes"}),"\n",(0,r.jsx)(t.h2,{id:"add-the-openziti-charts-repo-to-helm",children:"Add the OpenZiti Charts Repo to Helm"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"helm repo add openziti https://docs.openziti.io/helm-charts/\n"})}),"\n",(0,r.jsx)(t.h2,{id:"public-router",children:"Public Router"}),"\n",(0,r.jsxs)(t.p,{children:["The default configuration listens for incoming edge connections and router links. Set a public address for this listener (",(0,r.jsx)(t.code,{children:"edge.advertisedHost"}),") or disable it (",(0,r.jsx)(t.code,{children:"linkListeners.transport.enabled"}),") to avoid routers continually failing to dial into it."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'# get a router enrollment token from the controller\'s management API\nziti edge create edge-router "router1" \\\n  --tunneler-enabled --jwt-output-file /tmp/router1.jwt\n\n# subscribe to the openziti Helm repo\nhelm repo add openziti https://openziti.github.io/helm-charts/\n\n# install the router chart with a public address\nhelm upgrade \\\n  --install \\\n  --version "^1.0.0" \\\n  "ziti-router-123456789" \\\n  openziti/ziti-router \\\n    --set-file enrollmentJwt=/tmp/router1.jwt \\\n    --set ctrl.endpoint=ctrl.ziti.example.com:443 \\\n    --set edge.advertisedHost=router1.ziti.example.com\n'})}),"\n",(0,r.jsx)(t.h3,{id:"ingress-tls-passthrough",children:"Ingress TLS Passthrough"}),"\n",(0,r.jsx)(t.p,{children:"All router TLS listeners must terminate TLS, so it's essential that Ingress resources use TLS passthrough."}),"\n",(0,r.jsxs)(t.p,{children:["This example demonstrates creating TLS pass-through Ingress resources for use with ",(0,r.jsx)(t.a,{href:"https://docs.nginx.com/nginx-ingress-controller/installation/installing-nic/installation-with-helm/",children:"ingress-nginx"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["Ensure you have the ",(0,r.jsx)(t.code,{children:"ingress-nginx"})," chart installed with ",(0,r.jsx)(t.code,{children:"controller.extraArgs.enable-ssl-passthrough=true"}),". You can verify this feature is enabled by running ",(0,r.jsx)(t.code,{children:"kubectl describe pods {ingress-nginx-controller pod}"})," and checking the args for ",(0,r.jsx)(t.code,{children:"--enable-ssl-passthrough=true"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["If not enabled, then you must patch the ",(0,r.jsx)(t.code,{children:"ingress-nginx"})," deployment to enable the SSL passthrough option."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'kubectl patch deployment "ingress-nginx-controller" \\\n    --namespace ingress-nginx \\\n    --type json \\\n    --patch \'[{"op": "add",\n        "path": "/spec/template/spec/containers/0/args/-",\n        "value":"--enable-ssl-passthrough"\n    }]\'\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"# subscribe to ingress-nginx\nhelm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx/\n\n# install ingress-nginx\nhelm install \\\n  --namespace ingress-nginx --create-namespace --generate-name \\\n  ingress-nginx/ingress-nginx \\\n    --set controller.extraArgs.enable-ssl-passthrough=true\n"})}),"\n",(0,r.jsx)(t.p,{children:"Create a Helm chart values file for this router chart."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'# router-values.yml\nctrl:\n  endpoint: ziti-controller-ctrl.ziti-controller.svc:1280\nadvertisedHost: router1.ziti.example.com\nedge:\n  advertisedPort: 443\n  service:\n    type: ClusterIP\n  ingress:\n    enabled: true\n    ingressClassName: nginx\n    annotations:\n      kubernetes.io/ingress.allow-http: "false"\n      nginx.ingress.kubernetes.io/ssl-passthrough: "true"\n'})}),"\n",(0,r.jsx)(t.p,{children:"Now upgrade your router chart release with the values file."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'helm upgrade \\\n  --install \\\n  --version "^1.0.0" \\\n  "ziti-router-1" \\\n  openziti/ziti-router \\\n    --set-file enrollmentJwt=/tmp/router1.jwt \\\n    --values /tmp/router-values.yml\n'})}),"\n",(0,r.jsx)(t.h2,{id:"private-router",children:"Private Router"}),"\n",(0,r.jsxs)(t.p,{children:["Disable the link listener if the router does not have a public address set (",(0,r.jsx)(t.code,{children:"edge.advertisedHost"}),"). Ziti identities inside the cluster can still use the private router's edge listener ClusterIP service by authorizing them with a Ziti edge router policy."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'helm upgrade \\\n  --install \\\n  --version "^1.0.0" \\\n  "ziti-router-1" \\\n  openziti/ziti-router \\\n    --set-file enrollmentJwt=/tmp/router1.jwt \\\n    --set ctrl.endpoint=ctrl.ziti.example.com:443 \\\n    --set linkListeners.transport.enabled=false\n'})}),"\n",(0,r.jsx)(t.h2,{id:"tunnel-modes",children:"Tunnel Modes"}),"\n",(0,r.jsxs)(t.p,{children:["You may disable tunneling with input value ",(0,r.jsx)(t.code,{children:"tunnel.mode=none"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"host-tunnel-mode",children:"Host tunnel mode"}),"\n",(0,r.jsxs)(t.p,{children:["This is the default mode for the chart, i.e., ",(0,r.jsx)(t.code,{children:"tunnel.mode=host"}),", because it supports hosting Ziti services targeting servers on this router's regular network and does not require any special privileges beyond outgoing network access. Enable this mode by administratively creating or updating the Ziti edge router to enable tunneling."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'ziti edge update edge-router "router1" --tunneler-enabled\n'})}),"\n",(0,r.jsx)(t.h3,{id:"proxy-tunnel-mode",children:"Proxy tunnel mode"}),"\n",(0,r.jsxs)(t.p,{children:["Input value: ",(0,r.jsx)(t.code,{children:"tunnel.mode=proxy"})]}),"\n",(0,r.jsxs)(t.p,{children:["Proxy mode creates a default headless service ",(0,r.jsx)(t.code,{children:"<release>-proxy-default.<namespace>.svc"})," that resolves to the pod IP. Any Ziti service with config type ",(0,r.jsx)(t.code,{children:"proxy.v1"})," will dynamically bind its TCP or UDP port on the pod IP."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"tunnel:\n  mode: proxy\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Alternatively, you may override the port specified in the ",(0,r.jsx)(t.code,{children:"proxy.v1"})," config to bind specific Ziti services to specific ports on the default proxy service. This provisions a ClusterIP load balancer with address: ",(0,r.jsx)(t.code,{children:"<release>-proxy-default.<namespace>.svc"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"tunnel:\n  mode: proxy\n  proxyServices:\n    - zitiService: my-ziti-service.svc\n      containerPort: 10443\n      advertisedPort: 443\n      protocol: tcp  # Optional: tcp or udp, defaults to tcp if omitted\n    - zitiService: my-other-service.svc\n      containerPort: 10022\n      advertisedPort: 22\n"})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"protocol"})," field is optional and defaults to ",(0,r.jsx)(t.code,{children:"tcp"}),". You can specify ",(0,r.jsx)(t.code,{children:"udp"})," for UDP services. The protocol determines both the router's listener type and the Kubernetes service port protocol."]}),"\n",(0,r.jsx)(t.h4,{id:"proxy-mode-examples",children:"Proxy Mode Examples"}),"\n",(0,r.jsxs)(t.p,{children:["See the ",(0,r.jsx)(t.a,{href:"https://github.com/openziti/helm-charts/tree/main/charts/ziti-router/examples",children:"examples directory"})," for complete proxy mode configuration scenarios:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(93495).A+"",children:"scenario-1-dynamic.yaml"})})," - Dynamic proxy mode with headless service (no static port mappings)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(84267).A+"",children:"scenario-2-single-default.yaml"})})," - Single service on default ClusterIP service"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(88726).A+"",children:"scenario-3-two-default.yaml"})})," - Two services on the same default ClusterIP service"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(89517).A+"",children:"scenario-4-mixed-one-each.yaml"})})," - Mixed: one service on default, one on additional service"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(58949).A+"",children:"scenario-5-one-additional-only.yaml"})})," - Single service on additional service (default disabled)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(95361).A+"",children:"scenario-6-one-explicit-one-implicit-default.yaml"})})," - Explicit vs implicit default service mapping"]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["Finally, it is also possible to provision separate cluster services for certain Ziti services, optionally overriding any TCP ports configured in a ",(0,r.jsx)(t.code,{children:"proxy.v1"}),". The ",(0,r.jsx)(t.code,{children:"name"})," in ",(0,r.jsx)(t.code,{children:"proxyAdditionalK8sServices"})," must match a ",(0,r.jsx)(t.code,{children:"k8sService"})," in ",(0,r.jsx)(t.code,{children:"proxyServices"})," to map its advertised port on the additional service to the appropriate container port."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"tunnel:\n  mode: proxy\n  proxyServices:\n    - zitiService: my-ziti-service.svc\n      containerPort: 10443\n      advertisedPort: 443\n      k8sService: myservice\n  proxyDefaultK8sService:\n    enabled: false\n  proxyAdditionalK8sServices:\n    - name: myservice\n      type: LoadBalancer\n      annotations:\n        metallb.universe.tf/loadBalancerIPs: 192.168.1.100\n"})}),"\n",(0,r.jsx)(t.h2,{id:"additional-listeners-and-volumes",children:"Additional Listeners and Volumes"}),"\n",(0,r.jsxs)(t.p,{children:["You can configure an additional edge listener by setting ",(0,r.jsx)(t.code,{children:"edge.additionalListeners"}),". This is useful for making a WebSocket edge listener with a different server certificate."]}),"\n",(0,r.jsxs)(t.p,{children:["This example configures a wss listener and requests a certificate from cert-manager. The alternative certificate must have a DNS SAN that is distinct from the public address of the default edge listener (",(0,r.jsx)(t.code,{children:"edge.advertisedHost"}),"). This cert-manager approach has the advantage of automatically renewing the certificate and ensuring the DNS SAN of the certificate matches an additional listener's advertised host."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'edge:\n  advertisedHost: router1.ziti.example.com\n  advertisedPort: 443\n  ingress:\n    annotations:\n      kubernetes.io/ingress.allow-http: "false"\n      nginx.ingress.kubernetes.io/ssl-passthrough: "true"\n    enabled: true\n    ingressClassName: nginx\n  service:\n    enabled: true\n    type: ClusterIP\n  additionalListeners:\n    - name: router1-edge-wss\n      protocol: wss\n      containerPort: 3023                           # must be unique\n      advertisedHost: router1-wss.ziti.example.com  # must be distinct from edge.advertisedHost\n      advertisedPort: 443\n      addHostToSan: false                           # must be false to avoid colliding DNS SANs between listeners\n      service:\n        enabled: true\n        type: ClusterIP\n      ingress:\n        enabled: true\n        annotations:\n          kubernetes.io/ingress.allow-http: "false"\n          nginx.ingress.kubernetes.io/ssl-passthrough: "true"\n        ingressClassName: nginx\n\nidentity:\n  altServerCerts:\n    - name: alt-server-cert-1\n      mode: certManager\n      secretName: ziti-router1-alt-server-certs1\n      additionalListenerName: router1-edge-wss\n      mountPath: /etc/ziti/alt-server-cert-1\n      issuerRef:\n        group: cert-manager.io\n        kind: ClusterIssuer\n        name: cloudflare-dns01-issuer-staging\n'})}),"\n",(0,r.jsxs)(t.p,{children:["You don't have to use cert-manager. If you have a TLS secret named ",(0,r.jsx)(t.code,{children:"ziti-router1-alt-server-certs1"})," from some other issuer in the same namespace as the router containing the certificate and key, you can use it by setting values like these. You must also configure the additional listener as in the prior example with an advertisedHost that matches a DNS SAN of the alternative certificate."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"# this is an generic approach for mounting configmaps, secrets, csi volumes, etc.\nadditionalVolumes:\n  - name: alt-server-cert-2\n    volumeType: secret\n    mountPath: /etc/ziti/alt-server-cert-2\n    secretName: ziti-router1-alt-server-cert-2\n\n# this looks up a TLS secret's mountpoint to configure the router's identity\nidentity:\n  altServerCerts:\n    - mode: secret\n      secretName: ziti-router1-alt-server-cert-2\n"})}),"\n",(0,r.jsx)(t.p,{children:"You may also specify matching file paths for an additional volume and alternative certificate if the volume is not a TLS secret."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"additionalVolumes:\n  - name: alt-server-cert-3\n    volumeType: csi\n    driverName: csi.bpfd.dev\n    attributes: volumeAttributes\n    mountPath: /etc/ziti/alt-server-cert-3\n\nidentity:\n  altServerCerts:\n    - mode: localFile\n      serverCert: /etc/ziti/alt-server-cert-3/server3.crt\n      serverKey: /etc/ziti/alt-server-cert-3/server3.key\n"})}),"\n",(0,r.jsx)(t.h2,{id:"values-reference",children:"Values Reference"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Key"}),(0,r.jsx)(t.th,{children:"Type"}),(0,r.jsx)(t.th,{children:"Default"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"additionalVolumes"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"additional volumes to mount to ziti-router container"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"affinity"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"deployment template spec affinity"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"bootstrapEnv"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'{"ZITI_AUTO_RENEW_CERTS":"true","ZITI_BOOTSTRAP":"true","ZITI_BOOTSTRAP_CONFIG":"false","ZITI_BOOTSTRAP_ENROLLMENT":"true","ZITI_ENROLL_TOKEN":""}'})}),(0,r.jsx)(t.td,{children:"default env vars for router bootstrapping in Kubernetes"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"bootstrapEnv.ZITI_BOOTSTRAP"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"true"'})}),(0,r.jsx)(t.td,{children:"must be true or enroll() will not be called"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"bootstrapEnv.ZITI_BOOTSTRAP_CONFIG"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"false"'})}),(0,r.jsx)(t.td,{children:'"false" to suppress generating a config.yml because in K8s we mount a configMap rendered by Helm'})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"bootstrapEnv.ZITI_BOOTSTRAP_ENROLLMENT"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"true"'})}),(0,r.jsx)(t.td,{children:'enroll with controller if "true," overwrite if "force"; requires ZITI_BOOTSTRAP=true'})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"bootstrapEnv.ZITI_ENROLL_TOKEN"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"override enrollmentJwt - not currently used, possibly useful for re-enroll"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"configFile"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"ziti-router.yaml"'})}),(0,r.jsx)(t.td,{children:"filename of router config YAML"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"configMountDir"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"/etc/ziti/config"'})}),(0,r.jsx)(t.td,{children:"writable mountpoint where read-only config file is projected to allow router to write ./endpoints.yml statefile in same dir"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"csr"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'{"country":"","locality":"","organization":"","organizationalUnit":"","province":"","sans":{"dns":[],"email":[],"ip":[],"noDefaults":false,"uri":[]}}'})}),(0,r.jsx)(t.td,{children:"Certificate signing request distinguished name and subject alternative names"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"csr.country"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"country"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"csr.locality"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"city"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"csr.organization"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"organization"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"csr.organizationalUnit"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"organizational unit"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"csr.province"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"state"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"csr.sans.dns"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"additional DNS SANs"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"csr.sans.email"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"additional email SANs"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"csr.sans.ip"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"additional IP SANs"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"csr.sans.noDefaults"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"if true, disable computing default SANs from the advertisedHost, etc."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"csr.sans.uri"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"additional URI SANs"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ctrl.endpoint"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"required control plane endpoint, e.g., ctrl.ziti.example.com:443"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"dnsConfig"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"it allows to override dns options when dnsPolicy is set to None."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"dnsPolicy"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"ClusterFirstWithHostNet"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edge.additionalListeners"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"additional edge listeners have the same shape as the default edge listener, except they're enabled if defined, and you must specify a unique name for each additional edge listener. The name distinguishes their respective cluster services. This is useful for BrowZer clients that require a trusted certificate for the edge WebSocket and advertisedHost must resolve to a public IP that presents a trusted certificate, e.g., an Ingress with TLS termination."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edge.advertisedHost"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsxs)(t.td,{children:["Domain name that edge clients will use to reach this router's edge listener. Default is cluster-internal service DNS name",":port","."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edge.advertisedPort"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"443"})}),(0,r.jsx)(t.td,{children:"cluster service, node port, load balancer, and ingress port"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edge.containerPort"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"3022"})}),(0,r.jsx)(t.td,{children:"cluster service target port on the container"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edge.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"enable the edge listener in the router config; usually true because tunnel bindings require the edge which must have at least on listener"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edge.ingress.annotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"ingress annotations, e.g., to configure ingress-nginx for passthrough TLS"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edge.ingress.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"create an ingress for the cluster service; typically paired with a ClusterIP service type when enabled"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edge.ingress.ingressClassName"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"ingress class name"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edge.ingress.labels"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"ingress labels"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edge.options"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"additional common xgress options"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edge.protocol"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"tls"'})}),(0,r.jsx)(t.td,{children:"edge listener protocol: tls, wss; usually tls because additionalListeners can be used to provide a wss listener"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edge.service.annotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"service annotations"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edge.service.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"create a cluster service for the edge listener; usually true, but you can disable this to effectively un-publish the edge listener"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edge.service.labels"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"service labels"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"edge.service.type"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"ClusterIP"'})}),(0,r.jsx)(t.td,{children:"expose the service as a ClusterIP, NodePort, or LoadBalancer; default is ClusterIP, but you could use NodePort or LoadBalancer instead of an ingress controller"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"enrollmentJwt"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"nil"})}),(0,r.jsx)(t.td,{children:"enrollment one time token from the controller's management API"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"enrollmentJwtFromSecret"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"allow for using a secret to specify the enrollment token instead of using the enrollmentJwt field if enabled, setting the enrollment token on the enrollmentJwt field has no effect"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"enrollmentJwtSecretName"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"set the enrollment jwt from a secret The enrollment token secret must be of the following format: apiVersion: v1 kind: Secret metadata:   name: myEnrollmentJwtSecret type: Opaque data:   enrollmentJwt:"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"env"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"additional env vars for the router pod that are not already defined in bootstrapEnv"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"execMountDir"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"/usr/local/bin"'})}),(0,r.jsx)(t.td,{children:"read-only mountpoint for executables (must be in image's executable search PATH)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fabric.metrics.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"configure fabric metrics in the router config"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"forwarder.latencyProbeInterval"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"10"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"forwarder.linkDialQueueLength"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"1000"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"forwarder.linkDialWorkerCount"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"32"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"forwarder.rateLimitedQueueLength"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"5000"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"forwarder.rateLimitedWorkerCount"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"64"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"forwarder.xgressDialQueueLength"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"1000"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"forwarder.xgressDialWorkerCount"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"128"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"hostNetwork"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"Host networking requested for a pod if set, i.e. tproxy ports enabled in the host namespace. i.e. egress gateway"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"identity.altServerCerts"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"identityMountDir"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"/etc/ziti/identity"'})}),(0,r.jsx)(t.td,{children:"read-only mountpoint for router identity secret specified in deployment for use by router run container"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.additionalArgs"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"additional arguments can be passed directly to the container to modify ziti runtime arguments"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.args"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'["run","{{ .Values.configMountDir }}/{{ .Values.configFile }}"]'})}),(0,r.jsx)(t.td,{children:"deployment container command args and opts"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.command"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'["/entrypoint.bash"]'})}),(0,r.jsx)(t.td,{children:"deployment container command"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.pullPolicy"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"Always"'})}),(0,r.jsx)(t.td,{children:"deployment image pull policy"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.repository"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"docker.io/openziti/ziti-router"'})}),(0,r.jsx)(t.td,{children:"container image tag for deployment"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.tag"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"nil"})}),(0,r.jsx)(t.td,{children:"container image tag (default is Chart's appVersion)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"linkDialers.transport.extraProps"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"extra properties to define for the transport link dialer, e.g., groups"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"linkListeners.additionalListeners"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"Additional link listeners. Each entry defines an extra 'link' binding in the router config."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"linkListeners.transport.advertisedHost"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"{{ .Values.edge.advertisedHost }}"'})}),(0,r.jsx)(t.td,{children:"DNS name that other routers will use to form mesh transport links to this listener"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"linkListeners.transport.advertisedPort"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"{{ .Values.edge.advertisedPort }}"'})}),(0,r.jsx)(t.td,{children:"cluster service, node port, load balancer, and ingress port for this listener; default is edge.advertisedPort"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"linkListeners.transport.containerPort"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"{{ .Values.edge.containerPort }}"'})}),(0,r.jsx)(t.td,{children:"cluster service target port on the container; default is to share a listener with the edge, providing ziti-link ALPN"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"linkListeners.transport.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"enable the transport listener in the router config; set false for a private router that only connects to other routers and does not accept incoming links"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"linkListeners.transport.extraProps"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"extra properties to define for the transport link listener, e.g., groups"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"linkListeners.transport.ingress.annotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"ingress annotations, e.g., to configure ingress-nginx"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"linkListeners.transport.ingress.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"create an ingress for the cluster service"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"linkListeners.transport.ingress.ingressClassName"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"ingress class name"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"linkListeners.transport.ingress.labels"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"ingress labels"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"linkListeners.transport.options"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"link listener options"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"linkListeners.transport.service.annotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"service annotations"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"linkListeners.transport.service.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"create a cluster service for the router transport link listener; unnecessary if advertisedHost is shared with edge listener (the default)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"linkListeners.transport.service.labels"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"service labels"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"linkListeners.transport.service.type"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"ClusterIP"'})}),(0,r.jsx)(t.td,{children:"expose the service as a ClusterIP, NodePort, or LoadBalancer"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"livenessProbe"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'{"active":true,"command":["/bin/sh","-c","ziti agent stats"],"failureThreshold":5,"initialDelaySeconds":10,"periodSeconds":10,"successThreshold":1,"timeoutSeconds":5}'})}),(0,r.jsx)(t.td,{children:"deployment container liveness probe config"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"livenessProbe.active"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"enables the liveness probe for the deployment"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"livenessProbe.command"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'["/bin/sh","-c","ziti agent stats"]'})}),(0,r.jsx)(t.td,{children:"command to run to determine if the container is ready"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"livenessProbe.failureThreshold"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"5"})}),(0,r.jsx)(t.td,{children:"Number of consecutive probe failures before K8s marks the check as failed"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"livenessProbe.initialDelaySeconds"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"10"})}),(0,r.jsx)(t.td,{children:"seconds to wait before the first probe"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"livenessProbe.periodSeconds"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"10"})}),(0,r.jsx)(t.td,{children:"how often (in seconds) to perform the probe"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"livenessProbe.successThreshold"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"1"})}),(0,r.jsx)(t.td,{children:"minimum consecutive successes for the probe to be considered successful"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"livenessProbe.timeoutSeconds"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"5"})}),(0,r.jsx)(t.td,{children:"number of seconds after which the probe times out"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"noHelmHooks"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"disable the execution of hooks, defined within this chart This chart makes use of Helm hooks. Setting this to true will prevent the hooks from being deployed. This is useful when using the chart with tools like ArgoCD"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"nodeSelector"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"deployment template spec node selector"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"persistence.accessMode"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"ReadWriteOnce"'})}),(0,r.jsx)(t.td,{children:"PVC access mode: ReadWriteOnce (concurrent mounts not allowed), ReadWriteMany (concurrent allowed)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"persistence.annotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"annotations for the PVC"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"persistence.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"required: place a storage claim for the ctrl endpoints.yml state file"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"persistence.existingClaim"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"A manually managed Persistent Volume and Claim Requires persistence.enabled: true If defined, PVC must be created manually before volume will be bound"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"persistence.size"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"50Mi"'})}),(0,r.jsx)(t.td,{children:"50Mi is plenty for this state file"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"persistence.storageClass"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"Storage class of PV to bind. By default it looks for the default storage class. If the PV uses a different storage class, specify that here."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"persistence.volumeName"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"nil"})}),(0,r.jsx)(t.td,{children:"PVC volume name"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"podAnnotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"annotations to apply to all pods deployed by this chart"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"podSecurityContext"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'{"fsGroup":2171}'})}),(0,r.jsx)(t.td,{children:"deployment template spec security context"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"podSecurityContext.fsGroup"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"2171"})}),(0,r.jsx)(t.td,{children:'this is the GID of "ziggy" run-as user in the container that has access to any files created by the router process in the emptyDir volume used to persist the list of ctrl endpoints'})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"proxy"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"Explicit proxy setting in the router configuration. Router can be deployed in a site where all egress traffic is forwarded through an explicit proxy. The enrollment will also be forwarded through the proxy."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"readinessProbe"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'{"active":true,"command":["/bin/sh","-c","ziti agent stats"],"failureThreshold":5,"initialDelaySeconds":10,"periodSeconds":10,"successThreshold":1,"timeoutSeconds":5}'})}),(0,r.jsx)(t.td,{children:"deployment container readiness probe config"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"readinessProbe.active"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"enables the readiness probe for the deployment"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"readinessProbe.command"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'["/bin/sh","-c","ziti agent stats"]'})}),(0,r.jsx)(t.td,{children:"command to run to determine if the container is ready"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"readinessProbe.failureThreshold"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"5"})}),(0,r.jsx)(t.td,{children:"Number of consecutive probe failures before K8s marks the check as failed"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"readinessProbe.initialDelaySeconds"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"10"})}),(0,r.jsx)(t.td,{children:"seconds to wait before the first probe"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"readinessProbe.periodSeconds"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"10"})}),(0,r.jsx)(t.td,{children:"how often (in seconds) to perform the probe"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"readinessProbe.successThreshold"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"1"})}),(0,r.jsx)(t.td,{children:"minimum consecutive successes for the probe to be considered successful"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"readinessProbe.timeoutSeconds"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"5"})}),(0,r.jsx)(t.td,{children:"number of seconds after which the probe times out"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"resources"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"deployment container resources"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"securityContext"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"nil"})}),(0,r.jsx)(t.td,{children:"deployment container security context"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"tolerations"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"deployment template spec tolerations"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"tunnel.diverterPath"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"nil"})}),(0,r.jsx)(t.td,{children:"the tproxy mode can be switched from iptables based interception to bpf interception by passing the user space bpf program path. bpf kernel space program is expected to be loaded prior or during router deployment, e.g. bpfman agent, hostpath, etc"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"tunnel.dnsSvcIpRange"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"nil"})}),(0,r.jsx)(t.td,{children:"CIDR range for the internal service fqdn to dynamic intercept IP address resolution (default: 100.64.0.0/10)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"tunnel.lanIf"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"lo"'})}),(0,r.jsx)(t.td,{children:"interface device name for setting up INPUT firewall rules if fw enabled. It must be set but not needed in containers. Thus, it is set to lo by default"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"tunnel.mode"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"host"'})}),(0,r.jsx)(t.td,{children:"run mode for the router's built-in tunnel component: host, tproxy, proxy, or none"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"tunnel.proxyAdditionalK8sServices"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:'this is a list of additional K8s service configurations to provision and map to a Ziti service if tunnel mode is "proxy"; for each Ziti service in "proxyServices", where .k8sService != "default" and for which an item in proxyAdditionalK8sService[].name == .k8sService in proxyServices'})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"tunnel.proxyDefaultK8sService"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'{"enabled":true,"type":"ClusterIP"}'})}),(0,r.jsxs)(t.td,{children:['if tunnel mode is "proxy", create the a cluster service named ',(0,r.jsx)(t.code,{children:"{{ release }}-proxy-default"}),' listening on each "advertisedPort" defined in "proxyServices" or as a headless service on all TCP and UDP ports on the pod IP if no Ziti services are specified, i.e., dynamic reverse-proxy mode where all dialable services with config type proxy.v1 are bound to their respective ports and protocols on the pod IP']})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"tunnel.proxyServices"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsxs)(t.td,{children:["optional list of Ziti service",":port"," mappings to publish via the K8s service named ",(0,r.jsx)(t.code,{children:"<release>-proxy-default"}),", unless .k8sService names another service to map to the Ziti service. If the list is empty, then no TCP load balancer is provisioned and ",(0,r.jsx)(t.code,{children:"<release>-proxy-default"})," resolves to the pod IP, and all Ziti services with proxy.v1 configs that are dialable by the router's identity can be reached on their respective reverse-proxy ports at the headless service address."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"tunnel.resolver"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"nil"})}),(0,r.jsx)(t.td,{children:"Ziti nameserver listener where OS must be configured to send DNS queries (default: udp://127.0.0.1:53)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"websocket.enableCompression"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"enable compression on websocket"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"websocket.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"enable the websocket transport. Also requires an appropriate edge.additionalListeners entry."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"websocket.handshakeTimeout"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"10"})}),(0,r.jsx)(t.td,{children:"websocket handshake timeout"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"websocket.idleTimeout"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"5"})}),(0,r.jsx)(t.td,{children:"websocket idle timeout"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"websocket.pingInterval"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"54"})}),(0,r.jsx)(t.td,{children:"websocket ping timeout"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"websocket.pongTimeout"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"60"})}),(0,r.jsx)(t.td,{children:"websocket pong timeout"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"websocket.readBufferSize"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"4096"})}),(0,r.jsx)(t.td,{children:"websocket read buffer size"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"websocket.readTimeout"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"5"})}),(0,r.jsx)(t.td,{children:"websocket read timeout"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"websocket.writeBufferSize"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"4096"})}),(0,r.jsx)(t.td,{children:"websocket write buffer size"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"websocket.writeTimeout"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"10"})}),(0,r.jsx)(t.td,{children:"websocket write timeout"})]})]})]})]})}function y(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(f,{...e})}):f(e)}function b(e){const t={a:"a",code:"code",h4:"h4",p:"p",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.a,{href:"https://oauth.net/2/pkce/",children:"Authorization Code Flow with PKCE or PKCE flow"})," requires configuring callback URLs the\r\nIdentity Provider (IdP) will allow redirecting to. If the URL for a specific client is not specifically listed, the IdP\r\nwill deny the authentication request. Depending on the technology used to authenticate to the OpenZiti Network,\r\ndifferent URLs need to be specified. More than one URL is allowed to be configured. Decide if you are configuring the\r\nIdP for use with tunnelers, with BrowZer or with both and add the appropriate callback urls."]}),"\n",(0,r.jsx)(t.p,{children:'In the Auth0 dashboard, with the application selected, choose the "Settings" tab and scroll down to the "Application\r\nURIs" section and add the URLs.'}),"\n",(0,r.jsx)(t.h4,{id:"for-tunnelers",children:"For Tunnelers"}),"\n",(0,r.jsxs)(t.p,{children:["Tunnelers require an allowed callback URL of: ",(0,r.jsx)(t.code,{children:"http://localhost:20314/auth/callback"}),"."]}),"\n",(0,r.jsx)(t.h4,{id:"for-browzer",children:"For BrowZer"}),"\n",(0,r.jsxs)(t.p,{children:["The URL to configure for BrowZer will vary depending on the BrowZer configuration. BrowZer requires a wildcard\r\ncertificate in order to be deployed and all services are delivered from this wildcard domain. You will need to add\r\nthe configured ",(0,r.jsx)(t.a,{href:"/docs/openziti/learn/quickstarts/browzer/example/#get-a-wildcard-certificate",children:"wildcard domain"})," as the\r\ncallback url."]}),"\n",(0,r.jsx)(t.h4,{id:"for-ziti-admin-console-zac",children:"For Ziti Admin Console (ZAC)"}),"\n",(0,r.jsxs)(t.p,{children:["The URL to configure an IdP for so that ZAC will be able to authenticate will depend on how you deploy your ZAC. The\r\ncurrent method recommended to deploy ZAC will deploy it on the same URL as the controller. For example:\r\n",(0,r.jsx)(t.a,{href:"https://controller.example.com/zac/callback",children:"https://controller.example.com/zac/callback"})]})]})}function v(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(b,{...e})}):b(e)}function w(e){const t={a:"a",code:"code",h2:"h2",hr:"hr",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{id:"required-fields",children:"Required Fields"}),"\n",(0,r.jsxs)(t.p,{children:["The following fields are necessary in order to configure an external JWT signer with OpenZiti. This configuration will\r\nenable authentication via JWTs obtained through an\r\n",(0,r.jsx)(t.a,{href:"https://oauth.net/2/pkce/",children:"Authorization Code Flow with PKCE or PKCE flow"}),". OpenID Connect providers will provide a\r\ndiscovery endpoint that is useful for discovering the ",(0,r.jsx)(t.strong,{children:"Issuer"})," and the ",(0,r.jsx)(t.strong,{children:"JWKS Endpoint"})," needed to complete the\r\nexternal jwt signer setup."]}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Field"}),(0,r.jsx)(t.th,{children:"Description"}),(0,r.jsx)(t.th,{children:"Example"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"Issuer"})}),(0,r.jsxs)(t.td,{children:["The issuer field is a unique HTTPS URL that identifies the OpenID Provider. It must match the ",(0,r.jsx)(t.code,{children:"iss"})," claim provided in the JWT"]}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://my.identity.provider:2345",children:"https://my.identity.provider:2345"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"Client ID"})}),(0,r.jsx)(t.td,{children:"The unique value provided by the OIDC provider used to identify the application within the provider to use"}),(0,r.jsx)(t.td,{children:"openziti_client_id"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"Audience"})}),(0,r.jsxs)(t.td,{children:["The audience, specified as the ",(0,r.jsx)(t.code,{children:"aud"})," field in the JWT, used to verify the JWT is intended for the OpenZiti Controller"]}),(0,r.jsx)(t.td,{children:"openziti_client_id"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"External Auth URL"})}),(0,r.jsx)(t.td,{children:"For OIDC, this is the same value as the issuer and should be the base url of the OIDC discovery endpoint (.well-known/openid-configuration)"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://my.identity.provider:2345",children:"https://my.identity.provider:2345"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"JWKS Endpoint"})}),(0,r.jsxs)(t.td,{children:["A url the OpenZiti Controller can use to retrieve a ",(0,r.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/JSON_Web_Token",children:"JSON Web Key Set"}),", used to verify JWTs"]}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.a,{href:"https://my.identity.provider:2345/.well-known/openid-configuration",children:"https://my.identity.provider:2345/.well-known/openid-configuration"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"Claims Property"})}),(0,r.jsx)(t.td,{children:"The property within the JWT returned from the OIDC provider that will map to the external ID field of an identity"}),(0,r.jsx)(t.td,{children:"email"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"Scopes"})}),(0,r.jsx)(t.td,{children:"The set of scopes to request when generating the authentication request to the OIDC provider"}),(0,r.jsx)(t.td,{children:"profile offline_access"})]})]})]})]})}function k(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(w,{...e})}):w(e)}function z(e){const t={a:"a",admonition:"admonition",p:"p",strong:"strong",...(0,s.R)(),...e.components};return(0,r.jsxs)(t.admonition,{title:"Enhancing the Console with valid SSL Certificates",type:"note",children:[(0,r.jsx)(t.p,{children:"As mentioned above, the ZAC will produce TLS warnings in the browser. It is encouraged to fix this.\nValid certificates will promote confidence in the implementation. Let's Encrypt provides a free, automated\nway to obtain trusted certificates."}),(0,r.jsxs)(t.p,{children:["See ",(0,r.jsx)(t.a,{href:"/docs/openziti/guides/deployments/console",children:(0,r.jsx)(t.strong,{children:"The Console and Alternative Server Certificates"})}),"\nfor details on how to integrate."]})]})}function A(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(z,{...e})}):z(e)}function T(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"ziti-android-quickstart",children:"Ziti Android Quickstart"})}),"\n",(0,r.jsxs)(t.p,{children:["This is a simple app that demonstrates the use of ",(0,r.jsx)(t.a,{href:"https://github.com/openziti/ziti-sdk-android",children:"the Ziti SDK for Android"})," (Kotlin). You will need the files in ",(0,r.jsx)(t.a,{href:"https://github.com/openziti/ziti-android-app",children:"this Git repository"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Android studio or other Android IDE"}),"\n",(0,r.jsx)(t.li,{children:"Android simulator or device to run the app"}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"running-the-app",children:"Running the app"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Run one of ",(0,r.jsx)(t.a,{href:"https://docs.openziti.io/docs/learn/quickstarts/network/",children:"the quickstarts"})," to create a Ziti network."]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"Create a service that is used by this app:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"name = ziti-weather-service\nhostname = wttr.ziti\nport = 80\n\nendpoint host = wttr.in\nendpoint port = 80\nendpoint protocol = tcp\n"})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"Create an identity for the device running this. You'll need one identity per device.\nYou will need to configure access to the service for your new identity.\nDownload enrollment JWT and copy it to the device."}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Once the app starts it will show notification to let user know that the app has not been enrolled\n",(0,r.jsx)(t.img,{alt:"no-enrollment",src:n(45006).A+"",width:"540",height:"1080"})]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Tapping the notification allows you to select enrollent token\n",(0,r.jsx)(t.img,{alt:"pick-jwt",src:n(96069).A+"",width:"540",height:"1080"})]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["If enrollment is successful it shows shows notification on the screen\n",(0,r.jsx)(t.img,{alt:"success",src:n(57796).A+"",width:"540",height:"1080"})]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"After that the app can be used -- pushing the message button should load current weather\nfor Charlotte on the screen"}),"\n"]}),"\n"]})]})}function I(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(T,{...e})}):T(e)}function S(e){const t={code:"code",em:"em",p:"p",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"ziti-edge-tunnel run"})," provides a built-in nameserver for the services it is authorized to dial. The nameserver is automatically configured by ",(0,r.jsx)(t.code,{children:"systemd-resolved"}),", if enabled."]}),"\n",(0,r.jsxs)(t.p,{children:["If ",(0,r.jsx)(t.code,{children:"systemd-resolved"})," is not enabled, you must configure your resolver to query the tunneler's nameserver. Add Ziti's nameserver to the connection manager, e.g., NetworkManager, Netplan, or by directly editing ",(0,r.jsx)(t.code,{children:"/etc/resolv.conf"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"You may configure the system resolver to use the tunneler's nameserver as the first or only nameserver."}),"\n",(0,r.jsxs)(t.p,{children:["When the tunneler nameserver is the first of multiple nameservers and the requested DNS record does not match an authorized service's intercept domain name, it sets the query status to ",(0,r.jsx)(t.code,{children:"REFUSE"}),". This implies that the caller ",(0,r.jsx)(t.em,{children:"should"})," keep trying to resolve the domain name with other nameservers."]}),"\n",(0,r.jsxs)(t.p,{children:["To use the tunneler nameserver as the only nameserver, you must specify an upstream nameserver for recursion: ",(0,r.jsx)(t.code,{children:"ziti-edge-tunnel run --dns-upstream 208.67.222.222"}),". In this configuration, the query status from the upstream nameserver is returned, e.g., ",(0,r.jsx)(t.code,{children:"NXDOMAIN"})," if the domain name is not found in the tunneler nameserver or the upstream nameserver."]}),"\n",(0,r.jsxs)(t.p,{children:["The IP address of the nameserver (default: ",(0,r.jsx)(t.code,{children:"100.64.0.2"}),") is determined by the tunneler's dns-ip-range (default: ",(0,r.jsx)(t.code,{children:"100.64.0.1/10"}),")."]})]})}function P(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(S,{...e})}):S(e)}function C(e){const t={a:"a",admonition:"admonition",code:"code",h3:"h3",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["The tunneller can run with zero or more identities loaded, and needs at least one to make OpenZiti services available on\nthe host. Adding an identity means providing a JWT enrollment token which is used by the tunneller to obtain a client\ncertificate from the OpenZiti controller. ",(0,r.jsx)(t.a,{href:"/docs/openziti/learn/core-concepts/identities/overview",children:"Learn more about OpenZiti Identities"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"add-a-single-identity",children:"Add a Single Identity"}),"\n",(0,r.jsxs)(t.p,{children:["Root and members of group ",(0,r.jsx)(t.code,{children:"ziti"})," may add an identity without restarting."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:'sudo ziti-edge-tunnel add --jwt "$(< ./in-file.jwt)" --identity myIdentityName\n'})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"/docs/openziti/learn/core-concepts/identities/enrolling",children:"Learn more about enrolling"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"load-identities-directory",children:"Load Identities Directory"}),"\n",(0,r.jsxs)(t.p,{children:["The tunneller will load all enrolled identities in the ",(0,r.jsx)(t.code,{children:"--identity-dir"})," directory at startup. The default location for\nidentities is is ",(0,r.jsx)(t.code,{children:"/opt/openziti/etc/identities"}),". Add enrolled identity files to this directory by copying the JSON file\ninto the directory and setting permissions for group ",(0,r.jsx)(t.code,{children:"ziti"}),"."]}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsxs)(t.p,{children:["Linux package users may place enrollment tokens named ",(0,r.jsx)(t.code,{children:"*.jwt"})," in this directory for automatic enrollment at next\nstartup."]})}),"\n",(0,r.jsxs)(t.p,{children:["Ensure the identities directory and its contents are writable by group ",(0,r.jsx)(t.code,{children:"ziti"})," to allow the tunneler to manage identities, e.g., renew certificates, and not readable by others to protect the confidentiality of the identities."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"sudo chown -cR :ziti        /opt/openziti/etc/identities\nsudo chmod -cR ug=rwX,o-rwx /opt/openziti/etc/identities\n"})}),"\n",(0,r.jsxs)(t.p,{children:["The tunneller process needs to be restarted if the contents of ",(0,r.jsx)(t.code,{children:"/opt/openziti/etc/identities"})," change."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:"# package users can restart with systemd\nsudo systemctl restart ziti-edge-tunnel.service\n"})})]})}function N(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(C,{...e})}):C(e)}function _(e){const t={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"run-the-openziti-tunneler-with-docker",children:"Run The OpenZiti Tunneler with Docker"})}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"[!IMPORTANT]\nPersistent, writable volumes are necessary for the tunneler to manage identity files, e.g., certificate renewal."}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"host-services-with-docker",children:"Host Services with Docker"}),"\n",(0,r.jsx)(t.p,{children:'The most popular way of using the Linux tunneler in Docker is to "host" an OpenZiti service, meaning as a reverse proxy and exit point from the OpenZiti network toward some target server. You can deploy the container before or after you grant it permission to start hosting the service and it will autonomously obey the OpenZiti controller.'}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"openziti/ziti-host"})," image simply runs ",(0,r.jsx)(t.code,{children:"ziti-edge-tunnel run-host"})," with the following helpful conventions for supplying an enrollment token and persisting the identity."]}),"\n",(0,r.jsx)(t.h3,{id:"enroll-and-persist-identity-in-a-volume",children:"Enroll and Persist Identity in a Volume"}),"\n",(0,r.jsxs)(t.p,{children:["Set the enrollment token and run the container. This example saves the identity file in the persistent volume: ",(0,r.jsx)(t.code,{children:"/ziti-edge-tunnel/ziti_id.json"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"services:\n    ziti-host:\n        image: docker.io/openziti/ziti-host\n        volumes:\n            - ziti-host:/ziti-edge-tunnel\n        environment:\n            - ZITI_ENROLL_TOKEN\nvolumes:\n    ziti-host:\n"})}),"\n",(0,r.jsx)(t.h3,{id:"use-an-enrolled-identity-from-the-environment",children:"Use an Enrolled Identity from the Environment"}),"\n",(0,r.jsx)(t.p,{children:"You may source an existing identity from an environment variable. The value will be written to the mounted volume and the variable ignored thereafter. The identity file in the mounted volume will be overwritten when the certificate is automatically renewed."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"services:\n    ziti-host:\n        image: docker.io/openziti/ziti-host\n        volumes:\n            - ziti-host:/ziti-edge-tunnel\n        environment:\n            - ZITI_IDENTITY_JSON\nvolumes:\n    ziti-host:\n"})}),"\n",(0,r.jsx)(t.h3,{id:"mount-a-writable-identity-file",children:"Mount a Writable Identity File"}),"\n",(0,r.jsxs)(t.p,{children:["You may mount an existing, writable identity file from the host's filesystem. The default path in the container's filesystem is ",(0,r.jsx)(t.code,{children:"/ziti-edge-tunnel/ziti_id.json"}),". Optionally, set ",(0,r.jsx)(t.code,{children:"ZITI_IDENTITY_BASENAME"})," to another filename prefix (default: ",(0,r.jsx)(t.code,{children:"ziti_id"}),"). Ensure the run-as UID",":GID"," has permission to read and write the file so that the tunneler can automatically renew its certificate."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"$ ls -ln ziti_id.json\n-rw-r--r-- 1 1001 1001 123456789 Jan 1 12:34 ziti_id.json\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'services:\n    ziti-host:\n        user: "1001:1001"\n        image: docker.io/openziti/ziti-host\n        volumes:\n            - ./ziti_id.json:/ziti-edge-tunnel/ziti_id.json\n'})}),"\n",(0,r.jsx)(t.h3,{id:"mount-a-writable-directory-of-identity-files",children:"Mount a Writable Directory of Identity Files"}),"\n",(0,r.jsxs)(t.p,{children:["You may mount a writable directory containing existing identities from the host's filesystem. The tunneler will load all valid, readable identities named ",(0,r.jsx)(t.code,{children:"/ziti-edge-tunnel/*.json"})," at startup. Ensure the run-as UID",":GID"," has permission to read, write, and list the files so that the tunneler can automatically renew its certificates."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"$ ls -lna identities\ndrwx------    1 1001 1001 4096 Apr 22 21:03 .\ndrwx-----x    2 1001 1001 4096 Apr 10 09:58 ..\n-rw-r--r--    1 1001 1001 6789 Jan  1 12:34 ziti_id.json\n-rw-r--r--    1 1001 1001 6789 Jan  1 12:34 ziti_id2.json\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'services:\n    ziti-host:\n        user: "1001:1001"\n        image: docker.io/openziti/ziti-host\n        volumes:\n            - ./identities:/ziti-edge-tunnel\n'})})]})}function L(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(_,{...e})}):_(e)}function R(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"ziti-edge-tunnel",children:"ziti-edge-tunnel"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.img,{src:"https://img.shields.io/badge/Version-1.3.0-informational?style=flat-square",alt:"Version: 1.3.0"})," ",(0,r.jsx)(t.img,{src:"https://img.shields.io/badge/Type-application-informational?style=flat-square",alt:"Type: application"})," ",(0,r.jsx)(t.img,{src:"https://img.shields.io/badge/AppVersion-1.7.13-informational?style=flat-square",alt:"AppVersion: 1.7.13"})]}),"\n",(0,r.jsx)(t.p,{children:"Dial OpenZiti services with a tunneler daemonset"}),"\n",(0,r.jsx)(t.h2,{id:"source-code",children:"Source Code"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["<",(0,r.jsx)(t.a,{href:"https://github.com/openziti/ziti-tunnel-sdk-c%3E",children:"https://github.com/openziti/ziti-tunnel-sdk-c>"})]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"requirements",children:"Requirements"}),"\n",(0,r.jsxs)(t.p,{children:["Kubernetes: ",(0,r.jsx)(t.code,{children:">= 1.20.0-0"})]}),"\n",(0,r.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(t.p,{children:"You may use this chart to reach services node-wide via your Ziti network via DNS. For example, if you create a repository or container registry Ziti service, and your cluster has no internet access, you can reach those repositories or container registries via Ziti services."}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"NOTE:"}),"\nFor one node kubernetes approaches like k3s, this works out-of-the-box and you can extend your coredns configuration to forward to the Ziti DNS IP, as you can see ",(0,r.jsx)(t.a,{href:"https://openziti.io/docs/guides/kubernetes/workload-tunneling/kubernetes-daemonset/",children:"here"}),".\nFor multinode kubernetes installations, where your cluster DNS could run on a different node, you need to install the ",(0,r.jsx)(t.a,{href:"https://kubernetes.io/docs/tasks/administer-cluster/nodelocaldns/",children:"node-local-dns"})," feature, which secures that the Ziti DNS name will be resolved locally, on the very same tunneler, as Ziti Intercept IPs can change from node to node. See ",(0,r.jsx)(t.a,{href:"https://github.com/lablabs/k8s-nodelocaldns-helm",children:"this"})," helm chart for a possible implementation."]}),"\n",(0,r.jsx)(t.h2,{id:"how-this-chart-works",children:"How this Chart Works"}),"\n",(0,r.jsxs)(t.p,{children:["This chart deploys a DaemonSet running ",(0,r.jsx)(t.a,{href:"https://docs.openziti.io/docs/reference/tunnelers/linux/",children:"the OpenZiti Linux tunneler"}),", in transparent node-level proxy with DNS nameserver. The chart uses container image ",(0,r.jsx)(t.code,{children:"docker.io/openziti/ziti-edge-tunnel"})," which runs ",(0,r.jsx)(t.code,{children:"ziti-edge-tunnel run"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"identity-storage-options",children:"Identity Storage Options"}),"\n",(0,r.jsx)(t.p,{children:"The chart supports two approaches for persisting the tunneler's Ziti identity:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"PersistentVolumeClaim (Default)"}),": Identity is stored in a volume, allowing the tunneler to autonomously renew its certificate."]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Existing Secret"}),": Identity is mounted from a pre-created Kubernetes secret (read-only). This approach requires manual certificate management since the tunneler cannot write updates."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-console",children:"helm repo add openziti https://docs.openziti.io/helm-charts/\n"})}),"\n",(0,r.jsx)(t.h4,{id:"identity-storage-preferred---identity-in-pvc-from-enrollment-token",children:"Identity Storage (Preferred) - Identity in PVC from Enrollment Token"}),"\n",(0,r.jsx)(t.p,{children:"Provide the enrollment token as a JWT. The identity will be enrolled on first run and stored in a PVC, allowing autonomous certificate renewal. This is preferred for security because only the one-time enrollment token must be orchestrated, and the private key is generated in-place during first-run enrollment."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-console",children:"helm install ziti-edge-tunnel openziti/ziti-edge-tunnel --set-file zitiEnrollToken=/tmp/k8s-tunneler.jwt\n"})}),"\n",(0,r.jsx)(t.h4,{id:"identity-storage-option---pre-enrolled-identity-in-pvc",children:"Identity Storage Option - Pre-Enrolled Identity in PVC"}),"\n",(0,r.jsx)(t.p,{children:"Alternatively, you may supply a pre-enrolled identity as JSON. The identity will be stored in a PVC, allowing autonomous certificate renewal."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-console",children:"ziti-edge-tunnel enroll --jwt /tmp/k8s-tunneler.jwt --identity /tmp/k8s-tunneler.json\nhelm install ziti-edge-tunnel openziti/ziti-edge-tunnel --set-file zitiIdentity=/tmp/k8s-tunneler.json\n"})}),"\n",(0,r.jsx)(t.h4,{id:"identity-storage-option---existing-secret",children:"Identity Storage Option - Existing Secret"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"\u26a0\ufe0f Warning:"})," This approach disables autonomous certificate renewal. You must manually manage certificate updates, private key rolling, etc."]}),"\n",(0,r.jsx)(t.p,{children:"Create the secret:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-console",children:"kubectl create secret generic k8s-tunneler-identity --from-file=zitiIdentity=k8s-tunneler.json\n"})}),"\n",(0,r.jsx)(t.p,{children:"Deploy with the existing secret:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-console",children:"helm install ziti-edge-tunnel openziti/ziti-edge-tunnel --set secret.existingSecretName=k8s-tunneler-identity\n"})}),"\n",(0,r.jsxs)(t.p,{children:["You may specify another Kubernetes Secret resource data key name if your existing secret does not store the identity under the key ",(0,r.jsx)(t.code,{children:"persisted-identity"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-console",children:"helm install ziti-edge-tunnel openziti/ziti-edge-tunnel \\\n  --set secret.existingSecretName=k8s-tunneler-identity \\\n  --set secret.keyName=myKeyName\n"})}),"\n",(0,r.jsx)(t.h3,{id:"pvc-configuration-options-1--2-only",children:"PVC Configuration (Options 1 & 2 only)"}),"\n",(0,r.jsx)(t.p,{children:"When using PVC storage (Options 1 & 2), you can configure the PersistentVolumeClaim settings. The chart uses ReadWriteMany access mode by default for DaemonSet compatibility:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-console",children:"# Configure access mode (ReadWriteMany is default for multi-node DaemonSets)\nhelm install ziti-edge-tunnel openziti/ziti-edge-tunnel \\\n  --set-file zitiIdentity=/tmp/k8s-tunneler.json \\\n  --set pvc.accessMode=ReadWriteOnce\n\n# Configure storage class (uses cluster default if not set)\nhelm install ziti-edge-tunnel openziti/ziti-edge-tunnel \\\n  --set-file zitiIdentity=/tmp/k8s-tunneler.json \\\n  --set pvc.storageClass=nfs\n\n# Configure storage size (default is 2Gi)\nhelm install ziti-edge-tunnel openziti/ziti-edge-tunnel \\\n  --set-file zitiIdentity=/tmp/k8s-tunneler.json \\\n  --set pvc.storageSize=5Gi\n\n# Combine multiple PVC settings\nhelm install ziti-edge-tunnel openziti/ziti-edge-tunnel \\\n  --set-file zitiIdentity=/tmp/k8s-tunneler.json \\\n  --set pvc.accessMode=ReadWriteMany \\\n  --set pvc.storageClass=nfs \\\n  --set pvc.storageSize=1Gi\n"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Important:"})," For DaemonSets running on multiple nodes, your storage class must support ",(0,r.jsx)(t.code,{children:"ReadWriteMany"})," access mode. If your cluster doesn't support RWX volumes, use Option 3 (existing secret) instead."]}),"\n",(0,r.jsx)(t.h3,{id:"system-integration",children:"System Integration"}),"\n",(0,r.jsx)(t.h4,{id:"d-bus-socket-configuration",children:"D-Bus Socket Configuration"}),"\n",(0,r.jsx)(t.p,{children:"The tunneler can integrate with systemd-resolved via D-Bus to configure the node's system resolver automatically. This is enabled by default."}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"\u26a0\ufe0f Important:"})," If systemd-resolved integration is disabled, you must manually configure the node's resolver to query the tunneler's nameserver first for proper DNS interception."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-console",children:"# Disable D-Bus integration (if causing issues)\nhelm install ziti-edge-tunnel openziti/ziti-edge-tunnel \\\n  --set-file zitiIdentity=/tmp/k8s-tunneler.json \\\n  --set systemDBus.enabled=false\n\n# Use different D-Bus socket path (if default doesn't exist)\nhelm install ziti-edge-tunnel openziti/ziti-edge-tunnel \\\n  --set-file zitiIdentity=/tmp/k8s-tunneler.json \\\n  --set systemDBus.systemDBusSocketMnt=/run/dbus/system_bus_socket\n"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Common D-Bus socket paths:"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"/var/run/dbus/system_bus_socket"})," (default, most distributions)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"/run/dbus/system_bus_socket"})," (systemd-based systems)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"/var/lib/dbus/system_bus_socket"})," (some older systems)"]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Troubleshooting:"})," If you see ",(0,r.jsx)(t.code,{children:"hostPath type check failed: ... is not a socket file"}),", either:"]}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Verify the correct D-Bus socket path on your nodes: ",(0,r.jsx)(t.code,{children:"ls -la /var/run/dbus/"})]}),"\n",(0,r.jsxs)(t.li,{children:["Disable D-Bus integration with ",(0,r.jsx)(t.code,{children:"--set systemDBus.enabled=false"})]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"configure-coredns",children:"Configure CoreDNS"}),"\n",(0,r.jsxs)(t.p,{children:["If you want to resolve your Ziti domain inside the pods, you need to customize CoreDNS. See ",(0,r.jsx)(t.a,{href:"https://openziti.io/docs/guides/kubernetes/workload-tunneling/kubernetes-daemonset/",children:"Official docs"}),"."]}),"\n",(0,r.jsx)(t.h4,{id:"multinode-example",children:"Multinode example"}),"\n",(0,r.jsx)(t.p,{children:"Customise ConfigMap that you apply for node-local-dns by appending the ziti specific domain and the upstream DNS server of ziti-edge-tunnel,"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: node-local-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io/mode: Reconcile\ndata:\n  Corefile: |\n    your.ziti.domain:53 {\n        log\n        errors\n        reload\n        loop\n        bind __PILLAR__LOCAL__DNS__ __PILLAR__DNS__SERVER__\n        forward . 100.64.0.2\n        prometheus :9253\n        }\n    __PILLAR__DNS__DOMAIN__:53 {\n        errors\n        reload\n        loop\n        bind __PILLAR__LOCAL__DNS__ __PILLAR__DNS__SERVER__\n        forward . 100.64.0.2\n        prometheus :9253\n        health __PILLAR__LOCAL__DNS__:8080\n        }\n    in-addr.arpa:53 {\n        errors\n        cache 30\n        reload\n        loop\n        bind __PILLAR__LOCAL__DNS__ __PILLAR__DNS__SERVER__\n        forward . __PILLAR__CLUSTER__DNS__ {\n                force_tcp\n        }\n        prometheus :9253\n        }\n    ip6.arpa:53 {\n        errors\n        cache 30\n        reload\n        loop\n        bind __PILLAR__LOCAL__DNS__ __PILLAR__DNS__SERVER__\n        forward . __PILLAR__CLUSTER__DNS__ {\n                force_tcp\n        }\n        prometheus :9253\n        }\n    .:53 {\n        errors\n        cache 30\n        reload\n        loop\n        bind __PILLAR__LOCAL__DNS__ __PILLAR__DNS__SERVER__\n        forward . __PILLAR__UPSTREAM__SERVERS__\n        prometheus :9253\n        }\n"})}),"\n",(0,r.jsx)(t.p,{children:"Refer to the documentation of NodeLocal DNSCache on how to replace the values starting with two underscores and then apply it by,"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-console",children:"kubectl apply -f nodelocaldns.yaml\n"})}),"\n",(0,r.jsx)(t.h4,{id:"one-node-example",children:"One node example"}),"\n",(0,r.jsx)(t.p,{children:"Customize CoreDNS configuration,"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-console",children:"kubectl -n kube-system apply -f - <<EOF\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: coredns-custom\n  namespace: kube-system\ndata:\n  ziti.server: |\n    your.ziti.domain {\n      forward . 100.64.0.2\n    }\nEOF\n"})}),"\n",(0,r.jsx)(t.p,{children:"Reload CoreDNS config,"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-console",children:"kubectl rollout restart -n kube-system deployment/coredns\n"})}),"\n",(0,r.jsx)(t.h3,{id:"air-gapped-installations",children:"Air gapped installations"}),"\n",(0,r.jsxs)(t.p,{children:["For air gapped clusters, which mirrors their registries over this OpenZiti tunneler,\nthe upgrade will present the chicken-and-egg problem, and the DaemonSet will stay\nat the ",(0,r.jsx)(t.em,{children:"ImagePullBackOff"})," state for ever.\nTo work this problem around, you can install the ",(0,r.jsx)(t.a,{href:"https://github.com/enthus-it/helm-charts/tree/main/charts/prepull-daemonset",children:"prepull-daemonset"}),"\nHelm chart, which can pull the new ",(0,r.jsx)(t.code,{children:"ziti-edge-tunnel"})," image Version needed in beforehand.\nOnce the image is present on every node, you can proceed to upgrade the tunneler without problems."]}),"\n",(0,r.jsx)(t.h2,{id:"values-reference",children:"Values Reference"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Key"}),(0,r.jsx)(t.th,{children:"Type"}),(0,r.jsx)(t.th,{children:"Default"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"additionalVolumes"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{children:"additional volumes to mount to ziti-edge-tunnel container"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"affinity"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"dnsPolicy"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"ClusterFirstWithHostNet"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"fullnameOverride"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"hostNetwork"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.args"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.command"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.pullPolicy"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"IfNotPresent"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.registry"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"docker.io"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.repository"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"openziti/ziti-edge-tunnel"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"image.tag"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"imagePullSecrets"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"livenessProbe.exec.command[0]"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"/bin/bash"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"livenessProbe.exec.command[1]"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"-c"'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"livenessProbe.exec.command[2]"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:'`"if (ziti-edge-tunnel tunnel_status'}),(0,r.jsx)(t.td,{children:"jq '.Success'); then true; else false; fi\"`"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"livenessProbe.failureThreshold"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"3"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"livenessProbe.initialDelaySeconds"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"180"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"livenessProbe.periodSeconds"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"60"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"livenessProbe.successThreshold"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"1"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"livenessProbe.timeoutSeconds"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"10"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"log.timeFormat"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"utc"'})}),(0,r.jsx)(t.td,{children:'Set log time format, if set to "utc", then in UTC format, otherwise in milliseconds since the program has started.'})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"log.tlsUVLevel"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"3"})}),(0,r.jsx)(t.td,{children:"TLSUV log level, from 0 to 6 (see README.md Reference)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"log.zitiLevel"}),(0,r.jsx)(t.td,{children:"int"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"3"})}),(0,r.jsx)(t.td,{children:"Ziti log level, from 0 to 6 (see README.md Reference)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"nameOverride"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"nodeSelector"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"constrain worker nodes where the ziti-edge-tunnel pod can be scheduled"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"podAnnotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"podSecurityContext"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"ports"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"pvc.accessMode"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"ReadWriteMany"'})}),(0,r.jsx)(t.td,{children:"Access mode for the identity PVC (ReadWriteMany recommended for DaemonSets)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"pvc.storageClass"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"Storage class for the identity PVC (uses cluster default if empty)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"pvc.storageSize"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"2Gi"'})}),(0,r.jsx)(t.td,{children:"Storage size for the identity PVC"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"resources"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"secret.existingSecretName"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"Use an existing secret name (if set, disables PVC and certificate auto-renewal)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"secret.keyName"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"persisted-identity"'})}),(0,r.jsx)(t.td,{children:"Key name in the secret containing the identity JSON encoding"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"securityContext.privileged"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"serviceAccount.annotations"}),(0,r.jsx)(t.td,{children:"object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"{}"})}),(0,r.jsx)(t.td,{children:"Annotations to add to the service account"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"serviceAccount.create"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"Specifies whether a service account should be created"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"serviceAccount.name"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"The name of the service account to use. If not set and create is true, a name is generated using the fullname template"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"spireAgent.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"false"})}),(0,r.jsx)(t.td,{children:"if you are running a container with the spire-agent binary installed then this will allow you to add the hostpath necessary for connecting to the spire socket"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"spireAgent.spireSocketMnt"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"/run/spire/sockets"'})}),(0,r.jsx)(t.td,{children:"file path of the spire socket mount"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"systemDBus.enabled"}),(0,r.jsx)(t.td,{children:"bool"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"true"})}),(0,r.jsx)(t.td,{children:"Enable D-Bus socket connection for systemd-resolved integration"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"systemDBus.systemDBusSocketMnt"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'"/var/run/dbus/system_bus_socket"'})}),(0,r.jsx)(t.td,{children:"Host path to the system D-Bus socket (varies by distribution)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"tolerations"}),(0,r.jsx)(t.td,{children:"list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"[]"})}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"zitiEnrollToken"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"JWT to enroll a new identity and write in the PVC"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"zitiIdentity"}),(0,r.jsx)(t.td,{children:"string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:'""'})}),(0,r.jsx)(t.td,{children:"JSON of an enrolled identity to write in the PVC"})]})]})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-console",children:"helm upgrade {release} {source dir}\n"})}),"\n",(0,r.jsx)(t.h3,{id:"log-level-reference",children:"Log Level Reference"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"https://openziti.io/docs/reference/tunnelers/linux/linux-tunnel-options/#ziti-edge-tunnel-environment-variables",children:"OpenZiti tunneler"})," and ",(0,r.jsx)(t.a,{href:"https://github.com/openziti/tlsuv",children:"TLSUV"})," log levels are represented by integers, as follows,"]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{style:{textAlign:"center"},children:(0,r.jsx)(t.em,{children:"Log Level"})}),(0,r.jsx)(t.th,{style:{textAlign:"center"},children:(0,r.jsx)(t.em,{children:"Value"})})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"NONE"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"0"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"ERR"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"1"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"WARN"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"2"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"INFO (default)"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"3"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"DEBUG"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"4"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"VERBOSE"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"5"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"TRACE"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"6"})]})]})]})]})}function D(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(R,{...e})}):R(e)}const E=({children:e})=>{const t=(0,i.useRef)(!1);i.useEffect((()=>{t.current=!1}),[e]);const n={h1:e=>t.current?(0,r.jsx)("h1",{...e}):(t.current=!0,null)};return(0,r.jsx)(s.x,{components:n,children:e})};n(61426)},61426:(e,t,n)=>{n.d(t,{A:()=>r});n(96540);var i=n(74848);function r(e){const{children:t,style:n}=e;return(0,i.jsx)("span",{style:n,children:(0,i.jsx)("span",{style:{color:"var(--ifm-color-primary)"},children:t})})}},38947:(e,t,n)=>{n.d(t,{A:()=>d});n(96540);var i=n(27293);const r="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDI3LjguMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IlN0cm9rZV9Db2xvciIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IgoJIHk9IjBweCIgdmlld0JveD0iMCAwIDkuOCAxOS41IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA5LjggMTkuNTsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJLnN0MHtmaWxsOiM2NjgyOTE7fQo8L3N0eWxlPgo8Zz4KCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik05LjgsMTEuNmMwLTAuMi0wLjEtMC40LTAuMi0wLjVMNS4zLDcuNGMtMC4yLTAuMi0wLjYtMC4yLTAuOCwwbC00LjMsMy43QzAsMTEuMy0wLjEsMTEuNywwLjIsMTIKCQljMC4yLDAuMywwLjYsMC4zLDAuOSwwLjFsMy45LTMuM2wzLjksMy4zYzAuMywwLjIsMC43LDAuMiwwLjktMC4xQzkuOCwxMS45LDkuOCwxMS43LDkuOCwxMS42eiIvPgo8L2c+Cjwvc3ZnPgo=";var s=n(74848);function d(e){return"infoa"===e.type?(0,s.jsx)(i.A,{icon:(0,s.jsx)(s.Fragment,{}),title:(0,s.jsx)(s.Fragment,{}),...e}):"info2"===e.type?(0,s.jsx)(i.A,{icon:(0,s.jsx)(r,{}),title:(0,s.jsx)(s.Fragment,{}),...e}):(e.type,(0,s.jsx)(i.A,{...e}))}},93495:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/files/scenario-1-dynamic-596f54c7965121cc999ad7b0d837da05.yaml"},84267:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/files/scenario-2-single-default-325d28308d6d3dd764447f9585e22244.yaml"},88726:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/files/scenario-3-two-default-42051630ced72c4e5ca059ad371746cb.yaml"},89517:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/files/scenario-4-mixed-one-each-acf4f7946f1a484425bec2630f2e2fd7.yaml"},58949:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/files/scenario-5-one-additional-only-002263964d46f077a755bc5b89893e8e.yaml"},95361:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/files/scenario-6-one-explicit-one-implicit-default-878543cbc356660e457d2109413c4fba.yaml"},57796:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/enrollment-success-1ef86296bc22a3c8b5d7ba558d7b82e4.png"},45006:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/no-enrollment-8b88f8870847b8b38e4ff2aa053e85d9.png"},96069:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/pick-jwt-307e1b1be38bb7c379e72b4641e87e39.png"},70611:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/zac-create-ext-jwt-signer-3-537a35d3568eb26ee4089f9940273e70.png"},86173:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/zac-create-initial-fields-38e796a2347a432e5456b974ceac72e5.png"},98809:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/zac-ext-jwt-signer-basic-51a99f6a3e836ed6eb9ea3f4058cdcc9.png"}}]);