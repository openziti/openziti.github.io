"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[7655],{89133:(e,t,n)=>{n.d(t,{Ay:()=>a,RM:()=>o});var r=n(74848),i=n(28453);const o=[{value:"Steps",id:"steps",level:2}];function s(e){const t={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{id:"steps",children:"Steps"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Create and validate your certificates (for example with Let's Encrypt Certbot)"}),"\n",(0,r.jsx)(t.li,{children:"Alter the controller configuration using example below as a guide"}),"\n",(0,r.jsxs)(t.li,{children:["Restart the ",(0,r.jsx)(t.code,{children:"ziti-controller"})," service"]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"See the example configuration here:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'web:\n  - name: client-management\n    identity:\n      ...\n      alt_server_certs:\n      - server_cert: "/etc/letsencrypt/live/<YOUR_DOMAIN_NAME>/fullchain.pem"\n        server_key:  "/etc/letsencrypt/live/<YOUR_DOMAIN_NAME>/privkey.pem"\n'})}),"\n",(0,r.jsx)(t.p,{children:'At this point, the controller service should use the certificates for the ZAC, removing any "Potential Security\nRisk" warnings.'})]})}function a(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(s,{...e})}):s(e)}},4541:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"guides/deployments/console","title":"Console Configuration","description":"Alternative Server Certificates","source":"@site/docs/guides/deployments/console.mdx","sourceDirName":"guides/deployments","slug":"/guides/deployments/console","permalink":"/docs/guides/deployments/console","draft":false,"unlisted":false,"editUrl":"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/guides/deployments/console.mdx","tags":[],"version":"current","lastUpdatedAt":1753336678000,"sidebarPosition":50,"frontMatter":{"sidebar_label":"Alternative Server Certificates","sidebar_position":50},"sidebar":"docsSidebar","previous":{"title":"Router","permalink":"/docs/guides/deployments/cloud/router"},"next":{"title":"Configuring OIDC","permalink":"/docs/guides/external-auth/"}}');var i=n(74848),o=n(28453),s=n(89133);const a={sidebar_label:"Alternative Server Certificates",sidebar_position:50},c="Console Configuration",l={},d=[{value:"Alternative Server Certificates",id:"alternative-server-certificates",level:2},...s.RM,{value:"Further details:",id:"further-details",level:2},{value:"Creating a DNS Record",id:"creating-a-dns-record",level:3},{value:"Install Let\u2019s Encrypt CertBot",id:"install-lets-encrypt-certbot",level:3},{value:"Configure DNS Provider Authentication",id:"configure-dns-provider-authentication",level:3},{value:"Obtain an SSL Certificate",id:"obtain-an-ssl-certificate",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"console-configuration",children:"Console Configuration"})}),"\n",(0,i.jsx)(t.h2,{id:"alternative-server-certificates",children:"Alternative Server Certificates"}),"\n",(0,i.jsx)(t.p,{children:"At the time of writing, ZAC 3.0+ is hosted by the controller, which is the likely direction of travel\nfor the future, and the current preferred configuration."}),"\n",(0,i.jsxs)(t.p,{children:["As mentioned in the ",(0,i.jsx)(t.a,{href:"/docs/reference/configuration/conventions#identity",children:"identity"})," section of the Conventions reference document, you can\nuse certificates from public CAs like Let's Encrypt and associate them with the controller config in order to\npresent valid certificates for the ZAC single page application."]}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"alt_server_certs"})," configuration key is an array of certificate information, so the first-matched server\ncertificate is presented to the TLS client (in this case, a browser)."]}),"\n",(0,i.jsxs)(t.p,{children:["To configure this correctly for the ZAC, the certificate paths need to be added to the ",(0,i.jsx)(t.code,{children:"alt_server_certs"})," array\nin the ",(0,i.jsx)(t.code,{children:"web"})," listener section, under the ",(0,i.jsx)(t.code,{children:"client-management"})," named config section."]}),"\n",(0,i.jsx)(s.Ay,{}),"\n",(0,i.jsxs)(t.admonition,{title:"Important note on listener",type:"note",children:[(0,i.jsx)(t.p,{children:(0,i.jsxs)(t.strong,{children:["The ZAC binding must share a web listener with the ",(0,i.jsx)(t.code,{children:"edge-management"})," binding."]})}),(0,i.jsxs)(t.p,{children:["If the ",(0,i.jsx)(t.code,{children:"edge-client"})," and ",(0,i.jsx)(t.code,{children:"edge-management"})," are not sharing a web listener (i.e. they are bound to separate\nweb listeners) then you must bind the ZAC to the listener where ",(0,i.jsx)(t.code,{children:"edge-management"})," binding is configured."]})]}),"\n",(0,i.jsx)(t.h2,{id:"further-details",children:"Further details:"}),"\n",(0,i.jsx)(t.h3,{id:"creating-a-dns-record",children:"Creating a DNS Record"}),"\n",(0,i.jsx)(t.p,{children:"Before generating an SSL certificate, ensure you have a valid DNS record pointing to the public IP address of\nyour server. This can be done through your DNS provider\u2019s control panel, dashboard, or directly via a domain\nregistrar."}),"\n",(0,i.jsx)(t.p,{children:"Ensure you wait for DNS propagation to complete before attempting ACME DNS-based challenge."}),"\n",(0,i.jsxs)(t.p,{children:["This may take a few minutes to a few hours, but you can use tools like ",(0,i.jsx)(t.a,{href:"https://toolbox.googleapps.com/apps/dig/#TXT/",children:"Google Admin Toolbox Dig"}),"\nto track the progress on the propagation."]}),"\n",(0,i.jsx)(t.h3,{id:"install-lets-encrypt-certbot",children:"Install Let\u2019s Encrypt CertBot"}),"\n",(0,i.jsxs)(t.p,{children:["General instructions for this can be found by visiting the\n",(0,i.jsx)(t.a,{href:"https://letsencrypt.org/docs/",children:"Let's Encrypt Documentation"}),", and  also by reviewing the documentation of\n",(0,i.jsx)(t.a,{href:"https://certbot.eff.org/instructions",children:"Certbot"}),". These documents go into detail about various bespoke\nconfiguratons so you can choose the right one for your scenario."]}),"\n",(0,i.jsxs)(t.p,{children:["A simple way to satisfy the DNS-based challenge from Let's Encrypt is to use the Certbot DNS plugin.\n",(0,i.jsx)(t.a,{href:"https://eff-certbot.readthedocs.io/en/latest/using.html#dns-plugins",children:"CertBot DNS Plugins"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["These are specific to DNS providers, but you can see an example of how they should be used in\n",(0,i.jsx)(t.a,{href:"https://www.digitalocean.com/community/tutorials/how-to-create-let-s-encrypt-wildcard-certificates-with-certbot",children:"this tutorial"})]}),"\n",(0,i.jsx)(t.h3,{id:"configure-dns-provider-authentication",children:"Configure DNS Provider Authentication"}),"\n",(0,i.jsxs)(t.p,{children:["CertBot requires access to your DNS provider\u2019s API to perform DNS-based domain validation. This is because\nit provisions a TXT resource in the domain, as per ",(0,i.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/html/rfc8555#section-8.4",children:"RFC8555"}),".\nFor this you will need to look up how to create the token from your DNS provider."]}),"\n",(0,i.jsx)(t.p,{children:"Other mechanisms of satisfying the challenge are available. However, this method allows for better automation."}),"\n",(0,i.jsxs)(t.p,{children:["Read the documentation from ",(0,i.jsx)(t.a,{href:"https://eff-certbot.readthedocs.io/en/latest/using.html#dns-plugins",children:"CertBot DNS Plugins"}),"\nto determine how to configure this correctly for your setup."]}),"\n",(0,i.jsx)(t.h3,{id:"obtain-an-ssl-certificate",children:"Obtain an SSL Certificate"}),"\n",(0,i.jsx)(t.p,{children:"Once all the above is correct, you can run CertBot using the DNS-based challenge. The following command\ndemonstrates the principle. You should change the DNS provider specific arguments to match your scenario."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"sudo certbot certonly \\\n  --dns-digitalocean \\\n  --dns-digitalocean-credentials ~/certbot-creds.ini \\\n  -d <YOUR_DOMAIN_NAME>\n"})}),"\n",(0,i.jsxs)(t.p,{children:["If all goes well, this request will generate an SSL certificate for your domain, which by default\nwill be stored in ",(0,i.jsx)(t.code,{children:"/etc/letsencrypt/live/<YOUR_DOMAIN_NAME>/"}),", matching the example configuration given above."]})]})}function u(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>a});var r=n(96540);const i={},o=r.createContext(i);function s(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);