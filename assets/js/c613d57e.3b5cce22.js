"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[76397],{13528:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var s=t(77645),i=t(74848),o=t(28453);const a={title:"Easy Steps to Install a Private VPN on Linux with zrok",seoTitle:"Install Private VPN on Linux with zrok",seoDescription:"Learn easy steps to install, configure, and join a private VPN on Linux using zrok.",date:new Date("2024-08-02T17:10:31.000Z"),cuid:"clzcynn3a000009kwfowoela4",slug:"zrok-vpn-linux-service",authors:["KennethBingham"],image:"@site/blogs/openziti/v1722617478239/b985c30b-aae1-42c1-a450-b3fd255b14a3.avif",imageDark:"@site/blogs/openziti/v1722617478239/b985c30b-aae1-42c1-a450-b3fd255b14a3.avif",tags:["vpn"]},r=void 0,c={authorsImageUrls:[void 0]},l=[{value:"Join the VPN from Another Device",id:"join-the-vpn-from-another-device",level:2},{value:"Share the Project",id:"share-the-project",level:2}];function h(e){const n={a:"a",code:"code",h2:"h2",img:"img",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["The great thing about the ",(0,i.jsx)(n.code,{children:"zrok-share.service"})," is that it comes with the ",(0,i.jsx)(n.code,{children:"zrok"})," binary and is always on in the background, so it's a good fit for a reliable VPN connection. Let's install the service and configure it to auto-start after a reboot."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -sSLf https://get.openziti.io/install.bash | sudo bash -s zrok-share\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Edit ",(0,i.jsx)(n.code,{children:"/opt/openziti/etc/zrok/zrok-share.env"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# env\nZROK_ENABLE_TOKEN="w9pEuX3Gb750"  # account token from the console\nZROK_ENVIRONMENT_NAME="my zrok vpn service on hostname"\n\n# share\nZROK_UNIQUE_NAME="mysecretsharetoken"\nZROK_BACKEND_MODE="vpn"\nZROK_TARGET="172.21.71.1/24"  # allocate ip in some private subnet\nZROK_FRONTEND_MODE="reserved-private"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["You can control access to your VPN by keeping ",(0,i.jsx)(n.code,{children:"ZROK_UNIQUE_NAME"})," a secret (the share token) or adding the following to restrict zrok accounts by email. Only your account can use the share in closed mode if you don't add grants."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'ZROK_PERMISSION_MODE="closed"\nZROK_ACCESS_GRANTS="alice@example.com bob@example.org"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Grant kernel capability ",(0,i.jsx)(n.code,{children:"NET_ADMIN"})," to the service."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo sed -Ei 's/.*AmbientCapabilities=CAP_NET_ADMIN/AmbientCapabilities=CAP_NET_ADMIN/' /etc/systemd/system/zrok-share.service.d/override.conf\nsudo systemctl daemon-reload\n"})}),"\n",(0,i.jsx)(n.p,{children:"Start the service now and auto-start after a reboot."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl enable --now zrok-share.service\n"})}),"\n",(0,i.jsx)(n.p,{children:"Check the logs."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo journalctl -lfu zrok-share.service\n"})}),"\n",(0,i.jsx)(n.p,{children:"The logs should look like this, confirming this device is allocated 172.21.71.1 on the VPN."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'Aug 02 16:33:08 ubuntu zrok-share.bash[6243]: {"level":"info","ts":1722616388.2556849,"msg":"interface created tun0"}\nAug 02 16:33:08 ubuntu zrok-share.bash[6243]: {"level":"info","ts":1722616388.255752,"msg":"exec /sbin/ip [link set dev tun0 mtu 16384]"}\nAug 02 16:33:08 ubuntu zrok-share.bash[6243]: {"level":"info","ts":1722616388.2595484,"msg":"exec /sbin/ip [addr add 172.21.71.1/24 dev tun0]"}\nAug 02 16:33:08 ubuntu zrok-share.bash[6243]: {"level":"info","ts":1722616388.2627363,"msg":"exec /sbin/ip [-6 addr add fd00:7a72:6f6b::1/64 dev tun0]"}\nAug 02 16:33:08 ubuntu zrok-share.bash[6243]: {"level":"info","ts":1722616388.2659466,"msg":"exec /sbin/ip [link set dev tun0 up]"}\nAug 02 16:33:08 ubuntu zrok-share.bash[6243]: {"level":"info","ts":1722616388.2711568,"msg":"interface configured tun0"}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"join-the-vpn-from-another-device",children:"Join the VPN from Another Device"}),"\n",(0,i.jsx)(n.p,{children:"The zrok console looks like this for an account with two environments, one per VPN peer, and one VPN share."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:t(65275).A+"",width:"672",height:"562"})}),"\n",(0,i.jsx)(n.p,{children:"To temporarily join the zrok VPN you only need to run this command."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo -E zrok access private mysecretsharetoken\n"})}),"\n",(0,i.jsx)(n.p,{children:"You will see zrok's terminal user interface (TUI) telling you what is happening. This second device will be allocated 172.21.71.2 and subsequent devices will get unique IP allocations when they join. This is a network-layer VPN. You can send ICMP, TCP, UDP, etc."}),"\n",(0,i.jsx)(n.p,{children:'Now, this second device is joined to the VPN, so it has a dashed line to the VPN share indicating a zrok "private access."'}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:t(71114).A+"",width:"671",height:"542"})}),"\n",(0,i.jsx)(n.h2,{id:"share-the-project",children:"Share the Project"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:t(53854).A+"",width:"300",height:"300"})}),"\n",(0,i.jsxs)(n.p,{children:["If you find this interesting, please ",(0,i.jsx)(n.a,{href:"https://github.com/openziti/zrok",children:"give zrok a star on GitHub"}),"!"]}),"\n",(0,i.jsxs)(n.p,{children:["Let us know if you found a good use for this or have an improvement or question in mind on ",(0,i.jsx)(n.a,{href:"https://twitter.com/openziti",children:(0,i.jsxs)(n.strong,{children:["X ",(0,i.jsx)("s",{children:"twitter"})]})}),", in ",(0,i.jsx)(n.a,{href:"https://www.reddit.com/r/openziti/",children:"/r/openziti"}),", or the ",(0,i.jsx)(n.a,{href:"https://openziti.discourse.group/",children:"Discourse forum"}),". We upload and stream ",(0,i.jsx)(n.a,{href:"https://youtube.com/openziti",children:(0,i.jsx)(n.strong,{children:"on YouTube"})})," too. We'd love to hear from you!"]})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},53854:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/7bb2b76c-af3f-45c6-83ab-d519f183024d-905dcc2bc7ef9850c54417500e23d7fa.png"},65275:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/3972fae3-e826-402f-82e9-9c3514f0bfe4-deec1dd6052e036d141a233a4e483765.png"},71114:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/969509da-0a39-4a4b-ad76-0c0dc0a524c9-ddbea2d6f7b99a0f05826ffb730ae25f.png"},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var s=t(96540);const i={},o=s.createContext(i);function a(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:n},e.children)}},77645:e=>{e.exports=JSON.parse('{"permalink":"/docs/openziti/blog/zrok-vpn-linux-service","source":"@site/blog/easy-steps-to-install-a-private-vpn-on-linux-with-zrok.md","title":"Easy Steps to Install a Private VPN on Linux with zrok","description":"The great thing about the zrok-share.service is that it comes with the zrok binary and is always on in the background, so it\'s a good fit for a reliable VPN connection. Let\'s install the service and configure it to auto-start after a reboot.","date":"2024-08-02T17:10:31.000Z","tags":[{"inline":false,"label":"VPN","permalink":"/docs/openziti/blog/tags/vpn","description":"VPN related content"}],"readingTime":2.81,"hasTruncateMarker":true,"authors":[{"name":"Kenneth Bingham","title":"Author","url":"https://github.com/qrkourier","imageURL":"https://avatars.githubusercontent.com/qrkourier","key":"KennethBingham","page":null}],"frontMatter":{"title":"Easy Steps to Install a Private VPN on Linux with zrok","seoTitle":"Install Private VPN on Linux with zrok","seoDescription":"Learn easy steps to install, configure, and join a private VPN on Linux using zrok.","date":"2024-08-02T17:10:31.000Z","cuid":"clzcynn3a000009kwfowoela4","slug":"zrok-vpn-linux-service","authors":["KennethBingham"],"image":"@site/blogs/openziti/v1722617478239/b985c30b-aae1-42c1-a450-b3fd255b14a3.avif","imageDark":"@site/blogs/openziti/v1722617478239/b985c30b-aae1-42c1-a450-b3fd255b14a3.avif","tags":["vpn"]},"unlisted":false,"prevItem":{"title":"zrok is Growing Up","permalink":"/docs/openziti/blog/zrok-is-growing-up"},"nextItem":{"title":"Jitsi, meet zrok","permalink":"/docs/openziti/blog/jitsi-meet-zrok"}}')}}]);