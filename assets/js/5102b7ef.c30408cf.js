"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[4899],{73687:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"learn/core-concepts/security/authentication/third-party-cas","title":"3rd Party CAs","description":"3rd Party CAs allow external private key infrastructures (PKIs) to be imported into Ziti and used for client enrollment","source":"@site/docs/learn/core-concepts/security/authentication/10-third-party-cas.md","sourceDirName":"learn/core-concepts/security/authentication","slug":"/learn/core-concepts/security/authentication/third-party-cas","permalink":"/docs/learn/core-concepts/security/authentication/third-party-cas","draft":false,"unlisted":false,"editUrl":"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/learn/core-concepts/security/authentication/10-third-party-cas.md","tags":[],"version":"current","lastUpdatedAt":1743027175000,"sidebarPosition":10,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Password Management","permalink":"/docs/learn/core-concepts/security/authentication/password-management"},"next":{"title":"API Session Certificates","permalink":"/docs/learn/core-concepts/security/authentication/api-session-certificates"}}');var r=n(74848),a=n(28453);const c={},s="3rd Party CAs",l={},d=[{value:"Usage",id:"usage",level:2},{value:"Create",id:"create",level:2},{value:"Verification",id:"verification",level:2},{value:"Ziti CLI",id:"ziti-cli",level:3},{value:"Create Verification Certificate &amp; Submit",id:"create-verification-certificate--submit",level:4},{value:"Submit Verification Certificate",id:"submit-verification-certificate",level:4},{value:"Edge Management API",id:"edge-management-api",level:3},{value:"External ID &amp; X509 Claims",id:"external-id--x509-claims",level:2},{value:"CA Create/Update REST API",id:"ca-createupdate-rest-api",level:4},{value:"Ziti CLI",id:"ziti-cli-1",level:4},{value:"Location, Matcher, Parser",id:"location-matcher-parser",level:3},{value:"Location",id:"location",level:4},{value:"Matcher &amp; Matcher Criteria",id:"matcher--matcher-criteria",level:4},{value:"Parser &amp; Parser Criteria",id:"parser--parser-criteria",level:4}];function o(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"3rd-party-cas",children:"3rd Party CAs"})}),"\n",(0,r.jsx)(i.p,{children:"3rd Party CAs allow external private key infrastructures (PKIs) to be imported into Ziti and used for client enrollment\nand authentication. Ziti does not allow external private keys from PKIs to be imported for 3rd party CAs. Creation and\ndistribution of client certificates must be handled outside of Ziti."}),"\n",(0,r.jsxs)(i.p,{children:["3rd Party CAs represent x509 Certificate chains that have the ",(0,r.jsx)(i.code,{children:"CA:true"})," constraint. It is worth noting\nthat adding a x509 certificate as a 3rd Party CA will treat it as a trust anchor even if it is an intermediate CA.\n3rd Part CAs validate partial chains back to a registered 3rd Party CA. If full chain validation is required, ensure\nthat the root CA is added as a 3rd Party CA and ensure authenticating clients provide their client certificate in\nindex zero and any required intermediate certificates afterwards."]}),"\n",(0,r.jsx)(i.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(i.p,{children:"3rd Party CAs can be used in the following manners:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["allows clients to enroll and authenticate automatically for at-scale network boarding - ",(0,r.jsx)(i.a,{href:"../enrollment#auto-ca-enrollment",children:"Auto CA Enrollment"})]}),"\n",(0,r.jsxs)(i.li,{children:["allows clients to enroll pre-created identities - ",(0,r.jsx)(i.a,{href:"../enrollment#ott-ca-enrollment",children:"OTT CA Enrollment"})]}),"\n",(0,r.jsxs)(i.li,{children:["allows clients to map to pre-created identities using ",(0,r.jsx)(i.code,{children:"externalId"})," and ",(0,r.jsx)(i.a,{href:"#external-id--x509-claims",children:"X509 Claims"})]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"create",children:"Create"}),"\n",(0,r.jsx)(i.p,{children:"Creating a 3rd Party CA has various option that will determine how the 3rd Party CA will be used and how client\ncertificates will be validated. The following fields configure client authentication:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"isAutoCaEnrollmentEnabled"})," - allows client certificates of the CA to automatically enroll when encountered"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"isOttCaEnrollmentEnabled"})," - allows client certificates of the CA to enroll if an identity with an ",(0,r.jsx)(i.code,{children:"ottca"})," enrollment was created"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"isAuthEnabled"})," - allows client certificates of the CA to attempt to enroll"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"externalIdClaim"})," - configuration used to pull values out of the x509 client certificate used to match identity ",(0,r.jsx)(i.code,{children:"externalId"}),", see ",(0,r.jsx)(i.a,{href:"#external-id--x509-claims",children:"External Id & x509 Claims"})]}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:["For ",(0,r.jsx)(i.a,{href:"../enrollment#auto-ca-enrollment",children:"Auto CA Enrollment"})," an identity is created on first authentication.\nThe following fields allow configuration of newly created identities:"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"identityRoles"})," - the identity roles to give to automatically enrolling identities"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"identityNameFormat"})," - the identity name format used to name ",(0,r.jsx)(i.a,{href:"../enrollment#auto-ca-enrollment",children:"automatically enrolling identities"})]}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:["On initial creation of a 3rd Party CA it will be in an unverified stated and must undergo ",(0,r.jsx)(i.a,{href:"#verification",children:"verification"}),".\nThe following fields relate to ",(0,r.jsx)(i.a,{href:"#verification",children:"verification"}),":"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"isVerified"})," - read only field of whether this CA has been verified"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"verificationToken"})," - read only displaying the verification token required to verify the CA"]}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"All other fields are for informational purposes:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"name"})," - the name of the given CA"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"fingerprint"})," - read only field of the sha1 fingerprint of the provided x509 certificate"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"certPem"})," - PEM encoded version of the CA"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"verification",children:"Verification"}),"\n",(0,r.jsxs)(i.p,{children:["In order for a 3rd Party CA to be used authentication and enrollment it must first be verified. While in an unverified\nstate ",(0,r.jsx)(i.code,{children:"isVerfieid"})," will be false and ",(0,r.jsx)(i.code,{children:"verificationToken"})," will contain a random security token. In order to verify\nthe 3rd Party CA a certificate with the ",(0,r.jsx)(i.code,{children:"verificationToken"})," set as the common name must be signed by the certificate\nprovided for the 3rd Party CA."]}),"\n",(0,r.jsx)(i.h3,{id:"ziti-cli",children:"Ziti CLI"}),"\n",(0,r.jsx)(i.p,{children:"The Ziti CLI can assist with creating a verification certificate in two ways. It can create the verification certificate\nand submit it or submit an already created certificate."}),"\n",(0,r.jsx)(i.h4,{id:"create-verification-certificate--submit",children:"Create Verification Certificate & Submit"}),"\n",(0,r.jsx)(i.p,{children:"Access to the CA's certificate and private key is required."}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.code,{children:" ziti edge verify ca <name> --cacert <signingCaCert> --cakey <signingCaKey> [--password <caKeyPassword>]"})}),"\n",(0,r.jsx)(i.h4,{id:"submit-verification-certificate",children:"Submit Verification Certificate"}),"\n",(0,r.jsxs)(i.p,{children:["Access to a certificate with the ",(0,r.jsx)(i.code,{children:"verifiationToken"})," set as the common name and signed by the 3rd Party CA is required"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.code,{children:"ziti edge verify ca <name> --cert <pemCertFile>"})}),"\n",(0,r.jsx)(i.h3,{id:"edge-management-api",children:"Edge Management API"}),"\n",(0,r.jsxs)(i.p,{children:["The ",(0,r.jsx)(i.a,{href:"/docs/reference/developer/api#edge-management-api",children:"edge management API"})," accepts and ",(0,r.jsx)(i.code,{children:"id"})," in the URL path and x509 certificate PEM\nas the body:"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.code,{children:"POST /edge/management/v1/cas/<id>/verify"})}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"\u2014\u2013BEGIN CERTIFICATE\u2014\u2013\nMIIDdTCCAl2gAwIBAgILBAAAAAABFUtaw5QwDQYJKoZIhvcNAQEFBQAwVzELMAkG\n...\nHMUfpIBvFSDJ3gyICh3WZlXi/EjJKSZp4A==\n\u2014\u2013END CERTIFICATE\u2014\u2013\n"})}),"\n",(0,r.jsx)(i.h2,{id:"external-id--x509-claims",children:"External ID & X509 Claims"}),"\n",(0,r.jsxs)(i.p,{children:["The base set of capabilities of x509 certificates do not allow the inclusion of custom private claims. Ziti internally\nuses ",(0,r.jsx)(i.a,{href:"https://github.com/openziti/x509-claims",children:"x509-claims"})," to allow claims data to be parsed from SANs and other\nfields. An example of this in other projects is ",(0,r.jsx)(i.a,{href:"https://spiffe.io/",children:"SPIFFE"}),". SPIFFE defines ",(0,r.jsx)(i.a,{href:"https://spiffe.io/docs/latest/spiffe-about/spiffe-concepts/#spiffe-id",children:"SPIFFE IDs"}),"\nwhich are stored in ",(0,r.jsx)(i.a,{href:"https://spiffe.io/docs/latest/spiffe-about/spiffe-concepts/#spiffe-verifiable-identity-document-svid",children:"SVIDs"}),"."]}),"\n",(0,r.jsxs)(i.p,{children:["3rd Party CAs support defining a set of x509 claims configuration that allows a claim to be matched to an identity\n",(0,r.jsx)(i.code,{children:"externalId"}),". The configuration is contained in an object in the field ",(0,r.jsx)(i.code,{children:"externalIdClaims"}),". When not defined, x509\nclient certificate authentication attempts to find an identity that is tied to an ",(0,r.jsx)(i.a,{href:"./auth#authenticators",children:"authenticator"}),"\nby matching client certificates. Using x509 claims, the client is matched by the identity ",(0,r.jsx)(i.code,{children:"externalId"})," value."]}),"\n",(0,r.jsxs)(i.p,{children:["The fields under ",(0,r.jsx)(i.code,{children:"externalIdClaims"})," is as follows:"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"location"})," - defines which value(s) in an x509 certificate will be processed: ",(0,r.jsx)(i.code,{children:"COMMON_NAME"}),", ",(0,r.jsx)(i.code,{children:"SAN_URI"}),", ",(0,r.jsx)(i.code,{children:"SAN_EMAIL"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"matcher"})," - defines how values from ",(0,r.jsx)(i.code,{children:"location"})," will be filtered: ",(0,r.jsx)(i.code,{children:"ALL"}),", ",(0,r.jsx)(i.code,{children:"PREFIX"}),", ",(0,r.jsx)(i.code,{children:"SUFFIX"}),", ",(0,r.jsx)(i.code,{children:"SCHEME"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"matcherCriteria"})," - defines the ",(0,r.jsx)(i.code,{children:"PREFIX"}),", ",(0,r.jsx)(i.code,{children:"SUFFIX"}),", or ",(0,r.jsx)(i.code,{children:"SCHEME"})," to look for based on ",(0,r.jsx)(i.code,{children:"matcher"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"parser"})," - defines how values from ",(0,r.jsx)(i.code,{children:"location"})," filtered by ",(0,r.jsx)(i.code,{children:"matcher"})," will be parsed: ",(0,r.jsx)(i.code,{children:"NONE"}),", ",(0,r.jsx)(i.code,{children:"SPLIT"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"parserCriteria"})," - defines the criteria to provide to ",(0,r.jsx)(i.code,{children:"parser"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"index"})," - should multiple values still be available after ",(0,r.jsx)(i.code,{children:"location"}),", ",(0,r.jsx)(i.code,{children:"matcher,"})," and ",(0,r.jsx)(i.code,{children:"parser"})," processing the integer value here will be used from the set"]}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"ca-createupdate-rest-api",children:"CA Create/Update REST API"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-text",children:'{\n  "name": "myCA",\n  "certPem": "\u2014\u2013BEGIN CERTIFICATE\u2014\u2013\\nMIIDdTCCAHMU...\\n\u2014\u2013END CERTIFICATE\u2014\u2013",\n  "externalIdClaims": {\n    "location": "SAN_URI",\n    "matcher": "SCHEME",\n    "parser": "NONE",\n    "parserCriteria": "",\n    "index": 0\n  }\n}\n'})}),"\n",(0,r.jsx)(i.h4,{id:"ziti-cli-1",children:"Ziti CLI"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:'ziti edge create ca myCa ca.pem \\\n    --location SAN_URI \\\n    --matcher SCHEME \\\n    --matcher-criteria spiffe \\\n    --parser "NONE"\n'})}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:'ziti edge update ca myCa \\\n    --location SAN_URI \\\n    --matcher SCHEME \\\n    --matcher-criteria spiffe \\\n    --parser "NONE"\n'})}),"\n",(0,r.jsx)(i.h3,{id:"location-matcher-parser",children:"Location, Matcher, Parser"}),"\n",(0,r.jsx)(i.p,{children:"x509 claims are located, matched, and parsed. Location defines where the value(s) are sourced from, matching filters,\nand parsing allows for a single value to yield multiple claims."}),"\n",(0,r.jsx)(i.h4,{id:"location",children:"Location"}),"\n",(0,r.jsx)(i.p,{children:"Location configuration sources value(s) from the x509 certificate"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"COMMON_NAME"})," - the common name of the certificate"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"SAN_URI"})," - SAN URI fields"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"SAN_EMAIL"})," - SAN email fields"]}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"matcher--matcher-criteria",children:"Matcher & Matcher Criteria"}),"\n",(0,r.jsxs)(i.p,{children:["Matcher and matcher criteria work together to filter fields. The ",(0,r.jsx)(i.code,{children:"matcher"})," uses ",(0,r.jsx)(i.code,{children:"matcherCritera"})," to perform basic\nfiltering."]}),"\n",(0,r.jsx)(i.p,{children:"Matcher values:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"ALL"})," - returns all values (i.e. no filtering)"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"PREFIX"})," - matches by the string prefix defined by ",(0,r.jsx)(i.code,{children:"matcherCriteria"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"SUFFIX"})," - matched by the string suffix defined by ",(0,r.jsx)(i.code,{children:"matcherCriteria"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"SCHEME"})," - a matcher that specializes in matching the protocol defined in ",(0,r.jsx)(i.code,{children:"matcherCriteria"})," of  a URI (used with ",(0,r.jsx)(i.code,{children:"SAN_URI"})," only)"]}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"parser--parser-criteria",children:"Parser & Parser Criteria"}),"\n",(0,r.jsx)(i.p,{children:"Parser and parser criteria work together to turn individual values from location and matching into multiple values.\nParsers allow a single value to contain more than one claim."}),"\n",(0,r.jsx)(i.p,{children:"Parser values:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"NONE"})," - perform no parsing"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"SPLIT"})," - perform string splitting based on the string separator defined by ",(0,r.jsx)(i.code,{children:"parserCriteria"})]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,a.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},28453:(e,i,n)=>{n.d(i,{R:()=>c,x:()=>s});var t=n(96540);const r={},a=t.createContext(r);function c(e){const i=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function s(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),t.createElement(a.Provider,{value:i},e.children)}}}]);