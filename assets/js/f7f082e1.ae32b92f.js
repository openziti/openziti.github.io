"use strict";(self.webpackChunkopen_ziti=self.webpackChunkopen_ziti||[]).push([[8145],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),p=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),m=p(n),d=a,h=m["".concat(s,".").concat(d)]||m[d]||c[d]||r;return n?i.createElement(h,l(l({ref:t},u),{},{components:n})):i.createElement(h,l({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,l=new Array(r);l[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[m]="string"==typeof e?e:a,l[1]=o;for(var p=2;p<r;p++)l[p]=n[p];return i.createElement.apply(null,l)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>l});var i=n(67294),a=n(86010);const r={tabItem:"tabItem_Ymn6"};function l(e){let{children:t,hidden:n,className:l}=e;return i.createElement("div",{role:"tabpanel",className:(0,a.Z)(r.tabItem,l),hidden:n},t)}},74866:(e,t,n)=>{n.d(t,{Z:()=>v});var i=n(87462),a=n(67294),r=n(86010),l=n(12466),o=n(16550),s=n(91980),p=n(67392),u=n(50012);function m(e){return function(e){return a.Children.map(e,(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:i,default:a}}=e;return{value:t,label:n,attributes:i,default:a}}))}function c(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=t??m(n);return function(e){const t=(0,p.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function d(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:n}=e;const i=(0,o.k6)(),r=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,s._X)(r),(0,a.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(i.location.search);t.set(r,e),i.replace({...i.location,search:t.toString()})}),[r,i])]}function k(e){const{defaultValue:t,queryString:n=!1,groupId:i}=e,r=c(e),[l,o]=(0,a.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!d({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const i=n.find((e=>e.default))??n[0];if(!i)throw new Error("Unexpected error: 0 tabValues");return i.value}({defaultValue:t,tabValues:r}))),[s,p]=h({queryString:n,groupId:i}),[m,k]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[i,r]=(0,u.Nk)(n);return[i,(0,a.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:i}),b=(()=>{const e=s??m;return d({value:e,tabValues:r})?e:null})();(0,a.useLayoutEffect)((()=>{b&&o(b)}),[b]);return{selectedValue:l,selectValue:(0,a.useCallback)((e=>{if(!d({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);o(e),p(e),k(e)}),[p,k,r]),tabValues:r}}var b=n(72389);const N={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function g(e){let{className:t,block:n,selectedValue:o,selectValue:s,tabValues:p}=e;const u=[],{blockElementScrollPositionUntilNextRender:m}=(0,l.o5)(),c=e=>{const t=e.currentTarget,n=u.indexOf(t),i=p[n].value;i!==o&&(m(t),s(i))},d=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=u.indexOf(e.currentTarget)+1;t=u[n]??u[0];break}case"ArrowLeft":{const n=u.indexOf(e.currentTarget)-1;t=u[n]??u[u.length-1];break}}t?.focus()};return a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":n},t)},p.map((e=>{let{value:t,label:n,attributes:l}=e;return a.createElement("li",(0,i.Z)({role:"tab",tabIndex:o===t?0:-1,"aria-selected":o===t,key:t,ref:e=>u.push(e),onKeyDown:d,onClick:c},l,{className:(0,r.Z)("tabs__item",N.tabItem,l?.className,{"tabs__item--active":o===t})}),n??t)})))}function f(e){let{lazy:t,children:n,selectedValue:i}=e;const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=r.find((e=>e.props.value===i));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return a.createElement("div",{className:"margin-top--md"},r.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==i}))))}function y(e){const t=k(e);return a.createElement("div",{className:(0,r.Z)("tabs-container",N.tabList)},a.createElement(g,(0,i.Z)({},e,t)),a.createElement(f,(0,i.Z)({},e,t)))}function v(e){const t=(0,b.Z)();return a.createElement(y,(0,i.Z)({key:String(t)},e))}},79641:(e,t,n)=>{n.d(t,{Z:()=>a});var i=n(67294);function a(e){return i.createElement("div",{id:"Wizardly"},i.createElement("div",{className:"wizardmodal"},i.createElement("div",{className:"page-wrapper bg-img-1"}),i.createElement("div",{className:"page-wrapper"},i.createElement("div",{className:"wizard main"},i.createElement("div",{className:"container"},i.createElement("div",{className:"row"},i.createElement("div",{className:"whitez"}),i.createElement("h1",{id:"WizardTitle",className:"header-title"}),i.createElement("div",{className:"wizardclose"}))),i.createElement("div",{className:"ocontainer"},i.createElement("div",{className:"zcontainer"},i.createElement("div",{role:"application",className:"wizard clearfix vertical",id:"steps-uid-0"},i.createElement("div",{className:"steps clearfix"},i.createElement("ul",{id:"WizardTabs",role:"tablist"})),i.createElement("div",{className:"content clearfix"},i.createElement("div",null,i.createElement("fieldset",{id:"WizardContents",role:"tabpanel",className:"body current","aria-hidden":"false"}))),i.createElement("div",{className:"actions clearfix"},i.createElement("ul",{role:"menu","aria-label":"Pagination"},i.createElement("li",null,i.createElement("button",{id:"WizardPreviousButton"},"Previous")),i.createElement("li",null,i.createElement("button",{id:"WizardNextButton"},"Next")))))))))),i.createElement("div",{className:"openWizard"},"Try the Wizard"))}},6832:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>p,default:()=>k,frontMatter:()=>s,metadata:()=>u,toc:()=>c});var i=n(87462),a=(n(67294),n(3905)),r=n(79641),l=n(74866),o=n(85162);const s={sidebar_position:60,hide_table_of_contents:!0,sidebar_label:"Kubernetes",title:"Kubernetes Quickstart"},p=void 0,u={unversionedId:"learn/quickstarts/network/local-kubernetes",id:"learn/quickstarts/network/local-kubernetes",title:"Kubernetes Quickstart",description:"minikube quickly sets up a local Kubernetes cluster on macOS, Linux, or Windows (WSL). This quickstart is a great way to explore running your own OpenZiti Controller, Router, and Console.",source:"@site/docs/learn/quickstarts/network/local-kubernetes.md",sourceDirName:"learn/quickstarts/network",slug:"/learn/quickstarts/network/local-kubernetes",permalink:"/docs/learn/quickstarts/network/local-kubernetes",draft:!1,editUrl:"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/learn/quickstarts/network/local-kubernetes.md",tags:[],version:"current",sidebarPosition:60,frontMatter:{sidebar_position:60,hide_table_of_contents:!0,sidebar_label:"Kubernetes",title:"Kubernetes Quickstart"},sidebar:"docsSidebar",previous:{title:"Host OpenZiti Anywhere",permalink:"/docs/learn/quickstarts/network/hosted"},next:{title:"Help",permalink:"/docs/category/help"}},m={},c=[{value:"Tools of the Trade",id:"tools-of-the-trade",level:2},{value:"Configure DNS",id:"configure-dns",level:2},{value:"miniziti Script",id:"miniziti-script",level:2},{value:"Manual Steps to Learn by Doing",id:"manual-steps-to-learn-by-doing",level:2},{value:"Create the <code>miniziti</code> Cluster",id:"create-the-miniziti-cluster",level:3},{value:"Install Ingress Addons",id:"install-ingress-addons",level:3},{value:"Install the OpenZiti Controller",id:"install-the-openziti-controller",level:3},{value:"Allow Kubernetes to Manage Certificates",id:"allow-kubernetes-to-manage-certificates",level:4},{value:"Add the OpenZiti Helm Repository",id:"add-the-openziti-helm-repository",level:4},{value:"Install the Controller",id:"install-the-controller",level:4},{value:"Cluster DNS",id:"cluster-dns",level:3},{value:"Install the Router",id:"install-the-router",level:3},{value:"Install the Console",id:"install-the-console",level:3},{value:"Create OpenZiti Identities and Services",id:"create-openziti-identities-and-services",level:3},{value:"Install the <code>httpbin</code> Demo API Server Chart",id:"install-the-httpbin-demo-api-server-chart",level:3},{value:"Add the Client Identity",id:"add-the-client-identity",level:2},{value:"Test the Demo API Service",id:"test-the-demo-api-service",level:2},{value:"Explore the OpenZiti Console",id:"explore-the-openziti-console",level:2},{value:"Next Steps",id:"next-steps",level:2},{value:"Cleanup",id:"cleanup",level:2}],d={toc:c},h="wrapper";function k(e){let{components:t,...s}=e;return(0,a.kt)(h,(0,i.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"minikube")," quickly sets up a local Kubernetes cluster on macOS, Linux, or Windows (WSL). This quickstart is a great way to explore running your own OpenZiti Controller, Router, and Console."),(0,a.kt)("h2",{id:"tools-of-the-trade"},"Tools of the Trade"),(0,a.kt)("p",null,"We'll use the preferred ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube")," Docker driver for this quickstart. You can run ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube")," in WSL with Docker Engine or Docker Desktop, but keep an eye out for one extra step to run ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube tunnel")," at the necessary point in the process."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://docs.docker.com/engine/install/"},"Install Docker")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/"},"Install ",(0,a.kt)("inlineCode",{parentName:"a"},"kubectl"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://helm.sh/docs/intro/install/"},"Install Helm")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://minikube.sigs.k8s.io/docs/start/"},"Install ",(0,a.kt)("inlineCode",{parentName:"a"},"minikube"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/openziti/ziti/releases/latest"},"Install ",(0,a.kt)("inlineCode",{parentName:"a"},"ziti")," CLI")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://openziti.io/docs/downloads"},"Install an OpenZiti Tunneler app")),(0,a.kt)("li",{parentName:"ol"},"Optional: Install ",(0,a.kt)("inlineCode",{parentName:"li"},"curl")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"jq")," for testing an OpenZiti Service in the terminal.")),(0,a.kt)("p",null,"Make sure these command-line tools are available in your executable search ",(0,a.kt)("inlineCode",{parentName:"p"},"PATH"),"."),(0,a.kt)("h2",{id:"configure-dns"},"Configure DNS"),(0,a.kt)("p",null,"Your computer running ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube")," needs to resolve these three domain names. They will all resolve to the same IP address where minikube exposes ingresses on your OS."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"miniziti-controller.miniziti.internal"),(0,a.kt)("li",{parentName:"ul"},"miniziti-console.miniziti.internal"),(0,a.kt)("li",{parentName:"ul"},"miniziti-router.miniziti.internal")),(0,a.kt)(l.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,a.kt)(o.Z,{value:"win",label:"Windows (WSL2)",mdxType:"TabItem"},(0,a.kt)("p",null,"   This step allows you to connect to the ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube")," ingresses from Windows or WSL. We'll need that connection to the ingresses later when we run the ",(0,a.kt)("inlineCode",{parentName:"p"},"ziti")," CLI in WSL."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Enable localhost binding in WSL."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-cmd"},"%USERPROFILE%\\.wslconfig\n")),(0,a.kt)("p",{parentName:"li"},"Add ",(0,a.kt)("inlineCode",{parentName:"p"},"localhostforwarding=true")," to the ",(0,a.kt)("inlineCode",{parentName:"p"},"[wsl2]")," section like this."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-ini"},"[wsl2]\n# Turn off default connection to bind WSL 2 localhost to Windows localhost\nlocalhostforwarding=true\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Add the DNS names to the system hosts file. This allows us to resolve the DNS names from both Windows and WSL."),(0,a.kt)("p",{parentName:"li"},"Edit the system hosts file."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-cmd"},"%SYSTEMROOT%\\system32\\drivers\\etc\\hosts\n")),(0,a.kt)("p",{parentName:"li"},"Add this line to the system hosts file."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-ini"},"# miniziti\n127.0.0.1  miniziti-controller.miniziti.internal  miniziti-router.miniziti.internal  miniziti-console.miniziti.internal\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Restart WSL."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-powershell"},"wsl --shutdown\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"In WSL, verify that Docker restarted successfully."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"docker ps\n")),(0,a.kt)("p",{parentName:"li"},"If Docker has restarted then you'll see your running containers, if any. If you don't have any running containers then you'll only see the headings, like this. This is a healthy result and you can skip to the next numbered step."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ docker ps\nCONTAINER ID   IMAGE  COMMAND  CREATED  STATUS  PORTS  NAMES\n")),(0,a.kt)("p",{parentName:"li"},'If you see an error then you need to restart Docker. If you have Docker Desktop it may be necessary to "Quick Docker Desktop" in the system tray menu (right-click tray icon).'),(0,a.kt)("p",{parentName:"li"},"You can verify that the ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-desktop-data")," instance is running with this PowerShell command."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-powershell"},"wsl -l -v\n")),(0,a.kt)("p",{parentName:"li"},"Example output:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-powershell"},"% wsl -l -v\nFIXME: paste output here showing WSL, docker-desktop, docker-desktop-data running\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"In WSL, verify that localhost is bound. You know it's working if you see the *.ziti DNS names in ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/hosts")," duplicated from Windows."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"grep ziti /etc/hosts\n")),(0,a.kt)("p",{parentName:"li"},"It should look like this."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ grep ziti /etc/hosts\n127.0.0.1    miniziti-controller.miniziti.internal miniziti-router.miniziti.internal  miniziti-console.miniziti.internal\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"In WSL, Run ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube tunnel"),"."),(0,a.kt)("p",{parentName:"li"},'Keep a separate terminal window open so you can make sure the tunnel is still running and provide your password if prompted. Create a "miniziti" profile if you haven\'t, and run the tunnel.'),(0,a.kt)("admonition",{parentName:"li",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"You will likely be prompted by ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube tunnel")," for your WSL user's password, but this prompt may not occur immediately. This grants permission for the tunnel to add a route to the minikube node IP.")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"minikube --profile miniziti start\nminikube --profile miniziti tunnel\n\n"))))),(0,a.kt)(o.Z,{value:"mac",label:"macOS",mdxType:"TabItem"},(0,a.kt)("p",null,"In macOS, ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube")," sets up localhost port forwarding to the IP of the Docker container of the ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube")," node. Docker will forward localhost:80,443/tcp to support the HTTP ingresses to your miniziti cluster."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Add the DNS names to your system hosts file."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'sudo tee -a /etc/hosts <<< "127.0.0.1  miniziti-controller.miniziti.internal  miniziti-router.miniziti.internal  miniziti-console.miniziti.internal"\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Run ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube tunnel"),"."),(0,a.kt)("p",{parentName:"li"},'Keep a separate terminal window open so you can make sure the tunnel is still running and provide your password if prompted. Create a "miniziti" profile if you haven\'t, and run the tunnel.'),(0,a.kt)("admonition",{parentName:"li",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"You will likely be prompted by ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube tunnel")," for your macOS user's password, but this prompt may not occur immediately. This grants permission for the tunnel to add a route to the minikube node IP.")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"minikube --profile miniziti start\nminikube --profile miniziti tunnel\n\n"))))),(0,a.kt)(o.Z,{value:"linux",label:"Linux",mdxType:"TabItem"},(0,a.kt)("p",null,"On Linux, the IP of the ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube")," node running in Docker is routeable via the bridge interface created by ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube"),". Create a \"miniziti\" profile if you haven't, and obtain the node's external IP for your hosts file."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'minikube --profile miniziti start\nsudo tee -a /etc/hosts <<< "$(minikube --profile miniziti ip) miniziti-controller.miniziti.internal  miniziti-router.miniziti.internal  miniziti-console.miniziti.internal"\n')))),(0,a.kt)(l.Z,{mdxType:"Tabs"},(0,a.kt)(o.Z,{value:"miniziti.bash",label:"miniziti script",default:!0,mdxType:"TabItem"},(0,a.kt)("h2",{id:"miniziti-script"},"miniziti Script"),(0,a.kt)("p",null,'You can run the miniziti shell script or perform the steps manually yourself. Click the "Manual Steps" tab directly above to switch your view.'),(0,a.kt)("p",null,"It's recommended that you read the script before you run it. It's safe to re-run the script if it encounters a temporary problem."),(0,a.kt)("br",null),(0,a.kt)("p",null,(0,a.kt)("a",{target:"_blank",href:n(90862).Z},(0,a.kt)("strong",null,"DOWNLOAD: miniziti.bash"))),(0,a.kt)("br",null),"Be sure to complete the DNS setup steps above before running this command.",(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"bash ./miniziti.bash\n"))),(0,a.kt)(o.Z,{value:"manual",label:"Manual Steps",default:!0,mdxType:"TabItem"},(0,a.kt)("h2",{id:"manual-steps-to-learn-by-doing"},"Manual Steps to Learn by Doing"),(0,a.kt)("p",null,"This section explains the actions performed by the ",(0,a.kt)("inlineCode",{parentName:"p"},"miniziti.bash")," script.You need a BASH or ZSH terminal for pasting commands.",(0,a.kt)("br",null),(0,a.kt)("br",null)),(0,a.kt)("h3",{id:"create-the-miniziti-cluster"},"Create the ",(0,a.kt)("inlineCode",{parentName:"h3"},"miniziti")," Cluster"),(0,a.kt)("p",null,"First, let's create a brand new ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube"),' profile named "miniziti".'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"minikube --profile miniziti start\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"minikube")," will try to configure the default context of your KUBECONFIG. Let's test the connection to the new cluster."),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"You can always restore the KUBECONFIG context from this Minikube quickstart like this:"),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"minikube --profile miniziti update-context\n"))),(0,a.kt)("p",null,"Let's do a quick test of the current KUBECONFIG context."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl cluster-info\n")),(0,a.kt)("p",null,"A good result looks like this (no errors)."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# macOS and Linux look like this\n$ kubectl cluster-info\nKubernetes control plane is running at https://192.168.49.2:8443\nCoreDNS is running at https://192.168.49.2:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# Windows with WSL looks like this\n$ kubectl cluster-info\nKubernetes control plane is running at https://127.0.0.1:49439\nCoreDNS is running at https://127.0.0.1:49439/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n")),(0,a.kt)("h3",{id:"install-ingress-addons"},"Install Ingress Addons"),(0,a.kt)("p",null,"You will need two Minikube addons:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"ingress"),": installs the Nginx ingress controller. Ingresses provide access into the cluster and are the only things exposed to networks outside the cluster. This is required by the miniziti script, but the Helm charts can be configured to use other ingress controllers."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"ingress-dns"),': provides a DNS server that can answer queries about the cluster\'s ingresses, e.g. "miniziti-controller.miniziti.internal" which will be created when you install the OpenZiti Controller Helm chart.')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"minikube --profile miniziti addons enable ingress\nminikube --profile miniziti addons enable ingress-dns\n")),(0,a.kt)("p",null,"OpenZiti will need SSL passthrough, so let's patch the ",(0,a.kt)("inlineCode",{parentName:"p"},"ingress-nginx")," deployment to enable that feature."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl patch deployment "ingress-nginx-controller" \\\n   --namespace ingress-nginx \\\n   --type=\'json\' \\\n   --patch=\'[{"op": "add",\n         "path": "/spec/template/spec/containers/0/args/-",\n         "value":"--enable-ssl-passthrough"\n      }]\'\n\n# wait for ingress-nginx\nkubectl wait jobs "ingress-nginx-admission-patch" \\\n    --namespace ingress-nginx \\\n        --for condition=complete \\\n        --timeout=120s\n\nkubectl wait pods \\\n    --namespace ingress-nginx \\\n    --for=condition=ready \\\n    --selector=app.kubernetes.io/component=controller \\\n    --timeout=120s\n')),(0,a.kt)("p",null,"Now your miniziti cluster is ready for some OpenZiti!",(0,a.kt)("br",null),(0,a.kt)("br",null)),(0,a.kt)("h3",{id:"install-the-openziti-controller"},"Install the OpenZiti Controller"),(0,a.kt)("h4",{id:"allow-kubernetes-to-manage-certificates"},"Allow Kubernetes to Manage Certificates"),(0,a.kt)("p",null,"You need to install the required ",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/"},"Custom Resource Definitions")," (CRD) for the OpenZiti Controller."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply \\\n   --filename https://github.com/cert-manager/cert-manager/releases/latest/download/cert-manager.crds.yaml\nkubectl apply \\\n   --filename https://raw.githubusercontent.com/cert-manager/trust-manager/v0.4.0/deploy/crds/trust.cert-manager.io_bundles.yaml\n")),(0,a.kt)("h4",{id:"add-the-openziti-helm-repository"},"Add the OpenZiti Helm Repository"),(0,a.kt)("p",null,"Add the OpenZiti Helm Repo"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'helm repo add "openziti" https://openziti.io/helm-charts/\n')),(0,a.kt)("h4",{id:"install-the-controller"},"Install the Controller"),(0,a.kt)("p",null,'Let\'s create a Helm release named "miniziti-controller" for the OpenZiti Controller. This will also install sub-charts ',(0,a.kt)("inlineCode",{parentName:"p"},"cert-manager")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"trust-manager"),' in the same Kubernetes namespace "ziti-controller."'),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Install the Controller chart"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'helm install "ziti-controller" openziti/ziti-controller \\\n   --namespace ziti-controller --create-namespace \\\n   --set clientApi.advertisedHost="miniziti-controller.miniziti.internal" \\\n   --values https://openziti.io/helm-charts/charts/ziti-controller/values-ingress-nginx.yaml\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},'This may take a few minutes. Wait the controller\'s pod status progress to "Running." You can get started on the DNS set up in the next section, but you need the controller up and running to install the router.'),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl wait deployments "ziti-controller" \\\n   --namespace ziti-controller \\\n   --for condition=Available=True \\\n   --timeout=240s\n')))),(0,a.kt)("h3",{id:"cluster-dns"},"Cluster DNS"),(0,a.kt)("p",null,"Configure CoreDNS in the miniziti cluster. This is necessary no matter which host DNS resolver method you used above."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Add the *.ziti forwarder to the end of the value of ",(0,a.kt)("inlineCode",{parentName:"p"},"Corefile")," in CoreDNS's configmap. Don't forget to substitute the real IP from ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube --profile miniziti ip"),' if you get something different than "192.168.49.2", and be mindful to keep the indentation the same as the default ',(0,a.kt)("inlineCode",{parentName:"p"},".:53")," handler."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'# 1. Edit the configmap.\n# 2. Save the file.\n# 3. Exit the editor.\nkubectl edit configmap "coredns" \\\n   --namespace kube-system\n')),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-nginx"},"    miniziti.internal:53 {\n       errors\n       cache 30\n       forward . 192.168.49.2\n    }\n")),(0,a.kt)("p",{parentName:"li"},"It should look like this."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\ndata:\nCorefile: |\n   .:53 {\n      log\n      errors\n      health {\n         lameduck 5s\n      }\n      ready\n      kubernetes cluster.local in-addr.arpa ip6.arpa {\n         pods insecure\n         fallthrough in-addr.arpa ip6.arpa\n         ttl 30\n      }\n      prometheus :9153\n      hosts {\n         192.168.49.1 host.minikube.internal\n         fallthrough\n      }\n      forward . /etc/resolv.conf {\n         max_concurrent 1000\n      }\n      cache 30\n      loop\n      reload\n      loadbalance\n   }\n   miniziti.internal:53 {\n            errors\n            cache 30\n            forward . 192.168.49.2\n   }\nkind: ConfigMap\nmetadata:\ncreationTimestamp: "2023-02-25T16:17:24Z"\nname: coredns\nnamespace: kube-system\nresourceVersion: "19660"\nuid: deae90e7-5b3d-49ea-b996-4f525da5597a\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Delete the running CoreDNS pod so a new one will pick up the Corefile change you just made."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pods \\\n   --namespace kube-system \\\n   | awk '/^coredns-/ {print $1}' \\\n   | xargs -rl kubectl delete pods \\\n      --namespace kube-system\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Verify that *.ziti DNS names are resolvable from inside your cluster. This is required for your pods to communicate with the OpenZiti Controller's advertised address.You will know it's working because you see the same IP address in the response as when you run ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube --profile miniziti ip"),"."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl run "dnstest" --rm --tty --stdin --image=busybox --restart=Never -- \\\n      nslookup miniziti-controller.miniziti.internal\n')))),(0,a.kt)("h3",{id:"install-the-router"},"Install the Router"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Log in to OpenZiti."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl get secrets "ziti-controller-admin-secret" \\\n            --namespace ziti-controller \\\n            --output go-template=\'{{index .data "admin-password" | base64decode }}\' \\\n   | xargs -rl ziti edge login miniziti-controller.miniziti.internal:443 \\\n      --yes --username "admin" \\\n      --password\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},'Create a Router with role "public-routers" and save the enrollment one-time-token as a temporary file.'),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'ziti edge create edge-router "miniziti-router" \\\n   --role-attributes "public-routers" \\\n   --tunneler-enabled \\\n   --jwt-output-file /tmp/miniziti-router.jwt\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Install the Router Chart."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'helm install "ziti-router" openziti/ziti-router \\\n   --namespace ziti-router --create-namespace \\\n   --set-file enrollmentJwt=/tmp/miniziti-router.jwt \\\n   --set edge.advertisedHost=miniziti-router.miniziti.internal \\\n   --set ctrl.endpoint=ziti-controller-ctrl.miniziti.svc:6262 \\\n   --values https://openziti.io/helm-charts/charts/ziti-router/values-ingress-nginx.yaml\n\nkubectl wait deployments "ziti-router" \\\n   --namespace ziti-router \\\n   --for condition=Available=True\n')),(0,a.kt)("p",{parentName:"li"},'These Helm chart values configure the router to use the controller\'s cluster-internal service that provides the router control plane, i.e., the "ctrl" endpoint.')),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},'Verify the new router is "online=true"'),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge list edge-routers\n")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# example output\n$ ziti edge list edge-routers\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME            \u2502 ONLINE \u2502 ALLOW TRANSIT \u2502 COST \u2502 ATTRIBUTES     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 opR39JLZ2v \u2502 miniziti-router \u2502 true   \u2502 true          \u2502    0 \u2502 public-routers \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-1 of 1\n")))),(0,a.kt)("h3",{id:"install-the-console"},"Install the Console"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Install the chart"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'helm install "ziti-console" openziti/ziti-console \\\n   --namespace ziti-console --create-namespace  \\\n   --set ingress.advertisedHost=miniziti-console.miniziti.internal \\\n   --set settings.edgeControllers[0].url=https://miniziti-controller-client.miniziti.svc:443 \\\n   --values https://openziti.io/helm-charts/charts/ziti-console/values-ingress-nginx.yaml\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Wait for deployment."),(0,a.kt)("p",{parentName:"li"},"You'll see an Nginx 503 error while the console is deploying."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl wait deployments "ziti-console" \\\n   --namespace ziti-console \\\n   --for condition=Available=True \\\n   --timeout=240s\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Get the admin password on your clipboard."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl get secrets "ziti-controller-admin-secret" \\\n   --namespace ziti-controller \\\n   --output go-template=\'{{"\\nINFO: Your OpenZiti Console http://miniziti-console.miniziti.internal password for \\"admin\\" is: "}}{{index .data "admin-password" | base64decode }}{{"\\n\\n"}}\'\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Open ",(0,a.kt)("a",{parentName:"p",href:"http://miniziti-console.miniziti.internal"},"http://miniziti-console.miniziti.internal"),' in your web browser and login with username "admin" and the password from your clipboard.'))),(0,a.kt)("h3",{id:"create-openziti-identities-and-services"},"Create OpenZiti Identities and Services"),(0,a.kt)("p",null,"Here's a BASH script that runs several ",(0,a.kt)("inlineCode",{parentName:"p"},"ziti")," CLI commands to illustrate a minimal set of identities, services, and policies."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'ziti edge create identity device "miniziti-client" \\\n    --jwt-output-file /tmp/miniziti-client.jwt --role-attributes httpbin-clients\n\nziti edge create identity device "httpbin-host" \\\n    --jwt-output-file /tmp/httpbin-host.jwt --role-attributes httpbin-hosts\n\nziti edge create config "httpbin-intercept-config" intercept.v1 \\\n    \'{"protocols":["tcp"],"addresses":["httpbin.ziti"], "portRanges":[{"low":80, "high":80}]}\'\n\nziti edge create config "httpbin-host-config" host.v1 \\\n    \'{"protocol":"tcp", "address":"httpbin","port":8080}\'\n\nziti edge create service "httpbin-service" \\\n   --configs httpbin-intercept-config,httpbin-host-config\n\nziti edge create service-policy "httpbin-bind-policy" Bind \\\n    --service-roles \'@httpbin-service\' --identity-roles \'#httpbin-hosts\'\n\nziti edge create service-policy "httpbin-dial-policy" Dial \\\n    --service-roles \'@httpbin-service\' --identity-roles \'#httpbin-clients\'\n\nziti edge create edge-router-policy "public-routers" \\\n    --edge-router-roles \'#public-routers\' --identity-roles \'#all\'\n\nziti edge create service-edge-router-policy "public-routers" \\\n    --edge-router-roles \'#public-routers\' --service-roles \'#all\'\n\nziti edge enroll /tmp/httpbin-host.jwt\n')),(0,a.kt)("h3",{id:"install-the-httpbin-demo-api-server-chart"},"Install the ",(0,a.kt)("inlineCode",{parentName:"h3"},"httpbin")," Demo API Server Chart"),(0,a.kt)("p",null,"This Helm chart installs an OpenZiti fork of ",(0,a.kt)("inlineCode",{parentName:"p"},"go-httpbin"),", so it doesn't need to be accompanied by an OpenZiti Tunneler. We'll use it as a demo API to test the OpenZiti Service you just created named \"httpbin-service\"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'helm install "miniziti-httpbin" openziti/httpbin \\\n   --set-file zitiIdentity=/tmp/httpbin-host.json \\\n   --set zitiServiceName=httpbin-service\n')))),(0,a.kt)("h2",{id:"add-the-client-identity"},"Add the Client Identity"),(0,a.kt)("p",null,"Add the client identity you created to your OpenZiti Tunneler."),(0,a.kt)("p",null,"Follow ",(0,a.kt)("a",{parentName:"p",href:"https://openziti.io/docs/reference/tunnelers/"},"the instructions for your tunneler OS version")," to add the OpenZiti Identity that was saved as filename ",(0,a.kt)("inlineCode",{parentName:"p"},"/tmp/miniziti-client.jwt"),' (or WSL\'s "tmp" directory, e.g., ',(0,a.kt)("inlineCode",{parentName:"p"},"\\\\wsl$\\Ubuntu\\tmp")," in Desktop Edge for Windows)."),(0,a.kt)("p",null,"As soon as identity enrollment completes you should have a new OpenZiti DNS name available to this device. Let's test that with a DNS query."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# this DNS answer is coming from the OpenZiti Tunneler, e.g. Ziti Desktop Edge\nnslookup httpbin.miniziti.private\n")),(0,a.kt)("h2",{id:"test-the-demo-api-service"},"Test the Demo API Service"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# macOS or Linux, including WSL\ncurl -sSf -XPOST -d ziti=awesome http://httpbin.miniziti.private/post | jq .data\n")),(0,a.kt)("p",null,"Visit ",(0,a.kt)("a",{parentName:"p",href:"http://httpbin.miniziti.private/get"},"http://httpbin.miniziti.private/get")," in your web browser in macOS, Linux, or Windows to see a JSON test response from the demo server."),(0,a.kt)("h2",{id:"explore-the-openziti-console"},"Explore the OpenZiti Console"),(0,a.kt)("p",null,"Now that you've successfully tested the OpenZiti Service, check out the various entities in your that were created by the script in ",(0,a.kt)("a",{parentName:"p",href:"http://miniziti-console.miniziti.private/"},"http://miniziti-console.miniziti.internal/"),"."),(0,a.kt)("h2",{id:"next-steps"},"Next Steps"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"In the OpenZiti Console, try to revoke then restore your permission to acess the demo services.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Deploy a non-Ziti demo application to Kubernetes and securely ",(0,a.kt)("a",{parentName:"p",href:"../services/kubernetes-service"},"share it with a Ziti proxy pod"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Add a configs, service, and policies to access the Kubernetes apiserver with OpenZiti."),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},'Hint: the apiserver\'s address is "kubernetes.default.svc:443" inside the cluster.')),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},'Hint: After you create the configs, service, and policies, grant "Bind" permission for the service to "miniziti-router" by adding a role.'),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'# the role you add needs to match the bind policy\'s identity roles\nziti edge update identity "miniziti-router" \\\n   --role-attributes k8sapi-hosts\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Connect to the K8s apiserver from another computer with ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/openziti-test-kitchen/kubeztl/"},(0,a.kt)("inlineCode",{parentName:"a"},"kubeztl"),", the OpenZiti fork of ",(0,a.kt)("inlineCode",{parentName:"a"},"kubectl")),". ",(0,a.kt)("inlineCode",{parentName:"p"},"kubeztl")," works by itself without an OpenZiti Tunneler."))))),(0,a.kt)("h2",{id:"cleanup"},"Cleanup"),(0,a.kt)(l.Z,{groupId:"operating-systems-cleanup",mdxType:"Tabs"},(0,a.kt)(o.Z,{value:"win",label:"Windows (WSL2)",mdxType:"TabItem"},(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Remove the ",(0,a.kt)("inlineCode",{parentName:"p"},"mini*.ziti")," DNS names from the system hosts file."),(0,a.kt)("p",{parentName:"li"},"Edit the system hosts file."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-cmd"},"%SYSTEMROOT%\\system32\\drivers\\etc\\hosts\n")),(0,a.kt)("p",{parentName:"li"},"Remove this line."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-ini"},"# miniziti\n127.0.0.1  miniziti-controller.miniziti.internal  miniziti-router.miniziti.internal  miniziti-console.miniziti.internal\n"))))),(0,a.kt)(o.Z,{value:"mac",label:"macOS",mdxType:"TabItem"},(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Remove the ",(0,a.kt)("inlineCode",{parentName:"p"},"mini*.ziti")," names from ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/hosts"),"."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo sed -iE '/miniziti.*\\.internal/d' /etc/hosts\n"))))),(0,a.kt)(o.Z,{value:"linux",label:"Linux",mdxType:"TabItem"},(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Remove the ",(0,a.kt)("inlineCode",{parentName:"p"},"mini*.ziti")," names from ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/hosts"),"."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo sed -iE '/miniziti.*\\.internal/d' /etc/hosts\n")))))),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Delete the cluster."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"minikube --profile miniziti delete\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},'In your OpenZiti Tunneler, "Forget" your Identity.'))),(0,a.kt)(r.Z,{mdxType:"Wizardly"}))}k.isMDXComponent=!0},90862:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/files/miniziti-142d9ccaa5934e6ae662a8d4504d830b.bash"}}]);