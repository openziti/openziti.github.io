"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[6982],{87345:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>a,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"learn/quickstarts/network/help/upgrade-quickstart-network","title":"Upgrade a Quickstart Network","description":"This document explains the process for backing up, and upgrading your controller and router(s).","source":"@site/docs/learn/quickstarts/network/help/upgrade-quickstart-network.mdx","sourceDirName":"learn/quickstarts/network/help","slug":"/learn/quickstarts/network/help/upgrade-quickstart-network","permalink":"/docs/learn/quickstarts/network/help/upgrade-quickstart-network","draft":false,"unlisted":false,"editUrl":"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/learn/quickstarts/network/help/upgrade-quickstart-network.mdx","tags":[],"version":"current","lastUpdatedAt":1751306929000,"frontMatter":{"title":"Upgrade a Quickstart Network","id":"upgrade-quickstart-network"},"sidebar":"docsSidebar","previous":{"title":"Reset the Quickstart","permalink":"/docs/learn/quickstarts/network/help/reset-quickstart"},"next":{"title":"Console","permalink":"/docs/learn/quickstarts/zac/"}}');var i=t(74848),o=t(28453),s=t(11470),l=t(19365);const a={title:"Upgrade a Quickstart Network",id:"upgrade-quickstart-network"},c=void 0,d={},u=[{value:"Backup Existing Network",id:"backup-existing-network",level:2},{value:"Stop Existing Services",id:"stop-existing-services",level:2},{value:"Obtain the Desired Binary",id:"obtain-the-desired-binary",level:2},{value:"Update Services",id:"update-services",level:2},{value:"Reload and Start Services",id:"reload-and-start-services",level:2},{value:"Backup Existing Network",id:"backup-existing-network-1",level:2},{value:"Stop the Containers",id:"stop-the-containers",level:3},{value:"Obtain the Desired Version",id:"obtain-the-desired-version",level:3},{value:"Start the OpenZiti Containers",id:"start-the-openziti-containers",level:3},{value:"Verify the Upgrade",id:"verify-the-upgrade",level:3},{value:"Upgrading Versions &lt;=<code>v0.28.2</code>",id:"upgrading-versions-v0282",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"This document explains the process for backing up, and upgrading your controller and router(s)."}),"\n",(0,i.jsxs)(s.A,{groupId:"backup-network",children:[(0,i.jsxs)(l.A,{value:"non-docker-quickstart",label:"Non-Docker Quickstart",children:[(0,i.jsx)(n.h2,{id:"backup-existing-network",children:"Backup Existing Network"}),(0,i.jsx)(n.p,{children:"While you can certainly back up every file relating to your network, there are only a few that would be necessary. To\nback up the necessary files follow these steps:"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Backup the database:","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Run the following"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ziti edge db snapshot\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["This will create a backup file in the same directory as your controller's DB file. It will have the same name as\nthe controller DB file (usually ",(0,i.jsx)(n.code,{children:"ctrl.db"}),") with a date and timestamp appended to it in the following format\n",(0,i.jsx)(n.code,{children:"ctrl.db-YYYYMMDD-HHMMSS"}),". If you're not sure where your DB file is located, you can find the location in\nthe ",(0,i.jsx)(n.code,{children:"db"}),"\nsection of your controller config."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Backup the controller PKI.","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Copy the PKI directory to a safe backup location (Default path: ",(0,i.jsx)(n.code,{children:"$ZITI_HOME/quickstart/$(hostname -s)/pki/"}),")."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Backup the controller config file (default path: ",(0,i.jsx)(n.code,{children:"$ZITI_HOME/$(hostname -s).yaml"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Backup the environment file (default path ",(0,i.jsx)(n.code,{children:"$ZITI_HOME/$(hostname -s).env"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Backup any router config files.","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["If you used one of our quickstarts, the single edge router created defaults\nto ",(0,i.jsx)(n.code,{children:"$ZITI_HOME/$(hostname -s)-edge-router.yaml"})]}),"\n"]}),"\n"]}),"\n"]}),(0,i.jsx)(n.h2,{id:"stop-existing-services",children:"Stop Existing Services"}),(0,i.jsx)(n.p,{children:"If your network is using services to run your controller and/or router(s), stop those services."}),(0,i.jsx)(n.h2,{id:"obtain-the-desired-binary",children:"Obtain the Desired Binary"}),(0,i.jsxs)(n.p,{children:["Releases can be found ",(0,i.jsx)(n.a,{href:"https://github.com/openziti/ziti/releases",children:"here"}),". There is a helpful script function\ncalled ",(0,i.jsx)(n.code,{children:"getZiti"})," that will obtain the binary,\nand determine the correct architecture and OS for you."]}),(0,i.jsxs)(n.p,{children:["Here is the process for using ",(0,i.jsx)(n.code,{children:"getZiti"})," to obtain the latest binary. You may optionally add ",(0,i.jsx)(n.code,{children:"yes"})," as an argument to\nthe ",(0,i.jsx)(n.code,{children:"getZiti"})," function to have the new ziti binary automatically added to your $PATH"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'source /dev/stdin <<< "$(wget -qO- https://get.openziti.io/quick/ziti-cli-functions.sh)"\ngetZiti\n'})}),(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"After upgrading the binary, be sure to check your PATH to ensure it is pointing to the new binary."})}),(0,i.jsx)(n.h2,{id:"update-services",children:"Update Services"}),(0,i.jsx)(n.p,{children:"If you have services to start up the network, update them to use the new binary file."}),(0,i.jsxs)(s.A,{groupId:"update-services",children:[(0,i.jsxs)(l.A,{value:"28.2",label:"v0.28.2 or Later",children:[(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"ExecStart"})," section on a ",(0,i.jsx)(n.code,{children:"systemd"})," service will point to the full path to the old binary. Update this line to\npoint to the path of the newly downloaded binary. Any path in the service file needs to be updated similarly."]}),(0,i.jsxs)(n.p,{children:["For example, the following portion of the ",(0,i.jsx)(n.code,{children:"ExecStart"})]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'.../ziti-v0.28.0/ziti" controller run \n'})}),(0,i.jsxs)(n.p,{children:["will be updated to the following for ",(0,i.jsx)(n.code,{children:"v0.28.2"})," and later."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'.../ziti-v0.30.4/ziti" controller run\n'})})]}),(0,i.jsxs)(l.A,{value:"pre28.2",label:"v0.28.1 or Earlier",children:[(0,i.jsxs)(n.p,{children:["In version ",(0,i.jsx)(n.code,{children:"v0.28.2"}),", ",(0,i.jsx)(n.code,{children:"ziti-controller"}),", ",(0,i.jsx)(n.code,{children:"ziti-router"}),", and ",(0,i.jsx)(n.code,{children:"ziti-tunnel"})," were bundled into the ",(0,i.jsx)(n.code,{children:"ziti"})," binary.\nTherefore, in these earlier versions, the path to the binary will not only point to the older version of the binary\nbut the executable used will be ",(0,i.jsx)(n.code,{children:"ziti-router"})," and ",(0,i.jsx)(n.code,{children:"ziti-controller"}),". When upgrading, it is important to update the\npath(s) to use the new binary along with the command (ex. ",(0,i.jsx)(n.code,{children:"ziti controller"})," rather than ",(0,i.jsx)(n.code,{children:"ziti-controller"}),")."]}),(0,i.jsxs)(n.p,{children:["For example, the following portion of the ",(0,i.jsx)(n.code,{children:"ExecStart"})," on a ",(0,i.jsx)(n.code,{children:"systemd"})," file"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'.../ziti-v0.27.0/ziti-controller" run \n'})}),(0,i.jsxs)(n.p,{children:["will be updated to the following when upgrading ",(0,i.jsx)(n.code,{children:"v0.28.1"})," or earlier. Notice the version and executable change."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'.../ziti-v0.30.4/ziti" controller run\n'})})]})]}),(0,i.jsx)(n.h2,{id:"reload-and-start-services",children:"Reload and Start Services"}),(0,i.jsx)(n.p,{children:"To reflect changes made to the services, reload the service daemon and start your services."})]}),(0,i.jsxs)(l.A,{value:"docker-quickstart",label:"Docker Quickstart",children:[(0,i.jsx)(n.h2,{id:"backup-existing-network-1",children:"Backup Existing Network"}),(0,i.jsxs)(n.p,{children:["All the files used for the network are stored in the ",(0,i.jsx)(n.code,{children:"/persistent"})," directory of the docker containers. You may back up\nthe files if desired."]}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Exec into the controller container"}),"\n",(0,i.jsxs)(n.li,{children:["Backup the database:","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Create a database snapshot by running ",(0,i.jsx)(n.code,{children:"ziti edge db snapshot"}),". Here's one example of how you can do that."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"docker exec <ziti-controller-container> /var/openziti/ziti-bin/ziti edge db snapshot\n# List the files to find the snapshot filename\ndocker exec <ziti-controller-container> ls -la /persistent/db\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["This will create a backup file in the same directory as your controller's DB file. It will have the same name as\nthe controller DB file (usually ",(0,i.jsx)(n.code,{children:"ctrl.db"}),") with a date and timestamp appended to it in the following format\n",(0,i.jsx)(n.code,{children:"ctrl.db-YYYYMMDD-HHMMSS"}),". If you're not sure where your DB file is located, you can find the location in\nthe ",(0,i.jsx)(n.code,{children:"db"})," section of your controller config."]}),"\n",(0,i.jsx)(n.li,{children:"Copy the backup file to a safe location outside the docker container, here's an example."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"docker cp <ziti-controller-container>:/persistent/db/ctrl.db-YYYYMMDD-HHMMSS <local-backup-location>\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Backup the controller PKI.","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Copy the PKI as was done with the database file (Default path: ",(0,i.jsx)(n.code,{children:"/persistent/pki/"}),")."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Backup the controller config file (default path: ",(0,i.jsx)(n.code,{children:"/persistent/ziti-controller.yaml"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Backup the environment file (default path ",(0,i.jsx)(n.code,{children:"/persistent/ziti.env"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Backup the router config files, depending on which quickstart you performed, you may have more than one. (default\npath ",(0,i.jsx)(n.code,{children:"/persistent/*-router*.yaml"}),"). Unfortunately, docker does not support wildcard characters when using\n",(0,i.jsx)(n.code,{children:"docker cp"}),". However, this command will allow you to list the files in ",(0,i.jsx)(n.code,{children:"/persistent"}),", from which, you can craft your\ndocker cp commands for each router config.","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"docker exec -it ziti-controller ls -la\n"})}),"\n"]}),"\n"]}),(0,i.jsx)(n.h3,{id:"stop-the-containers",children:"Stop the Containers"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Stop, and remove the docker containers but ",(0,i.jsx)(n.strong,{children:"do not"})," remove the volume.","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["For docker-compose users, use ",(0,i.jsx)(n.code,{children:"docker compose down"})," (do not use the ",(0,i.jsx)(n.code,{children:"-v"})," option)"]}),"\n",(0,i.jsxs)(n.li,{children:["For standalone docker users, use ",(0,i.jsx)(n.code,{children:"docker stop <container1>, <container2>, ..."})]}),"\n"]}),"\n"]}),"\n"]}),(0,i.jsx)(n.h3,{id:"obtain-the-desired-version",children:"Obtain the Desired Version"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["If you used a ",(0,i.jsx)(n.code,{children:".env"})," file, update the ",(0,i.jsx)(n.code,{children:".env"})," file to use the desired OpenZiti version. Otherwise, the OpenZiti\nversion is likely specified in your run command. The line containing the OpenZiti version will look like this\n",(0,i.jsx)(n.code,{children:"openziti/quickstart:<version>"}),". If the ",(0,i.jsx)(n.code,{children:":<version>"})," portion is not showing in your command, it will pull the\nlatest version."]}),"\n",(0,i.jsxs)(n.li,{children:["Pull the desired image","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["For docker compose: ",(0,i.jsx)(n.code,{children:"docker compose pull"})]}),"\n",(0,i.jsxs)(n.li,{children:["For standalone docker: ",(0,i.jsx)(n.code,{children:"docker pull openziti/quickstart:<version>"})]}),"\n"]}),"\n"]}),"\n"]}),(0,i.jsx)(n.h3,{id:"start-the-openziti-containers",children:"Start the OpenZiti Containers"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Start the network back up","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Compose: ",(0,i.jsx)(n.code,{children:"docker compose up"})]}),"\n",(0,i.jsxs)(n.li,{children:["Standalone: modify the ",(0,i.jsx)(n.code,{children:"docker run"})," command replacing this line ",(0,i.jsx)(n.code,{children:"openziti/quickstart:latest"})," with your desired\nversion."]}),"\n"]}),"\n"]}),"\n"]}),(0,i.jsx)(n.h3,{id:"verify-the-upgrade",children:"Verify the Upgrade"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Confirmation of the upgrade can be made\nby ",(0,i.jsx)(n.code,{children:"docker exec <ziti-controller-container> /var/openziti/ziti-bin/ziti version"})]}),"\n"]})]})]}),"\n",(0,i.jsxs)(n.h2,{id:"upgrading-versions-v0282",children:["Upgrading Versions <=",(0,i.jsx)(n.code,{children:"v0.28.2"})]}),"\n",(0,i.jsxs)(n.p,{children:["If your old Ziti network was ",(0,i.jsx)(n.code,{children:"v0.28.3"})," or later, this section can be ignored"]}),"\n",(0,i.jsxs)(n.p,{children:["A major change to environment variables names was performed on ",(0,i.jsx)(n.code,{children:"v0.28.3"})," so, if your network was ",(0,i.jsx)(n.code,{children:"v0.28.2"})," or earlier,\nthen you may optionally run the following commands to update your env file to use the updated environment variable\nnames."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'source /dev/stdin <<< "$(wget -qO- https://get.openziti.io/quick/ziti-cli-functions.sh)"\nperformMigration\n'})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},19365:(e,n,t)=>{t.d(n,{A:()=>s});t(96540);var r=t(34164);const i={tabItem:"tabItem_Ymn6"};var o=t(74848);function s({children:e,hidden:n,className:t}){return(0,o.jsx)("div",{role:"tabpanel",className:(0,r.A)(i.tabItem,t),hidden:n,children:e})}},11470:(e,n,t)=>{t.d(n,{A:()=>y});var r=t(96540),i=t(34164),o=t(23104),s=t(56347),l=t(205),a=t(57485),c=t(31682),d=t(70679);function u(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return u(e).map((({props:{value:e,label:n,attributes:t,default:r}})=>({value:e,label:n,attributes:t,default:r})))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p({value:e,tabValues:n}){return n.some((n=>n.value===e))}function x({queryString:e=!1,groupId:n}){const t=(0,s.W6)(),i=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,a.aZ)(i),(0,r.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(t.location.search);n.set(i,e),t.replace({...t.location,search:n.toString()})}),[i,t])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:i}=e,o=h(e),[s,a]=(0,r.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find((e=>e.default))??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:o}))),[c,u]=x({queryString:t,groupId:i}),[f,j]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,i]=(0,d.Dv)(n);return[t,(0,r.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:i}),v=(()=>{const e=c??f;return p({value:e,tabValues:o})?e:null})();(0,l.A)((()=>{v&&a(v)}),[v]);return{selectedValue:s,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);a(e),u(e),j(e)}),[u,j,o]),tabValues:o}}var j=t(92303);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var m=t(74848);function b({className:e,block:n,selectedValue:t,selectValue:r,tabValues:s}){const l=[],{blockElementScrollPositionUntilNextRender:a}=(0,o.a_)(),c=e=>{const n=e.currentTarget,i=l.indexOf(n),o=s[i].value;o!==t&&(a(n),r(o))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;n=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;n=l[t]??l[l.length-1];break}}n?.focus()};return(0,m.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},e),children:s.map((({value:e,label:n,attributes:r})=>(0,m.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{l.push(e)},onKeyDown:d,onClick:c,...r,className:(0,i.A)("tabs__item",v.tabItem,r?.className,{"tabs__item--active":t===e}),children:n??e},e)))})}function k({lazy:e,children:n,selectedValue:t}){const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=o.find((e=>e.props.value===t));return e?(0,r.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,m.jsx)("div",{className:"margin-top--md",children:o.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function g(e){const n=f(e);return(0,m.jsxs)("div",{className:(0,i.A)("tabs-container",v.tabList),children:[(0,m.jsx)(b,{...n,...e}),(0,m.jsx)(k,{...n,...e})]})}function y(e){const n=(0,j.A)();return(0,m.jsx)(g,{...e,children:u(e.children)},String(n))}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>l});var r=t(96540);const i={},o=r.createContext(i);function s(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);