"use strict";(self.webpackChunkdocusaurus_3=self.webpackChunkdocusaurus_3||[]).push([[39246],{61622:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var s=t(36345),n=t(74848),o=t(28453);const r={title:"Zitifying SCP",date:new Date("2021-08-12T14:45:18.000Z"),cuid:"cl475237g030diunv9eu78yn8",slug:"zitifying-scp",authors:["ClintDovholuk"],image:"@site/blogs/openziti//5dcfe6cb113284b378817a8ad5878f98.jpeg",imageDark:"@site/blogs/openziti//5dcfe6cb113284b378817a8ad5878f98.jpeg",tags:["security","zero-trust"]},c=void 0,l={authorsImageUrls:[void 0]},d=[{value:"First Things First",id:"first-things-first",level:2},{value:"Sending and Receiving Files with Zscp",id:"sending-and-receiving-files-with-zscp",level:2},{value:"Zscp Flags",id:"zscp-flags",level:2}];function a(e){const i={a:"a",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(i.p,{children:["In the ",(0,n.jsx)(i.a,{href:"/docs/openziti/blog/zitifying-ssh",children:"previous post"})," we talked about how we could take a well-known\napplication and improve its security by zitifying it, producing ",(0,n.jsx)(i.code,{children:"zssh"}),". The logical next step after zitifying ",(0,n.jsx)(i.code,{children:"ssh"}),"\nwould be to extend the functionality of ",(0,n.jsx)(i.code,{children:"zssh"})," to cover moving files securely as well, enter ",(0,n.jsx)(i.code,{children:"zscp"}),". A zitified ",(0,n.jsx)(i.code,{children:"scp"}),"\neffectively creates a more secure command line tool for sending and receiving files between ziti-empowered devices.\nOnce zitified, we can use ",(0,n.jsx)(i.code,{children:"zscp"})," using ziti identity names just like we did in\n",(0,n.jsx)(i.a,{href:"/docs/openziti/blog/zitifying-ssh",children:"zitifying ssh"}),". I recommend reading the\n",(0,n.jsx)(i.a,{href:"/docs/openziti/blog/zitifying-ssh",children:"previous article"})," if you haven't to learn more about the benefits of\nzitifying tools like ",(0,n.jsx)(i.code,{children:"ssh"})," and ",(0,n.jsx)(i.code,{children:"scp"}),"."]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"first-things-first",children:"First Things First"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.code,{children:"zscp"})," functions with the same prerequisites as ",(0,n.jsx)(i.code,{children:"zssh"}),":"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsxs)(i.p,{children:["Establish a ",(0,n.jsx)(i.a,{href:"https://openziti.io/docs/learn/quickstarts/network/hosted",children:"Ziti Network"})]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsxs)(i.p,{children:["Create and enroll two Ziti Endpoints (one for our ",(0,n.jsx)(i.code,{children:"ssh"})," server, one for the client)"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsxs)(i.p,{children:["the ",(0,n.jsx)(i.code,{children:"sshd"})," server will run ",(0,n.jsx)(i.code,{children:"ziti-tunnel"})," for this demonstration. Conveniently it will run on the same machine I used to setup the ",(0,n.jsx)(i.a,{href:"https://openziti.io/docs",children:"Ziti Network"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsxs)(i.p,{children:["the client, in this case, is my local machine, and I'll ",(0,n.jsx)(i.code,{children:"zscp"})," files both to and from the remote machine."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsxs)(i.p,{children:["Create the ",(0,n.jsx)(i.a,{href:"https://openziti.io/docs/learn/core-concepts/services/overview",children:"Ziti Service"})," we'll use and authorize the two endpoints to use this service"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsxs)(i.p,{children:["Use the ",(0,n.jsx)(i.code,{children:"zscp"})," binary from the client side and the ",(0,n.jsx)(i.code,{children:"ziti-tunnel"})," binary from the serving side to connect"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsxs)(i.p,{children:["Harden ",(0,n.jsx)(i.code,{children:"sshd"})," further by removing port 22 from any internet-based firewall configuration (for example, from within the security-groups wizard in AWS) or by forcing ",(0,n.jsx)(i.code,{children:"sshd"})," to only listen on ",(0,n.jsx)(i.code,{children:"localhost/127.0.0.1"})]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.p,{children:["After ensuring these steps are complete, you can copy files across your Ziti Network. The traffic will be even more secure since now a Ziti Network is required for the connection, requiring that strong identity before even being able to access the ",(0,n.jsx)(i.code,{children:"sshd"})," server. And of course, now ",(0,n.jsx)(i.code,{children:"sshd"})," is 'dark' - it no longer needs the typical port 22 to be exposed to any network."]}),"\n",(0,n.jsxs)(i.p,{children:["Given all the prerequisites are satisfied, we can put ",(0,n.jsx)(i.code,{children:"zscp"})," to use. Simply download the binary for your platform:"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.a,{href:"https://github.com/openziti-incubator/zssh/releases/latest/download/zscp-linux-amd64",children:"linux amd64"})}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.a,{href:"https://github.com/openziti-incubator/zssh/releases/latest/download/zscp-windows-amd64.exe",children:"windows amd64"})}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.a,{href:"https://github.com/openziti-incubator/zssh/releases/latest/download/zscp-macos-amd64",children:"macOs amd64"})}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.a,{href:"https://github.com/openziti-test-kitchen/zssh/releases/latest",children:"other"})}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"sending-and-receiving-files-with-zscp",children:"Sending and Receiving Files with Zscp"}),"\n",(0,n.jsxs)(i.p,{children:["Once you have the executable downloaded, make sure it is named ",(0,n.jsx)(i.code,{children:"zscp"})," and for simplicity's sake we'll assume it's on the path. Just like ",(0,n.jsx)(i.code,{children:"zssh"})," to ",(0,n.jsx)(i.code,{children:"ssh"}),", ",(0,n.jsx)(i.code,{children:"zscp"})," provides the same basic functionality as ",(0,n.jsx)(i.code,{children:"scp"}),". As with most tooling, executing the binary with no arguments will display the expected usage."]}),"\n",(0,n.jsxs)(i.p,{children:["There are two main functions of ",(0,n.jsx)(i.code,{children:"zscp"}),". Just like ",(0,n.jsx)(i.code,{children:"scp"})," you can send and receive from the remote host."]}),"\n",(0,n.jsx)(i.p,{children:"To send files we use this basic syntax:"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.code,{children:"./zscp LOCAL_FILEPATHS... <REMOTE_USERNAME>@TARGET_IDENTITY:REMOTE_FILEPATH"})}),"\n",(0,n.jsx)(i.p,{children:"Then, to retrieve remote files we use a similar syntax:"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.code,{children:"./zscp <REMOTE_USERNAME>@TARGET_IDENTITY:REMOTE_FILEPATH LOCAL_FILEPATH"})}),"\n",(0,n.jsxs)(i.p,{children:["Below is a working example of using ",(0,n.jsx)(i.code,{children:"zscp"})," to send a file to a remote machine. In this case the remote username is not the same as my local username. Just like with ",(0,n.jsx)(i.code,{children:"scp"}),", I'll need to supply the username in my command and it will use the same syntax that regular ",(0,n.jsx)(i.code,{children:"scp"})," uses. Here I am ",(0,n.jsx)(i.code,{children:"zscp"}),"'ing as username ",(0,n.jsx)(i.code,{children:"ubuntu"})," to the remote computer that is joined to the Ziti Network using the identity named ",(0,n.jsx)(i.code,{children:"ziti-tunnel-aws"}),"."]}),"\n",(0,n.jsxs)(i.p,{children:["./zscp local/1.txt ubuntu@ziti-tunnel-aws",":remote"," INFO connection to edge router using token 6c2e8b79-ce8e-483e-a9f8-a930530e706a INFO sent file: /Users/name/local/1.txt ==> /home/ubuntu/remote/1.txt"]}),"\n",(0,n.jsxs)(i.p,{children:["This is only a basic example on how we can use ",(0,n.jsx)(i.code,{children:"zscp"})," to send a singular file to a remote computer. In the next section, we will go over how to use ",(0,n.jsx)(i.code,{children:"zscp"})," flags for extended functionality."]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"zscp-flags",children:"Zscp Flags"}),"\n",(0,n.jsxs)(i.p,{children:["Just like ",(0,n.jsx)(i.code,{children:"zssh"}),", ",(0,n.jsx)(i.code,{children:"zscp"})," has the same flags to pass in: ssh key, ziti configuration file, service name, and one to toggle debug logging. All the defaults are the same as with ",(0,n.jsx)(i.code,{children:"zssh"}),", thus both ",(0,n.jsx)(i.code,{children:"zscp"})," and ",(0,n.jsx)(i.code,{children:"zssh"})," will work without the ",(0,n.jsx)(i.code,{children:"-i"})," and ",(0,n.jsx)(i.code,{children:"-c"})," flag providing the files exist at the default locations. Refer to [zitifying-ssh][2] for instructions on how to use the flags below."]}),"\n",(0,n.jsx)(i.p,{children:'-i, --SshKeyPath string Path to ssh key. default: $HOME/.ssh/id_rsa -c, --ZConfig string Path to ziti config file. default: $HOME/.ziti/zssh.json -d, --debug pass to enable additional debug information -s, --service string service name. (default "zssh")'}),"\n",(0,n.jsxs)(i.p,{children:["In addition to the flags above, ",(0,n.jsx)(i.code,{children:"zscp"})," has a flag to enable recursive copying:"]}),"\n",(0,n.jsx)(i.p,{children:"-r, --recursive pass to enable recursive file transfer"}),"\n",(0,n.jsxs)(i.p,{children:["To use the recursive flag, you must input a directory into the ",(0,n.jsx)(i.code,{children:"LOCAL_FILEPATH"})," argument. Just like ",(0,n.jsx)(i.code,{children:"scp"}),", ",(0,n.jsx)(i.code,{children:"zscp"})," will copy all file contents under the provided directory. You can see below how we can use the ",(0,n.jsx)(i.code,{children:"-r"})," flag to send all contents of ",(0,n.jsx)(i.code,{children:"big_directory"}),"."]}),"\n",(0,n.jsxs)(i.p,{children:["Contents of ",(0,n.jsx)(i.code,{children:"big_directory"})," on local computer:"]}),"\n",(0,n.jsx)(i.p,{children:"tree local local \u2514\u2500\u2500 big_directory \u251c\u2500\u2500 1.txt \u251c\u2500\u2500 2.txt \u251c\u2500\u2500 3.txt \u251c\u2500\u2500 small_directory1 \u2502 \u2514\u2500\u2500 4.txt \u251c\u2500\u2500 small_directory2 \u2502 \u2514\u2500\u2500 5.txt \u2514\u2500\u2500 small_directory3 \u2514\u2500\u2500 6.txt"}),"\n",(0,n.jsx)(i.p,{children:"Here is the command and output:"}),"\n",(0,n.jsxs)(i.p,{children:["$ zscp -r big_directory ubuntu@ziti-tunnel-aws",":remote"," INFO connection to edge router using token d6c268ee-e4f5-4836-bd38-2fc1558257aa INFO sent file: /Users/name/local/big_directory/1.txt ==> /home/ubuntu/remote/big_directory/1.txt INFO sent file: /Users/name/local/big_directory/2.txt ==> /home/ubuntu/remote/big_directory/2.txt INFO sent file: /Users/name/local/big_directory/3.txt ==> /home/ubuntu/remote/big_directory/3.txt INFO sent file: /Users/name/local/big_directory/small_directory1/4.txt ==> /home/ubuntu/remote/big_directory/small_directory1/4.txt INFO sent file: /Users/name/local/big_directory/small_directory2/5.txt ==> /home/ubuntu/remote/big_directory/small_directory2/5.txt INFO sent file: /Users/name/local/big_directory/small_directory3/6.txt ==> /home/ubuntu/remote/big_directory/small_directory3/6.txt"]}),"\n",(0,n.jsxs)(i.p,{children:["After ",(0,n.jsx)(i.code,{children:"zssh'ing"})," to the remote machine, we can prove that all files have been transferred to remote device:"]}),"\n",(0,n.jsx)(i.p,{children:"ubuntu@IP:~$ tree remote/ remote/ \u2514\u2500\u2500 big_directory \u251c\u2500\u2500 1.txt \u251c\u2500\u2500 2.txt \u251c\u2500\u2500 3.txt \u251c\u2500\u2500 small_directory1 \u2502 \u2514\u2500\u2500 4.txt \u251c\u2500\u2500 small_directory2 \u2502 \u2514\u2500\u2500 5.txt \u2514\u2500\u2500 small_directory3 \u2514\u2500\u2500 6.txt"}),"\n",(0,n.jsx)(i.p,{children:"Recursive copying also works to retrieve all contents of a directory on the remote machine."}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.p,{children:"I hope this post has helped you get familiar with another ziti-empowered developer's tool and hopefully it's becoming more clear why zitifying your application will make it more resilient to attack and make the act of connecting to remote services trivial."}),"\n",(0,n.jsxs)(i.p,{children:["Have a look at the code over at ",(0,n.jsx)(i.a,{href:"https://github.com/openziti-test-kitchen/zssh/blob/main/zssh/zscp/main.go",children:"GitHub"})," or continue reading on to the next zitification - ",(0,n.jsx)(i.a,{href:"./kubernetes",children:"kubectl"}),"!"]})]})}function h(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(a,{...e})}):a(e)}},28453:(e,i,t)=>{t.d(i,{R:()=>r,x:()=>c});var s=t(96540);const n={},o=s.createContext(n);function r(e){const i=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function c(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),s.createElement(o.Provider,{value:i},e.children)}},36345:e=>{e.exports=JSON.parse('{"permalink":"/docs/openziti/blog/zitifying-scp","source":"@site/blog/zitifying-scp.md","title":"Zitifying SCP","description":"In the previous post we talked about how we could take a well-known","date":"2021-08-12T14:45:18.000Z","tags":[{"inline":false,"label":"Security","permalink":"/docs/openziti/blog/tags/security","description":"Security-related posts"},{"inline":false,"label":"Zero Trust","permalink":"/docs/openziti/blog/tags/zero-trust","description":"Zero Trust Security"}],"readingTime":5.7,"hasTruncateMarker":true,"authors":[{"name":"Clint Dovholuk","title":"Author","url":"https://github.com/dovholuknf","imageURL":"https://avatars.githubusercontent.com/dovholuknf","key":"ClintDovholuk","page":null}],"frontMatter":{"title":"Zitifying SCP","date":"2021-08-12T14:45:18.000Z","cuid":"cl475237g030diunv9eu78yn8","slug":"zitifying-scp","authors":["ClintDovholuk"],"image":"@site/blogs/openziti//5dcfe6cb113284b378817a8ad5878f98.jpeg","imageDark":"@site/blogs/openziti//5dcfe6cb113284b378817a8ad5878f98.jpeg","tags":["security","zero-trust"]},"unlisted":false,"prevItem":{"title":"Tunneling Ingress to Kubernetes Workloads","permalink":"/docs/openziti/blog/kubernetes"},"nextItem":{"title":"Zitifying SSH","permalink":"/docs/openziti/blog/zitifying-ssh"}}')}}]);