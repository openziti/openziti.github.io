<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Zitifying Kubectl | OpenZiti</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openziti.io/blog/zitification/kubernetes"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="robots" content="index, follow"><meta data-rh="true" property="og:title" content="Zitifying Kubectl | OpenZiti"><meta data-rh="true" name="description" content="The previous post showed how to use a zero trust overlay like Ziti for transferring files by zitifying scp. Next up in the list of zitifications is kubectl. Kubernetes is a container orchestration system. Its purpose is to deploy, scale, and manage the deployment containers. Containers are self-contained, pre-built images of software generally with a singular purpose. Developers often like using containers for various reasons. One major reason developers like containers is because it simplifies the deployment of the solutions they are developing. This is where Kubernetes starts to come into focus."><meta data-rh="true" property="og:description" content="The previous post showed how to use a zero trust overlay like Ziti for transferring files by zitifying scp. Next up in the list of zitifications is kubectl. Kubernetes is a container orchestration system. Its purpose is to deploy, scale, and manage the deployment containers. Containers are self-contained, pre-built images of software generally with a singular purpose. Developers often like using containers for various reasons. One major reason developers like containers is because it simplifies the deployment of the solutions they are developing. This is where Kubernetes starts to come into focus."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-10-03T13:50:50.000Z"><meta data-rh="true" property="article:author" content="https://github.com/dovholuknf"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://openziti.io/blog/zitification/kubernetes"><link data-rh="true" rel="alternate" href="https://openziti.io/blog/zitification/kubernetes" hreflang="en"><link data-rh="true" rel="alternate" href="https://openziti.io/blog/zitification/kubernetes" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EXWPKK5PV4-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OpenZiti RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OpenZiti Atom Feed">


<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-THVRRJ3GLE"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-THVRRJ3GLE",{anonymize_ip:!0})</script>




<link rel="search" type="application/opensearchdescription+xml" title="OpenZiti" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.6f94137e.css">
<link rel="preload" href="/assets/js/runtime~main.4f5dbf1f.js" as="script">
<link rel="preload" href="/assets/js/main.14256037.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="root_VOM9"><span style="color:whitesmoke">Star us on GitHub </span><span style="height:20px"><span><a href="https://github.com/openziti/ziti" data-icon="octicon-star" data-show-count="true" aria-label="Star buttons/github-buttons on GitHub">Star</a></span></span></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://openziti.io" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/ziti-logo-dark.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/ziti-logo-light.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/learn/introduction/">Documentation</a><a class="navbar__item navbar__link" href="/docs/downloads">Downloads</a><a href="https://blog.openziti.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Links</a><ul class="dropdown__menu"><li><div class="text-divider"><p>Socials</p></div></li><li><a href="https://www.youtube.com/OpenZiti" target="_blank" title="OpenZiti on YouTube"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/yt.svg">YouTube</span></a></li><li><a href="https://twitter.com/OpenZiti" target="_blank" title="OpenZiti on Twitter"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/twit.svg">Twitter</span></a></li><li><a href="https://www.reddit.com/r/openziti" target="_blank" title="OpenZiti Subreddit"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/reddit-logo.png">Reddit</span></a></li><li><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/ziggy.png"><a href="https://twitter.com/OpenZiggy" target="_blank" title="OpenZiggy on Twitter">Ziggy</a></span></li><li><div class="text-divider"><p>Other</p></div></li><li><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/blog-icon.png"><a href="https://blog.openziti.io/" target="_blank" title="Blog">Blog</a></span></li><li><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/oz-test-kitchen.png"><a href="https://github.com/openziti-test-kitchen" target="_blank" title="Git project for the test kitchen">Test Kitchen</a></span></li><li><a href="https://zeds.openziti.org" target="_blank" title="Developer Sandbox"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/zeds.png">ZEDS</span></a></li><li><a href="https://netfoundry.io/pricing/" target="_blank" title="NetFoundry-hosted Ziti"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/nf.svg">CloudZiti</span></a></li></ul></div><a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discourse-link" title="Discourse"></a><a href="https://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_eExm"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/articles">Articles</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/c-sdk-on-beaglebone">Building the Ziti C SDK and Sample Apps for arm (BeagleBone)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/bootstrapping-trust/part-01.encryption-everywhere">Bootstrapping Trust</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/bootstrapping-trust/part-02.a-primer-on-public-key-cryptography">Bootstrapping Trust</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/bootstrapping-trust/part-03.certificates">Bootstrapping Trust</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="The previous post showed how to use a zero trust overlay like Ziti for transferring files by zitifying scp. Next up in the list of zitifications is kubectl. Kubernetes is a container orchestration system. Its purpose is to deploy, scale, and manage the deployment containers. Containers are self-contained, pre-built images of software generally with a singular purpose. Developers often like using containers for various reasons. One major reason developers like containers is because it simplifies the deployment of the solutions they are developing. This is where Kubernetes starts to come into focus."><header><h1 class="title_f1Hy" itemprop="headline">Zitifying Kubectl</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-10-03T13:50:50.000Z" itemprop="datePublished">October 3, 2023</time> · <!-- -->13 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/dovholuknf" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/46322585?v=4" alt="Clint Dovholuk" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/dovholuknf" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Clint Dovholuk</span></a></div><small class="avatar__subtitle" itemprop="description">OpenZiti Maintainer</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>The <a href="/blog/zitification/zitifying-scp/">previous post</a> showed how to use a zero trust overlay like Ziti for transferring files by zitifying <code>scp</code>. Next up in the list of zitifications is <code>kubectl</code>. <a href="https://Kubernetes.io/" target="_blank" rel="noopener noreferrer">Kubernetes</a> is a container orchestration system. Its purpose is to deploy, scale, and manage the deployment containers. Containers are self-contained, pre-built images of software generally with a singular purpose. <a href="https://appfleet.com/blog/10-reasons-why-developers-love-docker/" target="_blank" rel="noopener noreferrer">Developers often like using containers for various reasons</a>. One major reason developers like containers is because it simplifies the deployment of the solutions they are developing. This is where Kubernetes starts to come into focus.</p><p>In this article we&#x27;ll use a cloud provider to create a Kubernetes cluster to use. I&#x27;m using Oracle OKE in this article but there are <a href="https://www.google.com/search?q=kubernetes+cloud+providers&amp;oq=kubernetes+cloud+providers" target="_blank" rel="noopener noreferrer">numerous Kubernetes providers</a> and any of them will work but clearly the commands I&#x27;m running here are Oracle specific. Once created we will then access the cluster three ways:</p><ol><li>Via the public Kubernetes API secured via mTLS. This is the default, out-of-the-box mechanism provided by Kubernetes.</li><li>Via a tunneling app. I run Windows, so I&#x27;ll use the Ziti Desktop Edge for Windows.</li><li>Via a zitified <code>kubectl</code>. Here&#x27;s where we&#x27;ll get to see the power of a truly zitified application. We&#x27;ll be able to access our cluster extremely securely using the Ziti overlay network without installing an additional agent. Once access to the cluster comes entirely from the <a href="/docs/learn/introduction/">Ziti Network</a>, we will be able to turn public access to the Kubernetes management API <strong>off</strong> entirely!</li></ol><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="about-kubernetes">About Kubernetes<a href="#about-kubernetes" class="hash-link" aria-label="Direct link to About Kubernetes" title="Direct link to About Kubernetes">​</a></h2><p>If you are not already familiar with Kubernetes then it&#x27;s probably best for you to stop reading and learn a little about it first. Though this article only expects you to understand the most rudimentary of commands, it won&#x27;t teach you enough about Kubernetes to understand the what&#x27;s and why&#x27;s. Lots of documentation on this topic already exist and are just a search away in your search engine of choice.</p><p>Kubernetes itself is not a container engine, it&#x27;s an orchestrator. This means that Kubernetes knows how to interface with container engines to perform deployments and management of workloads on the behalf of operators. This provides people with a common abstraction to use when doing this management and deployment. Interacting with the Kubernetes API is made easy by using the command-line tool: <code>kubectl</code>.</p><p><a href="https://Kubernetes.io/docs/reference/kubectl/overview/" target="_blank" rel="noopener noreferrer">kubectl</a> provides numerous commands and utilities to interact with your Kubernetes cluster. It does this by creating REST requests to a well-known endpoint. This endpoint is a highly-valuable target as it is the entry-point to the cluster. Plenty of blogs exist already on the internet addressing how to secure this endpoint but in this post we&#x27;ll take it one step further than ever before by removing the Kubernetes control plane from the internet entirely. Following that we will even go one step further by replacing the existing <code>kubectl</code> command with a zero-trust implementation leveraging the ziti golang sdk.</p><p>If you&#x27;d prefer to watch a video that goes over the same content contained in the rest of this article you can go ahead and click here to watch.</p><p><a href="https://youtu.be/CRoansolpR0" target="_blank" rel="noopener noreferrer"><img loading="lazy" src="https://img.youtube.com/vi/CRoansolpR0/0.jpg" alt="Secure Kubernetes" class="img_ev3q"></a></p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup">Setup<a href="#setup" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">​</a></h2><p>Below is an overview of the <a href="/docs/learn/introduction/">Ziti Network</a> I created for this article. On the left you can see that the client, my computer, runs Windows 10. Inside Windows 10 I run linux and bash using Ubuntu via <a href="https://docs.microsoft.com/en-us/windows/wsl/install" target="_blank" rel="noopener noreferrer">Windows Subsystem For Linux (WSL)</a>. If you run Windows and don&#x27;t have WSL installed I would encourage you to install and learn it!  In my bash shell I have downloaded the linux version of <code>kubectl</code> created by combining the Ziti Golang SDK into it. You can grab it from <a href="https://github.com/openziti-incubator/kubectl/releases/latest/download/kubectl-linux-amd64" target="_blank" rel="noopener noreferrer">this link</a> if you like or go check out <a href="https://github.com/openziti-incubator/kubectl" target="_blank" rel="noopener noreferrer">the code on GitHub</a> and build it yourself! :)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution-overview">Solution Overview<a href="#solution-overview" class="hash-link" aria-label="Direct link to Solution Overview" title="Direct link to Solution Overview">​</a></h3><p><img loading="lazy" alt="private-kubernetes.svg" src="/assets/images/private-kubernetes-046834ce3b35e4a1a28557d6f474c6a7.svg" width="1087" height="474" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="basic-ziti-setup">Basic Ziti Setup<a href="#basic-ziti-setup" class="hash-link" aria-label="Direct link to Basic Ziti Setup" title="Direct link to Basic Ziti Setup">​</a></h3><p>To accomplish our stated goals, we will need not only an existing <a href="/docs/learn/introduction/">Ziti Network</a> but we&#x27;ll also have to configure that network accordingly. Here&#x27;s a list of the components necessary to deliver Kubernetes with our zero-trust network:</p><ol><li>A configuration for the <code>Bind</code> side of the service. This informs the identity within Kubernetes where to send traffic and how.</li><li>A configuration for the <code>Dial</code> side of the service. This is strictly <strong>only</strong> necessary for tunneling apps. In this example, for the Ziti Desktop Edge for Windows and specifies what host and port will be intercepted on the machine running the stock <code>kubectl</code>. for Windows.</li><li>The service itself which ties our polices mentioned above together.</li><li>A <code>Bind</code> service-policy which specifies which identities are allowed to act as a &quot;host&quot; for the service (meaning an identity to send traffic to which knows where and how to offload that traffic). In our example this will be the <code>ziti-edge-tunnel</code> running in a Kubernetes pod.</li><li>A <code>Dial</code> service-policy which specifies the identities allowed to access the service. This will be the identity using
<code>kubectl</code>.</li><li>Create two identities - one for the <code>Bind</code> side of the service (deployed within the Kubernetes cluster) and one for the <code>Dial</code> or client side.</li></ol><p>Here are some example commands using the <a href="https://github.com/openziti/ziti/releases/latest" target="_blank" rel="noopener noreferrer">ziti cli</a> which illustrate how to create these services. Some things of note worth mentioning. I&#x27;m setting a variable to make my configuration easier. I reuse these code blocks a lot and by extracting some variables it makes it easy for me to delete/recreate services. First I set the <code>service_name</code>
variable. I use this variable in all the names of the Ziti objects I create just to make it more clear and obvious if I have to look back at my configuration again.</p><p>Since I&#x27;m going to be accessing my Kubernetes API which I&#x27;ve deployed using the Oracle cloud I chose to use <code>k8s.oci</code>
as my service name. When deployed by a cloud provider, the Kubernetes API is generated or updated with numerous SANS and IP address I can choose from to represent the <code>Dial</code> side which will be intercepted by the Ziti Desktop Edge for Windows. The Oracle cloud console informs me that the private IP of <code>10.0.0.6</code> was assigned to my cluster when I click on the &#x27;Access Cluster&#x27; button which is why I chose to use that value below. I could have chosen to use any of the DNS names provided by OKE. There are at least five I could choose from, all visible as SANS on the cert that the server returns: <code>kubernetes</code>, <code>kubernetes.default</code>, <code>kubernetes.default.svc</code>, <code>kubernetes.default.svc.cluster</code>
, <code>kubernetes.default.svc.cluster.local</code>. I chose the IP since it&#x27;s pretty obvious that it&#x27;s an internal IP, not on my local network. Also worth pointing out is that I&#x27;m mapping the port as well, changing it from the port that the server provides, 6443, to the common HTTPS port of 443 for the local intercept. With zitified <code>kubectl</code> we don&#x27;t even need these intercepts, but we&#x27;ll keep it here so that we can use the unmodified <code>kubectl</code> as well. Finally, these commands are all executed inside a bash shell since I&#x27;m using WSL.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-ziti-cli-commands">Example Ziti CLI commands<a href="#example-ziti-cli-commands" class="hash-link" aria-label="Direct link to Example Ziti CLI commands" title="Direct link to Example Ziti CLI commands">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># the name of the service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">service_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">k8s.oci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># the name of the identity you&#x27;d like to see on the kubectl client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">the_user_identity</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">.client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># the name of the identity deployed into the kubernetes cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">the_kubernetes_identity</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">.private</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">-host.v1 host.v1 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;{&quot;protocol&quot;:&quot;tcp&quot;, &quot;address&quot;:&quot;10.0.0.6&quot;,&quot;port&quot;:6443 }&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">-client-config intercept.v1 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;{&quot;protocols&quot;:[&quot;tcp&quot;],&quot;addresses&quot;:[&quot;10.0.0.6&quot;,&quot;kubernetes&quot;], &quot;portRanges&quot;:[{&quot;low&quot;:443, &quot;high&quot;:443}]}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --configs </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">-client-config,</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">-host.v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">-binding Bind </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --service-roles </span><span class="token string" style="color:#e3116c">&#x27;@&#x27;</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --identity-roles </span><span class="token string" style="color:#e3116c">&#x27;#&#x27;</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;&#x27;ServerEndpoints&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ziti edge create service-policy &quot;</span><span class="token variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;-dialing Dial \</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    --service-roles &#x27;@&#x27;&quot;</span><span class="token variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    --identity-roles &#x27;#&#x27;&quot;</span><span class="token variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;&#x27;ClientEndpoints&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ziti edge create identity device &quot;</span><span class="token variable" style="color:#36acaa">${the_kubernetes_identity}</span><span class="token string" style="color:#e3116c">&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    -a &quot;</span><span class="token variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;ServerEndpoints \</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    -o &quot;</span><span class="token variable" style="color:#36acaa">${the_kubernetes_identity}</span><span class="token string" style="color:#e3116c">&quot;.jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ziti edge create identity device &quot;</span><span class="token variable" style="color:#36acaa">${the_user_identity}</span><span class="token string" style="color:#e3116c">&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    -a &quot;</span><span class="token variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;ClientEndpoints \</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    -o &quot;</span><span class="token variable" style="color:#36acaa">${the_user_identity}</span><span class="token plain">&quot;.jwt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes-config-files">Kubernetes Config Files<a href="#kubernetes-config-files" class="hash-link" aria-label="Direct link to Kubernetes Config Files" title="Direct link to Kubernetes Config Files">​</a></h2><p>Once we have established the pieces of the <a href="/docs/learn/introduction/">Ziti Network</a>, we&#x27;ll want to get the Kubernetes config files from OKE so that we can test access, make sure the cluster works etc. Oracle provides a CLI command which makes it pretty easy to get those config files called <code>oci</code>. As of this writing - the guide from <a href="https://docs.oracle.com/en-us/iaas/Content/API/SDKDocs/cliinstall.htm" target="_blank" rel="noopener noreferrer">Oracle is here</a>. Once <code>oci</code> is installed and configured the Oracle cloud gives you very easy commands to run which will generate two files. One file will be for accessing the Kubernetes API through the public endpoint. The other will get you the file for private access. We&#x27;re going to want both since we&#x27;re on a journey here from &quot;public API endpoint&quot; to tunneling-app-based access, to the final stage of app-embedded zero-trust directly into <code>kubeztl</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getting-the-kubernetes-config-files">Getting the Kubernetes Config Files<a href="#getting-the-kubernetes-config-files" class="hash-link" aria-label="Direct link to Getting the Kubernetes Config Files" title="Direct link to Getting the Kubernetes Config Files">​</a></h3><p>Notice that we are changing the file location output by these commands and they are being output as two separate Kubernetes config files. If you prefer to merge them all into one big config file and change contexts - feel free. I left them as separate files here because it provides a very clear separation as to which config is being used or modified.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Get this value directly from Oracle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">oci_cluster_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;put-your-cluster-id-here&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oci ce cluster create-kubeconfig </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster-id </span><span class="token variable" style="color:#36acaa">${oci_cluster_id}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --file /tmp/oci/config.oci.public </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --region us-ashburn-1 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --token-version </span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain">.0 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --kube-endpoint PUBLIC_ENDPOINT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> /tmp/oci/config.oci.public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oci ce cluster create-kubeconfig </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster-id </span><span class="token variable" style="color:#36acaa">${oci_cluster_id}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --file /tmp/oci/config.oci.private </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --region us-ashburn-1 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --token-version </span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain">.0 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --kube-endpoint PRIVATE_ENDPOINT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> /tmp/oci/config.oci.private</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="connecting-the-pieces">Connecting the Pieces<a href="#connecting-the-pieces" class="hash-link" aria-label="Direct link to Connecting the Pieces" title="Direct link to Connecting the Pieces">​</a></h2><p>At this point we should have all the pieces in place so that we can start putting them together to test the overall solution. In this section we&#x27;ll access our public Kubernetes api to make sure it works. Then we&#x27;ll install Ziti into the Kubernetes cluster and verify private access works. Finally we&#x27;ll disable public access <strong>entirely</strong> and use the zitified <code>kubeztl</code> command to access the cluster with true, app-embedded zero-trust binary.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing-the-public-api">Testing the Public API<a href="#testing-the-public-api" class="hash-link" aria-label="Direct link to Testing the Public API" title="Direct link to Testing the Public API">​</a></h3><p>This step is very straight-forward for anyone who&#x27;s used Kubernetes before. Issue the following commands, making sure the path is correct for your public Kubernetes config file, and verify Kubernetes works as expected.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">KUBECONFIG</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/tmp/oci/config.oci.public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -v6 --request-timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;5s&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I1019 </span><span class="token number" style="color:#36acaa">13</span><span class="token plain">:57:31.910962    </span><span class="token number" style="color:#36acaa">3211</span><span class="token plain"> loader.go:372</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Config loaded from file:  /tmp/oci/config.oci.public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I1019 </span><span class="token number" style="color:#36acaa">13</span><span class="token plain">:57:33.676047    </span><span class="token number" style="color:#36acaa">3211</span><span class="token plain"> round_trippers.go:454</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> GET https://150.230.150.0:6443/api/v1/namespaces/default/pods?limit</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">500</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">5s </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1752</span><span class="token plain"> milliseconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                        READY   STATUS    RESTARTS   AGE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If your output looks something similar to the above (with or without the pods you expect to see) then great! That means your Kubernetes cluster is indeed up and running. Let&#x27;s move on!</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-ziti-to-kubernetes">Deploying Ziti to Kubernetes<a href="#deploying-ziti-to-kubernetes" class="hash-link" aria-label="Direct link to Deploying Ziti to Kubernetes" title="Direct link to Deploying Ziti to Kubernetes">​</a></h4><p>Next we&#x27;ll grab a few lines from the excellent guide NetFoundry put out for integrating with Kubernetes. There&#x27;s a section in that guide for <a href="https://developer.netfoundry.io/guides/kubernetes/#install-ziti-with-helm" target="_blank" rel="noopener noreferrer">installing Ziti with Helm</a>. This comes down to just these steps:</p><ol><li>install the <code>helm</code> CLI tool <a href="https://helm.sh/docs/intro/install/" target="_blank" rel="noopener noreferrer">using this guide</a></li><li>add the NetFoundry helm repo: <code>helm repo add netfoundry https://netfoundry.github.io/charts/</code></li><li>locate the jwt file for the Kubernetes identity. If you followed the steps above the file will be named: <code>&quot;${the_kubernetes_identity}&quot;.jwt</code> (make sure you replace the variable with the correct value)</li><li>use the jwt to add Ziti: <code>helm install ziti-host netfoundry/ziti-host --set-file enrollmentToken=&quot;${the_kubernetes_identity}&quot;.jwt</code> (again make sure you replace the variable name) If you need to, make sure you create a persistent volume. The ziti pod requires storage to store a secret.</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: PersistentVolume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: ziti-host-pv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type: </span><span class="token builtin class-name">local</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  storageClassName: oci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  capacity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    storage: 100Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  accessModes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ReadWriteMany</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hostPath:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path: </span><span class="token string" style="color:#e3116c">&quot;/netfoundry&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="addenroll-the-client-identity">Add/Enroll the Client Identity<a href="#addenroll-the-client-identity" class="hash-link" aria-label="Direct link to Add/Enroll the Client Identity" title="Direct link to Add/Enroll the Client Identity">​</a></h4><p>Now consume the one time token (the jwt file) to enroll and create a client-side identity using the Ziti Desktop Edge for Windows (or MacOS or via the <code>ziti-edge-tunnel</code> if you prefer). Once you can see the identity in your tunneling app, you should be able to use the private kubernetes config file to access the same exact cluster. Remember though, we have mapped the port on the client side to use 443. That means you&#x27;ll need to update your config file and change 6443 --&gt; 443. Now when you run <code>get pods</code> you&#x27;ll see the ziti-host pod deployed:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">KUBECONFIG</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/tmp/oci/config.oci.private</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                        READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti-host-976b84c66-kr4bc   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          90m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-big-finale---zitified-kubectl">The Big Finale - Zitified kubectl<a href="#the-big-finale---zitified-kubectl" class="hash-link" aria-label="Direct link to The Big Finale - Zitified kubectl" title="Direct link to The Big Finale - Zitified kubectl">​</a></h2><p>If you have made it this far, you&#x27;ve seen us access the Kubernetes API via the public IP. We&#x27;ve even accessed it via the private IP (which btw - is pretty cool in my opinion!). Now we&#x27;re going to download the zitified kubectl command, turn off the public IP and even turn off the locally running tunneling app and still access the API!</p><ol><li><p>Disable the cluster&#x27;s public IP address in OKE (go to the cluster in Oracle Cloud, click Edit and remove the public IP and click save)</p></li><li><p>Turn off the Ziti Desktop Edge for Windows</p></li><li><p>Build <code>kubeztl</code> from <a href="https://github.com/openziti-test-kitchen/kubeztl" target="_blank" rel="noopener noreferrer">the GitHub repo</a></p></li><li><p>Use <code>kubeztl</code> to get pods!</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./kubeztl -zConfig ./id.json -service k8s.oci get pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                        READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti-host-976b84c66-kr4bc   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          101m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modifying-kubeconfig">Modifying KUBECONFIG<a href="#modifying-kubeconfig" class="hash-link" aria-label="Direct link to Modifying KUBECONFIG" title="Direct link to Modifying KUBECONFIG">​</a></h3><p>The <code>kubeztl</code> command has also been modified to allow you to add the service name and config file directly into the file itself. This is convenient since you will not need to supply the ziti identity file, nor will you need to specify which service to use. Modifying the file is straight-forward. Open the config file, find the context listed under the contexts root and add two rows as shown here.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">contexts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- context:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cluster: cluster-cjw4arxuolq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user: user-cjw4arxuolq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    zConfig: /tmp/oci/k8s.id.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service: k8s.oci</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once done - you can now simply use the context the same way you have always - <code>kubeztl get pods</code>!</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./kubeztl get pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                        READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti-host-976b84c66-kr4bc   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          114m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>We&#x27;ve seen in this post how you can not only secure your Kubernetes API with the normal Kubernetes mechanisms. You can also take your Kubernetes API off the internet <strong>ENTIRELY</strong>. No need to deploy and maintain a special bastian node. Now by having a secure, zero-trust overlay in place you can safely and securely access your Kubernetes API without the fear of that public, high-value API getting attacked.</p><p><img loading="lazy" src="https://i.imgur.com/JRBQMkN.jpg" alt="But Wait, There&#x27;s More" class="img_ev3q"></p><p>Once you&#x27;ve deployed Ziti into the Kubernetes cluster you&#x27;re not done there. Now you can also use Ziti to span cloud networks. You can use it to easily link private data centers or other private Kubernetes clusters all into one secure, zero-trust overlay network! Use Ziti to expose workloads that are <strong>TRULY</strong> private!  In future articles we might explore how we can bring Ziti to bear on these topics, stay tuned!</p><hr></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/zitification"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Zitification</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/zitification/prometheus/part1"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Enable Prometheus to Scrape Anything from Anywhere</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#about-kubernetes" class="table-of-contents__link toc-highlight">About Kubernetes</a></li><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a><ul><li><a href="#solution-overview" class="table-of-contents__link toc-highlight">Solution Overview</a></li><li><a href="#basic-ziti-setup" class="table-of-contents__link toc-highlight">Basic Ziti Setup</a></li></ul></li><li><a href="#kubernetes-config-files" class="table-of-contents__link toc-highlight">Kubernetes Config Files</a><ul><li><a href="#getting-the-kubernetes-config-files" class="table-of-contents__link toc-highlight">Getting the Kubernetes Config Files</a></li></ul></li><li><a href="#connecting-the-pieces" class="table-of-contents__link toc-highlight">Connecting the Pieces</a><ul><li><a href="#testing-the-public-api" class="table-of-contents__link toc-highlight">Testing the Public API</a></li></ul></li><li><a href="#the-big-finale---zitified-kubectl" class="table-of-contents__link toc-highlight">The Big Finale - Zitified kubectl</a><ul><li><a href="#modifying-kubeconfig" class="table-of-contents__link toc-highlight">Modifying KUBECONFIG</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a class="footer__link-item" href="/policies/CODE_OF_CONDUCT">Policies</a><span class="footer__link-separator">·</span><a href="https://netfoundry.io/pricing/" target="_blank" rel="noopener noreferrer" class="footer__link-item">CloudZiti</a><span class="footer__link-separator">·</span><a href="https://blog.openziti.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 NetFoundry Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4f5dbf1f.js"></script>
<script src="/assets/js/main.14256037.js"></script>
</body>
</html>