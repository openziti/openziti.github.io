<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-docs-guides docs-doc-id-hsm/yubikey">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">YubiKey by Yubico | OpenZiti</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openziti.io/guides/hsm/yubikey"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-docs-guides-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-docs-guides-current"><meta data-rh="true" property="og:title" content="YubiKey by Yubico | OpenZiti"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://openziti.io/guides/hsm/yubikey"><link data-rh="true" rel="alternate" href="https://openziti.io/guides/hsm/yubikey" hreflang="en"><link data-rh="true" rel="alternate" href="https://openziti.io/guides/hsm/yubikey" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.542f13bf.css">
<link rel="preload" href="/assets/js/runtime~main.3347cdb9.js" as="script">
<link rel="preload" href="/assets/js/main.b96dd6d5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><div class="root_VOM9"><span style="color:whitesmoke">Star us on GitHub </span><span style="height:20px"><span><a href="https://github.com/openziti/ziti" data-icon="octicon-star" data-show-count="true" aria-label="Star buttons/github-buttons on GitHub">Star</a></span></span></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ziti-logo-dark.svg" alt="OpenZiti Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/ziti-logo-light.svg" alt="OpenZiti Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/docs/introduction/intro">Docs</a><a class="navbar__item navbar__link" href="/api/">APIs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/guides/">Guides</a><a class="navbar__item navbar__link" href="/glossary/glossary">Glossary</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_eExm docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/guides/">Guides</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/guides/kubernetes/kubernetes-sidecar-tunnel-quickstart">Kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/guides/hsm/">Hardware Security Modules (HSM)</a><button aria-label="Toggle the collapsible sidebar category &#x27;Hardware Security Modules (HSM)&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/hsm/softhsm">SoftHSMv2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/guides/hsm/yubikey">YubiKey by Yubico</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/guides/mobile/android">Ziti on Mobile</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/guides/hsm/"><span itemprop="name">Hardware Security Modules (HSM)</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">YubiKey by Yubico</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>YubiKey by Yubico</h1><p><a href="https://www.yubico.com/" target="_blank" rel="noopener noreferrer">Yubico</a> is a manufacturer of HSM deviceis. A popular line of HSM produced by Yubico is the
YubiKey. This quickstart guide will use specific device from Yubico - the <a href="https://www.yubico.com/product/YubiKey-5-nfc" target="_blank" rel="noopener noreferrer">YubiKey 5
nfc</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h2><p>The <a href="https://www.yubico.com/product/YubiKey-5-nfc" target="_blank" rel="noopener noreferrer">YubiKey 5 nfc</a> is a multi-purpose device with a few different
security-minded uses. One of the applications on the device is an application called PIV or &quot;Personal Identity
Verification&quot;. PIV is a <a href="https://csrc.nist.gov/projects/piv/piv-standards-and-supporting-documentation" target="_blank" rel="noopener noreferrer">standard published by
NIST</a> and describes the kinds of
credentials which make up the standard. PIV credentials have certificates and key pairs, pin numbers, biometrics
like fingerprints and pictures, and other unique identifiers. When put together into a PIV credential, it provides
the capability to implement multi-factor authentication for networks, applications and buildings.</p><p>In this quickstart you will see the commands and tools needed to use a <a href="https://www.yubico.com/product/YubiKey-5-nfc" target="_blank" rel="noopener noreferrer">YubiKey 5
nfc</a> with a Ziti Network. This document is intended to serve as a
quickstart. That means limited context will be provided for each step. When appropriate there will be a small amount of
context or a comment included to aid in understanding of what is happening and why. Most if not all of these commands
are easily searched for using your search engine of choice.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>This quickstart intended audience is for more technically savvy indiviuals. You will need to be familar with the command
line interface of your operating system.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequistites">Prerequistites<a class="hash-link" href="#prerequistites" title="Direct link to heading">​</a></h2><ul><li><a href="https://www.yubico.com/product/YubiKey-5-nfc" target="_blank" rel="noopener noreferrer">YubiKey 5 nfc</a> - clearly you&#x27;ll need one in order to use this
quickstart!</li><li><a href="https://github.com/OpenSC/OpenSC/wiki" target="_blank" rel="noopener noreferrer">OpenSC</a> is installed and <code>pkcs11-tool</code> is either on the PATH or at a known
location. Not required however this quickstart uses the <code>pkcs11-tool</code> to illustrate that the device is PKCS#11
compliant. HSM manufacturers will generally provide a similar tool and often expand it&#x27;s usage. See more below.
<a href="https://developers.yubico.com/yubico-piv-tool/" target="_blank" rel="noopener noreferrer">yubico-piv-tool</a> - YubiKey privides a similar tool to the
<code>pkcs11-tool</code>. This tool is needed to be installed because it contains the pkcs#11 module (driver) for the HSM. As
this is a tool specific to Yubico we&#x27;ve chosen to not use this in the following commands.</li><li>Ensure the YubiKey is factory reset. To avoid any compliations with existing information in the YubiKey ensure the
device is factory reset using the <a href="https://www.yubico.com/products/services-software/download/YubiKey-manager/" target="_blank" rel="noopener noreferrer">YubiKey
Manager</a>.</li><li>In order to successfully use the YubiKey the libraries provided by the <code>yubico-piv-tool</code> <em>MUST</em> either be on the path
or in a common location that is known to the OS. On linux this is likely done by the YubiKey software installation but
on Windows you&#x27;ll need to take any additional actions highlighted in the Windows-specific sections.</li><li>Linux Only: If you&#x27;re using linux - you&#x27;ll need to follow the <a href="https://developers.yubico.com/yubico-piv-tool/" target="_blank" rel="noopener noreferrer">build
instructions</a> provided by Yubico. Before you can do anything with the
Yubikey you&#x27;ll need to make sure the <code>libykcs11.so</code> exists on your system. When creating this quickstart the library
was built to <code>./yubico-piv-tool-2.0.0/ykcs11/.libs/libykcs11.so</code>.</li><li><a href="https://ubuntu.com/" target="_blank" rel="noopener noreferrer">Ubuntu</a> was used to test this guide. An attempt was also made with <a href="https://linuxmint.com/" target="_blank" rel="noopener noreferrer">linux
mint</a> however the attempt failed when trying to compile the Yubikey software and was aborted.
It would likely have worked if enough effort was put into discovering why that linux variant had issues pulling and
compiling the necessary software. If you see strange errors when following this guide and are not using Ubuntu it may
be related.</li><li>ziti and ziti-tunnel are both downloaded and on the path.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lets-use-the-yubikey">Let&#x27;s Use the YubiKey!<a class="hash-link" href="#lets-use-the-yubikey" title="Direct link to heading">​</a></h2><p>Here&#x27;s the list of steps we&#x27;ll accomplish in this quickstart:</p><ul><li>Establish a bunch of environment variables to make it easy to copy/paste the other commands. You&#x27;ll want to <em>look at
these environment variables</em>. They need to be setup properly. If you have problems with this guide it is almost
certainly because you have an environment variable setup incorrectly. Double check them.</li><li>Make a directory and generate a configuration files for Ziti</li><li>Use the <a href="https://netfoundry.jfrog.io/netfoundry/ziti-release/ziti/" target="_blank" rel="noopener noreferrer">Ziti CLI</a> to:<ul><li>create two identities - one demonstrating an RSA key, one EC</li><li>enroll the identities</li><li>create a test service</li><li>create test router/service policies</li></ul></li><li>Use the pkcs11-tool provided by OpenSC to interact with the YubiKey to:<ul><li>initialize the PIV app</li><li>create a key</li></ul></li><li>Use <code>ziti-tunnel</code> to enroll the identities using the YubiKey</li><li>Use <code>ziti-tunnel</code> in proxy mode to verify things are working and traffic is flowing over the Ziti Network</li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>Do <em>NOT</em> use id <code>2</code> or <code>02</code> for any keys you add. Id <code>02</code> corresponds to the YubiKey&#x27;s &quot;Management Key&quot;. You will not be
able to write a key into this location. The error you will see will indicate: <code>CKR_USER_NOT_LOGGED_IN</code>.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="establish-environment-variables">Establish Environment Variables<a class="hash-link" href="#establish-environment-variables" title="Direct link to heading">​</a></h3><p>Open a command line and establish the following environment varibles. Note that for the YubiKey we do <em>not</em> use id <code>02</code>
as it appears to be reserved by the YubiKey.  The default SOPIN and PIN are used as well. When using the YubiKey Manager
software the &quot;SO PIN&quot; corresponds to the &quot;Management Key&quot; while &quot;pin&quot; is the same both here and in the YubiKey Manager.</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Linux/MacOS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Windows</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># the name of the ziti controller you&#x27;re logging into</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ZITI_CTRL=local-edge-controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># the location of the certificate(s) to use to validate the controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ZITI_CTRL_CERT=/path/to/controller.cert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ZITI_USER=myUserName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ZITI_PWD=myPassword</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># a name for the configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HSM_NAME=yubikey_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># path to the yubikey pkcs11 libraries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HSM_ROOT=/path/to/yubico-piv-tool-2.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export PKCS11_MODULE=${HSM_ROOT}/ykcs11/.libs/libykcs11.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># the id of the key - you probably want to leave these alone unless you know better</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HSM_ID1=01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HSM_ID2=03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># the pins used when accessing the pkcs11 api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HSM_SOPIN=010203040506070801020304050607080102030405060708</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HSM_PIN=123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export RSA_ID=${HSM_NAME}${HSM_ID1}_rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export EC_ID=${HSM_NAME}${HSM_ID2}_ec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># location for the config files to be placed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HSM_DEST=${HSM_ROOT}/${HSM_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export HSM_LABEL=${HSM_NAME}-label</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># make an alias for ease</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alias p=&#x27;pkcs11-tool --module $PKCS11_MODULE&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>Ensure you use the correct dll. If you use an x86 dll with x64 binaries you&#x27;ll get an error. With Windows - make sure
you update the path to include the folder of libykcs11-1.dll as additional libraries are needed by the pkcs11 driver!</p></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">REM the name of the ziti controller you&#x27;re logging into</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET ZITI_CTRL=local-edge-controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM the location of the certificate(s) to use to validate the controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET ZITI_CTRL_CERT=c:\path\to\controller.cert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET ZITI_USER=myUserName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET ZITI_PWD=myPassword</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM a name for the configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET HSM_NAME=yubikey_windemo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM the path to the root of the yubikey piv tool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET HSM_ROOT=c:\path\to\yubico-piv-tool-2.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM path to the pkcs11 library</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET PATH=%PATH%;%HSM_ROOT%\bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET PKCS11_MODULE=%HSM_ROOT%\bin\libykcs11-1.dll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM the id of the key - you probably want to leave these alone unless you know better</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET HSM_ID1=01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET HSM_ID2=03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET RSA_ID=%HSM_NAME%%HSM_ID1%_rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET EC_ID=%HSM_NAME%%HSM_ID2%_ec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM the pins used when accessing the pkcs11 api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET HSM_SOPIN=010203040506070801020304050607080102030405060708</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET HSM_PIN=123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET HSM_DEST=%HSM_ROOT%\%HSM_NAME%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET HSM_LABEL=%HSM_NAME%-label</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET HSM_TOKENS_DIR=%HSM_DEST%\tokens\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM make an alias for ease</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">doskey p=&quot;c:\Program Files\OpenSC Project\OpenSC\tools\pkcs11-tool.exe&quot; --module %PKCS11_MODULE% $*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="make-directories-for-config-files">Make Directories for Config Files<a class="hash-link" href="#make-directories-for-config-files" title="Direct link to heading">​</a></h3><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Linux/MacOS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Windows</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ${HSM_ROOT}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf ${HSM_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ${HSM_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ${HSM_NAME}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /d %HSM_ROOT%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rmdir /s /q %HSM_NAME%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir %HSM_NAME%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /d %HSM_NAME%</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-the-ziti-cli">Use the Ziti CLI<a class="hash-link" href="#use-the-ziti-cli" title="Direct link to heading">​</a></h3><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Linux/MacOS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Windows</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge login $ZITI_CTRL:1280 -u $ZITI_USER -p $ZITI_PWD -c $ZITI_CTRL_CERT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create a new identity and output the jwt to a known location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create identity device &quot;${RSA_ID}&quot; -o &quot;${HSM_DEST}/${RSA_ID}.jwt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create a second new identity and output the jwt to a known location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create identity device &quot;${EC_ID}&quot; -o &quot;${HSM_DEST}/${EC_ID}.jwt&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge login %ZITI_CTRL%:1280 -u %ZITI_USER% -p %ZITI_PWD% -c %ZITI_CTRL_CERT%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM create a new identity and output the jwt to a known location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create identity device &quot;%RSA_ID%&quot; -o &quot;%HSM_DEST%\%RSA_ID%.jwt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM create a second new identity and output the jwt to a known location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create identity device &quot;%EC_ID%&quot; -o &quot;%HSM_DEST%\%EC_ID%.jwt&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-pkcs11-tool-to-setup-the-yubikey">Use pkcs11-tool to Setup the YubiKey<a class="hash-link" href="#use-pkcs11-tool-to-setup-the-yubikey" title="Direct link to heading">​</a></h3><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Linux/MacOS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Windows</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">p --init-token --label &quot;ziti-test-token&quot; --so-pin $HSM_SOPIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create a couple of keys - one rsa and one ec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p -k --key-type rsa:2048 --usage-sign --usage-decrypt --login --id $HSM_ID1 --login-type so --so-pin $HSM_SOPIN --label defaultkey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p -k --key-type EC:prime256v1 --usage-sign --usage-decrypt --login --id $HSM_ID2 --login-type so --so-pin $HSM_SOPIN --label defaultkey</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">p --init-token --label &quot;ziti-test-token&quot; --so-pin %HSM_SOPIN%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM create a couple of keys - one rsa and one ec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p -k --key-type rsa:2048 --usage-sign --usage-decrypt --login --id %HSM_ID1% --login-type so --so-pin %HSM_SOPIN% --label defaultkey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p -k --key-type EC:prime256v1 --usage-sign --usage-decrypt --login --id %HSM_ID2% --login-type so --so-pin %HSM_SOPIN% --label defaultkey</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-ziti-tunnel-to-enroll-the-identities">Use ziti-tunnel to Enroll the Identities<a class="hash-link" href="#use-ziti-tunnel-to-enroll-the-identities" title="Direct link to heading">​</a></h3><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Linux/MacOS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Windows</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti-tunnel enroll -j &quot;${HSM_DEST}/${RSA_ID}.jwt&quot; -k &quot;pkcs11://${PKCS11_MODULE}?id=${HSM_ID1}&amp;pin=${HSM_PIN}&quot; -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti-tunnel enroll -j &quot;${HSM_DEST}/${EC_ID}.jwt&quot; -k &quot;pkcs11://${PKCS11_MODULE}?id=${HSM_ID2}&amp;pin=${HSM_PIN}&quot; -v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti-tunnel enroll -j &quot;%HSM_DEST%\%RSA_ID%.jwt&quot; -k &quot;pkcs11://%PKCS11_MODULE%?id=%HSM_ID1%&amp;pin=%HSM_PIN%&quot; -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti-tunnel enroll -j &quot;%HSM_DEST%\%EC_ID%.jwt&quot; -k &quot;pkcs11://%PKCS11_MODULE%?id=%HSM_ID2%&amp;pin=%HSM_PIN%&quot; -v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-ziti-tunnel-to-verify-things-work">Use ziti-tunnel to Verify Things Work<a class="hash-link" href="#use-ziti-tunnel-to-verify-things-work" title="Direct link to heading">​</a></h3><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Linux/MacOS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Windows</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># if you only have a single edge router this command will work without the need for copy/paste</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EDGE_ROUTER_ID=$(ziti edge list edge-routers | cut -d &quot; &quot; -f2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># IF the above command doesn&#x27;t work - run this command and get the id from the first edge-router.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list edge-routers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># then use the id returned from the above command and put it into a variable for use in a momment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># EDGE_ROUTER_ID={insert the &#x27;id&#x27; from above - example: 64d4967b-5474-4f06-8548-5700ed7bfa80}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># remove/recreate the config - here we&#x27;ll be instructing the tunneler to listen on localhost and port 9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete config wttrconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config wttrconfig ziti-tunneler-client.v1 &quot;{ \&quot;hostname\&quot; : \&quot;localhost\&quot;, \&quot;port\&quot; : 9000 }&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># recreate the service with the EDGE_ROUTER_ID from above. Here we are adding a ziti service that will</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># send a request to wttr.in to retreive a weather forecast</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete service wttr.ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service wttr.ziti &quot;${EDGE_ROUTER_ID}&quot; tcp://wttr.in:80 --configs wttrconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># start one or both proxies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti-tunnel proxy -i &quot;${HSM_DEST}/${RSA_ID}.json&quot; wttr.ziti:8000 -v &amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti-tunnel proxy -i &quot;${HSM_DEST}/${EC_ID}.json&quot; wttr.ziti:9000 -v &amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># use a browser - or curl to verify the ziti tunneler is listening locally and the traffic has flowed over the ziti network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -H &quot;Host: wttr.in&quot; http://localhost:8000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -H &quot;Host: wttr.in&quot; http://localhost:9000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">REM these two commands can&#x27;t be copied and pasted - you need to get the result of the first command and use it in the next</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM run this command and get the id from the first edge-router.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge list edge-routers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM use the id returned from the above command and put it into a variable for use in a momment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SET EDGE_ROUTER_ID={insert the &#x27;id&#x27; from above - example: 64d4967b-5474-4f06-8548-5700ed7bfa80}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM remove/recreate the config - here we&#x27;ll be instructing the tunneler to listen on localhost and port 9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete config wttrconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config wttrconfig ziti-tunneler-client.v1 &quot;{ \&quot;hostname\&quot; : \&quot;localhost\&quot;, \&quot;port\&quot; : 9000 }&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM recreate the service with the EDGE_ROUTER_ID from above. Here we are adding a ziti service that will</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM send a request to wttr.in to retreive a weather forecast</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete service wttr.ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service wttr.ziti &quot;%EDGE_ROUTER_ID%&quot; tcp://wttr.in:80 --configs wttrconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM start one or both proxies - use ctrl-break or ctrl-pause to terminate these processes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start /b ziti-tunnel proxy -i &quot;%HSM_DEST%/%RSA_ID%.json&quot; wttr.ziti:8000 -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start /b ziti-tunnel proxy -i &quot;%HSM_DEST%/%EC_ID%.json&quot; wttr.ziti:9000 -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM use a browser - or curl to verify the ziti tunneler is listening locally and the traffic has flowed over the ziti network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -H &quot;Host: wttr.in&quot; http://localhost:8000 &gt; &quot;%HSM_DEST%\example_%RSA_ID%.txt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -H &quot;Host: wttr.in&quot; http://localhost:9000 &gt; &quot;%HSM_DEST%\example_%EC_ID%.txt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM set the codepage for the cmd prompt so that the output looks nice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chcp 65001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM show the results in the console</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type &quot;%HSM_DEST%\example_%RSA_ID%.txt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type &quot;%HSM_DEST%\example_%EC_ID%.txt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM ctrl-break or ctrl-pause to kill the tunnelers</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="putting-it-all-together">Putting It All Together<a class="hash-link" href="#putting-it-all-together" title="Direct link to heading">​</a></h3><p>Above we&#x27;ve only shown the commands that need to run and not what the output of those commands would look like. Here
we&#x27;ll see all the commands put together along with all the output from the commands. This section is long - you are
warned! Also note that this content is subject to change. If the output you see is not identical it&#x27;s because the
software has changed since this information was captured. File an <a href="https://github.com/openziti/ziti-doc/issues" target="_blank" rel="noopener noreferrer">issue</a>
if you&#x27;d like to see it updated.</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Sample Output</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Linux/MacOS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Windows</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>The tabs to the right contain example output from running all the commands in sequence. If you want to see what the
output would likely look like click one of the tabs to the right. Reminder - it&#x27;s a lot of commands and a lot of output!
:)</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # the name of the ziti controller you&#x27;re logging into</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: export ZITI_CTRL=local-edge-controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # the location of the certificate(s) to use to validate the controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: export ZITI_CTRL_CERT=/path/to/controller.cert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: export ZITI_USER=myUserName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: export ZITI_PWD=myPassword</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # a name for the configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: export HSM_NAME=yubikey_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # path to the yubikey pkcs11 libraries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: export HSM_ROOT=/path/to/yubico-piv-tool-2.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: export PKCS11_MODULE=${HSM_ROOT}/ykcs11/.libs/libykcs11.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # the id of the key - you probably want to leave these alone unless you know better</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: export HSM_ID1=01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: export HSM_ID2=03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # the pins used when accessing the pkcs11 api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: export HSM_SOPIN=010203040506070801020304050607080102030405060708</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: export HSM_PIN=123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: export RSA_ID=${HSM_NAME}${HSM_ID1}_rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: export EC_ID=${HSM_NAME}${HSM_ID2}_ec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # location for the config files to be placed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: export HSM_DEST=${HSM_ROOT}/${HSM_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: export HSM_LABEL=${HSM_NAME}-label</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # make an alias for ease</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: alias p=&#x27;pkcs11-tool --module $PKCS11_MODULE&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: cd ${HSM_ROOT}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf ${HSM_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: rm -rf ${HSM_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ${HSM_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: mkdir -p ${HSM_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: cd ${HSM_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: ziti edge login $ZITI_CTRL:1280 -u $ZITI_USER -p $ZITI_PWD -c $ZITI_CTRL_CERT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create a new identity and output the jwt to a known location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create identity device &quot;${RSA_ID}&quot; -o &quot;${HSM_DEST}/${RSA_ID}.jwt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create a second new identity and output the jwt to a known location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create identity device &quot;${EC_ID}&quot; -o &quot;${HSM_DEST}/${EC_ID}.jwt&quot;Token: 7083e601-cc2f-4636-94c0-959174e76264</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # create a new identity and output the jwt to a known location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: ziti edge create identity device &quot;${RSA_ID}&quot; -o &quot;${HSM_DEST}/${RSA_ID}.jwt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">76877717-9bce-4f34-ae7a-2ce313b8267a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enrollment expires at 2020-02-24T14:56:19.961322754Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # create a second new identity and output the jwt to a known location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: ziti edge create identity device &quot;${EC_ID}&quot; -o &quot;${HSM_DEST}/${EC_ID}.jwt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bdd18e58-e474-4ed3-98eb-c68ed96377be</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enrollment expires at 2020-02-24T14:56:21.673599433Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: p --init-token --label &quot;ziti-test-token&quot; --so-pin $HSM_SOPIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p -k --key-type rsa:2048 --usage-sign --usage-decrypt --login --id $HSM_ID1 --login-type so --so-pin $HSM_SOPIN --label defaultkey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p -k --key-type EC:prime256v1 --usage-sign --usage-decrypt --login --id $HSM_ID2 --login-type so --so-pin $HSM_SOPIN --label defaultkeyUsing slot 0 with a present token (0x0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Token successfully initialized</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # create a couple of keys - one rsa and one ec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: p -k --key-type rsa:2048 --usage-sign --usage-decrypt --login --id $HSM_ID1 --login-type so --so-pin $HSM_SOPIN --label defaultkey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Using slot 0 with a present token (0x0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Key pair generated:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Private Key Object; RSA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  label:      Private key for PIV Authentication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ID:         01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Usage:      decrypt, sign</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Public Key Object; RSA 2048 bits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  label:      Public key for PIV Authentication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ID:         01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Usage:      encrypt, verify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: p -k --key-type EC:prime256v1 --usage-sign --usage-decrypt --login --id $HSM_ID2 --login-type so --so-pin $HSM_SOPIN --label defaultkey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Using slot 0 with a present token (0x0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Key pair generated:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Private Key Object; EC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  label:      Private key for Key Management</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ID:         03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Usage:      decrypt, sign</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Public Key Object; EC  EC_POINT 256 bits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  EC_POINT:   044104ee01d2c979d4050a2f6e357b2cbe518c3adf816cb08c5b3116318b9cc92328213bb923ea1a3ce9bc46093ffec03912b1e7eda679287fd65419e47d337ca0bb8c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  EC_PARAMS:  06082a8648ce3d030107</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  label:      Public key for Key Management</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ID:         03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Usage:      encrypt, verify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: ziti-tunnel enroll -j &quot;${HSM_DEST}/${RSA_ID}.jwt&quot; -k &quot;pkcs11://${PKCS11_MODULE}?id=${HSM_ID1}&amp;pin=${HSM_PIN}&quot; -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBU[0000] jwt to parse: eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbSI6Im90dCIsImV4cCI6MTU4MjU1NjE3OSwiaXNzIjoiaHR0cHM6Ly9sb2NhbC1lZGdlLWNvbnRyb2xsZXI6MTI4MCIsImp0aSI6Ijk5NjVlZmQzLTliMjItNDk3ZS04NDdiLTM1NWI3MjE1NTZjMyIsInN1YiI6Ijc2ODc3NzE3LTliY2UtNGYzNC1hZTdhLTJjZTMxM2I4MjY3YSJ9.ohrYUZQK5xum-70AYARu8hYYxhvA9Cm2rEln6jVp8VDvMLRuIQi9bXNO1e2NQtkZLGzo3akg4Brx_QxM-9SIRKdBDYzgaN_otpV6y9XAQjVlarVvtA1bBA9OfQU1SyVGNkkaA2l660cY5gfsGb5TqBQt6wQ7KvMfzZvPhXFdQAMoXW-O2OaRh3jJGPne29-Hoz_thObv5PMTVlCGpzO6tKKfPnoV9p8HchjLHMMybEZO_xITyY_6UmkOPpeSJHdjWxJdkXu0xT8wC9PzAXK2xYYwgmW4yA8ygz2RJP6gXYd5maD-f1jgh87ELeN5dG2ksuy5Fh3_kyFAGg1X7dSnfmXSA0fWH-YPK54aSJe2fcCIt41O9pnqwepPT_7nCB4wSxVhuIugUBh_wYeJzXKI8tVnyv8nLyWhYqMwKRqTtiJM7EtxpBUPD6E35x3d4bw_fkVJ5z36NOIaGRmqhltPIsYMaFDwIE-nUU714Ra-cf8xN9lHuNoi_4Ehf8sR2YwLTsk7mJ9TKZkhLIj2KgwjL2KNCoM9n6MQtJJMq3Ae6H_xVxi2-DA_9zkbusdNi2j11OoIAtBGJQ4ONC5ekRsp_bTbb9GAxF-fO8oAQeFUXWyCpywRV8gT3G4huAlcofZTDnMtcyVvTJbvs8zYRtBM9jCKpUOmHuzb4FefgU-6kP0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO[0000] using engine : pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBU[0000] loading key                                   context=pkcs11 url=&quot;pkcs11:///path/to/yubico-piv-tool-2.0.0/ykcs11/.libs/libykcs11.so?id=01&amp;pin=123456&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO[0000] using driver: /path/to/yubico-piv-tool-2.0.0/ykcs11/.libs/libykcs11.so  context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARN[0000] slot not specified, using first slot reported by the driver (0)  context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBU[0001] found signing mechanism                       context=pkcs11 sign mechanism=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBU[0001] no cas provided in caPool. using system provided cas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBU[0001] fetching certificates from server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBU[0001] loading key                                   context=pkcs11 url=&quot;pkcs11:///path/to/yubico-piv-tool-2.0.0/ykcs11/.libs/libykcs11.so?id=01&amp;pin=123456&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO[0001] using driver: /path/to/yubico-piv-tool-2.0.0/ykcs11/.libs/libykcs11.so  context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARN[0002] slot not specified, using first slot reported by the driver (0)  context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBU[0002] found signing mechanism                       context=pkcs11 sign mechanism=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enrolled successfully. identity file written to: /path/to/yubico-piv-tool-2.0.0/yubikey_demo/yubikey_demo01_rsa.jsoncd@cd-ubuntuvm: ziti-tunnel enroll -j &quot;${HSM_DEST}/${EC_ID}.jwt&quot; -k &quot;pkcs11://${PKCS11_MODULE}?id=${HSM_ID2}&amp;pin=${HSM_PIN}&quot; -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBU[0000] jwt to parse: eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbSI6Im90dCIsImV4cCI6MTU4MjU1NjE4MSwiaXNzIjoiaHR0cHM6Ly9sb2NhbC1lZGdlLWNvbnRyb2xsZXI6MTI4MCIsImp0aSI6IjQwYTg1NmMxLWFiZmItNDQ4ZS1hN2E3LWE3YjZkMzVmYWU4OSIsInN1YiI6ImJkZDE4ZTU4LWU0NzQtNGVkMy05OGViLWM2OGVkOTYzNzdiZSJ9.o5hGXqZXWUuj-zkg-Xd335AbZUe9zNtvQmhE4cNFZNw40eRXNTBeFntLWjWv7-41AtsHbPwmQgWQfDdHS8JuLbhLS-8ZNSL3ZThBwnTiKtgYQvg_aArcu1FbPiw3jdiiHqXu0JoIToCEFX4kMjAJIZlzRi05J0d5w6Wvvjy3V7SqT_8viLla6l3PXsa1_xnHCc89HebuKB_qYds-XO2JvXTOFP0A3dSe6UgierjrTPvRxLMbf8TIfSOFtAc6bbSy17H8S0XrNiL-1bA9Ja9KKpB_ynGTygpM3h1vXda0niJN-_TpPdTX9kFEXOn-DpvAGKW8X6ggPlnpF7Rmfx9AEarA9ft-nRjx4Z4vyoAlukSc7LfnjAqTg9CCsN0-hKB1d1PnAOuWfHP5IZ2w1zibcUvdRQMoW2Twk_P75MP8rjr19VtZu5bDweZjP10-eHt3_QYeujaylBfb7VkJuRtSyh6IeWAb-IlIaJx7hzjGqssqNPn0vqVdf43Sc0h-PJcVTOkNPpcBIbxHPL5IVyujCWUSj4NUSgVh72uQIKjxC-WrkT8i-hEnGbJRYUL2NDcS190yt21AJAAkDPBTiFA_LR0aR7lEPzQV-lsjJzjmta7V460OKATsU8oo82_S8dVv8oYndk2kRboVsCWvR7_6H95CEnmRjAfI0Emxwkg1raA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO[0000] using engine : pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBU[0000] loading key                                   context=pkcs11 url=&quot;pkcs11:///path/to/yubico-piv-tool-2.0.0/ykcs11/.libs/libykcs11.so?id=03&amp;pin=123456&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO[0000] using driver: /path/to/yubico-piv-tool-2.0.0/ykcs11/.libs/libykcs11.so  context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARN[0000] slot not specified, using first slot reported by the driver (0)  context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBU[0001] found signing mechanism                       context=pkcs11 sign mechanism=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBU[0001] EC oid[1.2.840.10045.3.1.7], rest: [], err: &lt;nil&gt;  context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBU[0001] no cas provided in caPool. using system provided cas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBU[0001] fetching certificates from server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBU[0001] loading key                                   context=pkcs11 url=&quot;pkcs11:///path/to/yubico-piv-tool-2.0.0/ykcs11/.libs/libykcs11.so?id=03&amp;pin=123456&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO[0001] using driver: /path/to/yubico-piv-tool-2.0.0/ykcs11/.libs/libykcs11.so  context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARN[0001] slot not specified, using first slot reported by the driver (0)  context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBU[0001] found signing mechanism                       context=pkcs11 sign mechanism=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBU[0001] EC oid[1.2.840.10045.3.1.7], rest: [], err: &lt;nil&gt;  context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enrolled successfully. identity file written to: /path/to/yubico-piv-tool-2.0.0/yubikey_demo/yubikey_demo03_ec.jsoncd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # if you only have a single edge router this command will work without the need for copy/paste</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: EDGE_ROUTER_ID=$(ziti edge list edge-routers | cut -d &quot; &quot; -f2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># IF the above command doesn&#x27;t work - run this command and get the id from the first edge-router.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list edge-routers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># then use the id returned from the above command and put it into a variable for use in a momment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># EDGE_ROUTER_ID={insert the &#x27;id&#x27; from above - example: 64d4967b-5474-4f06-8548-5700ed7bfa80}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># remove/recreate the config - here we&#x27;ll be instructing the tunneler to listen on localhost and port 9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete config wttrconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config wttrconfig ziti-tunneler-client.v1 &quot;{ \&quot;hostname\&quot; : \&quot;localhost\&quot;, \&quot;port\&quot; : 9000 }&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># recreate the service with the EDGE_ROUTER_ID from above. Here we are adding a ziti service that will</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # IF the above command doesn&#x27;t work - run this command and get the id from the first edge-router.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # ziti edge list edge-routers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # then use the id returned from the above command and put it into a variable for use in a momment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # EDGE_ROUTER_ID={insert the &#x27;id&#x27; from above - example: 64d4967b-5474-4f06-8548-5700ed7bfa80}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # remove/recreate the config - here we&#x27;ll be instructing the tunneler to listen on localhost and port 9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: ziti edge delete config wttrconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge delete service wttr.ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service wttr.ziti &quot;${EDGE_ROUTER_ID}&quot; tcp://wttr.in:80 --configs wttrconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># start one or both proxies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti-tunnel proxy -i &quot;${HSM_DEST}/${RSA_ID}.json&quot; wttr.ziti:8000 -v &amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti-tunnel proxy -i &quot;${HSM_DEST}/${EC_ID}.json&quot; wttr.ziti:9000 -v &amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: ziti edge create config wttrconfig ziti-tunneler-client.v1 &quot;{ \&quot;hostname\&quot; : \&quot;localhost\&quot;, \&quot;port\&quot; : 9000 }&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4ff768fa-0e7e-4b4d-ab4e-5c5aec5bd28d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # recreate the service with the EDGE_ROUTER_ID from above. Here we are adding a ziti service that will</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # send a request to wttr.in to retreive a weather forecast</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: ziti edge delete service wttr.ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: ziti edge create service wttr.ziti &quot;${EDGE_ROUTER_ID}&quot; tcp://wttr.in:80 --configs wttrconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1827c649-9ba6-4f5a-b122-a8cb9d4e4893</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # start one or both proxies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: ziti-tunnel proxy -i &quot;${HSM_DEST}/${RSA_ID}.json&quot; wttr.ziti:8000 -v &amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1] 5969</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: ziti-tunnel proxy -i &quot;${HSM_DEST}/${EC_ID}.json&quot; wttr.ziti:9000 -v &amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2] 5970</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: [   0.001]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.(*interceptor).Start: starting proxy interceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.001]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.(*interceptor).Start: starting proxy interceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.002]   DEBUG github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.(*engine).LoadKey [pkcs11]: {url=[pkcs11:///path/to/yubico-piv-tool-2.0.0/ykcs11/.libs/libykcs11.so?id=03&amp;pin=123456]} loading key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.002]    INFO github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.(*engine).LoadKey [pkcs11]: using driver: /path/to/yubico-piv-tool-2.0.0/ykcs11/.libs/libykcs11.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.004]   DEBUG github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.(*engine).LoadKey [pkcs11]: {url=[pkcs11:///path/to/yubico-piv-tool-2.0.0/ykcs11/.libs/libykcs11.so?id=01&amp;pin=123456]} loading key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.004]    INFO github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.(*engine).LoadKey [pkcs11]: using driver: /path/to/yubico-piv-tool-2.0.0/ykcs11/.libs/libykcs11.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.085] WARNING github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.(*engine).LoadKey [pkcs11]: slot not specified, using first slot reported by the driver (0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   1.793]   DEBUG github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.(*engine).LoadKey [pkcs11]: {sign mechanism=[0]} found signing mechanism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   1.793]   DEBUG github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.loadECDSApub [pkcs11]: EC oid[1.2.840.10045.3.1.7], rest: [], err: &lt;nil&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   1.793]    INFO github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).Authenticate: attempting to authenticate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   1.912]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).Authenticate: {token=[426a9b25-5f9c-4d3d-9319-30096cb584fc] id=[30b4cc4a-1e71-4e34-971c-bd5bead0477b]} Got api session: {30b4cc4a-1e71-4e34-971c-bd5bead0477b 426a9b25-5f9c-4d3d-9319-30096cb584fc}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   1.912]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).getServices: using api session token 426a9b25-5f9c-4d3d-9319-30096cb584fc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   1.956]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).getServices: using api session token 426a9b25-5f9c-4d3d-9319-30096cb584fc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   2.000]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: starting tunnel for newly available service wttr.ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   2.000]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).getSession: requesting session from https://local-edge-controller:1280/sessions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   2.000]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).getSession: {service_id=[1827c649-9ba6-4f5a-b122-a8cb9d4e4893]} requesting session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   2.033]   DEBUG github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.interceptor.Intercept: {id=[ee783e84-c888-4912-ba1b-b79334590d3e] service=[wttr.ziti]} acquired network session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   2.034]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: starting tunnel for newly available service netcat7256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   2.034]   DEBUG github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.interceptor.Intercept: {service=[netcat7256]} service netcat7256 was not specified at initialization. not intercepting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   2.034]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.(*interceptor).handleTCP: {service=[wttr.ziti] addr=[0.0.0.0:9000]} service is listening</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   2.038] WARNING github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.(*engine).LoadKey [pkcs11]: slot not specified, using first slot reported by the driver (0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   3.863]   DEBUG github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.(*engine).LoadKey [pkcs11]: {sign mechanism=[0]} found signing mechanism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   3.864]    INFO github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).Authenticate: attempting to authenticate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   4.099]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).Authenticate: {token=[a2d721d4-4b4a-466f-b310-b7eabd539e75] id=[deaf5b97-e467-431a-9f16-4546e4ef42fc]} Got api session: {deaf5b97-e467-431a-9f16-4546e4ef42fc a2d721d4-4b4a-466f-b310-b7eabd539e75}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   4.099]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).getServices: using api session token a2d721d4-4b4a-466f-b310-b7eabd539e75</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   4.146]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).getServices: using api session token a2d721d4-4b4a-466f-b310-b7eabd539e75</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   4.189]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: starting tunnel for newly available service netcat7256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   4.189]   DEBUG github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.interceptor.Intercept: {service=[netcat7256]} service netcat7256 was not specified at initialization. not intercepting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   4.189]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: starting tunnel for newly available service wttr.ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   4.189]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).getSession: requesting session from https://local-edge-controller:1280/sessions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   4.189]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).getSession: {service_id=[1827c649-9ba6-4f5a-b122-a8cb9d4e4893]} requesting session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   4.222]   DEBUG github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.interceptor.Intercept: {service=[wttr.ziti] id=[a53212ef-404e-4528-9d36-02852db9c595]} acquired network session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   4.222]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.(*interceptor).handleTCP: {service=[wttr.ziti] addr=[0.0.0.0:8000]} service is listening</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: # use a browser - or curl to verify the ziti tunneler is listening locally and the traffic has flowed over the ziti network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: curl -H &quot;Host: wttr.in&quot; http://localhost:8000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.111]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*classicDialer).Create [tls:local-edge-router:3022]: started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.315]   DEBUG github.com/netfoundry/ziti-foundation/transport/tls.Dial: server provided [2] certificates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.315]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*classicDialer).sendHello [u{classic}-&gt;i{}]: started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.316]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*classicDialer).sendHello [u{classic}-&gt;i{}]: exited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.316]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*classicDialer).Create [tls:local-edge-router:3022]: exited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.316]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*muxAddSinkEvent).Handle: {connId=[1]} Added sink to mux. Current sink count: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.316]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*MsgMux).AddMsgSink: {connId=[1]} added to msg mux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.316]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*channelImpl).txer [ch{ziti-sdk}-&gt;u{classic}-&gt;i{oEzq}]: started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.316]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*channelImpl).rxer [ch{ziti-sdk}-&gt;u{classic}-&gt;i{oEzq}]: started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.557]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*channelImpl).rxer [ch{ziti-sdk}-&gt;u{classic}-&gt;i{oEzq}]: waiter found for message. type [60784], sequence [1], replyFor [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.557]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Connect: {connId=[1]} connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.557]    INFO github.com/netfoundry/ziti-edge/tunnel.Run: {src-remote=[127.0.0.1:41838] src-local=[127.0.0.1:8000] dst-local=[:1] dst-remote=[wttr.ziti]} tunnel started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.558]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*MsgChannel).WriteTraced: {connId=[1] type=[EdgeDataType] chSeq=[-1] edgeSeq=[1]} writing 71 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.558]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} read buffer = 32768 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.735]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*MsgEvent).Handle: {seq=[1] connId=[1]} handling received EdgeDataType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.735]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} got buffer from queue 8852 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.735]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} read buffer = 32768 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Weather report: Laurelton, United States</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              Overcast</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .--.     14..24 °F</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .-(    ).   ↘ 13 mph</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (___.__)__)  9 mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              0.0 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                      ┌─────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────┬───────────────────────┤  Fri 14 Feb ├───────────────────────┬──────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            Morning           │             Noon      └──────┬──────┘     Evening           │             Night            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────┼──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    \  /       Partly cloudy  │     \   /     Sunny          │     \   /     Clear          │     \   /     Clear          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  _ /&quot;&quot;.-.     6..19 °F       │      .-.      8..21 °F       │      .-.      8..19 °F       │      .-.      3..14 °F       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    \_(   ).   ↘ 11-13 mph    │   ― (   ) ―   ↘ 11-13 mph    │   ― (   ) ―   ↗ 11-13 mph    │   ― (   ) ―   ↓ 8-13 mph     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    /(___(__)  5 mi           │      `-’      6 mi           │      `-’      6 mi           │      `-’      6 mi           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│               0.0 in | 0%    │     /   \     0.0 in | 0%    │     /   \     0.0 in | 0%    │     /   \     0.0 in | 0%    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                      ┌─────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────┬───────────────────────┤  Sat 15 Feb ├───────────────────────┬──────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            Morning           │             Noon      └──────┬──────┘     Evening           │             Night            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────┼──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     \   /     Sunny          │    \  /       Partly cloudy  │    \  /       Partly cloudy  │    \  /       Partly cloudy  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      .-.      14..17 °F      │  _ /&quot;&quot;.-.     17..24 °F      │  _ /&quot;&quot;.-.     21..30 °F      │  _ /&quot;&quot;.-.     17..24 °F      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ― (   ) ―   ↖ 3 mph        │    \_(   ).   ↑ 6-8 mph      │    \_(   ).   ↑ 9-14 mph     │    \_(   ).   ↑ 8-14 mph     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      `-’      6 mi           │    /(___(__)  6 mi           │    /(___(__)  6 mi           │    /(___(__)  6 mi           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     /   \     0.0 in | 0%    │               0.0 in | 0%    │               0.0 in | 0%    │               0.0 in | 0%    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                      ┌─────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────┬───────────────────────┤  Sun 16 Feb ├───────────────────────┬──────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            Morning           │             Noon      └──────┬──────┘     Evening           │             Night            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────┼──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    \  /       Partly cloudy  │    \  /       Partly cloudy  │               Overcast       │               Overcast       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  _ /&quot;&quot;.-.     24..30 °F      │  _ /&quot;&quot;.-.     35..39 °F      │      .--.     37..39 °F      │      .--.     32..33 °F      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    \_(   ).   ↗ 4-7 mph      │    \_(   ).   ↗ 7-8 mph      │   .-(    ).   → 6-9 mph      │   .-(    ).   ↗ 3-8 mph      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    /(___(__)  6 mi           │    /(___(__)  6 mi           │  (___.__)__)  6 mi           │  (___.__)__)  6 mi           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│               0.0 in | 0%    │               0.0 in | 0%    │               0.0 in | 0%    │               0.0 in | 0%    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Follow @igor_chubin for wttr.in updates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.735]    INFO github.com/netfoundry/ziti-edge/tunnel.myCopy: {dst-remote=[wttr.ziti] src-remote=[127.0.0.1:41838] src-local=[127.0.0.1:8000] dst-local=[:1]} stopping pipe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.735]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Close: {connId=[1]} close: begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.735]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*muxRemoveSinkEvent).Handle: {connId=[1]} Removed sink from mux. Current sink count: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.736]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*MsgMux).RemoveMsgSinkById: {connId=[1]} removed from msg mux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  12.736]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Close: {connId=[1]} close: end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: [  13.736]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} sequencer closed, closing connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  13.736]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} return EOF from closing/closed connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  13.736]    INFO github.com/netfoundry/ziti-edge/tunnel.myCopy: {dst-remote=[127.0.0.1:41838] src-remote=[wttr.ziti] src-local=[:1] dst-local=[127.0.0.1:8000]} stopping pipe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  13.736]    INFO github.com/netfoundry/ziti-edge/tunnel.Run: {src-remote=[127.0.0.1:41838] src-local=[127.0.0.1:8000] dst-local=[:1] dst-remote=[wttr.ziti]} tunnel closed: 71 bytes sent; 8852 bytes received</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: curl -H &quot;Host: wttr.in&quot; http://localhost:9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  17.991]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*classicDialer).Create [tls:local-edge-router:3022]: started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.099]   DEBUG github.com/netfoundry/ziti-foundation/transport/tls.Dial: server provided [2] certificates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.099]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*classicDialer).sendHello [u{classic}-&gt;i{}]: started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.100]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*classicDialer).sendHello [u{classic}-&gt;i{}]: exited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.100]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*classicDialer).Create [tls:local-edge-router:3022]: exited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.100]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*muxAddSinkEvent).Handle: {connId=[1]} Added sink to mux. Current sink count: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.100]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*MsgMux).AddMsgSink: {connId=[1]} added to msg mux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.100]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*channelImpl).rxer [ch{ziti-sdk}-&gt;u{classic}-&gt;i{Jn2J}]: started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.100]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*channelImpl).txer [ch{ziti-sdk}-&gt;u{classic}-&gt;i{Jn2J}]: started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.211]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*channelImpl).rxer [ch{ziti-sdk}-&gt;u{classic}-&gt;i{Jn2J}]: waiter found for message. type [60784], sequence [1], replyFor [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.211]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Connect: {connId=[1]} connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.211]    INFO github.com/netfoundry/ziti-edge/tunnel.Run: {dst-remote=[wttr.ziti] src-remote=[127.0.0.1:57980] src-local=[127.0.0.1:9000] dst-local=[:1]} tunnel started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.211]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*MsgChannel).WriteTraced: {connId=[1] type=[EdgeDataType] chSeq=[-1] edgeSeq=[1]} writing 71 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.211]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} read buffer = 32768 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.379]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*MsgEvent).Handle: {seq=[1] connId=[1]} handling received EdgeDataType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.379]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} got buffer from queue 8852 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.379]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} read buffer = 32768 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Weather report: Laurelton, United States</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              Overcast</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .--.     14..24 °F</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .-(    ).   ↘ 13 mph</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (___.__)__)  9 mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              0.0 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                      ┌─────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────┬───────────────────────┤  Fri 14 Feb ├───────────────────────┬──────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            Morning           │             Noon      └──────┬──────┘     Evening           │             Night            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────┼──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    \  /       Partly cloudy  │     \   /     Sunny          │     \   /     Clear          │     \   /     Clear          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  _ /&quot;&quot;.-.     6..19 °F       │      .-.      8..21 °F       │      .-.      8..19 °F       │      .-.      3..14 °F       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    \_(   ).   ↘ 11-13 mph    │   ― (   ) ―   ↘ 11-13 mph    │   ― (   ) ―   ↗ 11-13 mph    │   ― (   ) ―   ↓ 8-13 mph     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    /(___(__)  5 mi           │      `-’      6 mi           │      `-’      6 mi           │      `-’      6 mi           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│               0.0 in | 0%    │     /   \     0.0 in | 0%    │     /   \     0.0 in | 0%    │     /   \     0.0 in | 0%    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                      ┌─────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────┬───────────────────────┤  Sat 15 Feb ├───────────────────────┬──────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            Morning           │             Noon      └──────┬──────┘     Evening           │             Night            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────┼──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     \   /     Sunny          │    \  /       Partly cloudy  │    \  /       Partly cloudy  │    \  /       Partly cloudy  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      .-.      14..17 °F      │  _ /&quot;&quot;.-.     17..24 °F      │  _ /&quot;&quot;.-.     21..30 °F      │  _ /&quot;&quot;.-.     17..24 °F      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ― (   ) ―   ↖ 3 mph        │    \_(   ).   ↑ 6-8 mph      │    \_(   ).   ↑ 9-14 mph     │    \_(   ).   ↑ 8-14 mph     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      `-’      6 mi           │    /(___(__)  6 mi           │    /(___(__)  6 mi           │    /(___(__)  6 mi           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     /   \     0.0 in | 0%    │               0.0 in | 0%    │               0.0 in | 0%    │               0.0 in | 0%    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                      ┌─────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────┬───────────────────────┤  Sun 16 Feb ├───────────────────────┬──────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            Morning           │             Noon      └──────┬──────┘     Evening           │             Night            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────┼──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    \  /       Partly cloudy  │    \  /       Partly cloudy  │               Overcast       │               Overcast       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  _ /&quot;&quot;.-.     24..30 °F      │  _ /&quot;&quot;.-.     35..39 °F      │      .--.     37..39 °F      │      .--.     32..33 °F      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    \_(   ).   ↗ 4-7 mph      │    \_(   ).   ↗ 7-8 mph      │   .-(    ).   → 6-9 mph      │   .-(    ).   ↗ 3-8 mph      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    /(___(__)  6 mi           │    /(___(__)  6 mi           │  (___.__)__)  6 mi           │  (___.__)__)  6 mi           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│               0.0 in | 0%    │               0.0 in | 0%    │               0.0 in | 0%    │               0.0 in | 0%    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Follow @igor_chubin for wttr.in updates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.379]    INFO github.com/netfoundry/ziti-edge/tunnel.myCopy: {dst-local=[:1] dst-remote=[wttr.ziti] src-remote=[127.0.0.1:57980] src-local=[127.0.0.1:9000]} stopping pipe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.379]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Close: {connId=[1]} close: begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.379]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*muxRemoveSinkEvent).Handle: {connId=[1]} Removed sink from mux. Current sink count: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.379]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*MsgMux).RemoveMsgSinkById: {connId=[1]} removed from msg mux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  18.379]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Close: {connId=[1]} close: end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: [  19.382]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} sequencer closed, closing connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  19.382]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} return EOF from closing/closed connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  19.382]    INFO github.com/netfoundry/ziti-edge/tunnel.myCopy: {dst-remote=[127.0.0.1:57980] src-remote=[wttr.ziti] src-local=[:1] dst-local=[127.0.0.1:9000]} stopping pipe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  19.383]    INFO github.com/netfoundry/ziti-edge/tunnel.Run: {src-remote=[127.0.0.1:57980] src-local=[127.0.0.1:9000] dst-local=[:1] dst-remote=[wttr.ziti]} tunnel closed: 71 bytes sent; 8852 bytes received</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: killall ziti-tunnel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  25.856]   DEBUG github.com/netfoundry/ziti-edge/tunnel/intercept.ServicePoller: caught signal terminated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  25.856]   DEBUG github.com/netfoundry/ziti-edge/tunnel/intercept.ServicePoller: caught signal terminated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  25.856]   DEBUG github.com/netfoundry/ziti-edge/tunnel/intercept.ServicePoller: caught signal terminated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  25.856]   DEBUG github.com/netfoundry/ziti-edge/tunnel/intercept.ServicePoller: caught signal terminated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  25.856]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: stopping tunnel for unavailable service: wttr.ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  25.856]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: stopping tunnel for unavailable service: netcat7256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd@cd-ubuntuvm: [  25.856]   ERROR github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: failed to stop intercepting: StopIntercepting not implemented by proxy interceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  25.856]   ERROR github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: failed to stop intercepting: StopIntercepting not implemented by proxy interceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  25.856]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: stopping tunnel for unavailable service: netcat7256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  25.856]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: stopping tunnel for unavailable service: wttr.ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  25.856]   ERROR github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: failed to stop intercepting: StopIntercepting not implemented by proxy interceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  25.856]   ERROR github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: failed to stop intercepting: StopIntercepting not implemented by proxy interceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  25.856]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.(*interceptor).Stop: stopping proxy interceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  25.856]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.(*interceptor).Stop: stopping proxy interceptor</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM the name of the ziti controller you&#x27;re logging into</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET ZITI_CTRL=local-edge-controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM the location of the certificate(s) to use to validate the controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET ZITI_CTRL_CERT=c:\path\to\controller.cert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET ZITI_USER=myUserName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET ZITI_PWD=myPassword</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM a name for the configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET HSM_NAME=yubikey_windemo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET HSM_ROOT=c:\path\to\yubico-piv-tool-2.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM path to the pkcs11 library</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET PATH=%PATH%;%HSM_ROOT%\bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET PKCS11_MODULE=%HSM_ROOT%\bin\libykcs11-1.dll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM the id of the key - you probably want to leave these alone unless you know better</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET HSM_ID1=01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET HSM_ID2=03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET RSA_ID=%HSM_NAME%%HSM_ID1%_rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET EC_ID=%HSM_NAME%%HSM_ID2%_ec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM the pins used when accessing the pkcs11 api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET HSM_SOPIN=010203040506070801020304050607080102030405060708</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET HSM_PIN=123456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET HSM_DEST=%HSM_ROOT%\%HSM_NAME%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET HSM_LABEL=%HSM_NAME%-label</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET HSM_TOKENS_DIR=%HSM_DEST%\tokens\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM make an alias for ease</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;doskey p=&quot;c:\Program Files\OpenSC Project\OpenSC\tools\pkcs11-tool.exe&quot; --module %PKCS11_MODULE% $*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;cd /d %HSM_ROOT%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0&gt;rmdir /s /q %HSM_NAME%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0&gt;mkdir %HSM_NAME%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0&gt;cd /d %HSM_NAME%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;ziti edge login %ZITI_CTRL%:1280 -u %ZITI_USER% -p %ZITI_PWD% -c %ZITI_CTRL_CERT%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Token: 2e4b9d55-fe89-4e35-8101-7d8a5f492b8b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM create a new identity and output the jwt to a known location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;ziti edge create identity device &quot;%RSA_ID%&quot; -o &quot;%HSM_DEST%\%RSA_ID%.jwt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">43b76397-c65e-43a9-a326-b58f83cacfea</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enrollment expires at 2020-02-24T14:47:02.783676578Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM create a second new identity and output the jwt to a known location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;ziti edge create identity device &quot;%EC_ID%&quot; -o &quot;%HSM_DEST%\%EC_ID%.jwt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fa116b87-d322-4058-a8c1-d41f21a9e051</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enrollment expires at 2020-02-24T14:47:03.521726623Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;p --init-token --label &quot;ziti-test-token&quot; --so-pin %HSM_SOPIN%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Using slot 0 with a present token (0x0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Token successfully initialized</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM create a couple of keys - one rsa and one ec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;p -k --key-type rsa:2048 --usage-sign --usage-decrypt --login --id %HSM_ID1% --login-type so --so-pin %HSM_SOPIN% --label defaultkey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Using slot 0 with a present token (0x0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Key pair generated:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Private Key Object; RSA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  label:      Private key for PIV Authentication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ID:         01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Usage:      decrypt, sign</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Access:     sensitive, always sensitive, never extractable, local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Public Key Object; RSA 2048 bits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  label:      Public key for PIV Authentication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ID:         01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Usage:      encrypt, verify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Access:     local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;p -k --key-type EC:prime256v1 --usage-sign --usage-decrypt --login --id %HSM_ID2% --login-type so --so-pin %HSM_SOPIN% --label defaultkey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Using slot 0 with a present token (0x0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Key pair generated:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Private Key Object; EC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  label:      Private key for Key Management</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ID:         03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Usage:      decrypt, sign</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Access:     sensitive, always sensitive, never extractable, local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Public Key Object; EC  EC_POINT 256 bits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  EC_POINT:   044104c5f6b528121fbe67e44dc2f966a2df9df97d5e712e40fdf6df74ba8c166d069d0eee65886c115034821b3e3c3c890e910ffe05efc70d281e531ae8073915f579</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  EC_PARAMS:  06082a8648ce3d030107</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  label:      Public key for Key Management</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ID:         03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Usage:      encrypt, verify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Access:     local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;ziti-tunnel enroll -j &quot;%HSM_DEST%\%RSA_ID%.jwt&quot; -k &quot;pkcs11://%PKCS11_MODULE%?id=%HSM_ID1%&amp;pin=%HSM_PIN%&quot; -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:46-05:00&quot; level=debug msg=&quot;jwt to parse: eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbSI6Im90dCIsImV4cCI6MTU4MjU1NTYyMiwiaXNzIjoiaHR0cHM6Ly9sb2NhbC1lZGdlLWNvbnRyb2xsZXI6MTI4MCIsImp0aSI6ImYwYjIxZjQ4LTk3N2QtNDVlZi04ZDZlLWY5YzllMzlkYTg1YSIsInN1YiI6IjQzYjc2Mzk3LWM2NWUtNDNhOS1hMzI2LWI1OGY4M2NhY2ZlYSJ9.lAfmkZb_3-qPtW4hWaaHsL_7rZiHlN3LKGIrudX4K91idw5C-AdcjT-smbfSlDBqmZElU0iomrmT4TJ3SbGM9yRhrnRZBgsbC76dKO6sbNuCEGLeMJ_pJFGo7ZZC32wLm2HsvCXszwjMXOrr1ndvWUKs3KkUhvmbBEIA4x566McsngeZ5B4ILso4BmL4KJcef-n-PuI14V42n7uzOu_KZomEGSNZ34LCg0cbWcsUmoeV8d3Vgb3xSR16wyyl7tC_pGvH1qPvaWmNUQ9BWk1j730C6RXLHZ3zECOUXqIjYTOaXkoDEpuXceNF5gNm9Cx76UwpKJlSEyD_LFbkULJL4_zmKy9w9JreSUh6cnkPW7ltXluEt-Wy1VckkwOPUCRXCQ_AuxvClhOPUW_Y-PW8Qbooou7eo8v-ZPAuFqx04_DkPdhMPn2h6CyZiqEM5ZqN_ln-Q6BAUgpBHmAFUuPDnCXk0R1l74Yc23z55hrfFreR9-t4BGl6ZBiV9oAa6kz4-8MTkg_osGJOAn3S0T_mFORCES68dppVAF9Lv8kaFkZsJE3pyQeApyYqtIZWZUUiQH4S3ssFfwuoy9KmP9lvSo4Ampl7whygx6B6nf5EiSvkQyvNPSW1L5VQeI3eShQbrUHVnrBMY2BQHa86Wqz6ICdSLQHW1P_Z6yX71HKa06A&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:46-05:00&quot; level=info msg=&quot;using engine : pkcs11\n&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:46-05:00&quot; level=debug msg=&quot;loading key&quot; context=pkcs11 url=&quot;pkcs11://c:%5Cpath%5Cto%5Cyubico-piv-tool-2.0.0%5Cbin%5Clibykcs11-1.dll?id=01&amp;pin=123456&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:46-05:00&quot; level=info msg=&quot;using driver: c:\\path\\to\\yubico-piv-tool-2.0.0\\bin\\libykcs11-1.dll&quot; context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:46-05:00&quot; level=warning msg=&quot;slot not specified, using first slot reported by the driver (0)&quot; context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:46-05:00&quot; level=debug msg=&quot;found signing mechanism&quot; context=pkcs11 sign mechanism=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:46-05:00&quot; level=debug msg=&quot;no cas provided in caPool. using system provided cas&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:46-05:00&quot; level=debug msg=&quot;fetching certificates from server&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:46-05:00&quot; level=debug msg=&quot;loading key&quot; context=pkcs11 url=&quot;pkcs11://c:%5Cpath%5Cto%5Cyubico-piv-tool-2.0.0%5Cbin%5Clibykcs11-1.dll?id=01&amp;pin=123456&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:46-05:00&quot; level=info msg=&quot;using driver: c:\\path\\to\\yubico-piv-tool-2.0.0\\bin\\libykcs11-1.dll&quot; context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:46-05:00&quot; level=warning msg=&quot;slot not specified, using first slot reported by the driver (0)&quot; context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:46-05:00&quot; level=debug msg=&quot;found signing mechanism&quot; context=pkcs11 sign mechanism=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enrolled successfully. identity file written to: c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo\yubikey_windemo01_rsa.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;ziti-tunnel enroll -j &quot;%HSM_DEST%\%EC_ID%.jwt&quot; -k &quot;pkcs11://%PKCS11_MODULE%?id=%HSM_ID2%&amp;pin=%HSM_PIN%&quot; -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:47-05:00&quot; level=debug msg=&quot;jwt to parse: eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbSI6Im90dCIsImV4cCI6MTU4MjU1NTYyMywiaXNzIjoiaHR0cHM6Ly9sb2NhbC1lZGdlLWNvbnRyb2xsZXI6MTI4MCIsImp0aSI6ImY1NzVkZTI0LTcyYzctNDcxZS1hMzI0LTUyMjE3ZWFlYmExNCIsInN1YiI6ImZhMTE2Yjg3LWQzMjItNDA1OC1hOGMxLWQ0MWYyMWE5ZTA1MSJ9.cMyzS7o4ou2XUN6d3C-fx6i7sleIZO5b_LeqOxBNkAZO6l7JFIAp54ak8TUYD-chsVnSZ-bYPiuO-lbPIR2UrZvN6SshOowiQpAKQPggL2y0UZJAqzRoxfzlkjBZXi5BjRSTGTW3nRd9y40AwR_aAkOr4IztYbREGBYvfTK4QX-NSVvSoGVCiBeKFC6PO_8nuAUxMgL_ODVpPVA1ThO5l6Jzut_N5LgysaxTjp8WWsAIvUIbnIxJ7y_hTvmKFQ9hbLuTLaWZ091AA-469dxzbMzQVe_xDSwpQDGfYgRm02_uRlKUlm_w_sPdytaNb54u0I0-la83r31S8ugyGz3xMD-xLDHVKwxZ7dUArQf3oKzGZNhCc6MMJQBI81jbHaeSCNlpDJugYDDG0bx1E87cU7Nt88h-jaLOwEOqozsG_4myhoFaMRGx-unNP8Lr-zlPtU3AGMTu21AvCq4CCg0HYLdKVjCkQ3m6N29wOrMgF_3G_hdvTLDTeHY2wKnJIBHg3lg106a7J6WtiM9CyS_N_01kCtwFWK49662GQPv6_IVb6eKokhtcA4-2E1F6H8v5BCUljzfjpfQ4EQds7uDtQSL3i3muBLuXkLUW86H98q8XVnQZms_41T2n6MWmo5smOYrs4--rM1R-in3lmKymd8nmmN-L2GuJF5zsRaiq0r4&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:47-05:00&quot; level=info msg=&quot;using engine : pkcs11\n&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:47-05:00&quot; level=debug msg=&quot;loading key&quot; context=pkcs11 url=&quot;pkcs11://c:%5Cpath%5Cto%5Cyubico-piv-tool-2.0.0%5Cbin%5Clibykcs11-1.dll?id=03&amp;pin=123456&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:47-05:00&quot; level=info msg=&quot;using driver: c:\\path\\to\\yubico-piv-tool-2.0.0\\bin\\libykcs11-1.dll&quot; context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:47-05:00&quot; level=warning msg=&quot;slot not specified, using first slot reported by the driver (0)&quot; context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:48-05:00&quot; level=debug msg=&quot;found signing mechanism&quot; context=pkcs11 sign mechanism=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:48-05:00&quot; level=debug msg=&quot;EC oid[1.2.840.10045.3.1.7], rest: [], err: &lt;nil&gt;&quot; context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:48-05:00&quot; level=debug msg=&quot;no cas provided in caPool. using system provided cas&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:48-05:00&quot; level=debug msg=&quot;fetching certificates from server&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:48-05:00&quot; level=debug msg=&quot;loading key&quot; context=pkcs11 url=&quot;pkcs11://c:%5Cpath%5Cto%5Cyubico-piv-tool-2.0.0%5Cbin%5Clibykcs11-1.dll?id=03&amp;pin=123456&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:48-05:00&quot; level=info msg=&quot;using driver: c:\\path\\to\\yubico-piv-tool-2.0.0\\bin\\libykcs11-1.dll&quot; context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:48-05:00&quot; level=warning msg=&quot;slot not specified, using first slot reported by the driver (0)&quot; context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:48-05:00&quot; level=debug msg=&quot;found signing mechanism&quot; context=pkcs11 sign mechanism=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time=&quot;2020-02-14T09:47:48-05:00&quot; level=debug msg=&quot;EC oid[1.2.840.10045.3.1.7], rest: [], err: &lt;nil&gt;&quot; context=pkcs11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enrolled successfully. identity file written to: c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo\yubikey_windemo03_ec.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM these two commands can&#x27;t be copied and pasted - you need to get the result of the first command and use it in the next</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM run this command and get the id from the first edge-router.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;ziti edge list edge-routers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id: 0c2c2049-3577-479c-aa09-625fa0e15d31    name: local-edge-router    role attributes: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM use the id returned from the above command and put it into a variable for use in a momment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;SET EDGE_ROUTER_ID=0c2c2049-3577-479c-aa09-625fa0e15d31</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM remove/recreate the config - here we&#x27;ll be instructing the tunneler to listen on localhost and port 9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;ziti edge delete config wttrconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;ziti edge create config wttrconfig ziti-tunneler-client.v1 &quot;{ \&quot;hostname\&quot; : \&quot;localhost\&quot;, \&quot;port\&quot; : 9000 }&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b2c7af06-072d-4ff2-9f73-8d1456a16d5a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM recreate the service with the EDGE_ROUTER_ID from above. Here we are adding a ziti service that will</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM send a request to wttr.in to retreive a weather forecast</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;ziti edge delete service wttr.ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;ziti edge create service wttr.ziti &quot;%EDGE_ROUTER_ID%&quot; tcp://wttr.in:80 --configs wttrconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5a11bfce-b716-4d7a-944b-ea72e6225549</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM start one or both proxies - use ctrl-break or ctrl-pause to terminate these processes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;start /b ziti-tunnel proxy -i &quot;%HSM_DEST%/%RSA_ID%.json&quot; wttr.ziti:8000 -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;start /b ziti-tunnel proxy -i &quot;%HSM_DEST%/%EC_ID%.json&quot; wttr.ziti:9000 -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM[   0.013]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.(*interceptor).Start: starting proxy interceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.013]   DEBUG github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.(*engine).LoadKey [pkcs11]: {url=[pkcs11://c:%5Cpath%5Cto%5Cyubico-piv-tool-2.0.0%5Cbin%5Clibykcs11-1.dll?id=01&amp;pin=123456]} loading key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.014]    INFO github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.(*engine).LoadKey [pkcs11]: using driver: c:\path\to\yubico-piv-tool-2.0.0\bin\libykcs11-1.dll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.012]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.(*interceptor).Start: starting proxy interceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.012]   DEBUG github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.(*engine).LoadKey [pkcs11]: {url=[pkcs11://c:%5Cpath%5Cto%5Cyubico-piv-tool-2.0.0%5Cbin%5Clibykcs11-1.dll?id=03&amp;pin=123456]} loading key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.013]    INFO github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.(*engine).LoadKey [pkcs11]: using driver: c:\path\to\yubico-piv-tool-2.0.0\bin\libykcs11-1.dll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.025] WARNING github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.(*engine).LoadKey [pkcs11]: slot not specified, using first slot reported by the driver (0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.195] WARNING github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.(*engine).LoadKey [pkcs11]: slot not specified, using first slot reported by the driver (0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.688]   DEBUG github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.(*engine).LoadKey [pkcs11]: {sign mechanism=[0]} found signing mechanism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.689]    INFO github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).Authenticate: attempting to authenticate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.699]   DEBUG github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.(*engine).LoadKey [pkcs11]: {sign mechanism=[0]} found signing mechanism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.699]   DEBUG github.com/netfoundry/ziti-foundation/identity/engines/pkcs11.loadECDSApub [pkcs11]: EC oid[1.2.840.10045.3.1.7], rest: [], err: &lt;nil&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.700]    INFO github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).Authenticate: attempting to authenticate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.812]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).Authenticate: {token=[3b8bbb76-5984-495e-94cd-9752fe6a4d61] id=[55a4e9aa-eb78-4a19-a685-92aa19fd7177]} Got api session: {55a4e9aa-eb78-4a19-a685-92aa19fd7177 3b8bbb76-5984-495e-94cd-9752fe6a4d61}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.813]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).getServices: using api session token 3b8bbb76-5984-495e-94cd-9752fe6a4d61</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.866]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).getServices: using api session token 3b8bbb76-5984-495e-94cd-9752fe6a4d61</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.920]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: starting tunnel for newly available service wttr.ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.936]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).getSession: requesting session from https://local-edge-controller:1280/sessions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.939]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).getSession: {service_id=[5a11bfce-b716-4d7a-944b-ea72e6225549]} requesting session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.960]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).Authenticate: {token=[79e3ef58-d712-4821-9f8b-3e2a947bd7b5] id=[4af36742-61ac-49cc-8935-08a8ab14d6c6]} Got api session: {4af36742-61ac-49cc-8935-08a8ab14d6c6 79e3ef58-d712-4821-9f8b-3e2a947bd7b5}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.975]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).getServices: using api session token 79e3ef58-d712-4821-9f8b-3e2a947bd7b5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.983]   DEBUG github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.interceptor.Intercept: {service=[wttr.ziti] id=[9eb75dd2-88df-4b6c-8a1e-f9d1a6e15adc]} acquired network session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.984]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: starting tunnel for newly available service netcat7256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   1.002]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.(*interceptor).handleTCP: {service=[wttr.ziti] addr=[0.0.0.0:9000]} service is listening</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   1.003]   DEBUG github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.interceptor.Intercept: {service=[netcat7256]} service netcat7256 was not specified at initialization. not intercepting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   1.023]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).getServices: using api session token 79e3ef58-d712-4821-9f8b-3e2a947bd7b5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   1.071]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: starting tunnel for newly available service wttr.ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   1.071]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).getSession: requesting session from https://local-edge-controller:1280/sessions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   1.072]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti.(*contextImpl).getSession: {service_id=[5a11bfce-b716-4d7a-944b-ea72e6225549]} requesting session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   1.102]   DEBUG github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.interceptor.Intercept: {service=[wttr.ziti] id=[5589a3dc-0301-4563-bf65-cf1143f9db3b]} acquired network session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   1.102]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: starting tunnel for newly available service netcat7256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   1.103]   DEBUG github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.interceptor.Intercept: {service=[netcat7256]} service netcat7256 was not specified at initialization. not intercepting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   1.104]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.(*interceptor).handleTCP: {service=[wttr.ziti] addr=[0.0.0.0:8000]} service is listening</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use a browser - or curl to verify the ziti tunneler is listening locally and the traffic has flowed over the ziti network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;curl -H &quot;Host: wttr.in&quot; http://localhost:8000 &gt; &quot;%HSM_DEST%\example_%RSA_ID%.txt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   7.803]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*classicDialer).Create [tls:local-edge-router:3022]: started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                Dload  Upload   Total   Spent    Left  Speed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[   7.948]   DEBUG github.com/netfoundry/ziti-foundation/transport/tls.Dial: server provided [2] certificates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   7.948]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*classicDialer).sendHello [u{classic}-&gt;i{}]: started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   7.949]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*classicDialer).sendHello [u{classic}-&gt;i{}]: exited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   7.950]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*classicDialer).Create [tls:local-edge-router:3022]: exited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   7.950]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*muxAddSinkEvent).Handle: {connId=[1]} Added sink to mux. Current sink count: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   7.950]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*channelImpl).rxer [ch{ziti-sdk}-&gt;u{classic}-&gt;i{nJXo}]: started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   7.951]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*channelImpl).txer [ch{ziti-sdk}-&gt;u{classic}-&gt;i{nJXo}]: started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   7.951]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*MsgMux).AddMsgSink: {connId=[1]} added to msg mux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.082]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*channelImpl).rxer [ch{ziti-sdk}-&gt;u{classic}-&gt;i{nJXo}]: waiter found for message. type [60784], sequence [1], replyFor [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.082]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Connect: {connId=[1]} connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.083]    INFO github.com/netfoundry/ziti-edge/tunnel.Run: {src-local=[127.0.0.1:8000] dst-local=[:1] dst-remote=[wttr.ziti] src-remote=[127.0.0.1:52952]} tunnel started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.084]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} read buffer = 32768 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.085]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*MsgChannel).WriteTraced: {edgeSeq=[1] connId=[1] type=[EdgeDataType] chSeq=[-1]} writing 71 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.252]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*MsgEvent).Handle: {seq=[1] connId=[1]} handling received EdgeDataType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.252]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} got buffer from queue 8852 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.255]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} read buffer = 32768 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">100  8687  100  8687    0     0  18522      0 --:--:-- --:--:-- --:--:-- 18522</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.269]    INFO github.com/netfoundry/ziti-edge/tunnel.myCopy: {dst-local=[:1] dst-remote=[wttr.ziti] src-remote=[127.0.0.1:52952] src-local=[127.0.0.1:8000]} stopping pipe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.269]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Close: {connId=[1]} close: begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.270]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*muxRemoveSinkEvent).Handle: {connId=[1]} Removed sink from mux. Current sink count: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.271]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*MsgMux).RemoveMsgSinkById: {connId=[1]} removed from msg mux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.273]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Close: {connId=[1]} close: end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;curl -H &quot;Host: wttr.in&quot; http://localhost:9000 &gt; &quot;%HSM_DEST%\example_%EC_ID%.txt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.298]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*classicDialer).Create [tls:local-edge-router:3022]: started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                Dload  Upload   Total   Spent    Left  Speed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[   8.379]   DEBUG github.com/netfoundry/ziti-foundation/transport/tls.Dial: server provided [2] certificates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.379]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*classicDialer).sendHello [u{classic}-&gt;i{}]: started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.380]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*classicDialer).sendHello [u{classic}-&gt;i{}]: exited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.381]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*classicDialer).Create [tls:local-edge-router:3022]: exited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.381]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*channelImpl).rxer [ch{ziti-sdk}-&gt;u{classic}-&gt;i{oWqn}]: started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.383]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*channelImpl).txer [ch{ziti-sdk}-&gt;u{classic}-&gt;i{oWqn}]: started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.384]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*muxAddSinkEvent).Handle: {connId=[1]} Added sink to mux. Current sink count: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.385]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*MsgMux).AddMsgSink: {connId=[1]} added to msg mux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.495]   DEBUG github.com/netfoundry/ziti-foundation/channel2.(*channelImpl).rxer [ch{ziti-sdk}-&gt;u{classic}-&gt;i{oWqn}]: waiter found for message. type [60784], sequence [1], replyFor [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.495]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Connect: {connId=[1]} connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.495]    INFO github.com/netfoundry/ziti-edge/tunnel.Run: {src-remote=[127.0.0.1:52954] src-local=[127.0.0.1:9000] dst-local=[:1] dst-remote=[wttr.ziti]} tunnel started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.496]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*MsgChannel).WriteTraced: {connId=[1] type=[EdgeDataType] chSeq=[-1] edgeSeq=[1]} writing 71 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.496]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} read buffer = 32768 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.665]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*MsgEvent).Handle: {seq=[1] connId=[1]} handling received EdgeDataType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.666]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} got buffer from queue 8852 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.667]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} read buffer = 32768 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">100  8687  100  8687    0     0  23165      0 --:--:-- --:--:-- --:--:-- 24130</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.674]    INFO github.com/netfoundry/ziti-edge/tunnel.myCopy: {src-remote=[127.0.0.1:52954] src-local=[127.0.0.1:9000] dst-local=[:1] dst-remote=[wttr.ziti]} stopping pipe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.674]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Close: {connId=[1]} close: begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.675]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*muxRemoveSinkEvent).Handle: {connId=[1]} Removed sink from mux. Current sink count: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.675]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/edge.(*MsgMux).RemoveMsgSinkById: {connId=[1]} removed from msg mux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   8.676]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Close: {connId=[1]} close: end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;[   9.271]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} sequencer closed, closing connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   9.271]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} return EOF from closing/closed connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   9.271]    INFO github.com/netfoundry/ziti-edge/tunnel.myCopy: {src-remote=[wttr.ziti] src-local=[:1] dst-local=[127.0.0.1:8000] dst-remote=[127.0.0.1:52952]} stopping pipe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   9.271]    INFO github.com/netfoundry/ziti-edge/tunnel.Run: {src-local=[127.0.0.1:8000] dst-local=[:1] dst-remote=[wttr.ziti] src-remote=[127.0.0.1:52952]} tunnel closed: 71 bytes sent; 8852 bytes received</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   9.676]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} sequencer closed, closing connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   9.676]   DEBUG github.com/netfoundry/ziti-sdk-golang/ziti/internal/edge_impl.(*edgeConn).Read: {connId=[1]} return EOF from closing/closed connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   9.676]    INFO github.com/netfoundry/ziti-edge/tunnel.myCopy: {src-remote=[wttr.ziti] src-local=[:1] dst-local=[127.0.0.1:9000] dst-remote=[127.0.0.1:52954]} stopping pipe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   9.677]    INFO github.com/netfoundry/ziti-edge/tunnel.Run: {src-remote=[127.0.0.1:52954] src-local=[127.0.0.1:9000] dst-local=[:1] dst-remote=[wttr.ziti]} tunnel closed: 71 bytes sent; 8852 bytes received</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM set the codepage for the cmd prompt so that the output looks nice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;chcp 65001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Active code page: 65001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM show the results in the console</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;type &quot;%HSM_DEST%\example_%RSA_ID%.txt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Weather report: Laurelton, United States</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              Overcast</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .--.     14..24 °F</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .-(    ).   ↘ 13 mph</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (___.__)__)  9 mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              0.0 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                      ┌─────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────���────────────────┬───────────────────────┤  Fri 14 Feb ├───────────────────────┬──────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            Morning           │             Noon      └──────┬──────┘     Evening           │             Night            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────��─────────────────┼──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    \  /       Partly cloudy  │     \   /     Sunny          │     \   /     Clear          │     \   /     Clear          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  _ /&quot;&quot;.-.     6..19 °F       │      .-.      8..21 °F       │      .-.      8..19 °F       │      .-.      3..14 °F       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    \_(   ).   ↘ 11-13 mph    │   ― (   ) ―   �� 11-13 mph    │   ― (   ) ―   ↗ 11-13 mph    │   ― (   ) ―   ↓ 8-13 mph     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    /(___(__)  5 mi           │      `-’      6 mi           │      `-’      6 mi           │      `-’      6 mi           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│               0.0 in | 0%    │     /   \     0.0 in | 0%    │     /   \     0.0 in | 0%    │     /   \     0.0 in | 0%    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┴──────────────────────���───────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                      ┌─────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────┬───────────────────────┤  Sat 15 Feb ├───────────────────────┬────────────────────────���─────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            Morning           │             Noon      └──────┬──────┘     Evening           │             Night            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────┼──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     \   /     Sunny          │    \  /       Partly cloudy  │    \  /       Partly cloudy  │    \  /       Partly cloudy  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      .-.      14..17 °F      │  _ /&quot;&quot;.-.     17..24 °F      │  _ /&quot;&quot;.-.     21..30 °F      │  _ /&quot;&quot;.-.     17..24 °F      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ― (   ) ―   ↖ 3 mph        │    \_(   ).   ↑ 6-8 mph      │    \_(   ).   ↑ 9-14 mph     │    \_(   ).   ↑ 8-14 mph     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      `-’      6 mi           │    /(___(__)  6 mi           │    /(___(__)  6 mi           │    /(___(__)  6 mi           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     /   \     0.0 in | 0%    │               0.0 in | 0%    │               0.0 in | 0%    │               0.0 in | 0%    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                      ┌─────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────���───────────────────────┤  Sun 16 Feb ├───────────────────────┬──────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            Morning           │             Noon      └──────┬──────┘     Evening           │             Night            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────��┼──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    \  /       Partly cloudy  │    \  /       Partly cloudy  │               Overcast       │               Overcast       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  _ /&quot;&quot;.-.     24..30 °F      │  _ /&quot;&quot;.-.     35..39 °F      │      .--.     37..39 °F      │      .--.     32..33 °F      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    \_(   ).   ↗ 4-7 mph      │    \_(   ).   ↗ 7-8 mph      │   .-(    ).   → 6-9 mph      │   .-(    ).   ↗ 3-8 mph      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    /(___(__)  6 mi           │    /(___(__)  6 mi           │  (___.__)__)  6 mi           │  (___.__)__)  6 mi           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│               0.0 in | 0%    │               0.0 in | 0%    │               0.0 in | 0%    │               0.0 in | 0%    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Follow @igor_chubin for wttr.in updates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;type &quot;%HSM_DEST%\example_%EC_ID%.txt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Weather report: Laurelton, United States</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              Overcast</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .--.     14..24 °F</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .-(    ).   ↘ 13 mph</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (___.__)__)  9 mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              0.0 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                      ┌─────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────���────────────────┬───────────────────────┤  Fri 14 Feb ├───────────────────────┬──────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            Morning           │             Noon      └──────┬──────┘     Evening           │             Night            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────��─────────────────┼──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    \  /       Partly cloudy  │     \   /     Sunny          │     \   /     Clear          │     \   /     Clear          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  _ /&quot;&quot;.-.     6..19 °F       │      .-.      8..21 °F       │      .-.      8..19 °F       │      .-.      3..14 °F       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    \_(   ).   ↘ 11-13 mph    │   ― (   ) ―   �� 11-13 mph    │   ― (   ) ―   ↗ 11-13 mph    │   ― (   ) ―   ↓ 8-13 mph     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    /(___(__)  5 mi           │      `-’      6 mi           │      `-’      6 mi           │      `-’      6 mi           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│               0.0 in | 0%    │     /   \     0.0 in | 0%    │     /   \     0.0 in | 0%    │     /   \     0.0 in | 0%    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┴──────────────────────���───────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                      ┌─────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────┬───────────────────────┤  Sat 15 Feb ├───────────────────────┬────────────────────────���─────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            Morning           │             Noon      └──────┬──────┘     Evening           │             Night            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├──────────────────────────────┼──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     \   /     Sunny          │    \  /       Partly cloudy  │    \  /       Partly cloudy  │    \  /       Partly cloudy  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      .-.      14..17 °F      │  _ /&quot;&quot;.-.     17..24 °F      │  _ /&quot;&quot;.-.     21..30 °F      │  _ /&quot;&quot;.-.     17..24 °F      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ― (   ) ―   ↖ 3 mph        │    \_(   ).   ↑ 6-8 mph      │    \_(   ).   ↑ 9-14 mph     │    \_(   ).   ↑ 8-14 mph     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│      `-’      6 mi           │    /(___(__)  6 mi           │    /(___(__)  6 mi           │    /(___(__)  6 mi           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     /   \     0.0 in | 0%    │               0.0 in | 0%    │               0.0 in | 0%    │               0.0 in | 0%    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                      ┌─────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────────────���───────────────────────┤  Sun 16 Feb ├───────────────────────┬──────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│            Morning           │             Noon      └──────┬──────┘     Evening           │             Night            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────��┼──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    \  /       Partly cloudy  │    \  /       Partly cloudy  │               Overcast       │               Overcast       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  _ /&quot;&quot;.-.     24..30 °F      │  _ /&quot;&quot;.-.     35..39 °F      │      .--.     37..39 °F      │      .--.     32..33 °F      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    \_(   ).   ↗ 4-7 mph      │    \_(   ).   ↗ 7-8 mph      │   .-(    ).   → 6-9 mph      │   .-(    ).   ↗ 3-8 mph      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    /(___(__)  6 mi           │    /(___(__)  6 mi           │  (___.__)__)  6 mi           │  (___.__)__)  6 mi           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│               0.0 in | 0%    │               0.0 in | 0%    │               0.0 in | 0%    │               0.0 in | 0%    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Follow @igor_chubin for wttr.in updates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;REM ctrl-break or ctrl-pause to kill the tunnelers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  39.022]   DEBUG github.com/netfoundry/ziti-edge/tunnel/intercept.ServicePoller: caught signal interrupt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  39.015]   DEBUG github.com/netfoundry/ziti-edge/tunnel/intercept.ServicePoller: caught signal interrupt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c:\path\to\yubico-piv-tool-2.0.0\yubikey_windemo&gt;[  39.023]   DEBUG github.com/netfoundry/ziti-edge/tunnel/intercept.ServicePoller: caught signal interrupt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  39.017]   DEBUG github.com/netfoundry/ziti-edge/tunnel/intercept.ServicePoller: caught signal interrupt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  39.025]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: stopping tunnel for unavailable service: wttr.ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  39.018]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: stopping tunnel for unavailable service: wttr.ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  39.025]   ERROR github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: failed to stop intercepting: StopIntercepting not implemented by proxy interceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  39.019]   ERROR github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: failed to stop intercepting: StopIntercepting not implemented by proxy interceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  39.026]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: stopping tunnel for unavailable service: netcat7256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  39.020]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: stopping tunnel for unavailable service: netcat7256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  39.027]   ERROR github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: failed to stop intercepting: StopIntercepting not implemented by proxy interceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  39.020]   ERROR github.com/netfoundry/ziti-edge/tunnel/intercept.updateServices: failed to stop intercepting: StopIntercepting not implemented by proxy interceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  39.028]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.(*interceptor).Stop: stopping proxy interceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  39.021]    INFO github.com/netfoundry/ziti-edge/tunnel/intercept/proxy.(*interceptor).Stop: stopping proxy interceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REM set the codepage for the cmd prompt so that the output looks nice</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/guides/hsm/softhsm"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SoftHSMv2</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/guides/mobile/android"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Android</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#prerequistites" class="table-of-contents__link toc-highlight">Prerequistites</a></li><li><a href="#lets-use-the-yubikey" class="table-of-contents__link toc-highlight">Let&#39;s Use the YubiKey!</a><ul><li><a href="#establish-environment-variables" class="table-of-contents__link toc-highlight">Establish Environment Variables</a></li><li><a href="#make-directories-for-config-files" class="table-of-contents__link toc-highlight">Make Directories for Config Files</a></li><li><a href="#use-the-ziti-cli" class="table-of-contents__link toc-highlight">Use the Ziti CLI</a></li><li><a href="#use-pkcs11-tool-to-setup-the-yubikey" class="table-of-contents__link toc-highlight">Use pkcs11-tool to Setup the YubiKey</a></li><li><a href="#use-ziti-tunnel-to-enroll-the-identities" class="table-of-contents__link toc-highlight">Use ziti-tunnel to Enroll the Identities</a></li><li><a href="#use-ziti-tunnel-to-verify-things-work" class="table-of-contents__link toc-highlight">Use ziti-tunnel to Verify Things Work</a></li><li><a href="#putting-it-all-together" class="table-of-contents__link toc-highlight">Putting It All Together</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 NetFoundry Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3347cdb9.js"></script>
<script src="/assets/js/main.b96dd6d5.js"></script>
</body>
</html>