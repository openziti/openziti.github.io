<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>http://localhost:3000/docs/openziti/blog</id>
    <title>OpenZiti Blog</title>
    <updated>2025-04-09T19:48:24.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="http://localhost:3000/docs/openziti/blog"/>
    <subtitle>OpenZiti Blog</subtitle>
    <icon>http://localhost:3000/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Introducing zrok 1.0]]></title>
        <id>http://localhost:3000/docs/openziti/blog/introducing-zrok-10</id>
        <link href="http://localhost:3000/docs/openziti/blog/introducing-zrok-10"/>
        <updated>2025-04-09T19:48:24.000Z</updated>
        <summary type="html"><![CDATA[What does version 1.0 mean?]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-does-version-10-mean">What does version 1.0 mean?<a href="http://localhost:3000/docs/openziti/blog/introducing-zrok-10#what-does-version-10-mean" class="hash-link" aria-label="Direct link to What does version 1.0 mean?" title="Direct link to What does version 1.0 mean?">​</a></h2>
<p>It’s always a big deal when a project releases “version 1.0”. Our version 1.0 release validates all of the good things
about zrok while improving a few areas that needed it, and also brings several exciting new features.</p>
<p>The initial release of 1.0 includes major new features like:</p>
<ul>
<li>
<p>A new polished API console (web interface)</p>
</li>
<li>
<p>A new “zrok Agent” designed to streamline the management of your zrok resources and provide a web interface making zrok accessible to users who aren’t command-line natives</p>
</li>
<li>
<p>The “zrok Canary” a new suite of tests designed to focus on both performance and reliability for production zrok environment</p>
</li>
</ul>
<p>We’re going to take a look at these highlights of zrok 1.0 in this blog post. For those of you who prefer videos, I recently did a zrok Office Hours covering this same information:</p>
<p></p><article class="yt-lite" data-title="YouTube video" style="background-image:url(https://i.ytimg.com/vi/cIqkbnv-xAQ/hqdefault.jpg);--aspect-ratio:56.25%"><button type="button" class="lty-playbtn" aria-label="Watch YouTube video"></button></article><p></p>
<h1>History</h1>
<p>I keep a detailed journal of my work. I like to save screenshots documenting interesting points in the development of the projects that I work on. Sometimes it’s fun to go back and look at them. Here’s a little look into zrok screenshots over the years.</p>
<p>First, starting in 2022, here is a <code>v0.2</code> screenshot. <code>v0.2</code> predates <a href="https://zrok.io/" target="_blank" rel="noopener noreferrer">zrok.io</a> and the hosted service. This is the very first version of zrok that had a “console” and integrated metrics:</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/9da95d37-6436-49c6-967a-21f74f292e92-a75d073d93c0012f4bb3132a6ed86e13.png" width="1913" height="1319" class="img_ev3q"></p>
<p><code>v0.2</code> also predates <code>private</code> sharing in zrok. This was just a proof-of-concept exercise to see what a secure public reverse proxy solution on top of OpenZiti might look like.</p>
<p>Then we developed <code>v0.3</code>, which added private sharing and introduced the concept of a “backend mode”:</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/52aa2f76-017c-4336-8a54-b1775041c49b-c006d323ce52bd29d43649589a1d0921.gif" width="1622" height="1452" class="img_ev3q"></p>
<p>The “visualizer” concept was first introduced in <code>v0.3</code>. This version of the visualizer is similar to what we ended up with in <code>v0.4</code>.</p>
<p>The main goal of the <code>v0.4</code> series was to develop zrok into a platform that could support a zrok as a service (<a href="https://zrok.io/" target="_blank" rel="noopener noreferrer">zrok.io</a>). A lot of refinement and polish went into making <code>v0.4</code> usable and useful for a wider range of users:</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/30237eb1-fa20-483c-86e9-25b1be9a8b68-da6f6c5f6a6ac53d50bbb69897952f75.png" width="1584" height="1337" class="img_ev3q"></p>
<p>Every time there is a major refresh of the zrok user interface, I feel like the new version feels like a substantial leap forward.</p>
<p>This brings us to the first major feature of zrok <code>v1.0</code>, which is the updated API console.</p>
<h1>The New API Console</h1>
<p>The new zrok API console (the primary “web interface”) has received a major refresh for <code>v1.0</code>. In addition to new branding, the technology under the covers has been streamlined as well. Here are some screenshots so you can get the vibes:</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/d2d3ba1c-f4e7-4f93-b094-1e9c013c7052-db1f68bc5863c1276e854714084c217d.png" width="1541" height="1243" class="img_ev3q"></p>
<p>These things are subjective, but I very much look at this new user interface and feel the same way about it that I’ve felt about previous iterations… it looks like a substantial improvement in polish and usability versus the previous version.</p>
<p>Under the covers the API console has been re-developed in Typescript using Vite. It’s still a React application, but the stack has been radically cleaned up and simplified. This new stack will give us a solid platform to extend and build on going forward.</p>
<p>The new API console retains the same visual approach to navigating your zrok resources as the previous release… but in addition, the new API console provides a “tabular” mode to easily filter and sort the contents of your account:</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/6ac1f878-3e82-4fef-b862-c6ca674c14ce-92861ce267d124e4e84fe75ca3e01a8c.png" width="1541" height="1243" class="img_ev3q"></p>
<p>When sorted by activity, the tabular mode operates kind of like a “top” command for your zrok account.</p>
<p>For users with large, active accounts, the sorting and filtering features can help you to zero in on the specific resources you’re looking for. The selection state is maintained between the visualizer and tabular modes, allowing you to search and then quickly visualize.</p>
<p>The forms and dialogs have also received a lot of attention and polish:</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/36f17c1f-ebc7-4d88-8537-7d5dcc6d7eca-b431f9724bf0708f08d89c6b0ac514bc.png" width="1541" height="1243" class="img_ev3q"></p>
<p>We’re excited about the new streamlined look-and-feel, too.</p>
<h1>zrok Agent</h1>
<p>If you’re a zrok power user who has ever used more than a single <code>zrok share</code> or <code>zrok access</code>, you’ve surely run into the issue where you’ve needed to manage a number of zrok processes. Some of them might go in <code>systemd</code>. Some of them might sit in terminal windows. You might even <code>nohup</code> some of them into the background.</p>
<p>zrok v1.0 introduces a new “zrok Agent” to make this situation much simpler. The Agent is a kind of intelligent “process manager” for all of your zrok shares and accesses. It’s designed to work well for both end-user environments (for developers and end-users) and also for headless production environments.</p>
<p>When you’re not running the zrok Agent, the v1.0 command-line works the way it always has… If you run a <code>zrok share</code>, you’ll end up with a single process for that share, like this:</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/8178eb22-1424-4dfb-8f32-4bea6987dc6b-81045af23d805377a52636131a65423d.png" width="585" height="418" class="img_ev3q"></p>
<p>But when I start the new zrok Agent using the <code>zrok agent start</code> command, we get a different operating mode. With the zrok Agent running, if I do a <code>zrok share</code>, I get a different result:</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/21f79d74-b5bd-4cfe-becf-4d1454bcf487-3bfd41da03102efd0cfe199e1777051c.png" width="585" height="418" class="img_ev3q"></p>
<p>Notice that the <code>zrok share public</code> command above returned immediately, displaying the share token and the URL for my new share. When I ran <code>zrok share public</code> with the Agent running, the Agent was detected and the process for my new share was managed by the Agent automatically.</p>
<p>With the zrok Agent you’ll have a single process to manage. You can put your <code>zrok agent start</code> command into <code>systemd</code> using the <code>zrok-agent</code> package for Linux. You can <code>nohup</code> it. You can just stash it away in a terminal window somewhere. You can run it as a Windows service. But once you’ve managed that single process, your whole zrok experience becomes simpler.</p>
<p>You might also notice the <code>zrok agent status</code> command in the terminal above. That command is used to display the shares and accesses being managed by the Agent.</p>
<p>There are additional commands under the <code>zrok agent</code> tree for managing shares and accesses:</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/4141ac00-4a3d-4801-aa52-6d6d0c19b6bf-18e44a84f948e7da6ec55cd14baa4ef1.png" width="585" height="418" class="img_ev3q"></p>
<p>And the <code>zrok agent release share</code> command can direct the agent to release the share.</p>
<p>The zrok Agent also includes a <code>localhost</code> web interface, which can be used to create and remove shares from the agent… yes, when you’re running the zrok Agent you can create new shares <em>without using the command-line</em> interface!</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/08b3caad-b8c5-4741-9e95-ec497afd5fff-0a85c8a26592938cd17a44b726499856.png" width="1358" height="948" class="img_ev3q"></p>
<p>The zrok “Agent console” is an early preview and a work-in-progress. There are currently a limited subset of share types that can be created through the Agent console, but we expect to elaborate this into a first-class interface over the next handful of releases.</p>
<p>We expect the zrok Agent console to grow into a super useful desktop assistant for managing your local zrok shares and accesses. This will be especially helpful for non-CLI users.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="remote-agent-administration">Remote Agent Administration<a href="http://localhost:3000/docs/openziti/blog/introducing-zrok-10#remote-agent-administration" class="hash-link" aria-label="Direct link to Remote Agent Administration" title="Direct link to Remote Agent Administration">​</a></h2>
<p>We’re not quite there yet, but we’re very excited about one of the features we’re actively developing for the zrok Agent… opt-in “remote administration”. Imagine you have a headless system somewhere with an enabled zrok environment running a zrok Agent. Sure, you could <code>ssh</code> into that system to create and manage shares. But what if you could simply enroll your zrok Agent so that it can be managed from the central zrok API console… from anywhere?</p>
<p>This kind of remote administration would allow you to create and release shares and accesses on remote environments through the zrok API console. Need to get into a remote system without direct access? This could be a way to make that very simple. This also allows you to shut down shares and accesses when you’re not using them, increasing security.</p>
<p>Remote administration will be completely opt-in and will be the kind of capability you can enable only when you need it. If you do not enroll your Agent, then that Agent is an island unto itself that you can only access locally. You’ll be in control.</p>
<h1>zrok Canary</h1>
<p>We take the reliability and performance of zrok very seriously. So seriously that we’re developing a set of performance and reliability tooling into zrok that we collectively refer to as the “zrok Canary”.</p>
<p>For the initial 1.0 release, we’ve re-worked the old <code>zrok test loop public</code> infrastructure into a more polished set of tools underneath <code>zrok test canary</code>.</p>
<p>We expect to continue elaborating these tools into a wide suite of monitors and tests to properly validate all of the major operating conditions of a zrok instance. And we expect to be rolling these tools out across <a href="https://zrok.io/" target="_blank" rel="noopener noreferrer">zrok.io</a> as they’re available to give us deeper and better visibility into how zrok is operating.</p>
<h1>Switching to 1.0</h1>
<p>To switch to 1.0, simply obtain a zrok binary at <code>v1.0.2</code> or later, and your existing environments will automatically be migrated to the new version, transparently.</p>
<h1>The Medium-term Roadmap</h1>
<p>There are a lot of exciting new features and capabilities lined up for the <code>v1.0.x</code> release series!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="zrok-for-openziti-networks">zrok for OpenZiti Networks<a href="http://localhost:3000/docs/openziti/blog/introducing-zrok-10#zrok-for-openziti-networks" class="hash-link" aria-label="Direct link to zrok for OpenZiti Networks" title="Direct link to zrok for OpenZiti Networks">​</a></h2>
<p>Have an existing OpenZiti network? Want to quickly and easily add zrok capabilities to your OpenZiti network on-demand? We’re taking a good look at how best to add and remove zrok as a capability of an existing OpenZiti network.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="remote-agent-administration-1">Remote Agent Administration<a href="http://localhost:3000/docs/openziti/blog/introducing-zrok-10#remote-agent-administration-1" class="hash-link" aria-label="Direct link to Remote Agent Administration" title="Direct link to Remote Agent Administration">​</a></h2>
<p>Enroll your zrok Agent for remote administration through the zrok API console. Un-enroll the instant you’re done. All communications between your zrok Agent and the zrok instance will be handled securely through the OpenZiti overlay.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-complete-zrok-agent-console">A Complete zrok Agent Console<a href="http://localhost:3000/docs/openziti/blog/introducing-zrok-10#a-complete-zrok-agent-console" class="hash-link" aria-label="Direct link to A Complete zrok Agent Console" title="Direct link to A Complete zrok Agent Console">​</a></h2>
<p>Do everything through the zrok Agent console that you can do through the command-line. Keep this interface on your desktop and never touch the zrok CLI again.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="reserved-namespace-improvements">Reserved Namespace Improvements<a href="http://localhost:3000/docs/openziti/blog/introducing-zrok-10#reserved-namespace-improvements" class="hash-link" aria-label="Direct link to Reserved Namespace Improvements" title="Direct link to Reserved Namespace Improvements">​</a></h2>
<p>Everyone wants the same names for their reserved shares: <code>staging</code>, <code>testing</code>, etc. We’ll be taking a good hard look at how to give users better, more specific namespaces allowing them to use the names that they want to use.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="more-zrok-drives-making-drives-more-useful">More zrok Drives; Making Drives More Useful<a href="http://localhost:3000/docs/openziti/blog/introducing-zrok-10#more-zrok-drives-making-drives-more-useful" class="hash-link" aria-label="Direct link to More zrok Drives; Making Drives More Useful" title="Direct link to More zrok Drives; Making Drives More Useful">​</a></h2>
<p>Magic wormholes. Drive-by upload boxes. Ephemeral downloads. We’ll be looking at ways to build on the proof-of-concept that is the current zrok Drives implementation, making it useful for all kinds of data-in-motion use cases.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="api-console-timeline-and-notifications">API Console Timeline and Notifications<a href="http://localhost:3000/docs/openziti/blog/introducing-zrok-10#api-console-timeline-and-notifications" class="hash-link" aria-label="Direct link to API Console Timeline and Notifications" title="Direct link to API Console Timeline and Notifications">​</a></h2>
<p>See how your zrok resources have changed over time. Answer questions like “when exactly did I remove that share?” We’ll also be looking at notifications and working on providing better mechanisms for communicating with users.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="openziti-ha-control-plane-integration">OpenZiti HA Control Plane Integration<a href="http://localhost:3000/docs/openziti/blog/introducing-zrok-10#openziti-ha-control-plane-integration" class="hash-link" aria-label="Direct link to OpenZiti HA Control Plane Integration" title="Direct link to OpenZiti HA Control Plane Integration">​</a></h2>
<p>OpenZiti has an HA control plane and we’re going to teach zrok how best to take advantage of that. zrok is one of our examples of best practices around “Ziti Native Applications” and we’re going to continue and expand that tradition to include HA.</p>
<h1>Thank you!</h1>
<p>Thank you for supporting zrok. We’re really looking forward to seeing where the 1.0 roadmap takes us.</p>
<p>If you like zrok, it’s always very much appreciated if you take a moment to drop a star onto the <a href="https://github.com/openziti/zrok" target="_blank" rel="noopener noreferrer">zrok repository on GitHub</a>. We literally see and appreciate every repository star.</p>
<p>If zrok is an important part of your workflow, maybe you would consider getting a subscription on <a href="https://zrok.io/" target="_blank" rel="noopener noreferrer">zrok.io</a>? Those subscriptions are an incredibly helpful signal that we’re on the right track.</p>
<p>If there is anything we can do to improve zrok or if you’ve run into anything we can help with, please reach out to us at our <a href="https://openziti.discourse.group/c/zrok/24" target="_blank" rel="noopener noreferrer">OpenZiti Discourse forum</a>. There is a <a href="https://openziti.discourse.group/c/zrok/24" target="_blank" rel="noopener noreferrer">zrok category</a>, and we’re standing by ready to help.</p>]]></content>
        <author>
            <name>Michael Quigley</name>
            <uri>https://github.com/michaelquigley</uri>
        </author>
        <category label="Software Development" term="Software Development"/>
        <category label="Tools" term="Tools"/>
        <category label="Security" term="Security"/>
        <category label="Developer" term="Developer"/>
        <category label="Announcement" term="Announcement"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[zrok Unleashed: Top 10 Uses Explored]]></title>
        <id>http://localhost:3000/docs/openziti/blog/zrok-unleashed-top-10-uses-explored</id>
        <link href="http://localhost:3000/docs/openziti/blog/zrok-unleashed-top-10-uses-explored"/>
        <updated>2025-03-05T14:23:33.000Z</updated>
        <summary type="html"><![CDATA[As we roll into 2025, we’re entering into an exciting time for the world of zrok. We’ve just recently]]></summary>
        <content type="html"><![CDATA[<p>As we roll into 2025, we’re entering into an exciting time for the world of zrok. We’ve just recently
added <a href="http://localhost:3000/docs/openziti/blog/zrok-custom-domains">support for custom domains</a>, and with the 1.0 release right
around the corner, zrok is more powerful than it has ever been. We thought this was a good time to zoom out and
take a look at how users are actually using our <a href="https://myzrok.io/" target="_blank" rel="noopener noreferrer">hosted zrok as a service</a>.</p>
<p>As part of the larger open source <a href="https://github.com/openziti/zrok/" target="_blank" rel="noopener noreferrer">OpenZiti project</a>, zrok uses an <a href="https://openziti.io/docs/learn/introduction/" target="_blank" rel="noopener noreferrer">OpenZiti overlay network</a> for any secure communications. When you start an instance of zrok, zrok will create a secure zero trust connection to the OpenZiti overlay. This connection is also how zrok can provide truly end-to-end encrypted tunnels with the <code>--tcpTunnel</code> <a href="https://docs.zrok.io/docs/getting-started#share-backend-modes" target="_blank" rel="noopener noreferrer">backend mode</a>. Given its nature, it’s difficult to know what services zrok is providing, but we were able to run some statistics based on the terminating port and make some inferences on whether or not the port was exposed as a public or private share. Here’s the list that we came up with. I found some of these use cases particularly cool, and I discovered some use cases in the process I’d never actually thought of. We’re hoping this post gives you some fresh eyes with zrok and you discover some new possibilities for how powerful it can be for resource sharing!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-local-development-servers">#1. Local Development Servers<a href="http://localhost:3000/docs/openziti/blog/zrok-unleashed-top-10-uses-explored#1-local-development-servers" class="hash-link" aria-label="Direct link to #1. Local Development Servers" title="Direct link to #1. Local Development Servers">​</a></h2>
<p><em>Ports: 80,8000,8080,3000,3001,5173</em></p>
<p>No surprise here! This is probably the original use case that zrok was built around, and zrok just makes it so easy to share your local environment and alleviates the need to stand up an entire shared environment just to be able to show off a local demo, collaborate on a pre-release, or share resources in a distributed developer environment. Whether you’re running apache, nginx, nodejs, or Vite, zrok allows you to easily share any of these technologies.</p>
<p><code>zrok share public 8080</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-minecraft-servers">#2. Minecraft Servers<a href="http://localhost:3000/docs/openziti/blog/zrok-unleashed-top-10-uses-explored#2-minecraft-servers" class="hash-link" aria-label="Direct link to #2. Minecraft Servers" title="Direct link to #2. Minecraft Servers">​</a></h2>
<p><em>Port: 25565</em></p>
<p>Still one of the best games of all time, and considering how easy it is to run your own server and add custom mods, zrok provides an easy way to share a private game server with your friends without having to open up your firewall ports to the world.</p>
<p>See <a href="http://localhost:3000/docs/openziti/blog/minecraft-over-zrok">this tutorial</a> for full details on how to run your minecraft server over zrok!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-aws-sagemaker-notebooks">#3. AWS Sagemaker Notebooks<a href="http://localhost:3000/docs/openziti/blog/zrok-unleashed-top-10-uses-explored#3-aws-sagemaker-notebooks" class="hash-link" aria-label="Direct link to #3. AWS Sagemaker Notebooks" title="Direct link to #3. AWS Sagemaker Notebooks">​</a></h2>
<p><em>Port: 7860</em></p>
<p>About a year ago we had a huge amount of buzz from the community that outlined how to integrate zrok with <a href="https://aws.amazon.com/sagemaker/" target="_blank" rel="noopener noreferrer">AWS Sagemaker</a> notebooks. <a href="https://www.youtube.com/@pogscafe" target="_blank" rel="noopener noreferrer">Pogs Cafe</a> put together some great video content that shows zrok integrated with their launcher for ephemeral AI image generation. <!-- --></p><article class="yt-lite" data-title="YouTube video" style="background-image:url(https://i.ytimg.com/vi/Tl5eHI_AMmw/hqdefault.jpg);--aspect-ratio:56.25%"><button type="button" class="lty-playbtn" aria-label="Watch YouTube video"></button></article>, or check out their <a href="https://www.pogs.cafe/software/tunneling-sagemaker-kaggle" target="_blank" rel="noopener noreferrer">blog post</a>.<p></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-bluebubbles">#4. BlueBubbles<a href="http://localhost:3000/docs/openziti/blog/zrok-unleashed-top-10-uses-explored#4-bluebubbles" class="hash-link" aria-label="Direct link to #4. BlueBubbles" title="Direct link to #4. BlueBubbles">​</a></h2>
<p><em>Port: 1234</em></p>
<p>BlueBubbles is a free, open-source app ecosystem that allows users to send and receive iMessages on non-Apple devices. <a href="https://newreleases.io/project/github/BlueBubblesApp/bluebubbles-server/release/v1.9.6" target="_blank" rel="noopener noreferrer">BlueBubbles leverages zrok</a> as one of its built-in proxy services so that you can run BlueBubbles server without the need for port-forwarding.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-irc---internet-relay-chat">#5. IRC - Internet Relay Chat<a href="http://localhost:3000/docs/openziti/blog/zrok-unleashed-top-10-uses-explored#5-irc---internet-relay-chat" class="hash-link" aria-label="Direct link to #5. IRC - Internet Relay Chat" title="Direct link to #5. IRC - Internet Relay Chat">​</a></h2>
<p><em>Port: 6666</em></p>
<p>The original chat server, has been alive since 1988. zrok provides a way for you to easily put modern security around your chat server with end-to-end encryption, and private access tokens with the use of <a href="https://docs.zrok.io/docs/concepts/tunnels/" target="_blank" rel="noopener noreferrer">private TCP shares</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-ssh">#6. SSH<a href="http://localhost:3000/docs/openziti/blog/zrok-unleashed-top-10-uses-explored#6-ssh" class="hash-link" aria-label="Direct link to #6. SSH" title="Direct link to #6. SSH">​</a></h2>
<p><em>Port: 22</em></p>
<p>Who needs a Bastion anyway? That’s so 2010! Just leave 22 closed to the world and put a zrok private TCP share on the host and call it a day. No open ports. Simply fire up a <a href="https://docs.zrok.io/docs/guides/linux-user-share/" target="_blank" rel="noopener noreferrer">zrok share as a systemd service</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7---jupyter-notebooks--ai-notebooks">#7 - Jupyter Notebooks / AI Notebooks<a href="http://localhost:3000/docs/openziti/blog/zrok-unleashed-top-10-uses-explored#7---jupyter-notebooks--ai-notebooks" class="hash-link" aria-label="Direct link to #7 - Jupyter Notebooks / AI Notebooks" title="Direct link to #7 - Jupyter Notebooks / AI Notebooks">​</a></h2>
<p><em>Port: 8188</em></p>
<p>This one was a little bit ambiguous because there are multiple AI Notebook tools that all rely on this same default port. We know that <a href="https://jupyter.org/" target="_blank" rel="noopener noreferrer">Jupyter Notebooks</a> is one of the biggest uses in this bucket, and some cloud providers like Google Cloud AI and Hauwei Cloud AI also make use of these tools.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-squid-proxy">#8. Squid Proxy<a href="http://localhost:3000/docs/openziti/blog/zrok-unleashed-top-10-uses-explored#8-squid-proxy" class="hash-link" aria-label="Direct link to #8. Squid Proxy" title="Direct link to #8. Squid Proxy">​</a></h2>
<p><em>Port: 3128</em></p>
<p><a href="https://www.squid-cache.org/" target="_blank" rel="noopener noreferrer">Squid proxy</a> is an easy-to-use caching and proxy server that can be used to give greater control over outbound traffic whether you’re testing compatibility with a corporate proxy for your application, or you need funnel traffic through a remote server’s address, zrok gives you an easy way to set this up. Just create a share that terminates on your proxy service and set your HTTP_PROXY/HTTPS_PROXY variables in your environment, and all http-based traffic will now filter through your zrok proxy.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="9-foundryvtt">#9. FoundryVTT<a href="http://localhost:3000/docs/openziti/blog/zrok-unleashed-top-10-uses-explored#9-foundryvtt" class="hash-link" aria-label="Direct link to #9. FoundryVTT" title="Direct link to #9. FoundryVTT">​</a></h2>
<p><em>Port: 30000</em></p>
<p>Probably my personal favorite use case for zrok. <a href="https://foundryvtt.com/" target="_blank" rel="noopener noreferrer">FoundryVTT is a virtual table top game server</a>, and zrok provides a fantastic way to host a virtual game night from your own PC while still protecting your home network. Check out this <!-- --></p><article class="yt-lite" data-title="YouTube video" style="background-image:url(https://i.ytimg.com/vi/x-3PODwEdDM/hqdefault.jpg);--aspect-ratio:56.25%"><button type="button" class="lty-playbtn" aria-label="Watch YouTube video"></button></article><p></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="10-nomachine-remote-desktop">#10. NoMachine Remote Desktop<a href="http://localhost:3000/docs/openziti/blog/zrok-unleashed-top-10-uses-explored#10-nomachine-remote-desktop" class="hash-link" aria-label="Direct link to #10. NoMachine Remote Desktop" title="Direct link to #10. NoMachine Remote Desktop">​</a></h2>
<p><em>Port 4000</em></p>
<p>Remote desktop is incredibly handy, but it’s also something you would never want to expose as an open port on the internet. <a href="https://www.nomachine.com/" target="_blank" rel="noopener noreferrer">NoMachine is a free multi-platform remote desktop tool</a>. With the use of <a href="https://docs.zrok.io/docs/concepts/tunnels/" target="_blank" rel="noopener noreferrer">private TCP shares</a>, zrok enables you to maintain secure remote access from anywhere without ever exposing a port to the internet.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="---you-tell-us">#??? - You Tell Us!!<a href="http://localhost:3000/docs/openziti/blog/zrok-unleashed-top-10-uses-explored#---you-tell-us" class="hash-link" aria-label="Direct link to #??? - You Tell Us!!" title="Direct link to #??? - You Tell Us!!">​</a></h2>
<p><em>Port: ???</em></p>
<p>Got a killer idea for zrok that we missed? Post it in the comments! We always love to hear new use cases for how people are using zrok so that we can make this technology better. And if you haven’t already, help us spread the word about zrok by <a href="https://github.com/openziti/zrok" target="_blank" rel="noopener noreferrer">giving us a star on github!</a></p>]]></content>
        <author>
            <name>Mike Guthrie</name>
            <uri>https://github.com/mguthrie88</uri>
        </author>
        <category label="zrok" term="zrok"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Securing Ziti Identities with HSM/TPM]]></title>
        <id>http://localhost:3000/docs/openziti/blog/securing-ziti-identities-with-hsmtpm</id>
        <link href="http://localhost:3000/docs/openziti/blog/securing-ziti-identities-with-hsmtpm"/>
        <updated>2025-02-26T15:27:28.000Z</updated>
        <summary type="html"><![CDATA[Regular readers of this blog know that OpenZiti provides secure overlay networking between Ziti identities.]]></summary>
        <content type="html"><![CDATA[<p>Regular readers of this blog know that OpenZiti provides secure overlay networking between Ziti identities.
You can improve security of your OpenZiti edge identities by using hardware-based private keys.
This guide provides step-by-step instructions on integrating hardware security with OpenZiti.
It uses Linux built-in TPM as a hardware security device. Similar steps will also work with other HSM devices.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="this-is-how-i-enroll">This is How I (en)Roll<a href="http://localhost:3000/docs/openziti/blog/securing-ziti-identities-with-hsmtpm#this-is-how-i-enroll" class="hash-link" aria-label="Direct link to This is How I (en)Roll" title="Direct link to This is How I (en)Roll">​</a></h2>
<p>On my Linux(Ubuntu) laptop I check that the kernel detected TPM hardware and created a device for it.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@hermes:~$ </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-l</span><span class="token plain"> /dev/tpm*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">crw-rw---- </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> tss root  </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">,   </span><span class="token number" style="color:#36acaa">224</span><span class="token plain"> Apr </span><span class="token number" style="color:#36acaa">26</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:41 /dev/tpm0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">crw-rw---- </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> tss tss  </span><span class="token number" style="color:#36acaa">253</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">65536</span><span class="token plain"> Apr </span><span class="token number" style="color:#36acaa">26</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:41 /dev/tpmrm0</span><br></span></code></pre></div></div>
<p>Device <code>/dev/tpmrm0</code> is there, so I can proceed.</p>
<p>Add my user to the <code>tss</code> group so that the TPM device can be accessed. You will probably need to restart your login shell for that to take effect, check your groups with <code>id</code> command.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@hermes:~$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">usermod</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-G</span><span class="token plain"> tss </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> ziggy</span><br></span></code></pre></div></div>
<p>Install some useful software packages to interact with the TPM device</p>
<ul>
<li>
<p><code>libtpm2-pkcs11-tools</code> - includes <code>tmp2_ptool</code> to initialize PKCS#11 token on TPM device</p>
</li>
<li>
<p><code>libtpm2-pkcs11-1</code> - TPM PKCS#11 library</p>
</li>
<li>
<p><code>opensc</code> - includes <code>pkcs11-tool</code> for interacting with PKCS#11 token. This is not needed for OpenZiti enrollment but is useful for inspecting tokens</p>
</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@hermes:~$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> libtpm2-pkcs11-tools libtpm2-pkcs11-1 opensc</span><br></span></code></pre></div></div>
<p>Now that I have access to the device and the needed software I can initialize the token and test PKCS#11 driver access to it</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@hermes:~$ tpm2_ptool init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">action: Created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@hermes:~$ tpm2_ptool addtoken </span><span class="token parameter variable" style="color:#36acaa">--pid</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--sopin</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1111</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--userpin</span><span class="token plain"> ziggy1 </span><span class="token parameter variable" style="color:#36acaa">--label</span><span class="token plain"> ziggy-tpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@hermes:~/ziti$ pkcs11-tool </span><span class="token parameter variable" style="color:#36acaa">--module</span><span class="token plain"> /usr/lib/x86_64-linux-gnu/pkcs11/libtpm2_pkcs11.so --list-slots</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARNING: Getting tokens from fapi backend failed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Available slots:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Slot </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: ziggy-tpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  token label        </span><span class="token builtin class-name">:</span><span class="token plain"> ziggy-tpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  token manufacturer </span><span class="token builtin class-name">:</span><span class="token plain"> Infineon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  token model        </span><span class="token builtin class-name">:</span><span class="token plain"> SLB9665</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  token flags        </span><span class="token builtin class-name">:</span><span class="token plain"> login required, rng, token initialized, PIN initialized</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hardware version   </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.16</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  firmware version   </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5.62</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serial num         </span><span class="token builtin class-name">:</span><span class="token plain"> 0000000000000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pin min/max        </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Slot </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  token state:   uninitialized</span><br></span></code></pre></div></div>
<p>Note: fapi backend warning can be <a href="https://github.com/tpm2-software/tpm2-pkcs11/issues/655#issuecomment-781500908" target="_blank" rel="noopener noreferrer">ignored</a>.</p>
<p>To enroll I need to get an enrollment token from my Ziti controller. Once I have that I can enroll. Let’s enroll with <code>ziti-edge-tunnel</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># enroll identity with ziti-edge-tunnel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@hermes:~$ ziti-edge-tunnel enroll </span><span class="token parameter variable" style="color:#36acaa">-j</span><span class="token plain"> ./ziggy.jwt </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> ziggy.json </span><span class="token parameter variable" style="color:#36acaa">-k</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'pkcs11:///usr/lib/x86_64-linux-gnu/pkcs11/libtpm2_pkcs11.so?label=ziggy-key&amp;pin=ziggy1'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1676722</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.000</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">    INFO ziti-sdk:utils.c:198 ziti_log_set_level</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> log level: </span><span class="token assign-left variable" style="color:#36acaa">root</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/INFO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1676722</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.000</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">    INFO ziti-sdk:utils.c:167 ziti_log_init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Ziti C SDK version </span><span class="token number" style="color:#36acaa">1.5</span><span class="token plain">.0 @ga39db85</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEAD</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> starting at </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2025</span><span class="token plain">-02-24T15:21:31.292</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1676722</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.000</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">    INFO ziti-sdk:ziti_enroll.c:112 ziti_enroll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Ziti C SDK version </span><span class="token number" style="color:#36acaa">1.5</span><span class="token plain">.0 @ga39db85</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HEAD</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> starting enrollment at </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2025</span><span class="token plain">-02-24T15:21:31.294</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1676722</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">0.000</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">    INFO ziti-sdk:ziti_enroll.c:221 start_enrollment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> pkcs11 key not found. trying to generate</span><br></span></code></pre></div></div>
<p>ZIti identity is stores in the JSON file -- <code>ziggy.json</code> in my case. Let take a look</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"ztAPI"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://&lt;my-controller-address&gt;:443"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"id"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"cert"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"-----BEGIN CERTIFICATE-----...."</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"key"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"pkcs11:///usr/lib/x86_64-linux-gnu/libtpm2_pkcs11.so?label=ziggy-key&amp;pin=ziggy1"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"ca"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"-----BEGIN CERTIFICATE-----...."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>As you can see the .id.key is referencing the private key stored in my laptop's TPM hardware. I can inspect it using <code>pkcs11-tool</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@hermes:~$ pkcs11-tool </span><span class="token parameter variable" style="color:#36acaa">--module</span><span class="token plain"> /usr/lib/x86_64-linux-gnu/pkcs11/libtpm2_pkcs11.so --list-objects </span><span class="token parameter variable" style="color:#36acaa">--pin</span><span class="token plain"> ziggy1          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> ↵</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Using slot </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> with a present token </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Public Key Object</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> EC  EC_POINT </span><span class="token number" style="color:#36acaa">384</span><span class="token plain"> bits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  EC_POINT:   04610442fa885e120e9c63227aa7c53aeb84a52400264f3452fcf4dc4dbf4ade9ca46e7e15c4d37cc7a317edd860887ccd5746eea70cdea1d106b36b59297ecb93d43c57f4e8aef7029fa55f52cd740292d8de92fbce35c7788d3cc00f528cac2d0e4d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  EC_PARAMS:  06052b81040022 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OID </span><span class="token number" style="color:#36acaa">1.3</span><span class="token plain">.132.0.34</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  label:      ziggy-key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ID:         dad9d0f20cc1d9ec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Usage:      encrypt, verify, wrap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Access:     </span><span class="token builtin class-name">local</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Private Key Object</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> EC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  label:      ziggy-key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ID:         dad9d0f20cc1d9ec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Usage:      decrypt, sign, unwrap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Access:     sensitive, always sensitive, never extractable, </span><span class="token builtin class-name">local</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Allowed mechanisms: ECDSA,ECDSA-SHA1,ECDSA-SHA256,ECDSA-SHA384,ECDSA-SHA512</span><br></span></code></pre></div></div>
<p>As you can see my TPM token <code>ziggy-tpm</code> now has two objects private, and public keys with same label and id. OpenZiti SDK will use that hardware key to provide identity.</p>
<p>Now I can start <code>ziti-edge-tunnel</code> with that identity:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@hermes:~$ sudo -E ziti-edge-tunnel run -i ziggy.json</span><br></span></code></pre></div></div>
<p>Note: <code>-E</code> flag is required since I initialized TPM token as user <code>ziggy</code> and there are some support files created in the user’s <code>$HOME</code> directory.</p>]]></content>
        <author>
            <name>Eugene Kobyakov</name>
            <uri>https://github.com/ekoby</uri>
        </author>
        <category label="Security" term="Security"/>
        <category label="Hardware" term="Hardware"/>
        <category label="Zero Trust" term="Zero Trust"/>
        <category label="HSM" term="HSM"/>
        <category label="TPM" term="TPM"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[zrok Custom Domains]]></title>
        <id>http://localhost:3000/docs/openziti/blog/zrok-custom-domains</id>
        <link href="http://localhost:3000/docs/openziti/blog/zrok-custom-domains"/>
        <updated>2025-02-12T20:17:23.000Z</updated>
        <summary type="html"><![CDATA[With the latest release of myzrok.io we are excited to announce the introduction of]]></summary>
        <content type="html"><![CDATA[<p>With the latest release of <a href="http://myzrok.io/" target="_blank" rel="noopener noreferrer">myzrok.io</a> we are excited to announce the introduction of
<a href="https://docs.zrok.io/docs/myzrok/custom-domains/" target="_blank" rel="noopener noreferrer">custom domains</a>!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tldr">TL;DR<a href="http://localhost:3000/docs/openziti/blog/zrok-custom-domains#tldr" class="hash-link" aria-label="Direct link to TL;DR" title="Direct link to TL;DR">​</a></h2>
<p>You can now use your own domain when creating <a href="https://zrok.io/" target="_blank" rel="noopener noreferrer">zrok</a> shares! With a zrok custom domain you’ll be able to create shares like <code>&lt;token&gt;.your.domain.com</code> instead of <code>&lt;token&gt;.share.zrok.io</code>. You’ll need to bring your own domain and have a <a href="http://myzrok.io/" target="_blank" rel="noopener noreferrer">myzrok.io</a> Pro plan to get started. Creating a zrok custom domain via myzrok will create a zrok frontend for you. This will allow you to create <a href="https://docs.zrok.io/docs/concepts/sharing-public/" target="_blank" rel="noopener noreferrer">ephemeral shares</a> or <a href="https://docs.zrok.io/docs/concepts/sharing-reserved/" target="_blank" rel="noopener noreferrer">reserved shares</a> using your domain name instead of zrok’s!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-myzrok">What is myzrok?<a href="http://localhost:3000/docs/openziti/blog/zrok-custom-domains#what-is-myzrok" class="hash-link" aria-label="Direct link to What is myzrok?" title="Direct link to What is myzrok?">​</a></h2>
<p><a href="http://myzrok.io/" target="_blank" rel="noopener noreferrer">myzrok</a> is the self-service billing portal for your zrok account. This is where you can upgrade your zrok to the different plans outlined on our <a href="https://zrok.io/pricing/" target="_blank" rel="noopener noreferrer">pricing page</a> to receive increased data, share, and environment limits based on your needs. This is also where you will now be able to create and manage custom domains if you have a Pro plan!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-custom-domains">Why Custom Domains?<a href="http://localhost:3000/docs/openziti/blog/zrok-custom-domains#why-custom-domains" class="hash-link" aria-label="Direct link to Why Custom Domains?" title="Direct link to Why Custom Domains?">​</a></h2>
<p>Up to this point, all <a href="https://zrok.io/" target="_blank" rel="noopener noreferrer">zrok</a> hosted shares have been created using the <code>share.zrok.io</code> domain. This is great when you want to get something hosted quickly and easily. However, there are situations where it would be really nice to host a share on your own domain to make it identifiably yours. This is where custom domains come into play.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-it-work">How Does it Work?<a href="http://localhost:3000/docs/openziti/blog/zrok-custom-domains#how-does-it-work" class="hash-link" aria-label="Direct link to How Does it Work?" title="Direct link to How Does it Work?">​</a></h2>
<p>You can set up your custom domain in just a few easy steps:</p>
<ol>
<li>
<p>Bring your own custom domain name</p>
</li>
<li>
<p>Create DNS records for certificate validation and traffic routing</p>
</li>
<li>
<p>Wait for zrok to validate your records and finalize configuration</p>
</li>
<li>
<p>Start sharing!</p>
</li>
</ol>
<p>You only need to do this once, after that you can create your shares like normal but utilize your domain instead of zrok’s!</p>
<p>Can’t wait to get started? Check out the step by step instructions in our <a href="https://docs.zrok.io/docs/myzrok/custom-domains/" target="_blank" rel="noopener noreferrer">guide here</a>!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="custom-domains-in-action">Custom Domains in Action<a href="http://localhost:3000/docs/openziti/blog/zrok-custom-domains#custom-domains-in-action" class="hash-link" aria-label="Direct link to Custom Domains in Action" title="Direct link to Custom Domains in Action">​</a></h2>
<p>Let’s take a look at how custom domains make zrok even more useful. Let’s say that I own a company <code>acme-corp</code> and I’ve got an upcoming convention I would really like to demo my latest software at. Rather than deploying to an environment, I could run my demo locally and use zrok to create a reverse proxy, which would allow others to access it. This works great, but by sharing my demo via a <code>zrok share</code> command, I would end up with a share link like <code>https://sjy8zgif4s8w.share.zrok.io/</code>. While this is nice and simple, the link generated doesn’t really identify my company, making it harder to leave a lasting impact. This is where a zrok custom domain comes in!</p>
<p>To do this I first create a zrok custom domain <code>demo.acme-corp.com</code> using the <code>acme-corp.com</code> domain.</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/20f27da7-7f4e-4f77-90da-eb3ec06b4cd8-b383fef8799b9fc762a78c3cdfacda42.png" width="1702" height="1014" class="img_ev3q"></p>
<p>Once the custom domain is created, I simply create a few DNS records for <code>acme-corp.com</code>. Within a few minutes I’m able to use the <code>demo.acme-corp.com</code> domain in my zrok shares!</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/54eb0324-fcfa-4fff-9ef4-afc54bd352c8-92e886e5d220794010f3da46d85793b3.png" width="810" height="458" class="img_ev3q"></p>
<p>By creating a custom domain, I have also created a <a href="https://docs.zrok.io/docs/guides/self-hosting/personalized-frontend/" target="_blank" rel="noopener noreferrer">zrok frontend</a>. This will create shares in the form of <code>&lt;token&gt;.demo.acme-corp.com</code>. This is much more identifiable to my company however, it still leaves me with the share token at the start of my share. I can improve this by creating a <a href="https://docs.zrok.io/docs/concepts/sharing-reserved/" target="_blank" rel="noopener noreferrer">reserved share</a>. This will reserve a unique identifier for me to use in place of my share token. Not only can I make my share even more branded towards my specific use case, but I can also start and stop it and still maintain the same link!</p>
<p>I’ll first set my frontend as the default for my environment, then I’ll create a reserved share for the resource I want to share. In this case it’s a demo app running on localhost:4000</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">zrok config </span><span class="token builtin class-name">set</span><span class="token plain"> defaultFrontend demo-acme-corp_YS6RyLSod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zrok configuration updated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zrok reserve public --unique-name </span><span class="token string" style="color:#e3116c">"summit"</span><span class="token plain"> http://localhost:4000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">0.388</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">    INFO main.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*reserveCommand</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.run: your reserved share token is </span><span class="token string" style="color:#e3116c">'summit'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">0.388</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">    INFO main.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*reserveCommand</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.run: reserved frontend endpoint: https://summit.demo.acme-corp.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zrok share reserved </span><span class="token string" style="color:#e3116c">"summit"</span><br></span></code></pre></div></div>
<p>I can then have people visit <code>summit.demo.acme-corp.com</code> to check my demo</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/d9f16273-9aa1-4d66-bbce-eb4f744a36f2-4c9d1d2c17da0d130f14d59b642233ea.png" width="1915" height="1028" class="img_ev3q"></p>
<p>Success!</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/6c6c4029-af97-4ece-9f7a-d95d4fab185e-d7abe8491aa98dccc3dbdf24fd600f2d.png" width="999" height="288" class="img_ev3q"></p>
<p>This is a relatively simple example of how custom domains can be used to enhance your zrok experience. There are many times where I might want to share something a bit more permanent than a demo, such as a production app. This is where I could take advantage of <a href="https://docs.zrok.io/docs/guides/frontdoor/" target="_blank" rel="noopener noreferrer">zrok frontdoor</a> alongside my custom domain. A zrok frontdoor would allow me to run zrok alongside my production app, enabling me to publicly expose access to it via a reserved share!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="wrapping-up">Wrapping Up<a href="http://localhost:3000/docs/openziti/blog/zrok-custom-domains#wrapping-up" class="hash-link" aria-label="Direct link to Wrapping Up" title="Direct link to Wrapping Up">​</a></h2>
<p>If you’re ready to dive in and create your own custom domain head over to <a href="http://myzrok.io/" target="_blank" rel="noopener noreferrer">myzrok.io</a>, sign up for a Pro plan and navigate to the custom domains page ( icon). For a more in-depth look at how to setup a custom domain you can <a href="https://docs.zrok.io/docs/myzrok/custom-domains/" target="_blank" rel="noopener noreferrer">check out the guide here</a>.</p>
<p>If you find this interesting and like what we’re doing, <a href="https://github.com/openziti/zrok" target="_blank" rel="noopener noreferrer">consider starring the project on GitHub</a>! zrok is open source and built on <a href="https://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer">OpenZiti</a>, which is another great project to check out and star if you haven’t done so already!</p>
<p>If you want to show us how zrok or ziti have been improving your workflow or have feedback you’d like to share with the team we’d love to hear from you over at&nbsp; <a href="https://twitter.com/openziti" target="_blank" rel="noopener noreferrer">X</a>, <a href="https://www.reddit.com/r/openziti/" target="_blank" rel="noopener noreferrer">reddit</a>, or at our <a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer">Discourse</a>!</p>]]></content>
        <author>
            <name>Nick Pieros</name>
            <uri>https://github.com/nf-npieros</uri>
        </author>
        <category label="DNS" term="DNS"/>
        <category label="zrok" term="zrok"/>
        <category label="myzrok" term="myzrok"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Golang Aha! Moments: OOP]]></title>
        <id>http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop</id>
        <link href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop"/>
        <updated>2024-11-01T14:05:06.000Z</updated>
        <summary type="html"><![CDATA[Moving to Go as my primary development language was a surprisingly easy transition. Coming from a language with strong OOP roots, like Java, I quickly found many analogs for the OOP constructs I was used to, but also had to adjust my thinking.]]></summary>
        <content type="html"><![CDATA[<p>Moving to Go as my primary development language was a surprisingly easy transition. Coming from a language with strong OOP roots, like Java, I quickly found many analogs for the OOP constructs I was used to, but also had to adjust my thinking.</p>
<p>This article walks through some of Go’s object oriented features and also discusses how some patterns common in other languages can be written in a way that’s closer to idiomatic Go. It also covers some features of Go that surprised and (in some cases) delighted me.</p>
<p>Go allows you to group data into structs, and to associate logic to those structs.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Beans </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Count </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">beans </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Beans</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Spill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    beans</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> beans</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Count </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"spilled %d beans\n"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Since Go supports these simple features, it meets certain bare-minimum standard for object oriented coding.</p>
<p>However, as we’ll cover below, many features like inheritance, method overriding, and abstract types work differently or not at all.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="inheritance-vs-composition">Inheritance vs Composition<a href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop#inheritance-vs-composition" class="hash-link" aria-label="Direct link to Inheritance vs Composition" title="Direct link to Inheritance vs Composition">​</a></h3>
<p>Even in languages with a strong object oriented bias, people often give the advice to favor composition over inheritance. Large complicated type hierarchies can lead to fragile designs and unexpected behavior.</p>
<p>Go is strongly biased towards composition. This, in my experience, leads to cleaner, simpler designs, that are easier to refactor and have less surprising behavior.</p>
<p><strong>Note:</strong> Most of the patterns explored below aren’t exclusive to Go. Go just encourages them more than other languages may.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fun-with-functions-nil-receivers">Fun with functions: Nil Receivers<a href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop#fun-with-functions-nil-receivers" class="hash-link" aria-label="Direct link to Fun with functions: Nil Receivers" title="Direct link to Fun with functions: Nil Receivers">​</a></h3>
<p>One difference from languages like Java, is that a nil receiver is allowed and can be handled in Go code. This is the equivalent of being able to call a method on a <code>null</code> object in Java without a <code>NullPointerException</code> and have the method check if <code>this</code> is null.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Beans </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Count </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">beans </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Beans</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Spill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> beans </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"you've got no beans to spill!\n"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beans</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> beans</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Count </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"spilled %d beans\n"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h1>What do we want to do?</h1>
<p>Rather than just look at language features, we’re going to look at what we’re trying to accomplish. Then we can see how to achieve our goals in Go, and how that might be different than a pure object-oriented approach.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="handle-different-types-with-a-common-set-of-methods">Handle different types with a common set of methods<a href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop#handle-different-types-with-a-common-set-of-methods" class="hash-link" aria-label="Direct link to Handle different types with a common set of methods" title="Direct link to Handle different types with a common set of methods">​</a></h2>
<p>For polymorphic types, Go uses interfaces.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Spillable </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Spill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Beans </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Count </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">beans </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Beans</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Spill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    beans</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> beans</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Count </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"spilled %d beans\n"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Tea </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Volume </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Tea</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Spill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Volume </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Volume </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"spilled %d ml of tea\n"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>You may have noticed that the types don’t have to declare that they are <code>Spillable</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="duck-ish-typing">Duck(-ish) Typing<a href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop#duck-ish-typing" class="hash-link" aria-label="Direct link to Duck(-ish) Typing" title="Direct link to Duck(-ish) Typing">​</a></h3>
<p>Unlike many other languages, Go types do not have to explicitly state which interfaces they implement. If the type has the correct methods, it can be used as that interface type.</p>
<p>I’m not sure if it’s accurate to call this duck typing, since you still need to define interfaces. But from where I’m standing, it looks a lot like duck typing and sounds like duck typing, so I’m going to call it duck typing.</p>
<p>This focuses the attention on where the interface is used, not where it’s implemented. In cases where a type is used in multiple contexts, Go pushes you towards multiple interfaces, one for each context. In other languages, I’ve seen types end up with one massive interface, covering all the possible contexts where it might be needed.</p>
<p>Consider an HR application. It might have various entities</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> employees</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Employee </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// has name, email, address, salary, etc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> vendors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Vendor </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// has company name, email, address</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>You might have a couple of modules, one for sending out email notifications and another for payroll.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> emailer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Contact </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">Email</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">Name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SendEmail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">contact Contact</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> subj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> body </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> payroll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Payee </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">HomeAddress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Salary</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">float32</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SendPaychecks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payee Payee</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Note that the payroll and email packages don’t know anything about the employee and vendor packages.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="package-coherency">Package Coherency<a href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop#package-coherency" class="hash-link" aria-label="Direct link to Package Coherency" title="Direct link to Package Coherency">​</a></h3>
<p>Go encourages keeping interfaces in the package where they are consumed. Let’s try adding an <code>Email</code> method to <code>Employee</code>.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">emp</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> Employee</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Email</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">string</span><span class="token plain"> subj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> body</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> email</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Email</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">emp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EmailAddress</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> subj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> body</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>If the <code>Contact</code> interface was defined in the <code>employee</code> package, we’d end up with a circular package dependency error. If the <code>emailer</code> package didn’t have a <code>Contact</code> interface, and was able to take <code>Employee</code> instances directly, that would also cause a circular package dependency error.</p>
<p>I found circular package dependency errors to be very frustrating when I first started with Go. Now however, having gotten more comfortable with Go style interfaces, I’ve realized the following:</p>
<ol>
<li>
<p>It’s OK to have smaller, highly specific interfaces per package. There may be some overlap, but each package will end up with exactly what’s needed. This makes the use clearer for developers using the package.</p>
</li>
<li>
<p>Having the interfaces in the package will also decouple the package from other packages, eliminating circular dependency issues.</p>
</li>
</ol>
<p>I’m still occasionally annoyed by circular dependency errors, but overall feel that the limitation promotes package decoupling and coherency.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="requiring-type-interface-conformance">Requiring Type Interface Conformance<a href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop#requiring-type-interface-conformance" class="hash-link" aria-label="Direct link to Requiring Type Interface Conformance" title="Direct link to Requiring Type Interface Conformance">​</a></h3>
<p>In most cases, if your type doesn’t match up with your interface, you’ll get a compile error. In some cases, where you may be doing runtime checks before converting, you might not notice that your type no longer fits the interface.</p>
<p>If you wish to guarantee at compile time that a specific type implements a given interface, you can do this as follows:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> Spillable </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Tea</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fun-with-functions-function-vs-interface">Fun with functions: Function Vs Interface<a href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop#fun-with-functions-function-vs-interface" class="hash-link" aria-label="Direct link to Fun with functions: Function Vs Interface" title="Direct link to Fun with functions: Function Vs Interface">​</a></h3>
<p>Sometimes you may have an API that only requires a single method. Something like:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> MessageHandler </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Handle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> MessageHandlers </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">AddHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msgType </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handler MessageHandler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>This could also be implemented using a function type.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> MessageHandler </span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> MessageHandlers </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">AddHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msgType </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handler MessageHandler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Which to use? For some library consumers a function may be more convenient. For others, an interface to implement would be better. Fortunately Go lets you handle both. In Go a function type can have methods defined on it.</p>
<p>This broke my brain slightly when I first encountered it, but it works well to allow both kinds of API.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> MessageHandler </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Handle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> MessageHandlerF </span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f MessageHandlerF</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Handle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">f</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// example use</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">handlers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">MessageHandlerF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="extending-interfaces">Extending Interfaces<a href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop#extending-interfaces" class="hash-link" aria-label="Direct link to Extending Interfaces" title="Direct link to Extending Interfaces">​</a></h3>
<p>Go interfaces can extend other interfaces. The classic examples are the types in the <code>io</code> package.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Closer </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Reader </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">byte</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ReadCloser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Closer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Reader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Older versions of Go used to complain if you extended multiple interfaces that had overlapping method signatures. Recent versions of Go no longer have this limitation, as long as method signatures with the same name match exactly.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="anonymous-interfaces">Anonymous Interfaces<a href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop#anonymous-interfaces" class="hash-link" aria-label="Direct link to Anonymous Interfaces" title="Direct link to Anonymous Interfaces">​</a></h3>
<p>There may be times when you want to invoke a method on a variable, but the method isn’t on the interface you’ve got. You can use an anonymous interface to check if the method exists, and if it does, invoke it.</p>
<p>I’m not sure there’s ever a strong reason to use an anonymous interface over declaring a named interface. I’ve used this feature when an interface was only used in a single method.</p>
<p>In this example we’re looking for a non-standard close method.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CloseIt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v any</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> closeable</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ok </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">interface</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CloseMe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> ok </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> closeable</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">CloseMe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="we-want-to-share-functionality-across-types">We Want to Share Functionality Across Types<a href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop#we-want-to-share-functionality-across-types" class="hash-link" aria-label="Direct link to We Want to Share Functionality Across Types" title="Direct link to We Want to Share Functionality Across Types">​</a></h2>
<p>In object-oriented languages, extending a type (or sometimes multiple types) to create a new type is very common. Go does not allow structs to extend other structs in exactly the same way as most object oriented languages.</p>
<p>What it does offer is type composition that can look something like inheritance. We’ll look at how it works, and the potential pitfalls from this approach.</p>
<p>Go allows embedding both structs and interfaces.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Knocker </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Knock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Door </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lock sync</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Mutex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    knocker Knocker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>The Door type has a lock and knocker. As they are, they are just struct members. Since they are private, they won’t be accessible outside the package. If you try to <code>Lock</code> the door or <code>Knock</code> at the door, the compiler will complain.</p>
<p>A door isn’t a lock or a knocker, it has a lock and and a knocker. However, it still makes sense to be able to Lock or Knock the door itself. We can do that as follows.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Knocker </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Knock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Door </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sync</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Mutex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Knocker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>When we embed types in our struct this way, the methods and fields of the embedded types become accessible at the top-level of the struct. The embedded types can still be referenced individually using the type name.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">door </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">Door</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Knocker </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">BrassKnocker</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">door</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Mutex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Lock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">door</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Unlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">door</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Knocker</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Knock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">door</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Knock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Note that we could also embed a pointer type.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Door </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sync</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Mutex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Knocker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="method-overriding-vs-method-shadowing">Method Overriding vs Method Shadowing<a href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop#method-overriding-vs-method-shadowing" class="hash-link" aria-label="Direct link to Method Overriding vs Method Shadowing" title="Direct link to Method Overriding vs Method Shadowing">​</a></h3>
<p>Methods from embedded types can’t be overridden, in an OO sense, but they can be shadowed. Here’s an example to highlight the difference.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> A </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">String</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"A"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> B </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">B</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">" or B"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> main </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">B</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// output: "A"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">String</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// output: "A"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// output: "A or B"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">String</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// output: "A"      &lt;-- Maybe unexpected</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Because <code>A</code> doesn’t know that it’s embedded by <code>B</code>, it won’t call <code>B</code>'s versions of methods that have been overridden. As long as you use type embedding with a composition mindset instead of an inheritance mindset, you should be OK.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="i-want-abstract-types">I Want Abstract Types!<a href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop#i-want-abstract-types" class="hash-link" aria-label="Direct link to I Want Abstract Types!" title="Direct link to I Want Abstract Types!">​</a></h3>
<p>Abstract types can be a very useful way of providing some base functionality that relies on methods to be supplied by a sub-type. When I first started using Go, I was generally happy and productive with the language. Two things I missed from Java were generics and abstract data types. Generics have since come to <a href="https://go.dev/blog/intro-generics" target="_blank" rel="noopener noreferrer">Go in version 1.18</a>, and I’ve since learned patterns better suited to Go to replace abstract data types.</p>
<p>Here’s a java example of an abstract data type:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">abstract</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">AbstractDataStore</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">T</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">abstract</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token plain"> </span><span class="token class-name">LoadEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Row</span><span class="token plain"> r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">T</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token class-name">ListEntities</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Database</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token class-name">Cursor</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name namespace" style="opacity:0.7">db</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name">ExecuteQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">T</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">T</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name namespace" style="opacity:0.7">c</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name">HasNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token class-name">Row</span><span class="token plain"> row </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name namespace" style="opacity:0.7">c</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name">Next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token class-name">T</span><span class="token plain"> entity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name namespace" style="opacity:0.7">this</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name">LoadEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">row</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token class-name namespace" style="opacity:0.7">result</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name">Add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">entity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>We’ve got a data store that’s got some generic functionality to iterate over database results and build an entity list. Each concrete implementation would manage the details specific to that entity type.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-wrong-way">The Wrong Way<a href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop#the-wrong-way" class="hash-link" aria-label="Direct link to The Wrong Way" title="Direct link to The Wrong Way">​</a></h3>
<p>The first time I tried modeling something like this in Go, I came up with a pattern similar to abstract types, but significantly worse because the underlying abstractions weren’t there to support it.</p>
<p>The idea was that if you defined the full API as an interface, the abstract type could keep a reference to the concrete type, and call it as necessary.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> DataStore</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T any</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">LoadEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Row</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">ListEntities</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db Database</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> query </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> BaseStore</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T any</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    impl DataStore</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">store </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">BaseStore</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ListEntities</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db Database</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> query </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">T </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cursor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ExecuteQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> result </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> cursor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">HasNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        row </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> cursor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        entity </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">impl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LoadEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> entity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>While this does work, it has a downside. If you treat it as an actual abstract type and try to override any of the base methods in the embedding type, they will only be shadowed. If you then ever forget to call the concrete version on the embedded <code>impl</code>, you’ll get the default version. This kind of bug can be easy to miss and hard to track down.</p>
<p>Subjectively, it also doesn’t feel right. It feels like we’re working against the language, rather than with it.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-better-way">A Better Way<a href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop#a-better-way" class="hash-link" aria-label="Direct link to A Better Way" title="Direct link to A Better Way">​</a></h3>
<p>The solution above is not that far off from something that feels more in line with Go’s ethos.</p>
<p>What is it we’re trying to accomplish? We’ve got a core set of functionality that needs to delegate some logic. There’s another pattern that fits this description:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="strategies">Strategies<a href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop#strategies" class="hash-link" aria-label="Direct link to Strategies" title="Direct link to Strategies">​</a></h4>
<p>Instead of trying to implement abstract types, we can use strategies. Let’s look at what a strategy oriented version of the above code would look like:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> EntityLoader</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T any</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">LoadEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Row</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Store</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T any</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entityLoader EntityLoader</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">store </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Store</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ListEntities</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db Database</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> query </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">T </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cursor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ExecuteQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> result </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> cursor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">HasNext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        row </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> cursor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        entity </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">entityLoader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LoadEntity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> entity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>It looks very similar, but the intent is different. This is a composition-oriented approach. Rather than extending a BaseStore, then overriding pieces, we compose the various strategies we might need.</p>
<p>This approach also lends itself to sharing functionality in a clean way. You might have three or four different strategies. Some of them might have default implementations that are rarely replaced. Some might have only a small set of implementations that are used across many instances. Some might be different for every instance.</p>
<p>Rather than trying to shape these as overrides in a convoluted type hierarchy, each instance can mix and match as needed.</p>
<h1>Conclusion</h1>
<p>Every language has some inbuilt preferences. If you’re coming from a heavily object-oriented language, it can take time to adapt how you design your data types in Go. However, I think Go pushes you towards code that is less fragile and cleaner. If I were to write Java code again, it would be positively influenced by the habits I’ve picked up from Go.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="about-openziti">About OpenZiti<a href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-oop#about-openziti" class="hash-link" aria-label="Direct link to About OpenZiti" title="Direct link to About OpenZiti">​</a></h2>
<p><a href="http://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer">OpenZiti</a> is an open-source platform for providing secure and reliable access to network applications. It does this using strong, certificate-based identities, end-to-end encryption, mesh networking, policy-based access control, and app-embedded SDKs. If you find this interesting, please consider <a href="https://github.com/openziti/ziti/" target="_blank" rel="noopener noreferrer"><strong>starring us on GitHub</strong></a>. It helps to support the project! And if you haven't seen it yet, check out <a href="https://zrok.io/" target="_blank" rel="noopener noreferrer"><strong>zrok.io</strong></a>. It's a free sharing platform built on OpenZiti! It uses the OpenZiti Go SDK since it's a ziti-native application. It's also <a href="https://github.com/openziti/zrok/" target="_blank" rel="noopener noreferrer"><strong>all open source too!</strong></a></p>
<p>Tell us how you're using OpenZiti on <a href="https://twitter.com/openziti" target="_blank" rel="noopener noreferrer"><strong>X</strong></a><strong><s>Twitter</s></strong>, <a href="https://www.reddit.com/r/openziti/" target="_blank" rel="noopener noreferrer"><strong>Reddit</strong></a>, or over at our <a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer"><strong>Discourse</strong></a>. Or you can check out <a href="https://youtube.com/openziti" target="_blank" rel="noopener noreferrer"><strong>our content on YouTube</strong></a> if that's more your speed. Regardless of how, we'd love to hear from you.</p>]]></content>
        <author>
            <name>Paul Lorenz</name>
            <uri>https://github.com/plorenz</uri>
        </author>
        <category label="golang" term="golang"/>
        <category label="Java" term="Java"/>
        <category label="Object Oriented Programming" term="Object Oriented Programming"/>
        <category label="golang-aha" term="golang-aha"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[The safest way to make Portainer Internet accessible]]></title>
        <id>http://localhost:3000/docs/openziti/blog/the-safest-way-to-make-portainer-internet-accessible</id>
        <link href="http://localhost:3000/docs/openziti/blog/the-safest-way-to-make-portainer-internet-accessible"/>
        <updated>2024-10-03T16:15:23.000Z</updated>
        <summary type="html"><![CDATA[If you run Portainer, and you seek a modern, flexible recipe for how to make it secure while also providing flexible]]></summary>
        <content type="html"><![CDATA[<p>If you run Portainer, and you seek a modern, flexible recipe for how to make it secure while also providing flexible
access to your authorized users, this article is for you.</p>
<p>A question that sometimes gets asked is: <em>What types of companies, self-hosters, or general use cases, will gain the greatest benefit from using</em> <a href="http://localhost:3000/docs/openziti/blog/introducing-openziti-browzer"><em>OpenZiti BrowZer</em></a>?</p>
<p>To help answer the “<em>who benefits</em>” question, much like I did in a <a href="http://localhost:3000/docs/openziti/blog/effortless-docker-management-with-private-web-access">previous article</a>, this article will frame the answer in the context of a web application named <a href="https://www.portainer.io/" target="_blank" rel="noopener noreferrer">Portainer</a> (a web-accessible container management platform) when it needs to be internet-facing.</p>
<p><code>NOTE: Upcoming articles will describe how similar techniques employing BrowZer can be used to protect and secure other popular web applications. So be sure to subscribe to this blog to be notified when those articles are published.</code></p>
<p>Portainer can be used to manage Docker, Kubernetes, and other container environments. It is primarily a web-based management interface, designed to be accessed via a browser. The web-based approach provides convenient access and centralized management, allowing users to interact with their container infrastructure …<em><strong>from anywhere</strong></em>.</p>
<p>Companies benefiting from Portainer include teams with limited in-house container management expertise, those with rapid deployment requirements, those having resource constraints/constrained IT budgets, or teams with members of varying skills, technical and non-technical. It also benefits those with a security and compliance focus.</p>
<p>Hobbyists and IT enthusiasts can also benefit from Portainer to manage containerized services for personal projects, home automation, media servers, and more.</p>
<p>Need to check on something in your docker fleet… while you are standing in line at the coffee shop? Just open a browser on your phone, and surf to your Portainer instance. Easy. Convenient. Powerful.</p>
<p>However…as the old saying goes: <em>Don’t run with scissors</em>.</p>
<p>Portainer is an exceptionally privileged piece of software, and it has near root-level access to your Container infrastructure, so you had better make sure your Portainer instance is safe from malicious actors.</p>
<h1>How to secure Portainer (without BrowZer)</h1>
<p>Getting Portainer up and running is very straightforward using their standard deployment scripts.</p>
<p>When I decided to kick the tires, I used the following code in a <code>docker compose</code> file:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">portainer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> portainer/portainer</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ce</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">2.21.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">stopped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"8000:8000"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"8080:9000"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /var/run/docker.sock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/run/docker.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./portainer_data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/data</span><br></span></code></pre></div></div>
<p>But when you've decided to allow access to Portainer from the public internet, things require more work.</p>
<p>Various <a href="https://www.portainer.io/blog/how-to-correctly-secure-portainer-when-presented-on-the-internet" target="_blank" rel="noopener noreferrer">writeups</a> have been <a href="https://www.portainer.io/blog/how-to-secure-your-portainer-installation" target="_blank" rel="noopener noreferrer">published</a> by the friendly folks on the Portainer team to provide advice on how to secure Portainer. While not wrong, the instructions are (in my opinion) inflexible and antiquated.</p>
<p>They mention <code>port forwarding</code> the Portainer UI ports (http:9000/https:9443) from a public IP to Portainer.</p>
<blockquote>
<p>This implies you must open some ports to the internet. Having ports open to the internet is something we on the <a href="https://openziti.io/" target="_blank" rel="noopener noreferrer">OpenZiti project</a>, as well as all zero-trust advocates in general, will advise against.</p>
</blockquote>
<p>They strongly recommend network ACLs on your firewall, so you only allow access from known trusted IP addresses.</p>
<blockquote>
<p>This is painful and tedious to set up correctly. It is technically out of reach for many. And, it is also incredibly brittle and inflexible (recall my coffee shop reference — this use case would be precluded in this scenario).</p>
</blockquote>
<p>They even question if you want to expose it to the internet directly at all, and instead, suggest you set up a VPN.</p>
<blockquote>
<p>VPN deployment and configuration is a non-starter for many because of complexity, and inflexibility.</p>
</blockquote>
<p>They assert that Portainer's internal authentication system should <strong>never</strong> be used when presenting Portainer to the internet, but instead you should configure an authentication system to use a suitably secure external mechanism, such as "LDAP" or "OAuth" (the latter of which supports 2FA/MFA).</p>
<blockquote>
<p>Again, this is getting to be a heavy lift for many teams.</p>
</blockquote>
<p>Understandably, they suggest you force/enable the <strong>HTTPS only</strong> option, and upload your own x509 certificates.</p>
<blockquote>
<p>Many would have given up before this :(</p>
</blockquote>
<h1>How to secure Portainer (with BrowZer)</h1>
<p>A better topology is one where Portainer resides in a <a href="https://en.wikipedia.org/wiki/Virtual_private_cloud" target="_blank" rel="noopener noreferrer"><strong>VPC</strong></a>, and the host has NO ports open to the internet. In this kind of deployment, Portainer will be completely invisible to the internet.</p>
<p>I hear you thinking: <em>How do I access Portainer over the web if it’s invisible</em>?</p>
<p>The answer is via a zero-trust overlay network that requires authentication before you (or anyone) can connect to it.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-easily-deploy-a-zero-trust-overlay-network">How to Easily Deploy a Zero-Trust Overlay Network<a href="http://localhost:3000/docs/openziti/blog/the-safest-way-to-make-portainer-internet-accessible#how-to-easily-deploy-a-zero-trust-overlay-network" class="hash-link" aria-label="Direct link to How to Easily Deploy a Zero-Trust Overlay Network" title="Direct link to How to Easily Deploy a Zero-Trust Overlay Network">​</a></h3>
<p>The component that implements the zero-trust overlay network solution is OpenZiti.</p>
<p><a href="https://openziti.io/" target="_blank" rel="noopener noreferrer"><strong>OpenZiti</strong></a> is an open-source project that brings zero-trust networking principles directly into any application. The project provides all the pieces required to implement a zero-trust overlay network and provides all the tools necessary to integrate zero trust into your existing solutions.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="browzer">BrowZer<a href="http://localhost:3000/docs/openziti/blog/the-safest-way-to-make-portainer-internet-accessible#browzer" class="hash-link" aria-label="Direct link to BrowZer" title="Direct link to BrowZer">​</a></h3>
<p>The next component involved in the solution is <code>BrowZer</code>.</p>
<p>The <code>Z</code> in this component's name (within the word normally spelled "<em>browser</em>") is not a typo. It is a purposeful indication that this solution, unique in today's technology offerings for securing browser-based applications, is built as part of the <a href="https://github.com/openziti/" target="_blank" rel="noopener noreferrer"><strong>OpenZiti project</strong></a>.</p>
<p>BrowZer enables you and your organization, enterprises, and self-hosting enthusiasts alike, in the cloud or at home, to operate private-to-the-internet web applications while still easily providing secure access for your authorized internet-based remote users.</p>
<p>I previously published a lengthy article that introduced the <a href="http://localhost:3000/docs/openziti/blog/introducing-openziti-browzer"><strong>concept of browZer</strong></a>. I recommend giving it a read.</p>
<p>There is a vast amount of documentation, as well as <a href="https://openziti.io/docs/learn/quickstarts/browzer/example/" target="_blank" rel="noopener noreferrer"><strong>quick starts for BrowZer</strong></a>, on the OpenZiti site.</p>
<p>There is also some related ZitiTV content:</p>
<p></p><article class="yt-lite" data-title="YouTube video" style="background-image:url(https://i.ytimg.com/vi/ZPkOQbVEnW0/hqdefault.jpg);--aspect-ratio:56.25%"><button type="button" class="lty-playbtn" aria-label="Watch YouTube video"></button></article><p></p>
<p>NOTE: If you like what you read about OpenZiti, or what you saw in the above ZitiTV episode, but prefer not to self-host it yourself, <a href="https://netfoundry.io/" target="_blank" rel="noopener noreferrer"><strong>we</strong></a> also offer a <a href="https://netfoundry.io/" target="_blank" rel="noopener noreferrer">zero-trust networking platform</a>. If that interests you, <a href="https://netfoundry.io/lets-talk/" target="_blank" rel="noopener noreferrer"><strong>reach out to us for more discussion.</strong></a></p>
<p>Here is a diagram that describes at a high level how browZer operates:</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/3fa80598-cf57-48f0-9fe3-c3dae201a33d-b766467ab182e4796ada1778401c1dd8.png" width="1264" height="754" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-of-accessing-portainer-over-browzer">Example of Accessing Portainer over BrowZer<a href="http://localhost:3000/docs/openziti/blog/the-safest-way-to-make-portainer-internet-accessible#example-of-accessing-portainer-over-browzer" class="hash-link" aria-label="Direct link to Example of Accessing Portainer over BrowZer" title="Direct link to Example of Accessing Portainer over BrowZer">​</a></h3>
<p>Here is what a user would experience using browZer to access a private-to-the-internet instance of Portainer:</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/4b5e5d9a-5a4f-461a-8bb7-cfe4232d091a-0314da7029f23928c5f2c9a83fc8d901.gif" width="1211" height="940" class="img_ev3q"></p>
<p>Here's what happens above:</p>
<ul>
<li>
<p>Brave web browser hits the public URL representing the protected instance of Portainer. This is where the BrowZer Bootstrapper runs.</p>
</li>
<li>
<p>The BrowZer runtime is loaded into Brave by the BrowZer Bootstrapper</p>
</li>
<li>
<p>Brave is redirected by BrowZer runtime to Auth0, then federated to Google (with 2FA) for authentication</p>
</li>
<li>
<p>Using the OIDC auth token received from Auth0, the BrowZer runtime then (transparently) authenticates onto the Ziti overlay network and then bootstraps the necessary x509 certs into the Brave tab, and the BrowZer runtime then loads the Portainer web app over the <a href="https://en.wikipedia.org/wiki/Mutual_authentication#mTLS" target="_blank" rel="noopener noreferrer">mTLS</a>-based zero-trust overlay network from the Portainer server which is invisible to the internet.</p>
</li>
<li>
<p>User is presented with Portainer login screen, and user authenticates using Portainer’s internal authentication system (no need to integrate or setup an external "LDAP" or "OAuth" system)</p>
</li>
<li>
<p>User clicks on BrowZer button, looks at various BrowZer settings, HTTP throughput chart, BrowZer changelog, BrowZer feedback form, etc</p>
</li>
<li>
<p>User is presented with Portainer GUI welcome screen showing that 2 Containers are running (one is Portainer, the other is an instance of the BrowZer Bootstrapper for a staging environment)</p>
</li>
<li>
<p>User clicks around, looks at logs for a running container, also removes an old Docker image, and then logs out</p>
</li>
</ul>
<h1>The BrowZer Difference</h1>
<p>In the above section, we discussed how difficult it can be to properly secure Portainer using “<em>traditional techniques</em>”.</p>
<p>BrowZer uses more modern, game-changing techniques that can not only properly secure your Portainer, but do it more easily, more flexibly, and more thoroughly.</p>
<p>With BrowZer there is:</p>
<ul>
<li>
<p>no need to expose Portainer ports to the internet or mess around with port forwarding.</p>
</li>
<li>
<p>no need to fuss with network ACLs on your firewall, or only allow access from statically configured IP addresses.</p>
</li>
<li>
<p>no need to install VPN software on clients.</p>
</li>
<li>
<p>remote access from ANY device that has a browser.</p>
</li>
<li>
<p>remote access from ANY location on the internet.</p>
</li>
<li>
<p>no need to alter Portainer AT ALL (use it off the shelf).</p>
</li>
<li>
<p>retained ability to use Portainer’s built-in auth system.</p>
</li>
<li>
<p>2FA/MFA for free (use whatever IdP you want)</p>
</li>
<li>
<p>not only is there HTTPS/TLS, but also automatic mTLS, and even end-to-end XChaCha20-Poly1305 encryption <em><strong>before</strong></em> data hits the mTLS wire.</p>
</li>
</ul>
<h1><strong>Wrap up</strong></h1>
<p>Do you host a web app (like Portainer) and want to be invisible to malicious intruders?</p>
<p>Do you want your users to have easy access from anywhere with no additional software on their client devices?</p>
<p>Do you want to do all this without making any modifications to the web app?</p>
<p>If so, then we hope you'll <a href="https://netfoundry.io/lets-talk/" target="_blank" rel="noopener noreferrer"><strong>reach out for a conversation</strong></a> about BrowZer.</p>]]></content>
        <author>
            <name>Curt Tudor</name>
            <uri>https://github.com/rentallect</uri>
        </author>
        <category label="Security" term="Security"/>
        <category label="Web Security" term="Web Security"/>
        <category label="Portainer" term="Portainer"/>
        <category label="Zero Trust" term="Zero Trust"/>
        <category label="Ziti" term="Ziti"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Multifactor Zero Trust ssh]]></title>
        <id>http://localhost:3000/docs/openziti/blog/multifactor-zero-trust-ssh</id>
        <link href="http://localhost:3000/docs/openziti/blog/multifactor-zero-trust-ssh"/>
        <updated>2024-09-09T00:10:41.000Z</updated>
        <summary type="html"><![CDATA[The previous post revisited the zssh project and demonstrated how to implement a simple ssh client using the extended modules provided by the Golang project. It also modified that simple program and showed what it takes to incorporate OpenZiti, creating a zero trust ssh client. This post focuses on another aspect of zssh and OpenZiti: multi-factor authentication.]]></summary>
        <content type="html"><![CDATA[<p><a href="http://localhost:3000/docs/openziti/blog/zero-trust-sshclient">The previous post</a> revisited the <code>zssh</code> project and demonstrated how to implement a simple ssh client using the extended modules provided by the Golang project. It also modified that simple program and showed what it takes to incorporate OpenZiti, creating a zero trust ssh client. This post focuses on another aspect of <code>zssh</code> and OpenZiti: multi-factor authentication.</p>
<p><a href="https://openziti.io/docs/learn/introduction/" target="_blank" rel="noopener noreferrer">OpenZiti</a> has a powerful and flexible authentication system. It allows an OpenZiti overlay network operator to decide what authentication mechanisms any given identity must satisfy before being authenticated to the overlay network. OpenZiti is a zero trust overlay network; authentication is only half of the equation. Once authenticated, identities still require authorization before accessing services secured by the overlay following the zero trust pillar of "least privilege".</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="certificate-based-authentication">Certificate-based Authentication<a href="http://localhost:3000/docs/openziti/blog/multifactor-zero-trust-ssh#certificate-based-authentication" class="hash-link" aria-label="Direct link to Certificate-based Authentication" title="Direct link to Certificate-based Authentication">​</a></h2>
<p>Perhaps the most common type of authentication, OpenZiti supports authentication to the the OpenZiti overlay network using certificates. It might not be obvious, but a <code>zssh</code> user using an <a href="https://openziti.io/docs/learn/core-concepts/identities/enrolling/" target="_blank" rel="noopener noreferrer">enrolled an OpenZiti identity</a> to authenticate to the overlay network <strong>is already implicitly</strong> using multi-factor authentication. The first authentication factor is OpenZiti itself. OpenZiti requires connections to be both authenticated and authorized before being allowed to connect to the target service. Once authenticated and authorized, <code>zssh</code> can connect to <code>sshd</code> and attempt to authenticate. Just by using <code>zssh</code>, users are protected with two factors of authentication but <code>zssh</code> (and OpenZiti) offers other factors of authentication as well.</p>
<p>When <a href="https://openziti.io/docs/learn/core-concepts/identities/enrolling/" target="_blank" rel="noopener noreferrer">enrolling an identity</a>, the output of the enrollment flow will be an OpenZiti identity file containing a certificate, key, and CA bundle. This identity can then be used to authenticate connections to the target OpenZiti overlay network. If you are interested in learning how this process works, you can read about it in <a href="http://localhost:3000/docs/openziti/blog/bootstrapping-trust-part-1-encryption-everywhere">Andrew's five-part series about bootstrapping trust</a>. Using <code>zssh</code> with an identity file and certificate-based authentication looks something like this (examples are taken <a href="https://github.com/openziti-test-kitchen/zssh?tab=readme-ov-file#identity-based-certificate-authentication" target="_blank" rel="noopener noreferrer">directly from the GitHub repo</a>):</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/75590748-1fb6-4616-bf1a-4fc59b31975b-542f8db961198b5d9d206e911f17faab.png" width="3124" height="1044" class="img_ev3q"></p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">zssh \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">i </span><span class="token string" style="color:#e3116c">"${private_key}"</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">s </span><span class="token string" style="color:#e3116c">"${service_name}"</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">c </span><span class="token string" style="color:#e3116c">"${client_identity}.json"</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"${user_id}@${server_identity}"</span><br></span></code></pre></div></div>
<p>In this example, <code>zssh</code> is accepting the ssh key to use to authenticate to <code>sshd</code> (<code>-i</code>), the OpenZiti service to dial (<code>-s</code>), the OpenZiti identity file (<code>-c</code>). Somewhat hidden within this example is the OpenZiti target identity that is binding the service. All <code>zssh</code> connections are made with the expectation that the target identity is provided to the <code>zssh</code> command where one would normal 'host' would be. This allows the OpenZiti overlay network operator to have a single service usable by any identity looking to provide ssh access.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="oidc-based-authentication-only">OIDC-based Authentication Only<a href="http://localhost:3000/docs/openziti/blog/multifactor-zero-trust-ssh#oidc-based-authentication-only" class="hash-link" aria-label="Direct link to OIDC-based Authentication Only" title="Direct link to OIDC-based Authentication Only">​</a></h2>
<p>The <code>zssh</code> executable was recently enhanced to support OIDC-only-based authentication. Using <a href="https://openziti.io/docs/learn/core-concepts/security/authentication/external-jwt-signers/" target="_blank" rel="noopener noreferrer">external JWT signers</a>, you can configure an OpenZIti overlay network to trust JWTs from configured IdPs as authentication tokens. This allows the operator to create <a href="https://openziti.io/docs/learn/core-concepts/security/authentication/authentication-policies/" target="_blank" rel="noopener noreferrer">authentication policies</a> allowing for external, OIDC-based integrations. This is interesting because it allows you to authenticate to the OpenZiti overlay network without needing to enroll the client ahead of time. Instead, <code>zssh</code> users complete an <a href="https://auth0.com/docs/get-started/authentication-and-authorization-flow/authorization-code-flow-with-pkce" target="_blank" rel="noopener noreferrer">Authorization Code Flow with PKCE</a>. In this scenario, the user will see the familiar flow of a browser window popping up and asking the user to authenticate to an identity provider configured to be trusted by OpenZiti. When the flow completes, the <code>zssh</code> binary will have a JWT that can be used to authenticate to the OpenZiti controller.</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/92208900-0593-410c-9305-b4b3b63821ce-0863f1d103c77dba359b9abc6cbb9b84.png" width="3124" height="1440" class="img_ev3q"></p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">zssh \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">i </span><span class="token string" style="color:#e3116c">"${private_key}"</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">s </span><span class="token string" style="color:#e3116c">"${service_name}"</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">o \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">a </span><span class="token string" style="color:#e3116c">"${oidc_issuer}"</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">n openziti</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">client \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">oidcOnly \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">controllerUrl https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1280</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"${user_id}@${server_identity}"</span><br></span></code></pre></div></div>
<p>In this example, <code>zssh</code> is given the same <code>-i</code> and <code>-s</code> parameters as the certificate-based example above as well as the <code>userid@identity</code> but there are a few others supplied. The <code>-o</code> flag is passed to indicate <code>zssh</code> should obtain a JWT from the specified (<code>-a</code>) OIDC provider. In this example, Keycloak is used as a federated IdP to federate authentication to GitHub. To authenticate to Keycloak, a client id (<code>-n</code>) will need to be provided. This Keycloak client minimally needs to be configured with URLs it's allowed to redirect to after successful authentication. This example uses the <code>--oidcOnly</code> flag, indicating no OpenZiti certificate will be used for authentication. An identity will need to exist in the controller and <a href="https://github.com/openziti-test-kitchen/zssh?tab=readme-ov-file#create-an-external-jwt-signer-and-auth-policies" target="_blank" rel="noopener noreferrer">a matching auth-policy</a> to allow the identity to authenticate. Finally, as no OpenZiti identity is used in this example, <code>zssh</code> must be told where to send the authentication request with the <code>--controllerUrl</code> flag.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="certificate-based--oidc-based-authentication">Certificate-based + OIDC-based Authentication<a href="http://localhost:3000/docs/openziti/blog/multifactor-zero-trust-ssh#certificate-based--oidc-based-authentication" class="hash-link" aria-label="Direct link to Certificate-based + OIDC-based Authentication" title="Direct link to Certificate-based + OIDC-based Authentication">​</a></h2>
<p>OpenZiti can also be configured to support OIDC as a secondary form of authentication. Accordingly, the <code>zssh</code> binary can be configured to use certificate-based authentication as a primary authentication source and an OIDC-based flow for secondary authentication. In the scenario, connecting to the OpenZiti overlay itself would require multiple forms of authentication. These mechanisms are a great way to prove there's both a human and a device. The device provides the certificate, while the human interacts with Keycloak/GitHub's OIDC to verify a human is indeed in the loop.</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/c0f03fe3-0d55-4046-846c-0a8df3715e50-f114957da55c6ab6baa28145ca124f73.png" width="3124" height="1440" class="img_ev3q"></p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">zssh \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">i </span><span class="token string" style="color:#e3116c">"${private_key}"</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">s </span><span class="token string" style="color:#e3116c">"${service_name}"</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">o \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">a </span><span class="token string" style="color:#e3116c">"${oidc_issuer}"</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">n openziti</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">client \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">c </span><span class="token string" style="color:#e3116c">"${client_identity}.json"</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"${user_id}@${server_identity}"</span><br></span></code></pre></div></div>
<p>In this example, <code>zssh</code> is given the all the same parameters as the OIDC-only example but because it specifies an OpenZiti identity with <code>-c</code>, the <code>--controllerUrl</code> and <code>--oidcOnly</code> flags are not necessary.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="totp-instead-of-oidc">TOTP Instead of OIDC<a href="http://localhost:3000/docs/openziti/blog/multifactor-zero-trust-ssh#totp-instead-of-oidc" class="hash-link" aria-label="Direct link to TOTP Instead of OIDC" title="Direct link to TOTP Instead of OIDC">​</a></h2>
<p>Also added in this release was support for OpenZiti's <a href="https://en.wikipedia.org/wiki/Time-based_one-time_password" target="_blank" rel="noopener noreferrer">TOTP-based</a> authentication. Users can now be required to enter their TOTP code before making a connection, allowing for multi-factor authentication to the OpenZiti overlay without using an IdP. Or, if using the OIDC-only based flow with an IdP that doesn't support TOTP (for reasons), OpenZiti's TOTP can be used as a secondary form of authentication to the overlay. For TOTP example usage have a look at <a href="https://github.com/openziti-test-kitchen/zssh?tab=readme-ov-file#adding-totp" target="_blank" rel="noopener noreferrer">the readme on the repository</a>. There, you’ll find the commands shown in the example gif below.</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/84bb2bc3-e5ba-45d4-9f3c-dccc08e6b0d6-fe66a9c39a99c695eeadaaf13285470d.gif" width="951" height="435" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="download-zsshzscp">Download zssh/zscp<a href="http://localhost:3000/docs/openziti/blog/multifactor-zero-trust-ssh#download-zsshzscp" class="hash-link" aria-label="Direct link to Download zssh/zscp" title="Direct link to Download zssh/zscp">​</a></h2>
<p>If you are interested in trying out <code>zssh</code> and it's partner <code>zscp</code>, you can download the latest releases from GitHub at <a href="https://github.com/openziti-test-kitchen/zssh/releases/latest" target="_blank" rel="noopener noreferrer">https://github.com/openziti-test-kitchen/zssh/releases/latest</a>, right next to the source code for the project.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="share-the-project">Share the Project<a href="http://localhost:3000/docs/openziti/blog/multifactor-zero-trust-ssh#share-the-project" class="hash-link" aria-label="Direct link to Share the Project" title="Direct link to Share the Project">​</a></h2>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/7bb2b76c-af3f-45c6-83ab-d519f183024d-905dcc2bc7ef9850c54417500e23d7fa.png" width="300" height="300" class="img_ev3q"></p>
<p>If you find this interesting, please consider <a href="https://github.com/openziti/ziti/" target="_blank" rel="noopener noreferrer"><strong>starring the projects on GitHub</strong></a>. It really does help to support the project! And if you haven't seen it yet, check out <a href="https://github.com/openziti/ziti/" target="_blank" rel="noopener noreferrer"><strong>https://zrok.io</strong></a>. It's a totally free sharing platform built on OpenZiti and uses the OpenIti SDK! It uses the OpenZiti Go SDK since it's a ziti-native application. It's also <a href="https://github.com/openziti/zrok/" target="_blank" rel="noopener noreferrer"><strong>all open source too!</strong></a></p>
<p>Tell us how you're using OpenZiti on <a href="https://twitter.com/openziti" target="_blank" rel="noopener noreferrer"><strong>X <s>twitter</s></strong></a>, <a href="https://www.reddit.com/r/openziti/" target="_blank" rel="noopener noreferrer"><strong>reddit</strong></a>, or over at our <a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer"><strong>Discourse</strong></a>. Or, if you prefer, check out <a href="https://youtube.com/openziti" target="_blank" rel="noopener noreferrer"><strong>our content on YouTube</strong></a> if that's more your speed. Regardless of how, we'd love to hear from you.</p>]]></content>
        <author>
            <name>Clint Dovholuk</name>
            <uri>https://github.com/dovholuknf</uri>
        </author>
        <category label="SSH" term="SSH"/>
        <category label="OpenZiti" term="OpenZiti"/>
        <category label="Zero Trust" term="Zero Trust"/>
        <category label="Zero Trust Security" term="Zero Trust Security"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Zero Trust *ssh.Client]]></title>
        <id>http://localhost:3000/docs/openziti/blog/zero-trust-sshclient</id>
        <link href="http://localhost:3000/docs/openziti/blog/zero-trust-sshclient"/>
        <updated>2024-09-09T00:09:12.000Z</updated>
        <summary type="html"><![CDATA[A few years ago, the OpenZiti project developed and published two client tools to]]></summary>
        <content type="html"><![CDATA[<p>A few years ago, the <a href="https://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer">OpenZiti project</a> developed and published two client tools to
make ssh and scp available over an OpenZiti overlay network without requiring the sshd port to be exposed to the
internet. If interested, read the original posts <a href="http://localhost:3000/docs/openziti/blog/zitifying-ssh">about zssh</a> and
<a href="http://localhost:3000/docs/openziti/blog/zitifying-scp">zscp</a>. Continuing with the belief that security-related code should be open
source and auditable, the project is <a href="https://github.com/openziti-test-kitchen/zssh" target="_blank" rel="noopener noreferrer">available on GitHub</a>.</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/7810a66b-c739-43d9-b7a8-fd607adb04e6-503eb9ec932b16a06718eb8e1cc2ef7c.gif" width="498" height="267" class="img_ev3q"></p>
<p>The <a href="https://openziti.io/docs/learn/introduction/" target="_blank" rel="noopener noreferrer">OpenZiti</a> project provides SDKs that developers can use to create secure connections. The <code>zssh</code> client demonstrates that adopting an OpenZiti SDK into an application is no harder than developing any application that uses traditional IP-based, underlay connectivity.</p>
<p>Secondly, though uncommon, there are still vulnerabilities found in <code>ssh</code>. Just this year (2024) <a href="https://en.wikipedia.org/wiki/RegreSSHion" target="_blank" rel="noopener noreferrer">RegreSSHion</a> was discovered and was given a staggering <a href="https://www.first.org/cvss/" target="_blank" rel="noopener noreferrer">CVSS score</a> of 9.8. Scores greater than 9 are generally deemed a "patch this as soon as possible" type of CVE. Yes, today's <code>ssh</code> clients are incredibly robust, but if it's easy to remove a substantial portion of attackers from attacking a service by using a zero trust overlay network like OpenZiti, why wouldn't you?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-sshclient">Using <code>*ssh.Client</code><a href="http://localhost:3000/docs/openziti/blog/zero-trust-sshclient#using-sshclient" class="hash-link" aria-label="Direct link to using-sshclient" title="Direct link to using-sshclient">​</a></h2>
<p>The go ecosystem provides extended packages from the <code>golang.org/x/*</code> modules. One of these modules is <code>golang.org/x/crypto</code>. Within this module, there is an <code>ssh</code> package that provides everything needed to make a functional ssh client. In there is <code>ssh.Client</code>, the main thing you'll interact with. This struct, along with <code>ssh.NewClientConn</code> and the Golang standard library, provides all the functionality needed to create a simple ssh client.</p>
<p>Shown below is all the code needed to make a very contrived ssh example. Any errors are ignored, and all values are hard-coded or expected as arguments to the program to keep the example small. In total, there are fewer than 30 total lines. Hopefully, the example is straightforward enough to understand.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token string" style="color:#e3116c">"golang.org/x/crypto/ssh"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token string" style="color:#e3116c">"os"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ReadFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Args</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	signer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> ssh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ParsePrivateKey</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	config </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ssh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ClientConfig</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		User</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">            </span><span class="token string" style="color:#e3116c">"ubuntu"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		Auth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">ssh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AuthMethod</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">ssh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">PublicKeys</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		HostKeyCallback</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ssh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">InsecureIgnoreHostKey</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	sshClient</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> ssh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Dial</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"tcp"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Args</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> sshClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	session</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> sshClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewSession</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">RequestPty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"xterm"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ssh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">TerminalModes</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Stdout </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Stdout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Stderr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Stderr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Stdin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Stdin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Shell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Try it out! That's really all there is to it. You'll be able to ssh to any machine that uses key-based authentication. Although it's not a robust example, it demonstrates the overall idea and shows off how amazing the go ecosystem can be. Note that <code>ssh.InsecureIgnoreHostKey</code> is used for the <code>HostKeyCallback</code>, to keep the example short. See <a href="https://github.com/openziti-test-kitchen/zssh/blob/main/zsshlib/ssh.go#L471" target="_blank" rel="noopener noreferrer"><code>zssh</code>'s implementation</a> if interested</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="layering-in-zero-trust-connectivity">Layering in Zero Trust Connectivity<a href="http://localhost:3000/docs/openziti/blog/zero-trust-sshclient#layering-in-zero-trust-connectivity" class="hash-link" aria-label="Direct link to Layering in Zero Trust Connectivity" title="Direct link to Layering in Zero Trust Connectivity">​</a></h2>
<p>The Golang standard library is well thought out. The <a href="http://localhost:3000/docs/openziti/blog/go-is-amazing-for-zero-trust">abstractions in place make it amazing for building applications embedding zero trust</a>. Adapting an application that uses normal IP-based connectivity (like the ssh example shown above that uses "tcp") to use an OpenZiti SDK is generally straightforward. From the example above, a single line needs to be changed: the line that creates the <code>ssh.Client</code>. This line:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">	sshClient</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> ssh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Dial</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"tcp"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Creating the <code>sshClient</code> needs to be adapted away from using IP-based underlay networking. Instead of "tcp" and "remote-machine-name:22", it needs to use a zero trust connection provided by the OpenZiti Golang SDK. Below is a simplified function that uses an OpenZiti identity file to create an OpenZiti context and dial an OpenZiti service, creating a Golang <code>net.Conn</code> that can be used to create an <code>ssh.Client</code>. Again, the example omits error handling and robustness for simplicity's sake, and looks like this:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">obtainZitiConn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> net</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Conn </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	cfg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> ziti</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewConfigFromFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Args</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> ziti</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cfg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	dialOptions </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ziti</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DialOptions</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		Identity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">       host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">DialWithOptions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"zsshSvc"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dialOptions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>With the IP-based underlay <code>net.Conn</code> connection replaced with a zero trust connection, an <code>ssh.Client</code> can be created by replacing the call to <code>ssh.Dial</code>, and instead using a call to <code>ssh.NewClientConn</code> combined with a call to <code>ssh.NewClient</code>. With the <code>ssh.Dial</code> line adapted, it looks like this:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">//adapted sshClient, _ := ssh.Dial("tcp", host, config)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> chans</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reqs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> ssh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewClientConn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">obtainZitiConn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	sshClient </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> ssh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> chans</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reqs</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Everything else in the example remains identical; these are the only lines that need to change! The full source for <code>zssh</code> is available on GitHub at <a href="https://github.com/openziti-test-kitchen/zssh" target="_blank" rel="noopener noreferrer">https://github.com/openziti-test-kitchen/zssh</a>. You'll find the examples shown above in that repo as individual, compilable go files available in <a href="https://github.com/openziti-test-kitchen/zssh/tree/main/zssh/example" target="_blank" rel="noopener noreferrer">the <code>example</code> folder</a>.</p>
<p>If you're interested in <code>zssh</code>, the OpenZiti project and zero trust in general, check out <a href="http://localhost:3000/docs/openziti/blog/multifactor-zero-trust-ssh">the next article</a>. It focuses on using <code>zssh</code> and using OpenZiti's OIDC-based authentication mechanisms and uses <a href="https://www.keycloak.org/" target="_blank" rel="noopener noreferrer">Keycloak</a> for federated authentication to GitHub or Google.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="share-the-project">Share the Project<a href="http://localhost:3000/docs/openziti/blog/zero-trust-sshclient#share-the-project" class="hash-link" aria-label="Direct link to Share the Project" title="Direct link to Share the Project">​</a></h2>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/7bb2b76c-af3f-45c6-83ab-d519f183024d-905dcc2bc7ef9850c54417500e23d7fa.png" width="300" height="300" class="img_ev3q"></p>
<p>If you find this interesting, please consider <a href="https://github.com/openziti/ziti/" target="_blank" rel="noopener noreferrer"><strong>starring the projects on GitHub</strong></a>. It really does help to support the project! And if you haven't seen it yet, check out <a href="https://github.com/openziti/ziti/" target="_blank" rel="noopener noreferrer"><strong>https://zrok.io</strong></a>. It's a totally free sharing platform built on OpenZiti and uses the OpenZiti Golang SDK and is also <a href="https://github.com/openziti/zrok/" target="_blank" rel="noopener noreferrer"><strong>all open source!</strong></a></p>
<p>Tell us how you're using OpenZiti on <a href="https://twitter.com/openziti" target="_blank" rel="noopener noreferrer"><strong>X <s>twitter</s></strong></a>, <a href="https://www.reddit.com/r/openziti/" target="_blank" rel="noopener noreferrer"><strong>reddit</strong></a>, or over at our <a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer"><strong>Discourse</strong></a>. Or, if you prefer, check out <a href="https://youtube.com/openziti" target="_blank" rel="noopener noreferrer"><strong>our content on YouTube</strong></a> if that's more your speed. Regardless of how, we'd love to hear from you.</p>]]></content>
        <author>
            <name>Clint Dovholuk</name>
            <uri>https://github.com/dovholuknf</uri>
        </author>
        <category label="golang" term="golang"/>
        <category label="SSH" term="SSH"/>
        <category label="Zero Trust" term="Zero Trust"/>
        <category label="OpenZiti" term="OpenZiti"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Effortless Docker Management]]></title>
        <id>http://localhost:3000/docs/openziti/blog/effortless-docker-management-with-private-web-access</id>
        <link href="http://localhost:3000/docs/openziti/blog/effortless-docker-management-with-private-web-access"/>
        <updated>2024-09-05T15:00:56.000Z</updated>
        <summary type="html"><![CDATA[If you're involved with software creation or deployment, you likely use Docker. If so, the following saga probably rings some bells with you:]]></summary>
        <content type="html"><![CDATA[<p>If you're involved with software creation or deployment, you likely use Docker. If so, the following <em>saga</em> probably rings some bells with you:</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-common-painful-scenario">A common, painful scenario<a href="http://localhost:3000/docs/openziti/blog/effortless-docker-management-with-private-web-access#a-common-painful-scenario" class="hash-link" aria-label="Direct link to A common, painful scenario" title="Direct link to A common, painful scenario">​</a></h3>
<p>You become aware that something's not working in your Docker fleet. Maybe a service is down? You <code>ssh</code> to the the host where the containers run, and do a <code>docker compose ps</code>. Yep, it's that buggy microservice that has crashed.</p>
<p>No problem, I'll restart it: <code>docker compose restart</code>. Okay now let's try again. Hmm... The issue is still there. <code>docker compose ps</code> again. Sigh... the service must have just crashed immediately after starting.</p>
<p>I probably would have known what was happening had I been reading the log stream, but there is a lot of clutter from other services. I could get the logs for just that one service via <code>docker compose logs --follow myservice</code> but that dies every time the service dies so I'd need to run that command every time I restart the service.</p>
<p>I could alternatively run <code>docker compose up myservice</code> and in that terminal window if the service is down I could just <code>up</code> it again, but now I've got one service hogging a terminal window even after I no longer care about its logs.</p>
<p>I guess when I want to reclaim the terminal real estate I can <code>ctrl+P,Q</code>, but... wait, that's not working for some reason. Should I use <code>ctrl+C</code> instead? I can't remember if that closes the foreground process or kills the actual service...</p>
<hr>
<p>OK. You get the picture. Ugh... What a headache!</p>
<p>Of course, it makes no sense to manage a large scale Docker deployment by connecting to each container individually or restarting processes (an orchestrator like K8S will serve that large scale use case much better). But if you've got a few containers running in a self-hosted (home?) network, the above story probably sounds familiar.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-better-way">A Better way<a href="http://localhost:3000/docs/openziti/blog/effortless-docker-management-with-private-web-access#a-better-way" class="hash-link" aria-label="Direct link to A Better way" title="Direct link to A Better way">​</a></h3>
<p>Memorizing docker commands is hard. Memorizing <code>alias</code>'s isn't much easier. Keeping track of your containers across multiple terminal windows is untenable.</p>
<p>But hang on. What if you had all the information you needed in a single <em>magical</em> terminal window where every common docker command was one keypress away?</p>
<p>Picture this:</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/33cfddf1-4849-4995-a5c4-18ee4df9e8a8-effcb92d7fb8602cfd04e133157dbbbc.gif" width="1383" height="829" class="img_ev3q"></p>
<p>If that got your attention, Now, imagine if you could access the <em>magical</em> terminal window by simply opening a web browser, on any laptop or mobile device, and then navigating to a URL representing the remote host where your containers run. Everything is right there in the browser tab.</p>
<p>Bye-bye <code>ssh</code>.</p>
<p>Intrigued?</p>
<p>As nice as that is, It gets even better. Now, imagine the URL was internet-accessible, but <em><strong>only</strong></em> visible to you, invisible to others, thus protecting your containers from malicious actors.</p>
<p>This is not a fever dream. In this article, I'll show you how all this is possible today.</p>
<p>I'll discuss the following components that collectively implement the solution:</p>
<ul>
<li>
<p>Isaiah</p>
</li>
<li>
<p>OpenZiti</p>
</li>
<li>
<p>BrowZer</p>
</li>
</ul>
<h1>The Isaiah Service</h1>
<p>One component involved in the solution is Isaiah. <a href="https://github.com/will-moss/isaiah" target="_blank" rel="noopener noreferrer">Isaiah</a> is a relatively new open-source project (<em>it first appeared in early 2024</em>). It is a self-hostable service that enables you to manage all your Docker resources on a remote server. It is an attempt at recreating the <code>lazydocker</code> command-line application while making everything available as a <em><strong>web application</strong></em>.</p>
<p>The screencap in the above "better way" section shows Isaiah in action.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="isaiah-deployment">Isaiah Deployment<a href="http://localhost:3000/docs/openziti/blog/effortless-docker-management-with-private-web-access#isaiah-deployment" class="hash-link" aria-label="Direct link to Isaiah Deployment" title="Direct link to Isaiah Deployment">​</a></h3>
<p>You run Isaiah on the host where your containers execute -- the host you would previously <code>ssh</code> to in the '<em>painful scenario</em>' described at the top of this article.</p>
<p><em>(NOTE: Ensure that Docker 23.0.0+ is installed on your host before proceeding)</em></p>
<p>There are several ways to deploy Isaiah, but perhaps the easiest is via <code>docker compose</code>. Here is a <code>compose.yml</code> file you can use:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">isaiah</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mosswill/isaiah</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">stopped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"80:80"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /var/run/docker.sock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/run/docker.sock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">ro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SERVER_PORT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"80"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">AUTHENTICATION_SECRET</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"some-very-long-and-mysterious-secret"</span><br></span></code></pre></div></div>
<p>Then simply run <code>docker compose up -d</code></p>
<p><em>(NOTE: if you already have a compose file on your host, you can simply add the above</em> <code>isaiah</code> <em>section to the existing</em> <code>services</code> <em>section of your compose file)</em></p>
<p>As you can see, this compose file will have Isaiah listening on HTTP, without TLS, on your LAN or perhaps even on the open internet. This is certainly sub-optimal from a security standpoint, but read on and I'll describe how to lock things down.</p>
<p>If the <code>AUTHENTICATION_SECRET</code> env var is configured, it tells Isaiah to require visitors to enter the secret when they arrive, like this:</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/06d61b16-4a94-4116-b9f3-87466ad91d82-ed16d652740f3447998857189e9d3247.png" width="998" height="232" class="img_ev3q"></p>
<p>But even with the <code>AUTHENTICATION_SECRET</code> in place, and HTTP visitors hitting your host being prompted as shown above...this is still not as secure as we need it to be.</p>
<p>A better topology is one where your Docker host, and Isaiah, reside in a <a href="https://en.wikipedia.org/wiki/Virtual_private_cloud" target="_blank" rel="noopener noreferrer">VPC</a>, and the host has NO ports open to the internet. In this kind of deployment, the host will be completely invisible to the internet. The best (most secure) way to access the host is via a zero-trust overlay network.</p>
<h1>How to Easily Deploy a Zero-Trust Overlay Network</h1>
<p>The next component involved in the solution is OpenZiti. <a href="https://openziti.io/" target="_blank" rel="noopener noreferrer">OpenZiti</a> is an open-source project focused on bringing zero trust networking principles directly into any application. The project provides all the pieces required to implement a zero trust overlay network and provides all the tools necessary to integrate zero trust into your existing solutions.</p>
<p>There is a vast amount of documentation, as well as <a href="https://openziti.io/docs/learn/quickstarts/" target="_blank" rel="noopener noreferrer">quick starts</a>, on the OpenZiti site, so I will not replicate it here.</p>
<p>If you like what you read about OpenZiti, but you prefer not to self-host it yourself, <a href="https://netfoundry.io/" target="_blank" rel="noopener noreferrer">we</a> also offer a zero trust networking platform. If that interests you, <a href="https://netfoundry.io/lets-talk/" target="_blank" rel="noopener noreferrer">reach out to us for more discussion.</a></p>
<h1>BrowZer</h1>
<p>The next component involved in the solution is <code>BrowZer</code>.</p>
<p>The <code>Z</code> in this component's name (within the word normally spelled "<em>browser</em>") is not a typo. It is a purposeful indication that this solution, unique in today's technology offerings for securing browser-based applications, is built as part of the <a href="https://github.com/openziti/" target="_blank" rel="noopener noreferrer"><strong>OpenZiti</strong> project</a>.</p>
<p>BrowZer enables you and your organization, enterprises and self-hosting enthusiasts alike, in the cloud or at home, to operate private-to-the-internet web applications while still easily providing secure access for your authorized internet-based remote users.</p>
<p>I previously published a lengthy article that introduced the <a href="http://localhost:3000/docs/openziti/blog/introducing-openziti-browzer">concept of browZer</a>. I recommend giving it a read.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="forward-proxy-authentication--trusted-sso">Forward Proxy Authentication / Trusted SSO<a href="http://localhost:3000/docs/openziti/blog/effortless-docker-management-with-private-web-access#forward-proxy-authentication--trusted-sso" class="hash-link" aria-label="Direct link to Forward Proxy Authentication / Trusted SSO" title="Direct link to Forward Proxy Authentication / Trusted SSO">​</a></h2>
<p>With OpenZiti and BrowZer now in your mind, I want to return to Isaiah for a moment.</p>
<p>Isaiah has a feature known as <em>Forward Proxy Authentication</em>. This feature enables you to log in to an authentication portal, and then connect to Isaiah without having to type your <code>AUTHENTICATION_SECRET</code> every time.</p>
<p>In this mode, you protect Isaiah using your authentication portal rather than a cleartext / hashed password.</p>
<p>To use this mechanism, configure Isaiah using the following variables:</p>
<ul>
<li>
<p>Set <code>FORWARD_PROXY_AUTHENTICATION_ENABLED</code> to <code>true</code>.</p>
</li>
<li>
<p>Set <code>FORWARD_PROXY_AUTHENTICATION_HEADER_KEY</code> to the name of the forwarded authentication header your auth proxy sends to Isaiah.</p>
</li>
<li>
<p>Set <code>FORWARD_PROXY_AUTHENTICATION_HEADER_VALUE</code> to the value of the header that Isaiah should expect (or use <code>*</code> if all values are accepted).</p>
</li>
</ul>
<p>By the way, by default, Isaiah is configured to work with <a href="https://www.authelia.com/" target="_blank" rel="noopener noreferrer">Authelia</a> out of the box. So if you are using the Authelia IdP as your auth proxy, you can just set <code>FORWARD_PROXY_AUTHENTICATION_ENABLED</code> to <code>true</code> and be done with it (no need to configure the other variables).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="trusted-sso-between-browzer-and-isaiah">Trusted SSO Between BrowZer and Isaiah<a href="http://localhost:3000/docs/openziti/blog/effortless-docker-management-with-private-web-access#trusted-sso-between-browzer-and-isaiah" class="hash-link" aria-label="Direct link to Trusted SSO Between BrowZer and Isaiah" title="Direct link to Trusted SSO Between BrowZer and Isaiah">​</a></h2>
<p>Much like Authelia, BrowZer also works with Isaiah's <em>Forward Proxy Authentication</em> out of the box.</p>
<p>As you read in the browZer article linked above, browZer requires you to authenticate with an IdP before connecting to your zero-trust overlay network. A common setup is to use Auth0 as the browZer IdP and have Auth0 federate to Google. You can read about how to do this in our <a href="https://openziti.io/docs/identity-providers-for-browZer-auth0" target="_blank" rel="noopener noreferrer">browZer IdP documentation</a>.</p>
<p>Once you have set up your Ziti overlay network, and have set up browZer to enable web access to Isaiah, you are then using browZer as your auth proxy.</p>
<p>Now you can configure Isaiah with:</p>
<ul>
<li>
<p><code>FORWARD_PROXY_AUTHENTICATION_ENABLED</code> to <code>true</code>, and</p>
</li>
<li>
<p><code>FORWARD_PROXY_AUTHENTICATION_HEADER_VALUE</code> to the value of your Google email address.</p>
</li>
</ul>
<p>For example:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">isaiah</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mosswill/isaiah</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">stopped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"80:80"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /var/run/docker.sock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/run/docker.sock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">ro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SERVER_PORT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"80"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">FORWARD_PROXY_AUTHENTICATION_ENABLED</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"true"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">FORWARD_PROXY_AUTHENTICATION_HEADER_VALUE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"you@gmail.com"</span><br></span></code></pre></div></div>
<p>Here is what it looks like to use browZer to access a private-to-the-internet instance of Isaiah:</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/f2d0112a-e120-41da-8030-95624e4ff713-bf17d042d3f91c4712e13cf31bd87814.gif" width="1135" height="941" class="img_ev3q"></p>
<p>Here's what happens above:</p>
<ul>
<li>
<p>Brave web browser hits the URL representing the protected instance of Isaiah</p>
</li>
<li>
<p>Brave is redirected by BrowZer to Auth0, then federated to Google (with 2FA) for authentication</p>
</li>
<li>
<p>BrowZer bootstraps the necessary OpenZiti software into Brave tab, and the OpenZiti software loads the Isaiah web app over the zero-trust overlay network</p>
</li>
<li>
<p>Isaiah sees that BrowZer has done the proper SSO by passing necessary info from Google to Isaiah, so no login prompt is rendered by Isaiah</p>
</li>
<li>
<p>User is presented with Isaiah GUI welcome screen showing that "2 Containers" are running (one is Isaiah, the other is an instance of the BrowZer Bootstrapper for a staging environment)</p>
</li>
<li>
<p>User clicks around, looks at logs for a running container, also removes an old Docker image</p>
</li>
</ul>
<h1>Wrap up</h1>
<p>Do you host a web app (like Isaiah) and want to be invisible to malicious intruders?</p>
<p>Do you want your users to have easy access from anywhere with no additional software on their client devices?</p>
<p>Do you want to do all this without making any modifications to the web app?</p>
<p>If so, then we hope you'll <a href="https://netfoundry.io/lets-talk/" target="_blank" rel="noopener noreferrer">reach out for a conversation</a> about BrowZer.</p>]]></content>
        <author>
            <name>Curt Tudor</name>
            <uri>https://github.com/rentallect</uri>
        </author>
        <category label="Docker" term="Docker"/>
        <category label="Open Source" term="Open Source"/>
        <category label="Security" term="Security"/>
        <category label="Web Security" term="Web Security"/>
        <category label="OpenZiti" term="OpenZiti"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[zrok is Growing Up]]></title>
        <id>http://localhost:3000/docs/openziti/blog/zrok-is-growing-up</id>
        <link href="http://localhost:3000/docs/openziti/blog/zrok-is-growing-up"/>
        <updated>2024-08-02T20:07:40.000Z</updated>
        <summary type="html"><![CDATA[zrok has been growing pretty steadily throughout 2024. As we've grown, we've started having to deal with abuse,]]></summary>
        <content type="html"><![CDATA[<p>zrok has been growing pretty steadily throughout 2024. As we've grown, we've started having to deal with abuse,
phishing, and other similar types of issues showing up on the service at zrok.io.</p>
<p>Over the last weeks, the team has worked together to figure out the best compromise to continue offering our users the best free sharing solution possible, while also offering a reasonable level of protection against abuse. We've batted around a number of different ideas.</p>
<p>The solution we've settled on is to introduce an "interstitial page" for free-tier accounts using public sharing. The interstitial page will be shown the first time an internet user visits a zrok public share (with a timer resetting every week). The page is there to make sure that the user visiting your share is very clear that the web resource they're visiting is shared through zrok, and very likely <em>not</em> a financial institution (or at least that they should be careful with personal information).</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/898a7bec-d03b-4aef-80bc-5860547001ef-071d085ec0491e935b442743fc2b1aa1.png" width="1429" height="1321" class="img_ev3q"></p>
<p>The interstitial page is designed to only be displayed to interactive clients (web browsers presenting with a <code>User-Agent</code> header starting with <code>Mozilla/5.0</code>). Other clients like <code>curl</code>, or HTTP clients from various programming langues will bypass the interstitial page.</p>
<p>zrok users who upgrade to any paid tier (see <a href="https://zrok.io/pricing/" target="_blank" rel="noopener noreferrer">pricing</a>) will not have an interstitial page presented on their shares. The interstitial pages feature does not impact private zrok sharing in any way. When you <code>zrok access private</code> a share and create a private frontend, that frontend does not present interstitial pages. In those cases, we're pretty confident the user understands what they're accessing.</p>
<p>We're also actively working on bringing some additional capabilities to the zrok paid offerings, including "bring your own domain" support, which will allow users to create public shares using their own domain name. So, we're kind of hoping you might want to consider one of those options outside of removing the interstitial page.</p>
<div data-node-type="callout"><div data-node-type="callout-emoji">💡</div><div data-node-type="callout-text">We're expecting to enable the interstitial pages feature globally for all free-tier zrok users starting on Thursday, August 8th.</div></div>
<p>If you're a self-hoster, you'll have extensive options to customize the interstitial page configuration. Each public frontend can enable or disable interstitial support, and interstitial pages can be disabled on a per-account basis.</p>
<p>I recently did a short zrok Office Hours video about the interstitial pages feature:</p>
<p></p><article class="yt-lite" data-title="YouTube video" style="background-image:url(https://i.ytimg.com/vi/NYjec5mIXTE/hqdefault.jpg);--aspect-ratio:56.25%"><button type="button" class="lty-playbtn" aria-label="Watch YouTube video"></button></article><p></p>
<p>We appreciate every zrok user. Thank you for your support and attention. If you appreciate what we're doing with zrok, it always means a lot when you can drop a star on the <a href="https://github.com/openziti/zrok" target="_blank" rel="noopener noreferrer">zrok repo on GitHub</a>.</p>
<p>If you have any questions or concerns, feel free to reach out on the <a href="https://openziti.discourse.group/c/zrok/24" target="_blank" rel="noopener noreferrer">OpenZiti discourse using the zrok topic</a>.</p>]]></content>
        <author>
            <name>Michael Quigley</name>
            <uri>https://github.com/michaelquigley</uri>
        </author>
        <category label="Network" term="Network"/>
        <category label="Browsers" term="Browsers"/>
        <category label="Web Development" term="Web Development"/>
        <category label="Security" term="Security"/>
        <category label="WebDev" term="WebDev"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Easy Steps to Install a Private VPN on Linux with zrok]]></title>
        <id>http://localhost:3000/docs/openziti/blog/zrok-vpn-linux-service</id>
        <link href="http://localhost:3000/docs/openziti/blog/zrok-vpn-linux-service"/>
        <updated>2024-08-02T17:10:31.000Z</updated>
        <summary type="html"><![CDATA[The great thing about the zrok-share.service is that it comes with the zrok binary and is always on in the background, so it's a good fit for a reliable VPN connection. Let's install the service and configure it to auto-start after a reboot.]]></summary>
        <content type="html"><![CDATA[<p>The great thing about the <code>zrok-share.service</code> is that it comes with the <code>zrok</code> binary and is always on in the background, so it's a good fit for a reliable VPN connection. Let's install the service and configure it to auto-start after a reboot.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-sSLf</span><span class="token plain"> https://get.openziti.io/install.bash </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> zrok-share</span><br></span></code></pre></div></div>
<p>Edit <code>/opt/openziti/etc/zrok/zrok-share.env</code>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># env</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_ENABLE_TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"w9pEuX3Gb750"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># account token from the console</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_ENVIRONMENT_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"my zrok vpn service on hostname"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># share</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_UNIQUE_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"mysecretsharetoken"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_BACKEND_MODE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"vpn"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_TARGET</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"172.21.71.1/24"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># allocate ip in some private subnet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_FRONTEND_MODE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"reserved-private"</span><br></span></code></pre></div></div>
<p>You can control access to your VPN by keeping <code>ZROK_UNIQUE_NAME</code> a secret (the share token) or adding the following to restrict zrok accounts by email. Only your account can use the share in closed mode if you don't add grants.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">ZROK_PERMISSION_MODE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"closed"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_ACCESS_GRANTS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"alice@example.com bob@example.org"</span><br></span></code></pre></div></div>
<p>Grant kernel capability <code>NET_ADMIN</code> to the service.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-Ei</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'s/.*AmbientCapabilities=CAP_NET_ADMIN/AmbientCapabilities=CAP_NET_ADMIN/'</span><span class="token plain"> /etc/systemd/system/zrok-share.service.d/override.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl daemon-reload</span><br></span></code></pre></div></div>
<p>Start the service now and auto-start after a reboot.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--now</span><span class="token plain"> zrok-share.service</span><br></span></code></pre></div></div>
<p>Check the logs.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> journalctl </span><span class="token parameter variable" style="color:#36acaa">-lfu</span><span class="token plain"> zrok-share.service</span><br></span></code></pre></div></div>
<p>The logs should look like this, confirming this device is allocated 172.21.71.1 on the VPN.</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Aug </span><span class="token number" style="color:#36acaa">02</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">33</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">08</span><span class="token plain"> ubuntu zrok-share.bash</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">6243</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"level"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"info"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"ts"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1722616388.2556849</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"msg"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"interface created tun0"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Aug </span><span class="token number" style="color:#36acaa">02</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">33</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">08</span><span class="token plain"> ubuntu zrok-share.bash</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">6243</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"level"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"info"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"ts"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1722616388.255752</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"msg"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"exec /sbin/ip [link set dev tun0 mtu 16384]"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Aug </span><span class="token number" style="color:#36acaa">02</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">33</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">08</span><span class="token plain"> ubuntu zrok-share.bash</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">6243</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"level"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"info"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"ts"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1722616388.2595484</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"msg"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"exec /sbin/ip [addr add 172.21.71.1/24 dev tun0]"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Aug </span><span class="token number" style="color:#36acaa">02</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">33</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">08</span><span class="token plain"> ubuntu zrok-share.bash</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">6243</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"level"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"info"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"ts"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1722616388.2627363</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"msg"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"exec /sbin/ip [-6 addr add fd00:7a72:6f6b::1/64 dev tun0]"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Aug </span><span class="token number" style="color:#36acaa">02</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">33</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">08</span><span class="token plain"> ubuntu zrok-share.bash</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">6243</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"level"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"info"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"ts"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1722616388.2659466</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"msg"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"exec /sbin/ip [link set dev tun0 up]"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Aug </span><span class="token number" style="color:#36acaa">02</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">33</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">08</span><span class="token plain"> ubuntu zrok-share.bash</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">6243</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">"level"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"info"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"ts"</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1722616388.2711568</span><span class="token punctuation" style="color:#393A34">,</span><span class="token property" style="color:#36acaa">"msg"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"interface configured tun0"</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="join-the-vpn-from-another-device">Join the VPN from Another Device<a href="http://localhost:3000/docs/openziti/blog/zrok-vpn-linux-service#join-the-vpn-from-another-device" class="hash-link" aria-label="Direct link to Join the VPN from Another Device" title="Direct link to Join the VPN from Another Device">​</a></h2>
<p>The zrok console looks like this for an account with two environments, one per VPN peer, and one VPN share.</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/3972fae3-e826-402f-82e9-9c3514f0bfe4-deec1dd6052e036d141a233a4e483765.png" width="672" height="562" class="img_ev3q"></p>
<p>To temporarily join the zrok VPN you only need to run this command.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-E</span><span class="token plain"> zrok access private mysecretsharetoken</span><br></span></code></pre></div></div>
<p>You will see zrok's terminal user interface (TUI) telling you what is happening. This second device will be allocated 172.21.71.2 and subsequent devices will get unique IP allocations when they join. This is a network-layer VPN. You can send ICMP, TCP, UDP, etc.</p>
<p>Now, this second device is joined to the VPN, so it has a dashed line to the VPN share indicating a zrok "private access."</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/969509da-0a39-4a4b-ad76-0c0dc0a524c9-ddbea2d6f7b99a0f05826ffb730ae25f.png" width="671" height="542" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="share-the-project">Share the Project<a href="http://localhost:3000/docs/openziti/blog/zrok-vpn-linux-service#share-the-project" class="hash-link" aria-label="Direct link to Share the Project" title="Direct link to Share the Project">​</a></h2>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/7bb2b76c-af3f-45c6-83ab-d519f183024d-905dcc2bc7ef9850c54417500e23d7fa.png" width="300" height="300" class="img_ev3q"></p>
<p>If you find this interesting, please <a href="https://github.com/openziti/zrok" target="_blank" rel="noopener noreferrer">give zrok a star on GitHub</a>!</p>
<p>Let us know if you found a good use for this or have an improvement or question in mind on <a href="https://twitter.com/openziti" target="_blank" rel="noopener noreferrer"><strong>X <s>twitter</s></strong></a>, in <a href="https://www.reddit.com/r/openziti/" target="_blank" rel="noopener noreferrer">/r/openziti</a>, or the <a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer">Discourse forum</a>. We upload and stream <a href="https://youtube.com/openziti" target="_blank" rel="noopener noreferrer"><strong>on YouTube</strong></a> too. We'd love to hear from you!</p>]]></content>
        <author>
            <name>Kenneth Bingham</name>
            <uri>https://github.com/qrkourier</uri>
        </author>
        <category label="VPN" term="VPN"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Jitsi, meet zrok]]></title>
        <id>http://localhost:3000/docs/openziti/blog/jitsi-meet-zrok</id>
        <link href="http://localhost:3000/docs/openziti/blog/jitsi-meet-zrok"/>
        <updated>2024-07-31T18:25:02.000Z</updated>
        <summary type="html"><![CDATA[Jitsi Meet is an open-source video conferencing server. I've wanted to run Jitsi behind zrok and someone asked about it today in the forum and we got it working! Here's how I conveniently self-host Jitsi with zrok.]]></summary>
        <content type="html"><![CDATA[<p><a href="https://jitsi.github.io/handbook/" target="_blank" rel="noopener noreferrer">Jitsi Meet</a> is an open-source video conferencing server. I've wanted to run Jitsi behind zrok and <a href="https://openziti.discourse.group/t/local-jitsi-meet-zrok/2900/4?u=qrkourier" target="_blank" rel="noopener noreferrer">someone asked about it today in the forum</a> and we got it working! Here's how I conveniently self-host Jitsi with zrok.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-zrok">Why zrok?<a href="http://localhost:3000/docs/openziti/blog/jitsi-meet-zrok#why-zrok" class="hash-link" aria-label="Direct link to Why zrok?" title="Direct link to Why zrok?">​</a></h2>
<p><a href="https://zrok.io/" target="_blank" rel="noopener noreferrer">zrok.io</a> makes it easy to self-host web applications while obscuring your real public IP and protecting your private network. Your visitors will see a trusted certificate with the name <code>*.share.zrok.io</code> provided by zrok.io as a service when they visit your Jitsi Meet instance's public URL.</p>
<p>Jitsi Meet requires a trusted certificate for WebRTC, so zrok.io also spares you the chore of issuing, renewing, and configuring a TLS server certificate for Jitsi.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="orientation">Orientation<a href="http://localhost:3000/docs/openziti/blog/jitsi-meet-zrok#orientation" class="hash-link" aria-label="Direct link to Orientation" title="Direct link to Orientation">​</a></h2>
<p>You only need Docker to follow this tutorial. There's nothing else to install. You can use this guide with a free account from <a href="https://zrok.io/" target="_blank" rel="noopener noreferrer">zrok.io</a> or a <a href="https://docs.zrok.io/docs/guides/self-hosting/docker/" target="_blank" rel="noopener noreferrer">self-hosted zrok instance</a>.</p>
<p>Jitsi Meet's Docker Compose project is pre-configured to publish the container ports to the Docker Host's external interfaces. Typically, that is necessary so they are reachable by clients.</p>
<p>zrok works differently and does not need the ports to be published externally. Instead, zrok runs inside the Compose project on the <code>meet.jitsi</code> bridge network. zrok will proxy the traffic securely to the containers' internal ports, so we'll override the forwarded, published ports, exposing them only inside the Compose project.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-steps">The Steps<a href="http://localhost:3000/docs/openziti/blog/jitsi-meet-zrok#the-steps" class="hash-link" aria-label="Direct link to The Steps" title="Direct link to The Steps">​</a></h2>
<ol>
<li>
<p>Follow <a href="https://jitsi.github.io/handbook/docs/devops-guide/devops-guide-docker/#quick-start" target="_blank" rel="noopener noreferrer">Jitsi's Docker Quickstart</a> and wait to run <code>docker compose up</code>.</p>
</li>
<li>
<p>In your terminal, change to the directory where you have created these Jitsi quickstart files: <code>.env</code> and <code>docker-compose.yml</code>.</p>
</li>
<li>
<p>Download the zrok <a href="https://docs.zrok.io/zrok-public-reserved/compose.yml" target="_blank" rel="noopener noreferrer">public share compose example</a> and save it as the filename <code>docker-compose.zrok.yml</code> in the same directory.</p>
</li>
<li>
<p>Add the following YAML as the filename <code>docker-compose.override.yml</code> in the same directory.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">web</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!override</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">jicofo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!override</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">jvb</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!override</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">zrok-share</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      meet.jitsi</span><span class="token punctuation" style="color:#393A34">:</span><br></span></code></pre></div></div>
</li>
<li>
<p>Think of a name for your self-hosted Jitsi Meet instance. You will use it in the next step to define the unique name of the zrok share which is part of the public URL. The name must be 4-32 lowercase letters or numbers.</p>
</li>
<li>
<p>Save the following variable assignments as the filename <code>.env.zrok</code> in the same directory.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">PUBLIC_URL</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"https://myjitsi.share.zrok.io"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># subdomain must match ZROK_UNIQUE_NAME</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_UNIQUE_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"myjitsi"</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic"># must match PUBLIC_URL subdomain</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_ENABLE_TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"ix9XrvQt13Rf"</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># zrok account token from console</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_ENVIRONMENT_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"jitsi-zrok-compose"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># name for the environment in the console graph</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_API_ENDPOINT</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"https://api.zrok.io"</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># must be set to the zrok API you're using</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_TARGET</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"https://web:443"</span><span class="token plain">               </span><span class="token comment" style="color:#999988;font-style:italic"># this is correct for the web container's internal port</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_INSECURE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"--insecure"</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic"># let zrok skip cert verification for the internal web:443 target</span><br></span></code></pre></div></div>
</li>
<li>
<p>Optionally, turn on OAuth for this Jitsi Meet instance with zrok. Add the following to the <code>.env.zrok</code> file (<a href="https://docs.zrok.io/docs/guides/docker-share/docker_public_share_guide/" target="_blank" rel="noopener noreferrer">Docker public share guide has more info</a>).</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">ZROK_OAUTH_PROVIDER</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"google"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># google, github</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># space-separated list email patterns verified by the provider</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_OAUTH_EMAILS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"alice.example@gmail.com *@acme.example.com"</span><br></span></code></pre></div></div>
</li>
<li>
<p>Save the following script as the filename <code>compose.bash</code> in the same directory. This script configures the compose project and environment files.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">COMPOSE_FILE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"docker-compose.yml:docker-compose.zrok.yml:docker-compose.override.yml"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">COMPOSE_ENV_FILES</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">".env,.env.zrok"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> compose  </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">${@}</span><span class="token string" style="color:#e3116c">"</span><br></span></code></pre></div></div>
</li>
<li>
<p>Ensure you have all the necessary files.</p>
<ol>
<li>
<p><code>docker-compose.yml</code></p>
</li>
<li>
<p><code>docker-compose.zrok.yml</code></p>
</li>
<li>
<p><code>docker-compose.override.yml</code></p>
</li>
<li>
<p><code>.env</code></p>
</li>
<li>
<p><code>.env.zrok</code></p>
</li>
<li>
<p><code>compose.bash</code></p>
</li>
</ol>
</li>
<li>
<p>Run Jitsi and zrok.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">bash</span><span class="token plain"> ./compose.bash up</span><br></span></code></pre></div></div>
</li>
<li>
<p>Open Jitsi in a web browser at the address from the <code>PUBLIC_URL</code> environment variable, e.g., <code>https://myjitsi.share.zrok.io</code> .</p>
</li>
<li>
<p>If you need to change the name, authentication, etc. you can delete the environment in the zrok web console and delete the Docker volumes like this to start over. It's also possible to make surgical changes if you don't want to start over. <a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer">Ask for help in Discourse</a>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">bash</span><span class="token plain"> ./compose.bash down </span><span class="token parameter variable" style="color:#36acaa">--volumes</span><br></span></code></pre></div></div>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="zrok-frontdoor">zrok frontdoor<a href="http://localhost:3000/docs/openziti/blog/jitsi-meet-zrok#zrok-frontdoor" class="hash-link" aria-label="Direct link to zrok frontdoor" title="Direct link to zrok frontdoor">​</a></h2>
<p>This tutorial for Jitsi Meet is a great example of <a href="https://docs.zrok.io/docs/guides/frontdoor/?os=Docker" target="_blank" rel="noopener noreferrer">zrok frontdoor</a>. zrok frontdoor brings many advantages for self-hosters and is always enabled when using zrok.io as a service with a production-ready service like this zrok public share in Docker. zrok.io users enjoy additional shielding for their Jitsi Meet public URL.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="relatedly">Relatedly<a href="http://localhost:3000/docs/openziti/blog/jitsi-meet-zrok#relatedly" class="hash-link" aria-label="Direct link to Relatedly" title="Direct link to Relatedly">​</a></h2>
<p>zrok is built with OpenZiti. Here's <a href="https://medium.com/netfoundry/tunneling-voip-over-openziti-69d6487605e4" target="_blank" rel="noopener noreferrer">another post about running an Asterisk PBX without published ports</a>, just as your Jitsi Meet instance has no open ports on the Docker Host's outward-facing interfaces.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="share-the-project">Share the Project<a href="http://localhost:3000/docs/openziti/blog/jitsi-meet-zrok#share-the-project" class="hash-link" aria-label="Direct link to Share the Project" title="Direct link to Share the Project">​</a></h2>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/7bb2b76c-af3f-45c6-83ab-d519f183024d-905dcc2bc7ef9850c54417500e23d7fa.png" width="300" height="300" class="img_ev3q"></p>
<p>If you find this interesting, please consider <a href="https://github.com/openziti/ziti/" target="_blank" rel="noopener noreferrer"><strong>starring us on GitHub</strong></a>. It helps. Let us know if you found a good use for this or have an improvement or question in mind on <a href="https://twitter.com/openziti" target="_blank" rel="noopener noreferrer"><strong>X <s>twitter</s></strong></a>, in <a href="https://www.reddit.com/r/openziti/" target="_blank" rel="noopener noreferrer">/r/openziti</a>, or the <a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer">Discourse forum</a>. We upload and stream <a href="https://youtube.com/openziti" target="_blank" rel="noopener noreferrer"><strong>on YouTube</strong></a> too. We'd love to hear from you!</p>]]></content>
        <author>
            <name>Kenneth Bingham</name>
            <uri>https://github.com/qrkourier</uri>
        </author>
        <category label="Self Hosted" term="Self Hosted"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Extend Access to a Private S3 Bucket Using Python]]></title>
        <id>http://localhost:3000/docs/openziti/blog/extend-access-to-a-private-s3-bucket-using-python</id>
        <link href="http://localhost:3000/docs/openziti/blog/extend-access-to-a-private-s3-bucket-using-python"/>
        <updated>2024-07-23T17:05:14.000Z</updated>
        <summary type="html"><![CDATA[A private S3 bucket protects against a data leak by denying all public access. This approach moves access control from the public S3 API to the network layer. We can use OpenZiti's cryptographic identity and attribute-based policies to securely extend access to a trusted Python program at a remote site.]]></summary>
        <content type="html"><![CDATA[<p>A private S3 bucket protects against a data leak by denying all public access. This approach moves access control from the public S3 API to the network layer. We can use OpenZiti's cryptographic identity and attribute-based policies to securely extend access to a trusted Python program at a remote site.</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/9428a427-5a2f-41f0-ac30-af0c83a09c69-290e62917e8088aee832c9d25597392f.png" width="1162" height="842" class="img_ev3q"></p>
<p>The OpenZiti Python SDK (<code>import openziti</code>) makes it easy to use the AWS Python SDK (<code>import boto3</code>) through an OpenZiti tunnel using only Python. No sidecar, agent, or client proxy is needed!</p>
<p>Here's an example of a bucket policy that allows any S3 bucket action for any AWS caller identity as long as the request arrives via the VPC endpoint (VPCE).</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">"Version"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"2012-10-17"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">"Id"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Policy1415115909152"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">"Statement"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token property" style="color:#36acaa">"Sid"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Access-to-specific-VPCE-only"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token property" style="color:#36acaa">"Principal"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"*"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token property" style="color:#36acaa">"Action"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"s3:*"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token property" style="color:#36acaa">"Effect"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Deny"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token property" style="color:#36acaa">"Resource"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"arn:aws:s3:::awsexamplebucket1"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">"arn:aws:s3:::awsexamplebucket1/*"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token property" style="color:#36acaa">"Condition"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token property" style="color:#36acaa">"StringNotEquals"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token property" style="color:#36acaa">"aws:SourceVpce"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vpce-1a2b3c4d"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><em>from</em> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/example-bucket-policies-vpc-endpoint.html#example-bucket-policies-restrict-accesss-vpc-endpoint" target="_blank" rel="noopener noreferrer"><em>Restricting access to a specific VPC endpoint</em></a></p>
<p>Consider this Python script that uploads a file to a private S3 bucket. This must run inside the trusted VPC to reach the private IP address of the VPCE (i.e., Privatelink Interface).</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> boto3 </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">s3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">service_name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'s3'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> endpoint_url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bucket_endpoint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">s3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">upload_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bucket_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_name</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>We can extend trust beyond the VPC to securely perform bucket actions from anywhere. This next example patches the S3 client to tunnel to the bucket endpoint with OpenZiti securely.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> boto3 </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> openziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">s3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">service_name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'s3'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> endpoint_url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bucket_endpoint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openziti</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ziti_identity_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> openziti</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">monkeypatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">upload_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bucket_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_name</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>These Python snippets are representative of a functioning sample, <code>s3z.py</code> (<a href="https://github.com/openziti/ziti-sdk-py/tree/main/sample/s3z#readme" target="_blank" rel="noopener noreferrer">link to OpenZiti Python SDK</a>). The README contains a list of the AWS and OpenZiti entities and configurations that make this possible.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="share-the-project">Share the Project<a href="http://localhost:3000/docs/openziti/blog/extend-access-to-a-private-s3-bucket-using-python#share-the-project" class="hash-link" aria-label="Direct link to Share the Project" title="Direct link to Share the Project">​</a></h2>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/7bb2b76c-af3f-45c6-83ab-d519f183024d-905dcc2bc7ef9850c54417500e23d7fa.png" width="300" height="300" class="img_ev3q"></p>
<p>If you find this interesting, please consider <a href="https://github.com/openziti/ziti/" target="_blank" rel="noopener noreferrer"><strong>starring us on GitHub</strong></a>. It helps. Let us know if you found a good use for this or have an improvement or question in mind on <a href="https://twitter.com/openziti" target="_blank" rel="noopener noreferrer"><strong>X <s>twitter</s></strong></a>, in <a href="https://www.reddit.com/r/openziti/" target="_blank" rel="noopener noreferrer">/r/openziti</a>, or the <a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer">Discourse forum</a>. We upload and stream <a href="https://youtube.com/openziti" target="_blank" rel="noopener noreferrer"><strong>on YouTube</strong></a> too. We'd love to hear from you!</p>]]></content>
        <author>
            <name>Kenneth Bingham</name>
            <uri>https://github.com/qrkourier</uri>
        </author>
        <category label="Python" term="Python"/>
        <category label="Boto3" term="Boto3"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Why We Verify GitHub Commits]]></title>
        <id>http://localhost:3000/docs/openziti/blog/why-we-verify-github-commits</id>
        <link href="http://localhost:3000/docs/openziti/blog/why-we-verify-github-commits"/>
        <updated>2024-05-24T16:00:14.000Z</updated>
        <summary type="html"><![CDATA[Assigning the author on a commit is an essential feature of Git that allows you to send a commit on behalf of someone]]></summary>
        <content type="html"><![CDATA[<p>Assigning the author on a commit is an essential feature of Git that allows you to send a commit on behalf of someone
while preserving their authorship. I speculate this was the norm when the Linux Kernel authors, who also
created Git, still received many contributions via email.</p>
<p>GitHub automatically links the commit to the attributed author's and committer's GitHub profile(s). By default, there's no visible indication that a commit was attributed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="attribution-with-git">Attribution with Git<a href="http://localhost:3000/docs/openziti/blog/why-we-verify-github-commits#attribution-with-git" class="hash-link" aria-label="Direct link to Attribution with Git" title="Direct link to Attribution with Git">​</a></h2>
<p>First, we can see that <a href="mailto:bob@example.com" target="_blank" rel="noopener noreferrer">bob@example.com</a> is the currently-configured author email.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> config </span><span class="token parameter variable" style="color:#36acaa">--local</span><span class="token plain"> user.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> config </span><span class="token parameter variable" style="color:#36acaa">--local</span><span class="token plain"> user.email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bob@example.com</span><br></span></code></pre></div></div>
<p>Next, Bob configures Git to impersonate a known email address.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> config </span><span class="token parameter variable" style="color:#36acaa">--local</span><span class="token plain"> user.name bot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> config </span><span class="token parameter variable" style="color:#36acaa">--local</span><span class="token plain"> user.email github-actions</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">bot</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">@users.noreply.github.com</span><br></span></code></pre></div></div>
<p>Next, Bob makes the commit locally and inspects the metadata.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit </span><span class="token parameter variable" style="color:#36acaa">-am</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"who sent this commit?"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> log </span><span class="token parameter variable" style="color:#36acaa">-1</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--format</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">fuller</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">commit 114550a026fb4a106ad3911b2c585eda16d8dbfe (HEAD -&gt; main, origin/main, origin/HEAD)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Author:     github-actions[bot] &lt;github-actions[bot]@users.noreply.github.com&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuthorDate: Tue May 21 09:52:06 2024 -0400</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Commit:     github-actions[bot] &lt;github-actions[bot]@users.noreply.github.com&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CommitDate: Tue May 21 09:52:06 2024 -0400</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    who sent this commit?</span><br></span></code></pre></div></div>
<p>In the above example, Bob specifies the committer and author metadata of the next commit to match a known email address before pushing it to GitHub, which displays the commit as if that bot had sent it.</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/f969b51e-be03-4a7a-923e-f3250601dc69-0424443e90b98cf33dca32a7deec3e60.png" width="471" height="212" class="img_ev3q"></p>
<p>Bob can also update the author and committer metadata on the last commit (<code>HEAD</code>, or any commit during a rebase) and push it to GitHub.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">GIT_COMMITTER_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"github-actions[bot]"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">GIT_COMMITTER_EMAIL</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">${GIT_COMMITTER_NAME}</span><span class="token string" style="color:#e3116c">@users.noreply.github.com"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> GIT_COMMITTER_NAME GIT_COMMITTER_EMAIL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--amend</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--no-edit </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--no-gpg-sign </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--author</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">${GIT_COMMITTER_NAME}</span><span class="token string" style="color:#e3116c"> &lt;</span><span class="token string variable" style="color:#36acaa">${GIT_COMMITTER_EMAIL}</span><span class="token string" style="color:#e3116c">&gt;"</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-can-i-protect-the-sauce">How can I protect the sauce?<a href="http://localhost:3000/docs/openziti/blog/why-we-verify-github-commits#how-can-i-protect-the-sauce" class="hash-link" aria-label="Direct link to How can I protect the sauce?" title="Direct link to How can I protect the sauce?">​</a></h2>
<p>While you can't disable attribution in GitHub, there are some things you can do.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="require-verified-commits">Require Verified Commits<a href="http://localhost:3000/docs/openziti/blog/why-we-verify-github-commits#require-verified-commits" class="hash-link" aria-label="Direct link to Require Verified Commits" title="Direct link to Require Verified Commits">​</a></h3>
<p>A verified commit is authenticated by GitHub. GitHub <a href="https://docs.github.com/en/authentication/managing-commit-signature-verification/about-commit-signature-verification" target="_blank" rel="noopener noreferrer">lets you require verified commits</a>. Once enabled, GitHub will not accept unverified commits in the specified branches.</p>
<p>Commits can be marked "verified" in several ways:</p>
<ol>
<li>
<p>The easiest way is to edit files in the GitHub UI. This allows GitHub to authenticate the commit with the browser session and sign the commit with <a href="https://github.com/web-flow.gpg" target="_blank" rel="noopener noreferrer">their web flow key</a>.</p>
</li>
<li>
<p>The most useful way is to sign commits locally with the <code>git</code> CLI and a GPG key. This allows GitHub and anyone to verify the signature on the commit.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> verify-commit </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> HEAD</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tree 550accc6ea105ed9e407db481c99d45d3cb32cb1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parent 408720459f8985dd01d4e36857d8e42f988539f9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">author Kenneth Bingham &lt;kenneth.bingham@netfoundry.io&gt; 1716477976 -0400</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">committer Kenneth Bingham &lt;kenneth.bingham@netfoundry.io&gt; 1716477976 -0400</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">document rolling back downstream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg: Signature made Thu 23 May 2024 11:26:17 AM EDT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg:                using RSA key 1EB5E833014594E4EDB0317331709281860130B6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg:                issuer "kenneth.bingham@netfoundry.io"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg: Good signature from "Kenneth Bingham &lt;kenneth.bingham@netfoundry.io&gt;"         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ultimate]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Primary key fingerprint: F52F 87DD 444E 337F FA40  951A F3FC 641E F53D D900</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Subkey fingerprint: 1EB5 E833 0145 94E4 EDB0  3173 3170 9281 8601 30B6</span><br></span></code></pre></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enable-vigilant-mode">Enable Vigilant Mode<a href="http://localhost:3000/docs/openziti/blog/why-we-verify-github-commits#enable-vigilant-mode" class="hash-link" aria-label="Direct link to Enable Vigilant Mode" title="Direct link to Enable Vigilant Mode">​</a></h3>
<p><a href="https://docs.github.com/en/authentication/managing-commit-signature-verification/displaying-verification-statuses-for-all-of-your-commits" target="_blank" rel="noopener noreferrer">Vigilant mode</a> changes the way your commits are presented on GitHub.com.</p>
<p>Without vigilant mode, unverified commits do not have any verification status badge, so there's no visual difference between those sent by the committer and those attributed to another author.</p>
<p>With vigilant mode, all of your commits have a badge ("verified," "unverified," or "partially verified"). This raises awareness about the significance of verified commits and serves as a visual warning that a commit was not authenticated by GitHub.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-doesnt-this-prevent">What Doesn't this Prevent?<a href="http://localhost:3000/docs/openziti/blog/why-we-verify-github-commits#what-doesnt-this-prevent" class="hash-link" aria-label="Direct link to What Doesn't this Prevent?" title="Direct link to What Doesn't this Prevent?">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hasty-review">Hasty Review<a href="http://localhost:3000/docs/openziti/blog/why-we-verify-github-commits#hasty-review" class="hash-link" aria-label="Direct link to Hasty Review" title="Direct link to Hasty Review">​</a></h3>
<p>Requiring verified commits is not a substitute for a careful review of contributions. A malicious or otherwise unwanted commit can indeed be verified.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-compromised-github-account">A Compromised GitHub Account<a href="http://localhost:3000/docs/openziti/blog/why-we-verify-github-commits#a-compromised-github-account" class="hash-link" aria-label="Direct link to A Compromised GitHub Account" title="Direct link to A Compromised GitHub Account">​</a></h3>
<p>Intruders can impersonate you and send verified malicious commits if your GitHub account is compromised.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-long-game">The Long Game<a href="http://localhost:3000/docs/openziti/blog/why-we-verify-github-commits#the-long-game" class="hash-link" aria-label="Direct link to The Long Game" title="Direct link to The Long Game">​</a></h3>
<p>A patient actor can build credibility for their GitHub account and infiltrate a project. This may yield an opportunity to introduce verified malicious commits.</p>
<p>Reference: <a href="https://boehs.org/node/everything-i-know-about-the-xz-backdoor" target="_blank" rel="noopener noreferrer">The xz backdoor timeline</a></p>]]></content>
        <author>
            <name>Kenneth Bingham</name>
            <uri>https://github.com/qrkourier</uri>
        </author>
        <category label="GitHub" term="GitHub"/>
        <category label="Git" term="Git"/>
        <category label="SDLC" term="SDLC"/>
        <category label="GPG" term="GPG"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Limitless zrok with Docker]]></title>
        <id>http://localhost:3000/docs/openziti/blog/limitless-zrok-with-docker</id>
        <link href="http://localhost:3000/docs/openziti/blog/limitless-zrok-with-docker"/>
        <updated>2024-05-22T20:00:34.000Z</updated>
        <summary type="html"><![CDATA[You can conveniently run a zrok instance on a Linux server. The Caddy option makes it easy to auto-renew a wildcard certificate to protect the zrok API and your public shares with TLS.]]></summary>
        <content type="html"><![CDATA[<p>You can conveniently run a zrok instance on a Linux server. The Caddy option makes it easy to auto-renew a wildcard certificate to protect the zrok API and your public shares with TLS.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-this-good-for">What's This Good For?<a href="http://localhost:3000/docs/openziti/blog/limitless-zrok-with-docker#whats-this-good-for" class="hash-link" aria-label="Direct link to What's This Good For?" title="Direct link to What's This Good For?">​</a></h2>
<ul>
<li>
<p><a href="https://docs.zrok.io/docs/concepts/sharing-public/" target="_blank" rel="noopener noreferrer">You can publicly share websites, files, etc.</a>, with auth from your computers without punching holes in their inbound firewalls. This is called reverse tunneling. Your Linux server is public and acts as a relay.</p>
</li>
<li>
<p><a href="https://docs.zrok.io/docs/concepts/sharing-private/" target="_blank" rel="noopener noreferrer">You can privately share TCP/UDP services or create a VPN</a>. You must give the other party an account on your instance. This is excellent for multi-player games, etc.</p>
</li>
<li>
<p><strong>No limits</strong> — Maximize the use of your available bandwidth and compute.</p>
</li>
<li>
<p><strong>Data sovereignty</strong> — Assuming you control your server, no third parties can access your data.</p>
</li>
<li>
<p><strong>Availability</strong> — You control upgrades and uptime...which can be a double-edged sword!</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-needful-things">The Needful Things<a href="http://localhost:3000/docs/openziti/blog/limitless-zrok-with-docker#the-needful-things" class="hash-link" aria-label="Direct link to The Needful Things" title="Direct link to The Needful Things">​</a></h2>
<ul>
<li>
<p><a href="https://docs.docker.com/engine/install/" target="_blank" rel="noopener noreferrer">Install Docker on your Linux</a> server.</p>
</li>
<li>
<p>Create a wildcard record in the zrok DNS zone for your Linux server's public IP address.</p>
</li>
<li>
<p>to enable Caddy TLS, you'll need an API token from your DNS provider.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-short-version">The Short Version<a href="http://localhost:3000/docs/openziti/blog/limitless-zrok-with-docker#the-short-version" class="hash-link" aria-label="Direct link to The Short Version" title="Direct link to The Short Version">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> https://get.openziti.io/zrok-instance/fetch.bash </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bash</span><br></span></code></pre></div></div>
<p>Then, configure your environment with an <code>.env</code> file</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">ZROK_DNS_ZONE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">share.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_USER_EMAIL</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">me@example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_USER_PWD</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">zrokuserpw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZITI_PWD</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">zitiadminpw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_ADMIN_TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">zroktoken</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># if you don't plan to enable Caddy TLS,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#  set this to publish insecure ports</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZROK_INSECURE_INTERFACE</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0</span><br></span></code></pre></div></div>
<p>...and start the containers.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> compose up </span><span class="token parameter variable" style="color:#36acaa">--build</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enable-caddy-tls">Enable Caddy TLS<a href="http://localhost:3000/docs/openziti/blog/limitless-zrok-with-docker#enable-caddy-tls" class="hash-link" aria-label="Direct link to Enable Caddy TLS" title="Direct link to Enable Caddy TLS">​</a></h2>
<p>If you have an API token from your DNS provider, you can add these values to your <code>.env</code> file to configure Caddy to auto-renew a wildcard certificate for your zrok DNS zone.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">CADDY_DNS_PLUGIN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">cloudflare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CADDY_DNS_PLUGIN_TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">abcd1234</span><br></span></code></pre></div></div>
<p>Enable Caddy by renaming the extra compose file.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> caddy.compose.override.yml compose.override.yml</span><br></span></code></pre></div></div>
<p>Restart the containers.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> compose up </span><span class="token parameter variable" style="color:#36acaa">--build</span><span class="token plain"> --force-recreate</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-longer-version">The Longer Version<a href="http://localhost:3000/docs/openziti/blog/limitless-zrok-with-docker#the-longer-version" class="hash-link" aria-label="Direct link to The Longer Version" title="Direct link to The Longer Version">​</a></h2>
<iframe width="100%" height="315" src="https://www.youtube.com/embed/70zJ_h4uiD8"></iframe>
<p>Here's <a href="https://docs.zrok.io/docs/guides/self-hosting/docker/" target="_blank" rel="noopener noreferrer">a link to the full guide</a> used in the video.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="get-in-touch">Get in Touch<a href="http://localhost:3000/docs/openziti/blog/limitless-zrok-with-docker#get-in-touch" class="hash-link" aria-label="Direct link to Get in Touch" title="Direct link to Get in Touch">​</a></h2>
<p>Visit us in <a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer">our Discourse community</a> if you have any ideas or questions.</p>]]></content>
        <author>
            <name>Kenneth Bingham</name>
            <uri>https://github.com/qrkourier</uri>
        </author>
        <category label="Self Hosted" term="Self Hosted"/>
        <category label="Docker Compose" term="Docker Compose"/>
        <category label="OpenZiti" term="OpenZiti"/>
        <category label="zrok" term="zrok"/>
        <category label="Tunneling" term="Tunneling"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[How to Prevent Path Traversal Attacks with OpenZiti BrowZer]]></title>
        <id>http://localhost:3000/docs/openziti/blog/how-to-prevent-path-traversal-attacks-with-openziti-browzer</id>
        <link href="http://localhost:3000/docs/openziti/blog/how-to-prevent-path-traversal-attacks-with-openziti-browzer"/>
        <updated>2024-05-22T18:49:58.000Z</updated>
        <summary type="html"><![CDATA[The web has revolutionized how the world operates, enabling everything from banking and shopping to social media and general business transactions. However, as with all technological advancements, malicious actors quickly found ways to exploit the web for fraudulent activities. The anonymity provided by internet usage allowed criminals to deceive users and providers, leading to significant financial losses. In response, technologies like SSL/TLS and public trust architectures were developed to enhance security, helping users verify the servers they communicate with and feel more secure in their online interactions. Despite these measures, software is inherently fallible, as it is created by humans who can make mistakes.]]></summary>
        <content type="html"><![CDATA[<p>The web has revolutionized how the world operates, enabling everything from banking and shopping to social media and general business transactions. However, as with all technological advancements, malicious actors quickly found ways to exploit the web for fraudulent activities. The anonymity provided by internet usage allowed criminals to deceive users and providers, leading to significant financial losses. In response, technologies like SSL/TLS and public trust architectures were developed to enhance security, helping users verify the servers they communicate with and feel more secure in their online interactions. Despite these measures, software is inherently fallible, as it is created by humans who can make mistakes.</p>
<p>Criminals continually discover and exploit these vulnerabilities, using sophisticated techniques to steal information and steal or extort money. Rather than defraud users directly, they turned to stealing information by attacking the applications. BrowZer, part of the OpenZiti project, prevents one of the most common attack techniques listed in the <a href="https://owasp.org/www-project-top-ten/" target="_blank" rel="noopener noreferrer">OWASP Top 10</a> and elsewhere, Broken Access Control.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-threat-of-path-traversal">The Threat of Path Traversal<a href="http://localhost:3000/docs/openziti/blog/how-to-prevent-path-traversal-attacks-with-openziti-browzer#the-threat-of-path-traversal" class="hash-link" aria-label="Direct link to The Threat of Path Traversal" title="Direct link to The Threat of Path Traversal">​</a></h2>
<p>Some of the worst incidents occur when simple mistakes are made in software design, allowing vulnerabilities like path traversal attacks.&nbsp; For those unfamiliar with the term, path traversal is a relatively simple attack strategy of appending paths to the URL of a website.&nbsp; For example, one might usually go to <a href="https://www.mywebsite.com/" target="_blank" rel="noopener noreferrer">https://www.mywebsite.com</a>.&nbsp; One can append a path, like <a href="https://www.mywebsite.com/users" target="_blank" rel="noopener noreferrer">https://www.mywebsite.com/users</a>. In a vulnerable application, these requests or uploads will return data or take actions without the user having logged in.</p>
<p>There are 3 separate CWE's mapped to Broken Access Control specifically tied to path traversal, CWEs <a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank" rel="noopener noreferrer">22</a>, <a href="https://cwe.mitre.org/data/definitions/23.html" target="_blank" rel="noopener noreferrer">23</a>, and <a href="https://cwe.mitre.org/data/definitions/35.html" target="_blank" rel="noopener noreferrer">35</a>. &nbsp; Tools like <a href="https://www.kali.org/tools/dirbuster/" target="_blank" rel="noopener noreferrer">DirBuster</a> and <a href="https://github.com/ffuf/ffuf" target="_blank" rel="noopener noreferrer">ffuf</a> take in wordlists and can run thousands of paths against a site automatically, logging any path that receives something other than an error, and giving malicious actors a list of potentially exploitable paths.&nbsp; Highly automated systems can do much more, scraping and analyzing the data for value, allowing the actor to scan large numbers of sites and receive a list of targets ranked by potential value.&nbsp; More so, when particular exploits are located, these actors can scan the Web and automatically scrape data in known instances of the vulnerable sites.</p>
<p><a href="https://www.hackingarticles.in/comprehensive-guide-on-path-traversal/" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/7b88062c-3f06-47a2-95c8-25cc7696acb8-847a609be6146217b71a6f3121e38e2b.png" width="937" height="449" class="img_ev3q"></a></p>
<p>These types of vulnerabilities and attacks they enable are not trivial.&nbsp; As of 5/17/24, there are <a href="https://nvd.nist.gov/vuln/search/results?isCpeNameSearch=false&amp;query=directory+traversal&amp;results_type=overview&amp;form_type=Basic&amp;search_type=all&amp;startIndex=0" target="_blank" rel="noopener noreferrer">4,846 CVEs</a> in the CVE database referring to directory traversal.&nbsp; These attacks are at the root of some of the largest incidents, <a href="https://www.infosecinstitute.com/resources/hacking/equifax-breach-exploit/" target="_blank" rel="noopener noreferrer">Equifax</a>, and <a href="https://www.exploit-db.com/exploits/30475" target="_blank" rel="noopener noreferrer">Synology NAS</a> devices, as well as popular tools like <a href="https://www.securityweek.com/poc-published-for-critical-fortra-code-execution-vulnerability/" target="_blank" rel="noopener noreferrer">Jenkins</a>.&nbsp; Even applications meant to protect corporate data, <a href="https://nvd.nist.gov/vuln/detail/CVE-2018-13379" target="_blank" rel="noopener noreferrer">Fortinet</a> and <a href="https://www.tenable.com/cve/CVE-2019-11510" target="_blank" rel="noopener noreferrer">Pulse Secure VPNs</a>, fell victim to these types of attacks.&nbsp;&nbsp;&nbsp; There have been vulnerabilities in frameworks, like Apache Struts, used to create web applications, meaning those built with these frameworks are likely to be vulnerable; this is the root vulnerability of the Equifax breach.&nbsp;</p>
<p>All the companies in the cases above have responded quickly to provide patches and other support to their customers to address the issues once discovered, but in many cases, the damage was done.&nbsp; Zero day exploits travel through the hacker community much more quickly than the affected products can respond.&nbsp; Even information for virtual patching, web application firewall rules to apply until the software can be updated and similar measures often arrive far too late.</p>
<p>The fundamental problem is that the authentication and authorization functions, those processes that make sure the user is who they say they are, and decide what they are allowed to do are part of the information system itself.&nbsp; This allows an exploit to gain critical information from unauthenticated remote users. This of the worst kinds of vulnerabilities, as it is open to the entire network for potential exploitation, either publicly on an open site, or to malicious actors and APTs within enterprise environments.&nbsp; <a href="https://openziti.io/docs/learn/quickstarts/browzer/" target="_blank" rel="noopener noreferrer">BrowZer</a>, a project of the OpenZiti project sponsored by NetFoundry, addresses this fundamental design issue by moving the authentication of the user completely outside of the actual information system only allowing authorized connections after authentication is complete.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="browzer-breaks-the-path">Browzer Breaks the Path<a href="http://localhost:3000/docs/openziti/blog/how-to-prevent-path-traversal-attacks-with-openziti-browzer#browzer-breaks-the-path" class="hash-link" aria-label="Direct link to Browzer Breaks the Path" title="Direct link to Browzer Breaks the Path">​</a></h2>
<p>BrowZer allows a completely clientless connection to protected systems by dynamically loading into the web browser a package that creates a secure connection to assets protected by OpenZiti.&nbsp; How is this different than Pulse Secure or Foritnet which also create secured tunnels?&nbsp; The BrowZer agent is completely independent of the application it is placed in front of.&nbsp; Once authenticated, using one of a multitude of authentication services, the system loads the client dynamically into the local browser and creates a new connection from that software to the OpenZiti network, which provides connectivity to the application.&nbsp; This prevents any unauthenticated user from reaching the application in question.&nbsp; Actors can't initiate a path traversal or other unauthenticated attack because it can't reach the actual application until the authentication and authorization have occurred.</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/1292c372-d81a-45d7-896f-9c0b6f2ef782-32f2d5dd586eff4cb828895e8fdbc292.png" width="1156" height="648" class="img_ev3q"></p>
<p><a href="https://openziti.io/" target="_blank" rel="noopener noreferrer">OpenZiti</a> is a software network overlay providing secure communication through a true network, with provisioning, monitoring, and highly granular communication permissions allowing microsegmentation and other Zero Trust features to be applied to networks and applications at a network connectivity level.&nbsp; This allows for a common centralized platform to allow and monitor traffic throughout a dispersed network of applications, devices, users, and workloads.&nbsp; BrowZer is one method of accessing the network's resources without having to control the system or application used to access it to load a client or embed into the software using the available SDKs.</p>]]></content>
        <author>
            <name>Mike Gorman</name>
            <uri>https://github.com/mikegorman-nf</uri>
        </author>
        <category label="Open Source" term="Open Source"/>
        <category label="Security" term="Security"/>
        <category label="CVE" term="CVE"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[zrok VPN]]></title>
        <id>http://localhost:3000/docs/openziti/blog/zrok-vpn</id>
        <link href="http://localhost:3000/docs/openziti/blog/zrok-vpn"/>
        <updated>2024-05-21T15:17:50.000Z</updated>
        <summary type="html"><![CDATA[The latest version of zrok has a new capability -- host-to-host VPN tunnel.]]></summary>
        <content type="html"><![CDATA[<p>The latest version of <a href="https://zrok.io/" target="_blank" rel="noopener noreferrer"><code>zrok</code></a> has a new capability -- host-to-host VPN tunnel.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tldr-version">TL;DR version<a href="http://localhost:3000/docs/openziti/blog/zrok-vpn#tldr-version" class="hash-link" aria-label="Direct link to TL;DR version" title="Direct link to TL;DR version">​</a></h2>
<p>On VPN <em>host</em></p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo -E zrok share private --headless --backend-mode vpn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.542]    INFO sdk-golang/ziti.(*listenerManager).createSessionWithBackoff: {session token=[589d443c-f59d-4fc8-8c48-76609b7fb402]} new service session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.705]    INFO main.(*sharePrivateCommand).run: allow other to access your share with the following command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zrok access private 3rq7torslq3n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.705]    INFO zrok/endpoints/vpn.(*Backend).Run: started</span><br></span></code></pre></div></div>
<p>On VPN <em>client</em></p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo -E zrok access private --headless 3rq7torslq3n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.201]    INFO main.(*accessPrivateCommand).run: allocated frontend '50B5hloP1s1X'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.662]    INFO main.(*accessPrivateCommand).run: access the zrok share at the following endpoint: VPN:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.662]    INFO main.(*accessPrivateCommand).run: 10.122.0.1 -&gt; CONNECTED Welcome to zrok VPN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   0.662]    INFO zrok/endpoints/vpn.(*Frontend).Run: connected:Welcome to zrok VPN</span><br></span></code></pre></div></div>
<p>At this point your VPN host and client are connect with VPN -- you can access host resources via host IP address (10.122.0.1), client IP will be from 10.122.0.0/16 block.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="longer-read">Longer Read<a href="http://localhost:3000/docs/openziti/blog/zrok-vpn#longer-read" class="hash-link" aria-label="Direct link to Longer Read" title="Direct link to Longer Read">​</a></h2>
<p>If you just want to learn more and what options are available the best place to start is on zrok <a href="https://docs.zrok.io/docs/guides/vpn/" target="_blank" rel="noopener noreferrer">doc page</a>. Also check out a ZitiTV episode where I discuss zrok VPN with the host, Clint.</p>
<p><a href="https://www.youtube.com/live/OG9z1_8FbDg?si=FNXqs8SYAMPMLggn" target="_blank" rel="noopener noreferrer">https://www.youtube.com/live/OG9z1_8FbDg?si=FNXqs8SYAMPMLggn</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-what-took-so-long">Why? What took so long?<a href="http://localhost:3000/docs/openziti/blog/zrok-vpn#why-what-took-so-long" class="hash-link" aria-label="Direct link to Why? What took so long?" title="Direct link to Why? What took so long?">​</a></h2>
<p>Both fair questions, so a little background. We (<a href="https://openziti.io/" target="_blank" rel="noopener noreferrer">OpenZiti</a> project) and me personally do not consider VPN solutions particularly zero-trust-worthy. There a number of reasons for that:</p>
<ul>
<li>
<p>VPNs operate at the network packet level not application level. This means that they will forward any matching packet into the private network whether or not there is a legitimate target for it.</p>
</li>
<li>
<p>VPNs have no concept of application access control -- meaning everyone connecting to a private network gets the same access to network resources.</p>
</li>
</ul>
<p>For those reasons we built OpenZiti on the foundation of <a href="https://openziti.io/docs/learn/introduction/features" target="_blank" rel="noopener noreferrer">strong zero-trust principals</a>.</p>
<p>...But people still <em>want</em> an easy way of remote access to home or office with <em>good enough</em> security that VPN gives them.</p>
<p>So, you want a VPN I'll build you a VPN. How hard can it really be??</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enter-zrok">Enter zrok<a href="http://localhost:3000/docs/openziti/blog/zrok-vpn#enter-zrok" class="hash-link" aria-label="Direct link to Enter zrok" title="Direct link to Enter zrok">​</a></h2>
<p>If you have not yet tried or heard about zrok, I invite you to read the <a href="http://localhost:3000/docs/openziti/blog/tags/zrok">zrok series</a> on this very blog.</p>
<p>The reasons we chose to implement VPN as part of <a href="https://zrok.io/" target="_blank" rel="noopener noreferrer">zrok</a> are the following:</p>
<ul>
<li>
<p>super easy to start and use</p>
</li>
<li>
<p>well established share/access pattern: both side are in sync on what mode is used</p>
</li>
<li>
<p>easy to add another <code>backend</code> mode</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="vpn-implementation">VPN implementation<a href="http://localhost:3000/docs/openziti/blog/zrok-vpn#vpn-implementation" class="hash-link" aria-label="Direct link to VPN implementation" title="Direct link to VPN implementation">​</a></h2>
<p>Under the hood, the zrok framework already has all the necessary components for creating shares, accessing them, and establishing connections between the <code>access</code> and <code>share</code> sides. So all I needed to do to implement VPN mode:</p>
<ul>
<li>
<p>open virtual network device (tun)</p>
</li>
<li>
<p>configure network addresses and routes</p>
</li>
<li>
<p>read packets and forward them</p>
</li>
<li>
<p>... Wait ... that was it? Took me a few hours. What was the fuss about?</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="zrok-vpn-future">zrok VPN future<a href="http://localhost:3000/docs/openziti/blog/zrok-vpn#zrok-vpn-future" class="hash-link" aria-label="Direct link to zrok VPN future" title="Direct link to zrok VPN future">​</a></h2>
<p>The initial zrok VPN release is somewhat simple and minimal. It currently provides only a host-to-host VPN functionality. We have some ideas how we want to continue improving it: better routing support, DNS, VPN mesh, mobile client -- are just some of them.</p>
<p>Please give it a try and let us know how you like it, what features you want to see, and, of course, any bugs that you encounter.</p>
<ul>
<li>
<p>Reach us on <a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer">Discourse</a></p>
</li>
<li>
<p>Check out (and star!) our repos: <a href="https://github.com/openziti/zrok" target="_blank" rel="noopener noreferrer">zrok</a>, <a href="https://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer">ziti</a>, and <a href="https://github.com/openziti" target="_blank" rel="noopener noreferrer">more</a></p>
</li>
</ul>]]></content>
        <author>
            <name>Eugene Kobyakov</name>
            <uri>https://github.com/ekoby</uri>
        </author>
        <category label="Zero Trust" term="Zero Trust"/>
        <category label="zrok" term="zrok"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Deploy OpenZiti in Kubernetes with Ease Using k3d]]></title>
        <id>http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d</id>
        <link href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d"/>
        <updated>2024-05-17T19:13:03.000Z</updated>
        <summary type="html"><![CDATA[k3d is a Kubernetes distribution for Docker that makes it easy to replicate a production-like environment in a local container environment. It's great for local development and familiarizing yourself with OpenZiti's deployment options.]]></summary>
        <content type="html"><![CDATA[<p>k3d is a Kubernetes distribution for Docker that makes it easy to replicate a production-like environment in a local container environment. It's great for local development and familiarizing yourself with <a href="https://openziti.io/docs/category/deployments" target="_blank" rel="noopener noreferrer">OpenZiti's deployment options</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-plan">The Plan<a href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d#the-plan" class="hash-link" aria-label="Direct link to The Plan" title="Direct link to The Plan">​</a></h2>
<ol>
<li>
<p>Create a k3d cluster.</p>
</li>
<li>
<p>Install the OpenZiti controller.</p>
</li>
<li>
<p>Install the OpenZiti router.</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-cluster">Create a Cluster<a href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d#create-a-cluster" class="hash-link" aria-label="Direct link to Create a Cluster" title="Direct link to Create a Cluster">​</a></h2>
<p>Prerequisite: <a href="https://k3d.io/#install-script" target="_blank" rel="noopener noreferrer"><code>k3d</code></a> CLI</p>
<p>We need a cluster with forwarded ports for the controller and a router. Run <code>k3d</code> to create a cluster.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">k3d cluster create ziti-local </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--port</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1280</span><span class="token plain">:1280@loadbalancer </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--port</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6262</span><span class="token plain">:6262@loadbalancer </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--port</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3022</span><span class="token plain">:3022@loadbalancer </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--port</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10080</span><span class="token plain">:10080@loadbalancer</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ports-breakdown">Ports Breakdown<a href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d#ports-breakdown" class="hash-link" aria-label="Direct link to Ports Breakdown" title="Direct link to Ports Breakdown">​</a></h3>
<ul>
<li>
<p>controller</p>
<ul>
<li>
<p><code>1280</code> - client API web listener</p>
</li>
<li>
<p><code>6262</code> - control plane for routers</p>
</li>
</ul>
</li>
<li>
<p>router</p>
<ul>
<li>
<p><code>3022</code> - edge listener for identities</p>
</li>
<li>
<p><code>10080</code> - link listener for other routers</p>
</li>
</ul>
</li>
</ul>
<p><em>A note about why everything's port-separated in this tutorial: It's simpler. OpenZiti uses mTLS extensively, so the cluster must pass through TLS to the controller and router pods. This tutorial uses LoadBalancer services because they provide a raw TCP proxy and are convenient with Traefik in k3d. OpenZiti can also separate services sharing a port by ALPN identifier, and Ingress/Gateway controllers can separate them by SNI.</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="find-the-node-address">Find the Node Address<a href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d#find-the-node-address" class="hash-link" aria-label="Direct link to Find the Node Address" title="Direct link to Find the Node Address">​</a></h2>
<p>Prerequisite: <a href="https://kubernetes.io/docs/tasks/tools/#kubectl" target="_blank" rel="noopener noreferrer"><code>kubectl</code></a> CLI</p>
<p>Run <code>kubectl</code> to set a shell environment variable <code>NODE_IP</code> to the LoadBalancer address. This gives us an IP address that's routable inside and outside our k3d cluster. We'll use it to invent a DNS name in a magic wildcard zone (e.g., <code>sslip.io</code>, <code>nip.io</code>).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="windows">Windows<a href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d#windows" class="hash-link" aria-label="Direct link to Windows" title="Direct link to Windows">​</a></h3>
<p>For Docker Desktop on Windows, use the WSL2 VM interface address and run the rest of the commands with BASH in WSL2.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">NODE_IP</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">getent hosts host.docker.internal </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">'{ print $1 }'</span><span class="token variable" style="color:#36acaa">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="macos">macOS<a href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d#macos" class="hash-link" aria-label="Direct link to macOS" title="Direct link to macOS">​</a></h3>
<p>For Docker Desktop on macOS, use the default host interface address.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">NODE_IP</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">ipconfig getifaddr </span><span class="token variable punctuation" style="color:#393A34">$(</span><span class="token variable" style="color:#36acaa">route get default </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">'/interface: / { print $2 }'</span><span class="token variable punctuation" style="color:#393A34">)</span><span class="token variable" style="color:#36acaa">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux">Linux<a href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d#linux" class="hash-link" aria-label="Direct link to Linux" title="Direct link to Linux">​</a></h3>
<p>For Docker daemon on Linux, use the IP of the load balancer container.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">NODE_IP</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">docker</span><span class="token variable" style="color:#36acaa"> inspect k3d-ziti-local-serverlb</span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa">jq </span><span class="token variable parameter variable" style="color:#36acaa">-r</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">'.[].NetworkSettings.Networks[].IPAddress'</span><span class="token variable" style="color:#36acaa">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-the-controller-chart">Install the Controller Chart<a href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d#install-the-controller-chart" class="hash-link" aria-label="Direct link to Install the Controller Chart" title="Direct link to Install the Controller Chart">​</a></h2>
<p>Prerequisite: <a href="https://helm.sh/docs/intro/install/" target="_blank" rel="noopener noreferrer"><code>helm</code></a> CLI</p>
<p>Run <code>helm</code> to add the OpenZiti charts repo.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"openziti"</span><span class="token plain"> https://openziti.io/helm-charts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update </span><span class="token string" style="color:#e3116c">"openziti"</span><br></span></code></pre></div></div>
<p>Install the <a href="https://cert-manager.io/docs/" target="_blank" rel="noopener noreferrer">Cert Manager</a> and <a href="https://cert-manager.io/docs/trust/trust-manager/" target="_blank" rel="noopener noreferrer">Trust Manager</a> Custom Resource Definitions so we can install them as subcharts.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> https://github.com/cert-manager/cert-manager/releases/latest/download/cert-manager.crds.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> https://raw.githubusercontent.com/cert-manager/trust-manager/v0.7.0/deploy/crds/trust.cert-manager.io_bundles.yaml</span><br></span></code></pre></div></div>
<p>Install and configure the controller to advertise the node address (i.e., the LoadBalancer address).</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade </span><span class="token parameter variable" style="color:#36acaa">--install</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ziti-controller"</span><span class="token plain"> openziti/ziti-controller </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ziti"</span><span class="token plain"> --create-namespace </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">clientApi.advertisedHost</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"client.ziti.</span><span class="token string variable" style="color:#36acaa">${NODE_IP}</span><span class="token string" style="color:#e3116c">.sslip.io"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">clientApi.advertisedPort</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1280</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">clientApi.service.type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">LoadBalancer </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ctrlPlane.advertisedHost</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"ctrl.ziti.</span><span class="token string variable" style="color:#36acaa">${NODE_IP}</span><span class="token string" style="color:#e3116c">.sslip.io"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ctrlPlane.advertisedPort</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">6262</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ctrlPlane.service.type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">LoadBalancer </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> trust-manager.app.trust.namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ziti </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> trust-manager.enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> cert-manager.enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="input-values-breakdown">Input Values Breakdown<a href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d#input-values-breakdown" class="hash-link" aria-label="Direct link to Input Values Breakdown" title="Direct link to Input Values Breakdown">​</a></h3>
<ul>
<li>
<p><code>clientApi</code></p>
<ul>
<li>
<p><code>advertisedHost</code>: FQDN that identities will connect to the control plane</p>
</li>
<li>
<p><code>advertisedPort</code>: port on the FQDN identities will connect to</p>
</li>
<li>
<p><code>service.type</code>: K8s Service type</p>
</li>
</ul>
</li>
<li>
<p><code>ctrlPlane</code></p>
<ul>
<li>
<p><code>advertisedHost</code>: FQDN that routers will connect to the control plane</p>
</li>
<li>
<p><code>advertisedPort</code>: port on the FQDN routers will connect to</p>
</li>
<li>
<p><code>service.type</code>: K8s service type</p>
</li>
</ul>
</li>
<li>
<p><a href="http://trust-manager.app.trust/" target="_blank" rel="noopener noreferrer"><code>trust-manager</code></a></p>
<ul>
<li>
<p><code>app.trust.namespace</code>: K8s Namespace where Trust Manager is allowed to read K8s Secrets to serve bundles of trusted root CA certificates</p>
</li>
<li>
<p><code>enabled</code>: install Trust Manager sub chart in the same namespace</p>
</li>
</ul>
</li>
<li>
<p><code>cert-manager</code></p>
<ul>
<li><code>enabled</code>: install Cert Manager sub chart in the same namespace</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="log-in-to-the-openziti-controller">Log in to the OpenZiti Controller<a href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d#log-in-to-the-openziti-controller" class="hash-link" aria-label="Direct link to Log in to the OpenZiti Controller" title="Direct link to Log in to the OpenZiti Controller">​</a></h2>
<p>Wait for the controller deployment to become ready.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token function" style="color:#d73a49">wait</span><span class="token plain"> deployments </span><span class="token string" style="color:#e3116c">"ziti-controller"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> ziti </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--for</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">condition</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Available</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--timeout</span><span class="token plain"> 240s</span><br></span></code></pre></div></div>
<p>Prerequisite: <a href="https://openziti.io/docs/downloads?os=Linux" target="_blank" rel="noopener noreferrer"><code>ziti</code></a> CLI</p>
<p>Get the admin's password and log in</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get secrets </span><span class="token string" style="color:#e3116c">"ziti-controller-admin-secret"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ziti"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--output</span><span class="token plain"> go-template</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'{{index .data "admin-password" | base64decode }}'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">xargs</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-rl</span><span class="token plain"> ziti edge login client.ziti.</span><span class="token variable" style="color:#36acaa">${NODE_IP}</span><span class="token plain">.sslip.io:1280 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--yes</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--username</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"admin"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--password</span><br></span></code></pre></div></div>
<p>What does this gnarly one-liner do? It's three commands. The first, <code>kubectl</code>, gets the admin password from K8s. The second command, <code>xargs</code> , tacks the password onto the end of the third, <code>ziti edge login</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-an-openziti-router">Create an OpenZiti Router<a href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d#create-an-openziti-router" class="hash-link" aria-label="Direct link to Create an OpenZiti Router" title="Direct link to Create an OpenZiti Router">​</a></h2>
<p>You must administratively create a Ziti router. The <code>-t</code> option is short for <code>--tunneler-enabled</code> and enables the built-in tunneler to be used as a reverse proxy for cluster-internal services. This will be convenient when you create your first OpenZiti service.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create edge-router </span><span class="token string" style="color:#e3116c">"router1"</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> ./router1.jwt</span><br></span></code></pre></div></div>
<p>Expected Output</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">New edge router router1 created with id: OdiqYOi9RW</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enrollment expires at </span><span class="token number" style="color:#36acaa">2024</span><span class="token plain">-05-17T20:50:59.142Z</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-the-router-chart">Install the Router Chart<a href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d#install-the-router-chart" class="hash-link" aria-label="Direct link to Install the Router Chart" title="Direct link to Install the Router Chart">​</a></h2>
<p>The token allows the router to bootstrap itself with a renewable identity from the controller.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade </span><span class="token parameter variable" style="color:#36acaa">--install</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ziti-router"</span><span class="token plain"> openziti/ziti-router </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ziti"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--set-file </span><span class="token assign-left variable" style="color:#36acaa">enrollmentJwt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">./router1.jwt </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">edge.advertisedHost</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"router1.edge.ziti.</span><span class="token string variable" style="color:#36acaa">${NODE_IP}</span><span class="token string" style="color:#e3116c">.sslip.io"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">edge.advertisedPort</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3022</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">edge.service.type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">LoadBalancer </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">linkListeners.transport.advertisedHost</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"router1.link.ziti.</span><span class="token string variable" style="color:#36acaa">${NODE_IP}</span><span class="token string" style="color:#e3116c">.sslip.io"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">linkListeners.transport.advertisedPort</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10080</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">linkListeners.transport.service.type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">LoadBalancer </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">tunnel.mode</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">host </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ctrl.endpoint</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"ctrl.ziti.</span><span class="token string variable" style="color:#36acaa">${NODE_IP}</span><span class="token string" style="color:#e3116c">.sslip.io:6262"</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="input-values-breakdown-1">Input Values Breakdown<a href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d#input-values-breakdown-1" class="hash-link" aria-label="Direct link to Input Values Breakdown" title="Direct link to Input Values Breakdown">​</a></h3>
<ul>
<li>
<p><code>enrollmentJwt</code>: This is the path to the token file you got from administratively creating the router.</p>
</li>
<li>
<p><code>edge</code></p>
<ul>
<li>
<p><code>advertisedHost</code>: FQDN identities will connect to the data plane</p>
</li>
<li>
<p><code>advertisedPort</code>: Port on the FQDN identities will connect to</p>
</li>
<li>
<p><code>service.type</code>: K8s service type</p>
</li>
</ul>
</li>
<li>
<p><code>linkListeners</code></p>
<ul>
<li>
<p><code>transport</code></p>
<ul>
<li>
<p><code>advertisedHost</code>: FQDN routers will connect to the data plane</p>
</li>
<li>
<p><code>advertisedPort</code>: port on the FQDN where routers will connect</p>
</li>
<li>
<p><code>service.type</code>: K8s service type</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>ctrl</code></p>
<ul>
<li><code>endpoint</code>: control plane address for this router to connect to</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ensure-router1-is-online">Ensure router1 is Online.<a href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d#ensure-router1-is-online" class="hash-link" aria-label="Direct link to Ensure router1 is Online." title="Direct link to Ensure router1 is Online.">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge list edge-routers</span><br></span></code></pre></div></div>
<p>Expected Output</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">╭────────────┬─────────┬────────┬───────────────┬──────┬────────────╮</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ID         │ NAME    │ ONLINE │ ALLOW TRANSIT │ COST │ ATTRIBUTES │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────┼─────────┼────────┼───────────────┼──────┼────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ OdiqYOi9RW │ router1 │ </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">   │ </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">          │    </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╰────────────┴─────────┴────────┴───────────────┴──────┴────────────╯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">-1 of </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="thats-it">That's It!<a href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d#thats-it" class="hash-link" aria-label="Direct link to That's It!" title="Direct link to That's It!">​</a></h2>
<p>Now, you can add identities and connect them with services and policies.</p>
<p>Recommended: <a href="https://openziti.io/docs/learn/quickstarts/services/kubernetes-service/" target="_blank" rel="noopener noreferrer">Kubernetes service tutorial</a>.</p>
<p>Pop into the forum if you have any ideas or issues: <a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer">https://openziti.discourse.group/</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="related">Related<a href="http://localhost:3000/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d#related" class="hash-link" aria-label="Direct link to Related" title="Direct link to Related">​</a></h2>
<ul>
<li><a href="https://openziti.io/docs/learn/quickstarts/network/local-kubernetes" target="_blank" rel="noopener noreferrer">This other Kubernetes Quickstart</a> uses Minikube instead of k3d</li>
</ul>]]></content>
        <author>
            <name>Kenneth Bingham</name>
            <uri>https://github.com/qrkourier</uri>
        </author>
        <category label="Docker" term="Docker"/>
        <category label="Kubernetes" term="Kubernetes"/>
        <category label="Self Hosted" term="Self Hosted"/>
        <category label="k3d" term="k3d"/>
        <category label="Zero Trust" term="Zero Trust"/>
        <category label="Overlay Networking" term="Overlay Networking"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Signing Executables From GitHub Actions]]></title>
        <id>http://localhost:3000/docs/openziti/blog/signing-executables-from-github-actions</id>
        <link href="http://localhost:3000/docs/openziti/blog/signing-executables-from-github-actions"/>
        <updated>2024-05-15T02:28:38.000Z</updated>
        <summary type="html"><![CDATA[Hopefully, by now, we all know that we shouldn't download and run random, untrusted executables from the internet.]]></summary>
        <content type="html"><![CDATA[<p>Hopefully, by now, we all know that we shouldn't download and run random, untrusted executables from the internet.
Users want to feel good that the code they are executing is authentic and free from malware.
<a href="https://en.wikipedia.org/wiki/Microsoft_Defender_Antivirus" target="_blank" rel="noopener noreferrer">Windows Defender</a> is one of the better things Microsoft
has done to keep the world safe. Defender is a free anti-virus application that scans executables for malicious code.
Often criticized for its intrusiveness (among other reasons), it's still a vital tool for millions of Windows users
around the globe. While it's not the only anti-virus/endpoint protection tool around, it comes with Windows by
default so making sure it doesn't tell your users your application is suspicious by popping up some scary modal
dialog is important!</p>
<p><a href="https://en.wikipedia.org/wiki/Code_signing" target="_blank" rel="noopener noreferrer">Signing an executable</a> is a cryptographic process that embeds information into the executable, allowing users to verify the software's author and ensure that the software has not been modified/tampered with after the author created and published it. Once signed, inside the file, there will be one or more digital signatures that contain an encrypted version of the file's hash. For a Windows executable, <a href="https://github.com/openziti/desktop-edge-win/blob/release-next/ZitiUpdateService/checkers/PeFile/SignedFileValidator.cs" target="_blank" rel="noopener noreferrer">calculating the file's hash</a> is <a href="https://learn.microsoft.com/en-us/windows/win32/debug/pe-format" target="_blank" rel="noopener noreferrer">too complex to outline here</a>, but the important point is that one must be able to calculate the same hash for a given file before and after signatures are added, which the PE32 format accounts for.</p>
<blockquote>
<p>using an EV cert with an online build tool like GitHub can be a bit of a pain</p>
</blockquote>
<p>The easiest, fastest, and, of course, most expensive way to make it so Windows Defender SmartScreen doesn't tell your users the executable is questionable, is to sign your executables using an <a href="https://en.wikipedia.org/wiki/Extended_Validation_Certificate" target="_blank" rel="noopener noreferrer">extended validation certificate (EV)</a>. You can save money and develop your reputation organically through users running your executable, but until the needed reputation is established, new users will be greeted by a scary modal from Windows. Using an EV cert will immediately establish the necessary trust. The OpenZiti project is sponsored by NetFoundry, so we are fortunate to have the means to purchase one of these EV certificates and use it for signing but using an EV cert with an online build tool like GitHub can be a bit of a pain.</p>
<p>Starting June 1, 2023, you are now required to store your primary key inside a <a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.140-2.pdf" target="_blank" rel="noopener noreferrer">FIPS 140 Level 2</a> module. A level 2 module is one that builds on the level 1 requirements by adding the need for additional security measures such as tamper-evident seals or coatings. As of May 2024, GitHub secrets do not meet this requirement. Previously, we had placed the key and certificate into GitHub as secrets and pulled them out as needed to sign executables but with the new rules, this is no longer adequate. We had to upgrade the mechanism we use to sign executables. Looking around the internet, for a long time, the only cloud-friendly tooling example with something like GitHub Actions I could find was a <a href="https://melatonin.dev/blog/how-to-code-sign-windows-installers-with-an-ev-cert-on-github-actions/" target="_blank" rel="noopener noreferrer">great blog from Sudara</a>, but it leveraged Azure exclusively and required a different tool. I wanted to use AWS since that's where all our dev-related tooling was already. During my search, I discovered that <a href="https://aws.amazon.com/about-aws/whats-new/2023/05/aws-kms-hsm-fips-security-level-3/" target="_blank" rel="noopener noreferrer">AWS KMS is FIPS-140 Level 3 certified</a>. Since it's level 3 is a superset of level 2, we can use it for EV Certificate signing.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="microsoft-signtool">Microsoft SignTool<a href="http://localhost:3000/docs/openziti/blog/signing-executables-from-github-actions#microsoft-signtool" class="hash-link" aria-label="Direct link to Microsoft SignTool" title="Direct link to Microsoft SignTool">​</a></h2>
<p>Microsoft provides a tool to sign executables called <code>signtool</code>. Getting Signtool is straightforward. It is included with the Microsoft Windows Software Development Kit but it's also installed by default when you install Visual Studio. If you have Visual Studio installed, you'll have <code>signtool</code>.</p>
<blockquote>
<p>you no longer need to keep the private key on the machine running signtool</p>
</blockquote>
<p>At some point in the past, signtool <a href="https://learn.microsoft.com/en-us/windows/win32/seccrypto/signtool#sign-command-options" target="_blank" rel="noopener noreferrer">was upgraded</a> to allow for the digest to be generated out-of-band from the overall signing process. Signing the digest out-of-band makes the overall process of signing an executable only slightly more complex, but has a big benefit. With this process, <strong>you will no longer need to keep the private key on the machine running signtool</strong>. This is <em>particularly</em> valuable when signing files from a cloud CI/CD pipeline like GitHub's Actions. Recently, I upgraded the process of how the <a href="https://github.com/openziti/desktop-edge-win/blob/release-next/Installer/build.ps1#L10-L33" target="_blank" rel="noopener noreferrer">OpenZiti project signs</a> the <a href="https://github.com/openziti/desktop-edge-win/releases/tag/2.1.16" target="_blank" rel="noopener noreferrer">Ziti Desktop Edge for Windows</a> to leverage detached digest signing.</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/de8bf432-8f2e-412c-b200-a3125c7d39bd-b16bfe996ababc6e3dbcf0c634294977.jpeg" width="1650" height="485" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="aws-kms-prerequisites">AWS KMS Prerequisites<a href="http://localhost:3000/docs/openziti/blog/signing-executables-from-github-actions#aws-kms-prerequisites" class="hash-link" aria-label="Direct link to AWS KMS Prerequisites" title="Direct link to AWS KMS Prerequisites">​</a></h3>
<p>To implement detached digest signing with signtool I needed a few things:</p>
<ul>
<li>
<p>A private key in AWS KMS</p>
</li>
<li>
<p>A certificate from our CA (we use <a href="https://www.globalsign.com/en" target="_blank" rel="noopener noreferrer">GlobalSign</a>) with key usage of "Digital Signature" and enhanced key usage of "Code Signing (1.3.6.1.5.5.7.3.3)".</p>
</li>
<li>
<p>A new IAM user with access the following permissions so it can list and sign data: "kms<!-- -->:ListKeys<!-- -->", "kms<!-- -->:DescribeKey<!-- -->", "kms<!-- -->:Sign<!-- -->"</p>
</li>
<li>
<p>Configured the AWS CLI with this new user</p>
</li>
</ul>
<p>The first step is to create or import a private key into AWS KMS. With the key in AWS KMS, I had to create a certificate signing request (CSR) using that private key so that I could submit it to our CA (we use <a href="https://www.globalsign.com/en" target="_blank" rel="noopener noreferrer">GlobalSign</a>) for processing. After going through their vetting process, they created the necessary signing certificate which has the key usage of "Digital Signature" and enhanced key usage of "Code Signing (1.3.6.1.5.5.7.3.3)" I could download and test out.</p>
<p>I also created a new IAM user in AWS with access only to the AWS KMS key. Since I knew I was going to be transferring this process to <a href="https://github.com/openziti/desktop-edge-win/blob/release-next/.github/workflows/installer.build.yml#L88" target="_blank" rel="noopener noreferrer">a GitHub action</a>, I did all my testing with the AWS CLI credentials of this user to ensure once I set the secrets in GitHub, I'd know the process would work.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="detached-digest-signing-with-signtool">Detached Digest Signing With Signtool<a href="http://localhost:3000/docs/openziti/blog/signing-executables-from-github-actions#detached-digest-signing-with-signtool" class="hash-link" aria-label="Direct link to Detached Digest Signing With Signtool" title="Direct link to Detached Digest Signing With Signtool">​</a></h2>
<p>With AWS CLI configured for the new user, the private key in AWS KMS, and with the EV signing cert in hand, I was ready to put a process in place to sign the executables built from the action using AWS KMS and signtool.</p>
<p>It really isn't significantly more difficult to use a detached digest signing with signtool but I couldn't find a single guide with examples that outlined the exact process. There are basically three steps you need to complete:</p>
<ul>
<li>
<p>produce the digest to sign</p>
</li>
<li>
<p>sign the digest</p>
</li>
<li>
<p>incorporate the digest into the signature and attach the signature to the file</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="producing-the-digest">Producing the Digest<a href="http://localhost:3000/docs/openziti/blog/signing-executables-from-github-actions#producing-the-digest" class="hash-link" aria-label="Direct link to Producing the Digest" title="Direct link to Producing the Digest">​</a></h3>
<p>To produce the digest you simply need to run signtool with the <code>/dg</code> parameter to indicate you want to emit the digest of the file that needs to be signed. You must also specify <code>/fd</code> (the file digest algorithm to use for creating file signatures) and <code>/f</code> (the path to the signing certificate). The exact command to generate the digest to be signed looks like this.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&amp; "$SIGNTOOL" sign /dg $digestLoc /fd sha256 /f $signingCert $exePath</span><br></span></code></pre></div></div>
<p>Here you can see the path to signtool is represented with the Powershell variable <code>$SIGNTOOL</code>. The <code>$digestLoc</code> represents the <em>directory</em> you want to emit the digest into. The file name will be the executable name + <code>.dig</code>. Don't be confused by that param. Personally, I opted to keep the digest file in the same directory as the executable so they are adjacent to one another. The signing certificate path is specified by the <code>/f</code> flag and the final parameter is the path to the executable path you want to sign. This command also creates a <code>.p7u</code> file in the <code>$digestLoc</code> that is used in the final step.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="signing-the-digest">Signing the Digest<a href="http://localhost:3000/docs/openziti/blog/signing-executables-from-github-actions#signing-the-digest" class="hash-link" aria-label="Direct link to Signing the Digest" title="Direct link to Signing the Digest">​</a></h3>
<p>With the digest generated, next, you need to sign the digest.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$tosign = Get-Content "${exePath}.dig" -Raw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$signedData = aws kms sign `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --message $tosign `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --message-type DIGEST `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --signing-algorithm "RSASSA_PKCS1_V1_5_SHA_256" `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --key-id $env:AWS_KEY_ID `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --output text `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --query "Signature"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Set-Content -Path "${exePath}.dig.signed" -Value $signedData</span><br></span></code></pre></div></div>
<p>The digest file to sign is read into a variable called <code>$tosign</code> and is read in using <code>-Raw</code> to ensure no spaces nor additional bytes are injected into the digest mistakenly (spaces, newlines, etc). Even one byte will cause the process to fail, as the SHA256 (or whatever algorithm you choose) created will change. This content is provided as the <code>--message</code> parameter.</p>
<p>Here we are sending only the digest to AWS KMS to be signed so we <strong>must</strong> specify the <code>--message-type DIGEST</code> and since I am using SHA256 in these examples, so I've asked for the corresponding <code>signing-algorithm</code>.</p>
<p>Finally, I've used an environment variable injected by <a href="https://github.com/openziti/desktop-edge-win/blob/release-next/.github/workflows/installer.build.yml#L23" target="_blank" rel="noopener noreferrer">the GitHub action</a> to specify which key is to be used to sign the data (the digest). All this content is then read into the <code>$signedData</code> variable and then written to disk as <code>${exePath}.dig.signed</code>. This file should be in the same directory as the <code>.dig</code> and executable you wish to sign.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="incorporating-the-signed-digest">Incorporating the Signed Digest<a href="http://localhost:3000/docs/openziti/blog/signing-executables-from-github-actions#incorporating-the-signed-digest" class="hash-link" aria-label="Direct link to Incorporating the Signed Digest" title="Direct link to Incorporating the Signed Digest">​</a></h3>
<p>The last step is to use the signed data file produced in the last step, incorporate it into the signature, and attach the signature to the file.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&amp; "$SIGNTOOL" sign /di $digestLoc $exePath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp; "$SIGNTOOL" timestamp /tr "http://timestamp.digicert.com" /td sha256 $exePath</span><br></span></code></pre></div></div>
<p>Notice that to ingest the signed digest into the file you only need to provide the path to the signed digest (and <code>p7u</code> file generated in the first step) and the executable itself. When these steps finish, you'll have a signed binary!</p>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/0ca65ace-4ee1-4656-b90d-c745eaba593f-0cc9210184ad3390298747e5380002d6.png" width="466" height="553" class="img_ev3q"></p>
<p>It's a good idea to add a timestamp to your signed binary using a Time Stamping Authority (TSA) of your choice. Normally, a digital signature is only considered valid as long as the signing certificate is valid. Once the certificate expires, the signature can no longer be verified. However, if the signature includes a timestamp, it shows that the code was signed while the certificate was still valid, extending the trustworthiness of the signature beyond the certificate's expiration date.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="http://localhost:3000/docs/openziti/blog/signing-executables-from-github-actions#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2>
<p>Using EV certificates isn't for everyone, it's expensive. However, using an EV cert will gain you instant reputation with Defender and for some people, that price is worth it. Even if you're not using an EV cert, using AWS KMS to sign your binaries has the added benefit of keeping your private key safer. Yes, you still need to give GitHub credentials to list the key and sign data, but if there's a catastrophic bug with GitHub actions, you can feel good that it's impossible to extract the key!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="share-the-project">Share the Project<a href="http://localhost:3000/docs/openziti/blog/signing-executables-from-github-actions#share-the-project" class="hash-link" aria-label="Direct link to Share the Project" title="Direct link to Share the Project">​</a></h2>
<p><img decoding="async" loading="lazy" src="http://localhost:3000/assets/images/7bb2b76c-af3f-45c6-83ab-d519f183024d-905dcc2bc7ef9850c54417500e23d7fa.png" width="300" height="300" class="img_ev3q"></p>
<p>If you find this interesting, please consider <a href="https://github.com/openziti/ziti/" target="_blank" rel="noopener noreferrer"><strong>starring us on GitHub</strong></a>. It really does help to support the project! And if you haven't seen it yet, check out <a href="https://github.com/openziti/ziti/" target="_blank" rel="noopener noreferrer"><strong>https://zrok.io</strong></a>. It's totally free sharing platform built on OpenZiti! It uses the OpenZiti Go SDK since it's a ziti-native application. It's also <a href="https://github.com/openziti/zrok/" target="_blank" rel="noopener noreferrer"><strong>all open source too!</strong></a></p>
<p>Tell us how you're using OpenZiti on <a href="https://twitter.com/openziti" target="_blank" rel="noopener noreferrer"><strong>X <s>twitter</s></strong></a>, <a href="https://www.reddit.com/r/openziti/" target="_blank" rel="noopener noreferrer"><strong>reddit</strong></a>, or over at our <a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer"><strong>Discourse</strong></a>. Or you prefer, check out <a href="https://youtube.com/openziti" target="_blank" rel="noopener noreferrer"><strong>our content on YouTube</strong></a> if that's more your speed. Regardless of how, we'd love to hear from you.</p>]]></content>
        <author>
            <name>Clint Dovholuk</name>
            <uri>https://github.com/dovholuknf</uri>
        </author>
        <category label="Digital Signature" term="Digital Signature"/>
        <category label="AWS KMS" term="AWS KMS"/>
        <category label="GitHub Actions" term="GitHub Actions"/>
        <category label="Signtool" term="Signtool"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[The NodeJS zrok SDK]]></title>
        <id>http://localhost:3000/docs/openziti/blog/the-nodejs-zrok-sdk</id>
        <link href="http://localhost:3000/docs/openziti/blog/the-nodejs-zrok-sdk"/>
        <updated>2024-05-06T20:51:11.000Z</updated>
        <summary type="html"><![CDATA[You may be familiar with zrok, the open-source solution built on OpenZiti, which makes it very]]></summary>
        <content type="html"><![CDATA[<p>You may be familiar with <code>zrok</code>, the open-source solution built on <a href="https://openziti.io/" target="_blank" rel="noopener noreferrer">OpenZiti</a>, which makes it very
easy to securely share resources over the internet. If you are already a <code>zrok</code> fan, that's great news -- Thank you for
being part of our community!</p>
<p>If <code>zrok</code> is new to you, please check out this post <a href="http://localhost:3000/docs/openziti/blog/introducing-zrok"><strong>introducing</strong><code>zrok</code></a>.</p>
<p><code>zrok</code> is built to enable developers to seamlessly and securely share their applications (we previously released our <a href="http://localhost:3000/docs/openziti/blog/the-zrok-sdk"><code>zrok</code> Golang SDK</a>, and our <a href="http://localhost:3000/docs/openziti/blog/the-python-zrok-sdk"><code>zrok</code> Python SDK</a>). Using just a little code enables you to share your app through <code>zrok</code>'s robust network.</p>
<p>Today we are excited to expand our <code>zrok</code> SDK philosophy by introducing a NodeJS SDK (available as of <code>zrok</code> <code>0.4.30</code>), and that is what we'll discuss in this article.</p>
<p>The package is published as <a href="https://www.npmjs.com/package/@openziti/zrok" target="_blank" rel="noopener noreferrer"><code>@openziti/zrok</code></a></p>
<p>We will be spinning up a local HTTP server to be served via <code>zrok</code>!</p>
<p>If you want to follow along you'll need to have a <code>zrok</code> environment set up. If you don't want to self-host you can sign up for a free account at <a href="https://zrok.io/" target="_blank" rel="noopener noreferrer"><strong>https://zrok.io</strong></a>.</p>
<p>Check out the <a href="https://docs.zrok.io/docs/getting-started/" target="_blank" rel="noopener noreferrer"><strong>Getting Started</strong></a> guide for more information.</p>
<p><img decoding="async" loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d9/Node.js_logo.svg/2560px-Node.js_logo.svg.png" alt="File.js logo.svg - Wikipedia" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="expanding-into-nodejs">Expanding into NodeJS<a href="http://localhost:3000/docs/openziti/blog/the-nodejs-zrok-sdk#expanding-into-nodejs" class="hash-link" aria-label="Direct link to Expanding into NodeJS" title="Direct link to Expanding into NodeJS">​</a></h2>
<p>Here is all it takes to spin up a <code>zrok</code>-enabled web server using Express:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> root </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> zrok</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> zrok</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> root </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> err</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Error </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> shr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> zrok</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">CreateShare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">zrok</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ShareRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        zrok</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">PROXY_BACKEND_MODE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> zrok</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">PRIVATE_SHARE_MODE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"http-server"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"public"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">access remotely using: 'zrok access private </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">shr</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">Token</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">'</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> zrok</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">express</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> shr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Token </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Hello zrok!</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">undefined</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">private HTTP Server is now listening for incoming requests</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Let's quickly go over what's happening here:</p>
<p>First, we use the <code>zrok</code> object to load the root config and initialize, and then we're off to the races.</p>
<p>We create a private <code>zrok</code> share, and then we call <code>zrok.express</code> using the share token we just created.</p>
<p>This <code>zrok.express</code> call spins up a NodeJS Express server, <em><strong>however</strong></em>, the Express server is transparently instrumented by the <code>zrok</code> SDK (and its embedded <a href="http://localhost:3000/docs/openziti/blog/securing-nodejs-applications">Ziti SDK for NodeJS</a>) to enable the Express web server to "bind" (i.e. host) the Ziti Service represented by the <code>zrok</code> share.</p>
<p>In other words, the NodeJS Express web server does <em><strong>NOT</strong></em> listen on an open TCP port as traditional NodeJS Express servers do (<em>because that's way too insecure</em>).</p>
<p>Instead, a <code>zrok</code>-enabled NodeJS Express server listens <em><strong>ONLY</strong></em> for incoming Ziti connections to the private <code>zrok</code> share (<em>because zero-trust connections are now considered best practice, and this is how the most robust security is done these days</em>).</p>
<p>The <code>SIGINT</code> handler at the end just handles a CTRL-C event, and tears down the <code>zrok</code> share.</p>
<p>The above example employs a <code>private</code> share. You can opt to use a <code>public</code> share if you like; in that case, you can find it <a href="http://localhost:3000/docs/openziti/blog/the-zrok-oauth-public-frontend">here</a>.</p>
<p>To expand this example from here you would simply declare any routes your app wants to expose and it's just like producing a typical Express server. No additional complications!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-though">Why <strong>Though</strong>?<a href="http://localhost:3000/docs/openziti/blog/the-nodejs-zrok-sdk#why-though" class="hash-link" aria-label="Direct link to why-though" title="Direct link to why-though">​</a></h2>
<p>The primary reason is we want this to be easy.</p>
<p>Sharing what you make should be painless. You develop the application -- let <code>zrok</code> handle all the security complications.</p>
<p>Plus you can deploy your application anywhere. As long as the environment can reach the <code>zrok</code> host controller, it can run wherever you want it to.</p>
<p>It can live in a container, cloud-hosted, or even run nicely on a home server, or dev laptop.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="coming-attractions-zrokbrowzer">Coming Attractions (zrok+BrowZer)<a href="http://localhost:3000/docs/openziti/blog/the-nodejs-zrok-sdk#coming-attractions-zrokbrowzer" class="hash-link" aria-label="Direct link to Coming Attractions (zrok+BrowZer)" title="Direct link to Coming Attractions (zrok+BrowZer)">​</a></h2>
<p>Since the above example talks about sharing an Express web server over <code>zrok</code>, I would be remiss if I didn't mention something exciting we will release soon that will alleviate a few friction points.</p>
<p>To illustrate, today if you want to spin up a web server on your laptop and then <a href="https://docs.zrok.io/docs/getting-started/#private-shares" target="_blank" rel="noopener noreferrer">share it privately with someone</a>, the person you are sharing it with will need to:</p>
<ul>
<li>
<p>download the <code>zrok</code> binary, then</p>
</li>
<li>
<p>execute a specific <code>zrok</code> command (which starts a local HTTP listener), then</p>
</li>
<li>
<p>point their browser at that HTTP listener (typically running at <code>http://127.0.0.1:9191</code>)</p>
</li>
</ul>
<p>The above technology certainly works in many scenarios, but there are use cases where it may not...</p>
<p>For example, it's possible that the person you are sharing your local web server with is not tech-savvy (e.g. my grandmother) and they can't successfully obtain and/or run the <code>zrok</code> commands on their client.</p>
<p>Another use case is when the remote person can't install new tooling on their machine due to a lack of permission (e.g. IT restrictions). Or they can, but they elect not to.</p>
<p>Another use case is when you want to share your web app with someone who wants to access it on their mobile phone (where <code>zrok</code> binaries simply can't be installed).</p>
<p>The above use cases could be supported perfectly if only you could share a (<em>magic</em>) URL with the people you want to share your private web server with. This is because every laptop and mobile phone already has a ubiquitous web browser, so your friends, family, and colleagues already have what they need...except the URL...</p>
<p>So what's this magic URL, and what makes it "magic"?</p>
<p>The URL you will share with people will resemble this: <code>https://&lt;SOME_SHARE_TOKEN&gt;/zrok.browzer.cloudziti.io</code></p>
<p>(<code>SOME_SHARE_TOKEN</code> is produced by your <code>zrok share private</code> command)</p>
<p><a href="http://localhost:3000/docs/openziti/blog/introducing-openziti-browzer">OpenZiti BrowZer provides the magic</a> that ties everything together. We are currently testing this new <code>zrok+BrowZer</code> functionality and we will release it soon.</p>
<p>Once it has been shipped, we will be back here posting articles that discuss all the details, so be sure to subscribe to this blog's newsletter so you don't miss the announcements.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="moving-forward">Moving Forward<a href="http://localhost:3000/docs/openziti/blog/the-nodejs-zrok-sdk#moving-forward" class="hash-link" aria-label="Direct link to Moving Forward" title="Direct link to Moving Forward">​</a></h2>
<p>Moving forward we want <code>zrok</code> to be as accessible as possible, both in options and ease of use. Support for more languages is coming! If you want to talk about languages to support or friction points, please reach out on <a href="https://openziti.discourse.group/c/zrok/24" target="_blank" rel="noopener noreferrer">Discourse</a>!</p>
<p><a href="https://openziti.discourse.group/c/zrok/24" target="_blank" rel="noopener noreferrer"><br>
</a>Also if you like <code>zrok</code> or OpenZiti and want to support it, we would very much appreciate you dropping a star on both <a href="https://github.com/openziti/zrok" target="_blank" rel="noopener noreferrer">Github (zrok)</a> / <a href="https://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer">Github (OpenZiti)</a>.</p>
<p>It means a lot!</p>]]></content>
        <author>
            <name>Curt Tudor</name>
            <uri>https://github.com/rentallect</uri>
        </author>
        <category label="Web Development" term="Web Development"/>
        <category label="Security" term="Security"/>
        <category label="NodeJS" term="NodeJS"/>
        <category label="zrok" term="zrok"/>
    </entry>
</feed>