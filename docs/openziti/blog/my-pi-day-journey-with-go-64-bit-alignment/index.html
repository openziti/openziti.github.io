<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true"></title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:url" content="http://localhost:3000/docs/openziti/blog/my-pi-day-journey-with-go-64-bit-alignment"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="robots" content="index, follow"><meta data-rh="true" property="og:title" content="My Pi Day Journey with Go 64-bit alignment | OpenZiti"><meta data-rh="true" name="description" content="A few days ago, we had a user bring to our attention, a failure of OpenZiti on a Raspberry Pi 4 running a 32-bit operating system. As I got started investigating the bug, I smirked a little as it just so happened to be Pi day (March 14th)."><meta data-rh="true" property="og:description" content="A few days ago, we had a user bring to our attention, a failure of OpenZiti on a Raspberry Pi 4 running a 32-bit operating system. As I got started investigating the bug, I smirked a little as it just so happened to be Pi day (March 14th)."><meta data-rh="true" property="og:image" content="http://localhost:3000/@site/blogs/openziti/v1678975036152/5a834580-b0f3-481b-9409-61c697ed719b.png"><meta data-rh="true" name="twitter:image" content="http://localhost:3000/@site/blogs/openziti/v1678975036152/5a834580-b0f3-481b-9409-61c697ed719b.png"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-03-17T13:07:52.000Z"><meta data-rh="true" property="article:author" content="https://github.com/gberl002"><meta data-rh="true" property="article:tag" content="golang,Raspberry Pi,Troubleshooting,OpenZiti"><meta data-rh="true" data-rh="true" name="nf-layout-version" content="0.0.168"><meta data-rh="true" name="twitter:card" content="summary_large_image"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="http://localhost:3000/docs/openziti/blog/my-pi-day-journey-with-go-64-bit-alignment"><link data-rh="true" rel="alternate" href="http://localhost:3000/docs/openziti/blog/my-pi-day-journey-with-go-64-bit-alignment" hreflang="en"><link data-rh="true" rel="alternate" href="http://localhost:3000/docs/openziti/blog/my-pi-day-journey-with-go-64-bit-alignment" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EXWPKK5PV4-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"http://localhost:3000/docs/openziti/blog/my-pi-day-journey-with-go-64-bit-alignment","mainEntityOfPage":"http://localhost:3000/docs/openziti/blog/my-pi-day-journey-with-go-64-bit-alignment","url":"http://localhost:3000/docs/openziti/blog/my-pi-day-journey-with-go-64-bit-alignment","headline":"My Pi Day Journey with Go 64-bit alignment","name":"My Pi Day Journey with Go 64-bit alignment","description":"A few days ago, we had a user bring to our attention, a failure of OpenZiti on a Raspberry Pi 4 running a 32-bit operating system. As I got started investigating the bug, I smirked a little as it just so happened to be Pi day (March 14th).","datePublished":"2023-03-17T13:07:52.000Z","author":{"@type":"Person","name":"Geoff Berl","description":"Author","url":"https://github.com/gberl002","image":"https://avatars.githubusercontent.com/gberl002"},"image":{"@type":"ImageObject","@id":"http://localhost:3000/@site/blogs/openziti/v1678975036152/5a834580-b0f3-481b-9409-61c697ed719b.png","url":"http://localhost:3000/@site/blogs/openziti/v1678975036152/5a834580-b0f3-481b-9409-61c697ed719b.png","contentUrl":"http://localhost:3000/@site/blogs/openziti/v1678975036152/5a834580-b0f3-481b-9409-61c697ed719b.png","caption":"title image for the blog post: My Pi Day Journey with Go 64-bit alignment"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"http://localhost:3000/docs/openziti/blog","name":"Blog"}}</script><script>!function(t,h,e,j,s,n){t.hj=t.hj||function(){(t.hj.q=t.hj.q||[]).push(arguments)},t._hjSettings={hjid:3576473,hjsv:6},s=h.getElementsByTagName("head")[0],(n=h.createElement("script")).async=1,n.src="https://static.hotjar.com/c/hotjar-"+t._hjSettings.hjid+".js?sv="+t._hjSettings.hjsv,s.appendChild(n)}(window,document)</script>
<link rel="alternate" type="application/rss+xml" href="/docs/openziti/blog/rss.xml" title="OpenZiti RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/openziti/blog/atom.xml" title="OpenZiti Atom Feed">

<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-5SF399H3",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>





<link rel="search" type="application/opensearchdescription+xml" title="OpenZiti" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.273075c6.css">
<script src="/assets/js/runtime~main.6236f723.js" defer="defer"></script>
<script src="/assets/js/main.d05d9df4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5SF399H3" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>



<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/ziti-logo-dark.svg"><link rel="preload" as="image" href="/img/ziti-logo-light.svg"><link rel="preload" as="image" href="https://avatars.githubusercontent.com/gberl002"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/"><div class="navbar__logo"><img src="/img/ziti-logo-dark.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/ziti-logo-light.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item"><a class="navbar__item navbar__link header-netfoundry-link" href="https://netfoundry.io/products/netfoundry-cloud-30-day-free-trial/" target="_blank">NetFoundry</a></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/openziti/learn/introduction/">Documentation</a><a class="navbar__item navbar__link" href="/docs/openziti/downloads">Downloads</a><div class="navbar__item"><a class="navbar__item navbar__link header-netfoundry-link" href="https://blog.openziti.io/" target="_blank">Blog</a></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Links</a><ul class="dropdown__menu"><li class=""><div class="text-divider"><p>Socials</p></div></li><li class=""><a href="https://www.youtube.com/OpenZiti" target="_blank" title="OpenZiti on YouTube"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/yt.svg" alt="YouTube logo">YouTube</span></a></li><li class=""><a href="https://x.com/OpenZiti" target="_blank" title="OpenZiti on X(formerly Twitter)"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/twit.svg" alt="X/Twitter logo">X (Twitter)</span></a></li><li class=""><a href="https://www.reddit.com/r/openziti" target="_blank" title="OpenZiti Subreddit"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/reddit-logo.png" alt="Reddit logo">Reddit</span></a></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/ziggy.png" alt="X/Twitter Ziggy logo"><a href="https://x.com/OpenZiggy" target="_blank" title="OpenZiggy on X(formerly Twitter)">Ziggy</a></span></li><li class=""><div class="text-divider"><p>Other</p></div></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/blog-icon.png" alt="OpenZiti blog logo"><a href="https://blog.openziti.io/" target="_blank" title="Blog">Blog</a></span></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/oz-test-kitchen.png" alt="OpenZiti Test Kitchen logo"><a href="https://github.com/openziti-test-kitchen" target="_blank" title="Git project for the test kitchen">Test Kitchen</a></span></li></ul></div><a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discourse-link" title="Discourse"></a><a href="https://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="styles-module_starUsRoot__hMNZp"><span style="color:whitesmoke">Star Us on GitHub<!-- --> </span><span style="height:20px"><span><a href="https://github.com/openziti/ziti" data-icon="octicon-star" data-show-count="true" aria-label="Star buttons/github-buttons on GitHub">Star</a></span></span></div><div class="main-wrapper NetFoundryLayout-module_ozLayoutMainWrapper__a2vwh"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/introducing-zrok-10">Introducing zrok 1.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-unleashed-top-10-uses-explored">zrok Unleashed: Top 10 Uses Explored</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-ziti-identities-with-hsmtpm">Securing Ziti Identities with HSM/TPM</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-custom-domains">zrok Custom Domains</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/golang-aha-moments-oop">Golang Aha! Moments: OOP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-safest-way-to-make-portainer-internet-accessible">The safest way to make Portainer Internet accessible</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/multifactor-zero-trust-ssh">Multifactor Zero Trust ssh</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zero-trust-sshclient">Zero Trust *ssh.Client</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/effortless-docker-management-with-private-web-access">Effortless Docker Management</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-is-growing-up">zrok is Growing Up</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-vpn-linux-service">Easy Steps to Install a Private VPN on Linux with zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/jitsi-meet-zrok">Jitsi, meet zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/extend-access-to-a-private-s3-bucket-using-python">Extend Access to a Private S3 Bucket Using Python</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/why-we-verify-github-commits">Why We Verify GitHub Commits</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/limitless-zrok-with-docker">Limitless zrok with Docker</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/how-to-prevent-path-traversal-attacks-with-openziti-browzer">How to Prevent Path Traversal Attacks with OpenZiti BrowZer</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-vpn">zrok VPN</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d">Deploy OpenZiti in Kubernetes with Ease Using k3d</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/signing-executables-from-github-actions">Signing Executables From GitHub Actions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-nodejs-zrok-sdk">The NodeJS zrok SDK</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/no-listening-ports">No Listening Ports?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/announcing-openziti-v1">Announcing OpenZiti v1.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/pixy-dust-for-web-applications-pkce">Pixy Dust For Web Applications</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/secure-remote-development-with-zrok-and-jetbrains">Secure Remote Development with zrok and JetBrains</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-permission-modes">zrok Permission Modes</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-zrok-socks-backend">The zrok SOCKS Backend</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-python-zrok-sdk">The Python zrok SDK</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-dedicated-palworld-server-with-zrok">Securing a Dedicated  Palworld Server For My Family with zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/fun-with-adaptive-rate-limiting">Fun with Adaptive Rate Limiting</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-zrok-drives-cli-preview">The zrok Drives CLI Preview</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/minecraft-over-zrok">Minecraft Over zrok</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/go-is-amazing-for-zero-trust">Go is Amazing for Zero Trust</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-frontdoor">zrok frontdoor</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/business-rule-driven-just-in-time-network-access">Business Rule Driven Just-in-Time Network Access</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-drives-an-early-preview">zrok Drives (an Early Preview)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/put-some-ziti-in-your-caddy">Put some Ziti in your Caddy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-zrok-oauth-public-frontend">The zrok OAuth Public Frontend</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-azure-openai-applications-with-openziti">Securing Azure OpenAI Applications with OpenZiti</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openziti-zero-trust-iot-wi-fi-gateway">OpenZiti Zero Trust IoT Wi-Fi Gateway</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-with-the-power-of-caddy">zrok with the Power of Caddy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-zrok-sdk">The zrok SDK</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/got-5-minutes-secure-your-python-website-with-zero-trust">Got 5 Minutes? Secure Your Python Website with Zero Trust.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/announcing-the-zrok-public-beta">Announcing the zrok Public Beta!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-v040-released">zrok v0.4.0 Released!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/commercial-open-source-and-ethical-and-practical-community-engagement">Commercial Open Source and Ethical (and practical) Community Engagement</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/docs/openziti/blog/my-pi-day-journey-with-go-64-bit-alignment">My Pi Day Journey with Go 64-bit alignment</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/private-dns-on-windows">Private DNS on Windows</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/websockets-over-zrok">Websockets over zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openapi-python-clients">OpenAPI Python Clients</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/postman-mgmt">Postman and the Management API</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-road-ahead-for-zrok">The Road Ahead for zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/auto-complete">Ziti Shell Auto-Complete</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/introducing-zrok">Introducing zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/connecting-to-local-development-environment-from-cloud-hosts-with-zrok">Connecting to Local Development Environment from Cloud Hosts with zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/lessons-learned-writing-a-zero-trust-nginx-module">Lessons Learned Writing a Zero Trust NGINX Module</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zero-trust-monitoring-with-openziti">Zero Trust Monitoring with OpenZiti</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2022</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/its-a-zitiful-life">It&#x27;s A Zitiful Life</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/nginx-zerotrust-api-security">NGINX &amp; ZeroTrust API Security</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/using-ebpf-tc-to-securely-mangle-packets-in-the-kernel-and-pass-them-to-my-secure-networking-application">Using eBPF-TC to securely mangle packets in the kernel, and pass them to my secure networking application</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/browzer-gateway-fqdn-certs">OpenZiti BrowZer Gateway</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openziti-authentication-api-integrations">OpenZiti Authentication API Integrations</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/high-level-publicprivate-cryptography">High-Level Public/Private Cryptography</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/set-up-a-secure-multiplayer-minecraft-server">Set Up a Secure Multiplayer Minecraft Server</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/setting-up-oracle-cloud-to-host-openziti">Setting Up Oracle Cloud To Host OpenZiti</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/integrating-ziti-is-easy">Integrating Ziti is Easy! How we got our app tested with go-httpbin</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/golang-aha-moments-generics">Golang Aha! Moments: Generics</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-nodejs-applications">Securing NodeJS Applications — An Introduction to the OpenZiti SDK for NodeJS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openziti-is-participating-in-hacktoberfest-prost">OpenZiti is Participating in Hacktoberfest, Prost!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openziti-python-sdk-introduction">OpenZiti Python SDK: Introduction</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/free-secure-access-to-nas-from-anywhere">Free Secure Access to NAS From Anywhere</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/introducing-openziti-browzer">Introducing OpenZiti BrowZer</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/golang-aha-moments-channels">Golang Aha! Moments: Channels</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zero-trust-overlay-network-to-access-homeassistant">I Created a Zero Trust Overlay Network to Access HomeAssistant</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/my-intern-assignment-call-a-dark-webhook-from-aws-lambda">My Intern Assignment - Call a Dark Webhook from AWS Lambda</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/extrovert-wednesday">Extrovert Wednesday</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-web-apis-with-openziti">Securing Web APIs With OpenZiti — Zero Trust For Web APIs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/tunneling-voip-over-openziti">Tunneling VoIP over OpenZiti</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-5-bootstrapping-trust">Bootstrapping Trust Part 5</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-4-certificate-authorities-chains-of-trust">Bootstrapping Trust Part 4</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-3-certificates">Bootstrapping Trust Part 3 - Certificates</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-2-a-primer-on-public-key-cryptography">Bootstrapping Trust Part 2 - PKI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-1-encryption-everywhere">Bootstrapping Trust Part 1 - Encryption Everywhere</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/configuring-openziti-to-enable-prometheus">Configuring OpenZiti to Enable Prometheus</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/prometheus-scrape-anything-from-anywhere">Prometheus - Scrape Anything from Anywhere</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/scraping-anything-anywhere-in-action">Scraping Anything, Anywhere in Action</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2021</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/kubernetes">Tunneling Ingress to Kubernetes Workloads</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zitifying-scp">Zitifying SCP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zitifying-ssh">Zitifying SSH</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zitification">Zitification</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2020</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/mobile-point-of-sale-mpos-app-ziti-android-java-sdk-integration">Mobile Point of Sale (mPOS) app – embed zero trust networking</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">My Pi Day Journey with Go 64-bit alignment</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-03-17T13:07:52.000Z">March 17, 2023</time> · <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/gberl002" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/gberl002" alt="Geoff Berl"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/gberl002" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Geoff Berl</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>A few days ago, we had a user bring to our attention, a failure of OpenZiti on a Raspberry Pi 4 running a 32-bit operating system. As I got started investigating the bug, I smirked a little as it just so happened to be Pi day (March 14th).</p>
<p>In any case, the error presented looked like this.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">panic: unaligned </span><span class="token number" style="color:#36acaa">64</span><span class="token plain">-bit atomic operation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">goroutine </span><span class="token number" style="color:#36acaa">118</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">running</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime/internal/atomic.panicUnaligned</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        runtime/internal/atomic/unaligned.go:8 +0x24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime/internal/atomic.Load64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x45a8354</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        runtime/internal/atomic/atomic_arm.s:280 +0x14</span><br></span></code></pre></div></div>
<p>My immediate thought was, you must be running a 64-bit binary on a 32-bit system. But, to my surprise, the user responded, assuring me they were using the 32-bit arm release.</p>
<p>Well, it seemed it was time to dig my raspberry pi out of the abyss of untouched, but of course, still running Raspberry Pis I had around my house. I installed a 32-bit and 64-bit OS on two different SD cards and started my journey.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="64-bit-raspbian">64 Bit Raspbian<a href="#64-bit-raspbian" class="hash-link" aria-label="Direct link to 64 Bit Raspbian" title="Direct link to 64 Bit Raspbian">​</a></h3>
<p>The 64-bit <a href="https://netfoundry.io/docs/openziti/learn/quickstarts/network/local-no-docker" target="_blank" rel="noopener noreferrer">expressInstall</a> process went swimmingly, with no issues at all. I started up the router, and zipped through some boilerplate commands I have to test out an OpenZiti network locally. No problems, I hadn&#x27;t expected any since the user seeing the issue is running a 32-bit OS, but I had to be sure.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-bit-raspbian">32 Bit Raspbian<a href="#32-bit-raspbian" class="hash-link" aria-label="Direct link to 32 Bit Raspbian" title="Direct link to 32 Bit Raspbian">​</a></h3>
<p>Onto the 32-bit Raspbian, I went, again, <a href="https://netfoundry.io/docs/openziti/learn/quickstarts/network/local-no-docker" target="_blank" rel="noopener noreferrer">expressInstall</a> is no problem. I start up the router, annnnd there it is.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ startRouter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1486</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Express Edge Router started as process id: </span><span class="token number" style="color:#36acaa">1486</span><span class="token plain">. log located at: /home/gberl001/.ziti/quickstart/raspberrypi/raspberrypi-edge-router.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">+  Exit </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">                  </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${ZITI_BIN_DIR}</span><span class="token string" style="color:#e3116c">/ziti&quot;</span><span class="token plain"> router run </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${ZITI_HOME_OS_SPECIFIC}</span><span class="token string" style="color:#e3116c">/</span><span class="token string variable" style="color:#36acaa">${ZITI_EDGE_ROUTER_RAWNAME}</span><span class="token string" style="color:#e3116c">.yaml&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${log_file}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:#393A34">2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token file-descriptor important">&amp;1</span><br></span></code></pre></div></div>
<p>I checked the router log, and sure enough <code>panic: unaligned 64-bit atomic operation</code>.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin">panic</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> unaligned </span><span class="token number" style="color:#36acaa">64</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">bit atomic operation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">goroutine </span><span class="token number" style="color:#36acaa">41</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">running</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">internal</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">atomic</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">panicUnaligned</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        runtime</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">internal</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">atomic</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">unaligned</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">go</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">0x24</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">internal</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">atomic</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Load64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x638f404</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        runtime</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">internal</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">atomic</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">atomic_arm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">280</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">0x14</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">github</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">openziti</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">channel</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">v2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">heartbeater</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Tx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x638f3e0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x5e06080</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0x2eb5ecc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x63862d0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        github</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">openziti</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">channel</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">v2@v2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token number" style="color:#36acaa">0.27</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">heartbeater</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">go</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">82</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">0x1b8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">github</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">openziti</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">channel</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">v2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">channelImpl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">txer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x63862d0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        github</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">openziti</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">channel</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">v2@v2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token number" style="color:#36acaa">0.27</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">impl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">go</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">422</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">0x984</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">created by github</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">openziti</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">channel</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">v2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">channelImpl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">startMultiplex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        github</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">openziti</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">channel</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">v2@v2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token number" style="color:#36acaa">0.27</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">impl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">go</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">287</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">0x128</span><br></span></code></pre></div></div>
<p>So I traced the stack to the location where it failed, and I see it&#x27;s trying to load an int in an atomic operation.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> unrespondedHeartbeat </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> atomic</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LoadInt64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unrespondedHeartbeat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> unrespondedHeartbeat </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		m</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">PutUint64Header</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HeartbeatResponseHeader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">unrespondedHeartbeat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		atomic</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">StoreInt64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unrespondedHeartbeat</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">events </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">heartbeatRespTxEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">now</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>This led me to do as every programmer does, look online for an answer, fingers crossed for a stack-overflow post haha. Of course, I saw a bunch of responders who had my initial reaction, thinking it was a 64-bit binary on a 32-bit OS they said, &quot;switch to Raspbian 64-bit,&quot; and went on with their day. While that <em>is</em> <em>a</em> solution, it&#x27;s not the right one, the right solution would be to fix the issue with the binary that is supposed to run on a 32-bit OS. But, like me, they didn&#x27;t know the real cause of the problem. I removed the keywords &quot;Raspberry&quot; and &quot;Pi&quot; from my search and got much better results, leading me to <a href="https://github.com/golang/go/issues/36606" target="_blank" rel="noopener noreferrer">this GitHub issue</a> which ultimately (after carefully reading and following a rabbit hole of links) got me to a point where I better understood what was going on.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-cause">The Cause<a href="#the-cause" class="hash-link" aria-label="Direct link to The Cause" title="Direct link to The Cause">​</a></h3>
<p>It&#x27;s not every day you hear about unaligned memory-related operations, and this is generally because the compiler handles these messes for you automatically. In fact, I have never experienced an issue like this and had no idea this was even a thing. Hence, my first assumption was that it was simply a 64-bit binary on a 32-bit OS. This is somewhat of a unique situation as it&#x27;s specific to 64-bit atomic operations in Golang. I don&#x27;t pretend to understand the Golang compiler well enough to know why this is only an issue with atomic operations or why this is even an issue at all, as generally, compilers will add padding to align data automatically, you can see much more information on that in this <a href="https://en.wikipedia.org/wiki/Data_structure_alignment" target="_blank" rel="noopener noreferrer">Wikipedia article</a>, which is surprisingly well-written and understandable. But, what I can say is, the problem lies in the fact that memory is byte addressable, and is accessed by a single word size at a time. The word size changes depending on the architecture. On arm, and other 32-bit architectures, this is 32 bits, so the processing word size will be 4 bytes. My guess as to the root of this problem lies in the nature of atomic operations. When memory addresses for data are properly aligned, it should only take one cycle to read the data, if it is misaligned, then it would take more than one cycle and, thus, likely cannot guarantee atomicity. As mentioned, I&#x27;m not entirely positive on this, that&#x27;s just my interpretation, so if you have any input on this, I&#x27;d love to hear it in the comments.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-fix">The Fix<a href="#the-fix" class="hash-link" aria-label="Direct link to The Fix" title="Direct link to The Fix">​</a></h3>
<p>As stated by the <a href="https://pkg.go.dev/sync/atomic#pkg-note-BUG" target="_blank" rel="noopener noreferrer">Golang documentation</a> (link thanks to the treasure trove of information starting, in one way or another, from the original GitHub issue), it is the caller&#x27;s responsibility to arrange for 64-bit alignment of 64-bit words accessed atomically on a 32-bit architecture. To do this, the 64-bit variables need to be aligned with an 8-byte word boundary. Essentially, if the address is not divisible by 8, we&#x27;re going to see this issue. So, I need to find every 64-bit variable that has an atomic operation performed on it, then see if that is stored in a data structure. If the variable is stored in a data structure, I then need to ensure the alignment is at an 8-byte word boundary.</p>
<p>I whipped up a quick little test using <code>Alignof</code>, <code>Sizeof</code>, and <code>Offsetof</code> from the <code>unsafe</code> package in Golang as is documented <a href="https://go.dev/ref/spec#Size_and_alignment_guarantees" target="_blank" rel="noopener noreferrer">here</a>, to show the offsets of variables in a suspected struct, there is a bit of extra information as I was still not totally sure what I was looking for.</p>
<p>Here&#x27;s the struct containing the problem variable; <code>unrespondedHeartbeat</code>.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> heartbeater </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ch                   Channel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	lastHeartbeatTx      </span><span class="token builtin">int64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	heartBeatIntervalNs  </span><span class="token builtin">int64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	callback             HeartbeatCallback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	events               </span><span class="token keyword" style="color:#00009f">chan</span><span class="token plain"> heartbeatEvent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	unrespondedHeartbeat </span><span class="token builtin">int64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>And, here&#x27;s the quick test showing Alignof, Sizeof, and Offsetof for each variable in the struct.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TestAlignment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">testing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	hb </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> heartbeater</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Channel Alignof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Alignof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ch</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;lastHearbeatTx Alignof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Alignof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lastHeartbeatTx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;heartBeatInternalNs Alignof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Alignof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">heartBeatIntervalNs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Callback Alignof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Alignof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;chan heartbeatEvent Alignof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Alignof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">events</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;unrespondedHeartbeat Alignof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Alignof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unrespondedHeartbeat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;\n\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Channel Sizeof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ch</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;lastHearbeatTx Sizeof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lastHeartbeatTx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;heartBeatInternalNs Sizeof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">heartBeatIntervalNs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Callback Sizeof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;chan heartbeatEvent Sizeof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">events</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;unrespondedHeartbeat Sizeof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unrespondedHeartbeat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;\n\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Channel Offsetof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Offsetof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ch</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;lastHearbeatTx Offsetof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Offsetof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lastHeartbeatTx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;heartBeatInternalNs Offsetof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Offsetof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">heartBeatIntervalNs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Callback Offsetof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Offsetof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;chan heartbeatEvent Offsetof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Offsetof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">events</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;unrespondedHeartbeat Offsetof: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Offsetof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unrespondedHeartbeat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>And, here are the results (run on the Raspberry Pi of course); can you spot the issue?</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token keyword" style="color:#00009f">go</span><span class="token plain"> test </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">v </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">run TestAlignment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> RUN   TestAlignment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Channel Alignof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lastHearbeatTx Alignof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heartBeatInternalNs Alignof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Callback Alignof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">chan</span><span class="token plain"> heartbeatEvent Alignof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unrespondedHeartbeat Alignof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Channel Sizeof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lastHearbeatTx Sizeof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heartBeatInternalNs Sizeof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Callback Sizeof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">chan</span><span class="token plain"> heartbeatEvent Sizeof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unrespondedHeartbeat Sizeof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Channel Offsetof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lastHearbeatTx Offsetof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heartBeatInternalNs Offsetof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Callback Offsetof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">24</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">chan</span><span class="token plain"> heartbeatEvent Offsetof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unrespondedHeartbeat Offsetof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">36</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> PASS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TestAlignment </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">00s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PASS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok  	github</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">openziti</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">channel</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">v2	</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">014s</span><br></span></code></pre></div></div>
<p>If you guessed that <code>unrespondedHeartbeat</code>&#x27;s offset is not at an 8-byte word boundary, then go congratulate yourself and buy that gadget on your Amazon wish list you&#x27;ve had on there for years but know you don&#x27;t need. The variable needed to be at an 8-byte boundary, an offset of 36 is not an 8-byte boundary. The variable <code>chan</code>, which is a pointer, hence the 4 bytes, is the reason, and seeing that chan <em>was</em> at an 8-byte word boundary, I simply popped that guy (<code>unrespondedHeartbeat</code>) up before <code>chan</code> and that put it at an offset of 32. Here&#x27;s what I got after moving it up before <code>chan</code>. Bear in mind, since I reordered the struct, I reordered the test outputs to keep my sanity.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token keyword" style="color:#00009f">go</span><span class="token plain"> test </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">v </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">run TestAlignment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> RUN   TestAlignment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Channel Alignof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lastHearbeatTx Alignof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heartBeatInternalNs Alignof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Callback Alignof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unrespondedHeartbeat Alignof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">chan</span><span class="token plain"> heartbeatEvent Alignof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Channel Sizeof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lastHearbeatTx Sizeof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heartBeatInternalNs Sizeof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Callback Sizeof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unrespondedHeartbeat Sizeof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">chan</span><span class="token plain"> heartbeatEvent Sizeof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Channel Offsetof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lastHearbeatTx Offsetof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heartBeatInternalNs Offsetof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Callback Offsetof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unrespondedHeartbeat Offsetof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">24</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">chan</span><span class="token plain"> heartbeatEvent Offsetof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> PASS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TestAlignment </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">00s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PASS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok  	github</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">openziti</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">channel</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">v2	</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">015s</span><br></span></code></pre></div></div>
<p>With <code>unrespondedHeartbeat</code> having an offset of 24, all is right with the world, well, it is for 32-bit arm devices that can now be used to run OpenZiti. An alternative is that I could have put some padding after chan to bump <code>unrespondedHeartbeat</code>&#x27;s offset to 40, which would make it an 8-byte boundary. I guess there are pros and cons to each. There is even a third option, I could have moved all of the int64 variables to the beginning of the struct since the first one will clearly start at offset 0, with each being an 8-byte variable any int64 immediately following would be guaranteed as well. But who&#x27;s to say someone doesn&#x27;t come in down the road and add a variable right at the beginning of the struct and throw everything off? I opted not to go into analysis paralysis and just pick one, any solution was just a one-line commit away from being broken in the future.</p>
<p>This <a href="https://xkcd.com/" target="_blank" rel="noopener noreferrer">xkcd</a> sums up my pragmatic decision nicely.</p>
<p><img decoding="async" loading="lazy" src="https://imgs.xkcd.com/comics/efficiency.png" alt="Efficiency" class="img_ev3q"></p>
<p>I knew this wasn&#x27;t going to be the only case, there was no way that more wouldn&#x27;t appear in this project and many other projects used by OpenZiti. So, the easiest way I could come up with to solve this across the board was to, as before, find all variables which have atomic 64-bit operations performed on them, and check if they are in a data structure. To start this venture, I put together a quick little regex and grepped it across the project, to pull out all 64-bit variables having atomic operations performed on them. Unfortunately, Mac grep doesn&#x27;t have Perl regex so there&#x27;s a little quirk in my regex to make it &quot;non-greedy&quot;.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--include</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">*.go </span><span class="token parameter variable" style="color:#36acaa">-irn</span><span class="token plain"> ./ </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;atomic\.[^6]*64(&quot;</span><br></span></code></pre></div></div>
<p>This resulted in the following, a quick copy-paste into Sublime Text and regex to extract the variable names.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/0335faba-14a4-4457-bebd-7e9f2f80c67d-bbb1934be44508b4e6fceb0048da849a.png" width="1868" height="318" class="img_ev3q"></p>
<p>There&#x27;s no quick way to determine if they are in a data structure so I just used a search across the project for each variable, then jumped to the declaration of that variable. There were only nine results, and of those, only three distinct variables. I wrote a test that attempted to perform an atomic operation on any variable that I found to be in a struct, and checked if it failed. After collecting them all, and running the test, I investigated any failures and left the rest alone.</p>
<p>Here&#x27;s what my new test looked like</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Test64BitAlignment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">testing</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> r </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">recover</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> r </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Errorf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;One of the variables that was tested is not properly 64-bit aligned.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	hb </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> heartbeater</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	chImpl </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> channelImpl</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	atomic</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LoadInt64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lastHeartbeatTx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	atomic</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LoadInt64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">hb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unrespondedHeartbeat</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	atomic</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LoadInt64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">chImpl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lastRead</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>I repeated this process for other projects and found a few more spots where we likely would have had issues down the road. I, of course, left the tests in place, which will at least make sure we don&#x27;t break these existing variables &quot;hooray for regression tests!&quot;</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pi-day-2023-concludes">Pi Day 2023 Concludes<a href="#pi-day-2023-concludes" class="hash-link" aria-label="Direct link to Pi Day 2023 Concludes" title="Direct link to Pi Day 2023 Concludes">​</a></h3>
<p>I never really took much significance in Pi Day in the past. It really has nothing to do with Raspberry Pi other than the creators spelled pie without the e, so it resembles the mathematical value. In any case, I just found it slightly amusing that I happened to be fixing a Raspberry Pi-related bug on a Raspberry Pi, on Pi Day.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Go/Golang content" class="tag_zVej tagRegular_sFm0" href="/docs/openziti/blog/tags/golang">golang</a></li><li class="tag_QGVx"><a rel="tag" title="Raspberry Pi content" class="tag_zVej tagRegular_sFm0" href="/docs/openziti/blog/tags/raspberry-pi">Raspberry Pi</a></li><li class="tag_QGVx"><a rel="tag" title="Troubleshooting guides" class="tag_zVej tagRegular_sFm0" href="/docs/openziti/blog/tags/troubleshooting">Troubleshooting</a></li><li class="tag_QGVx"><a rel="tag" title="OpenZiti related content" class="tag_zVej tagRegular_sFm0" href="/docs/openziti/blog/tags/openziti">OpenZiti</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/openziti/blog/commercial-open-source-and-ethical-and-practical-community-engagement"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Commercial Open Source and Ethical (and practical) Community Engagement</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/openziti/blog/private-dns-on-windows"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Private DNS on Windows</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#64-bit-raspbian" class="table-of-contents__link toc-highlight">64 Bit Raspbian</a></li><li><a href="#32-bit-raspbian" class="table-of-contents__link toc-highlight">32 Bit Raspbian</a></li><li><a href="#the-cause" class="table-of-contents__link toc-highlight">The Cause</a></li><li><a href="#the-fix" class="table-of-contents__link toc-highlight">The Fix</a></li><li><a href="#pi-day-2023-concludes" class="table-of-contents__link toc-highlight">Pi Day 2023 Concludes</a></li></ul></div></div></div></div><footer class="styles-module_ozFooter__vHkQA"><section class="styles-module_footer__Qk0iB styles-module_ozHorizontalSectionRoot__QwWz0 styles-module_ozhsContent__haNeV"><div class="styles-module_footerContainer__azQkg"><div class="styles-module_footerGrid__fsf9C"><div class="styles-module_footerColumn__tK2bv"><h3>NetFoundry</h3><p>An open source project enabling developers to embed zero trust networking directly into applications.</p><div class="styles-module_footerSocialLinks__b1FcV"><a href="https://github.com/openziti/ziti" target="_blank" class="styles-module_footerSocialLink__iAElV" rel="noreferrer"><svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"></path></svg></a><a href="https://www.linkedin.com/in/netfoundry/" target="_blank" class="styles-module_footerSocialLink__iAElV" rel="noreferrer"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.996 16V10.1C15.996 7.5 15.375 5.49999 12.025 5.49999C10.4 5.49999 9.325 6.39999 8.875 7.29999H8.825V5.79999H5.65V16H8.95V10.7C8.95 9.30001 9.2 7.9 10.925 7.9C12.65 7.9 12.675 9.59999 12.675 10.8V16H15.996Z"></path><path d="M0.25 5.79999H3.575V16H0.25V5.79999Z"></path><path d="M1.9 0C0.85 0 0 0.85 0 1.9C0 2.95 0.85 3.8 1.9 3.8C2.95 3.8 3.8 2.95 3.8 1.9C3.8 0.85 2.95 0 1.9 0Z"></path></svg></a><a href="https://youtube.com/openziti/" target="_blank" class="styles-module_footerSocialLink__iAElV" rel="noreferrer"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.969 4.69c-.183-1.358-1.062-2.275-2.361-2.46C12.371 2 8 2 8 2S3.629 2 2.362 2.229c-1.3.186-2.179 1.103-2.361 2.461C0 6.03 0 10 0 10s0 3.97.2 5.31c.183 1.358 1.062 2.275 2.361 2.46C3.63 18 8 18 8 18s4.371 0 5.638-.23c1.3-.185 2.178-1.102 2.361-2.46.2-1.34.2-5.31.2-5.31s0-3.97-.23-5.31zm-8.36, 8.57V6.73l3.76 2.27-3.76 2.26z"></path></svg></a><a href="https://twitter.com/openziti/" target="_blank" class="styles-module_footerSocialLink__iAElV" rel="noreferrer"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.996 3.038c-.59.262-1.219.44-1.885.52.677-.406 1.194-1.05 1.438-1.815-.634.375-1.337.648-2.085.795-.598-.638-1.45-1.038-2.396-1.038-1.813 0-3.283 1.469-3.283 3.282 0 .257.03.507.085.748-2.728-.137-5.147-1.445-6.766-3.43-.282.485-.444 1.05-.444 1.651 0 1.14.58 2.143 1.46 2.732-.538-.017-1.044-.164-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.219-.276.075-.567.116-.866.116-.211 0-.416-.021-.617-.06.418 1.304 1.63 2.254 3.066 2.28-1.124.883-2.539 1.406-4.077 1.406-.265 0-.526-.015-.785-.046 1.453.933 3.178 1.475 5.032 1.475 6.038 0 9.34-5.002 9.34-9.34 0-.142-.004-.284-.01-.425.641-.463 1.198-1.039 1.638-1.696"></path></svg></a></div></div><div class="styles-module_footerColumn__tK2bv"><h3>Community</h3><ul class="styles-module_footerLinks__eOmJ9"><li><a href="https://github.com/openziti/ziti">GitHub</a></li><li><a href="https://openziti.discourse.group/">Discourse Forum</a></li><li><a href="/docs/openziti/policies/CONTRIBUTING">Contributing</a></li></ul></div><div class="styles-module_footerColumn__tK2bv"><h3>Resources</h3><ul class="styles-module_footerLinks__eOmJ9"><li><a href="https://blog.openziti.io">OpenZiti Tech Blog</a></li><li><a href="https://netfoundry.io/">NetFoundry</a></li></ul></div></div></div><div class="styles-module_footerCopyright__nWyvc"><p>© 2025 NetFoundry Inc. OpenZiti is an open source project sponsored by NetFoundry. All rights reserved.</p></div></section></footer></div></div>
</body>
</html>