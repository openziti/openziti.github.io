<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true"></title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:url" content="http://localhost:3000/docs/openziti/blog/golang-aha-moments-generics"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="robots" content="index, follow"><meta data-rh="true" property="og:title" content="Golang Aha! Moments: Generics | OpenZiti"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><meta data-rh="true" property="og:image" content="http://localhost:3000/@site/blogs/openziti/v1663771708776/OXjhFrMmZ.jpg"><meta data-rh="true" name="twitter:image" content="http://localhost:3000/@site/blogs/openziti/v1663771708776/OXjhFrMmZ.jpg"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-10-06T17:46:21.000Z"><meta data-rh="true" property="article:author" content="https://github.com/plorenz"><meta data-rh="true" property="article:tag" content="golang,Developer,Generics,OpenZiti,golang-aha"><meta data-rh="true" data-rh="true" name="nf-layout-version" content="0.0.168"><meta data-rh="true" name="twitter:card" content="summary_large_image"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-generics"><link data-rh="true" rel="alternate" href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-generics" hreflang="en"><link data-rh="true" rel="alternate" href="http://localhost:3000/docs/openziti/blog/golang-aha-moments-generics" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EXWPKK5PV4-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"http://localhost:3000/docs/openziti/blog/golang-aha-moments-generics","mainEntityOfPage":"http://localhost:3000/docs/openziti/blog/golang-aha-moments-generics","url":"http://localhost:3000/docs/openziti/blog/golang-aha-moments-generics","headline":"Golang Aha! Moments: Generics","name":"Golang Aha! Moments: Generics","description":"Introduction","datePublished":"2022-10-06T17:46:21.000Z","author":{"@type":"Person","name":"Paul Lorenz","description":"Author","url":"https://github.com/plorenz","image":"https://avatars.githubusercontent.com/plorenz"},"image":{"@type":"ImageObject","@id":"http://localhost:3000/@site/blogs/openziti/v1663771708776/OXjhFrMmZ.jpg","url":"http://localhost:3000/@site/blogs/openziti/v1663771708776/OXjhFrMmZ.jpg","contentUrl":"http://localhost:3000/@site/blogs/openziti/v1663771708776/OXjhFrMmZ.jpg","caption":"title image for the blog post: Golang Aha! Moments: Generics"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"http://localhost:3000/docs/openziti/blog","name":"Blog"}}</script><script>!function(t,h,e,j,s,n){t.hj=t.hj||function(){(t.hj.q=t.hj.q||[]).push(arguments)},t._hjSettings={hjid:3576473,hjsv:6},s=h.getElementsByTagName("head")[0],(n=h.createElement("script")).async=1,n.src="https://static.hotjar.com/c/hotjar-"+t._hjSettings.hjid+".js?sv="+t._hjSettings.hjsv,s.appendChild(n)}(window,document)</script>
<link rel="alternate" type="application/rss+xml" href="/docs/openziti/blog/rss.xml" title="OpenZiti RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/openziti/blog/atom.xml" title="OpenZiti Atom Feed">

<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-5SF399H3",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>





<link rel="search" type="application/opensearchdescription+xml" title="OpenZiti" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.273075c6.css">
<script src="/assets/js/runtime~main.6236f723.js" defer="defer"></script>
<script src="/assets/js/main.d05d9df4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5SF399H3" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>



<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/ziti-logo-dark.svg"><link rel="preload" as="image" href="/img/ziti-logo-light.svg"><link rel="preload" as="image" href="https://avatars.githubusercontent.com/plorenz"><link rel="preload" href="https://i.ytimg.com/vi/4JFA31O2UaE/hqdefault.jpg" as="image"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/"><div class="navbar__logo"><img src="/img/ziti-logo-dark.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/ziti-logo-light.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item"><a class="navbar__item navbar__link header-netfoundry-link" href="https://netfoundry.io/products/netfoundry-cloud-30-day-free-trial/" target="_blank">NetFoundry</a></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/openziti/learn/introduction/">Documentation</a><a class="navbar__item navbar__link" href="/docs/openziti/downloads">Downloads</a><div class="navbar__item"><a class="navbar__item navbar__link header-netfoundry-link" href="https://blog.openziti.io/" target="_blank">Blog</a></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Links</a><ul class="dropdown__menu"><li class=""><div class="text-divider"><p>Socials</p></div></li><li class=""><a href="https://www.youtube.com/OpenZiti" target="_blank" title="OpenZiti on YouTube"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/yt.svg" alt="YouTube logo">YouTube</span></a></li><li class=""><a href="https://x.com/OpenZiti" target="_blank" title="OpenZiti on X(formerly Twitter)"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/twit.svg" alt="X/Twitter logo">X (Twitter)</span></a></li><li class=""><a href="https://www.reddit.com/r/openziti" target="_blank" title="OpenZiti Subreddit"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/reddit-logo.png" alt="Reddit logo">Reddit</span></a></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/ziggy.png" alt="X/Twitter Ziggy logo"><a href="https://x.com/OpenZiggy" target="_blank" title="OpenZiggy on X(formerly Twitter)">Ziggy</a></span></li><li class=""><div class="text-divider"><p>Other</p></div></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/blog-icon.png" alt="OpenZiti blog logo"><a href="https://blog.openziti.io/" target="_blank" title="Blog">Blog</a></span></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/oz-test-kitchen.png" alt="OpenZiti Test Kitchen logo"><a href="https://github.com/openziti-test-kitchen" target="_blank" title="Git project for the test kitchen">Test Kitchen</a></span></li></ul></div><a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discourse-link" title="Discourse"></a><a href="https://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="styles-module_starUsRoot__hMNZp"><span style="color:whitesmoke">Star Us on GitHub<!-- --> </span><span style="height:20px"><span><a href="https://github.com/openziti/ziti" data-icon="octicon-star" data-show-count="true" aria-label="Star buttons/github-buttons on GitHub">Star</a></span></span></div><div class="main-wrapper NetFoundryLayout-module_ozLayoutMainWrapper__a2vwh"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/introducing-zrok-10">Introducing zrok 1.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-unleashed-top-10-uses-explored">zrok Unleashed: Top 10 Uses Explored</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-ziti-identities-with-hsmtpm">Securing Ziti Identities with HSM/TPM</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-custom-domains">zrok Custom Domains</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/golang-aha-moments-oop">Golang Aha! Moments: OOP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-safest-way-to-make-portainer-internet-accessible">The safest way to make Portainer Internet accessible</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/multifactor-zero-trust-ssh">Multifactor Zero Trust ssh</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zero-trust-sshclient">Zero Trust *ssh.Client</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/effortless-docker-management-with-private-web-access">Effortless Docker Management</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-is-growing-up">zrok is Growing Up</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-vpn-linux-service">Easy Steps to Install a Private VPN on Linux with zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/jitsi-meet-zrok">Jitsi, meet zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/extend-access-to-a-private-s3-bucket-using-python">Extend Access to a Private S3 Bucket Using Python</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/why-we-verify-github-commits">Why We Verify GitHub Commits</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/limitless-zrok-with-docker">Limitless zrok with Docker</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/how-to-prevent-path-traversal-attacks-with-openziti-browzer">How to Prevent Path Traversal Attacks with OpenZiti BrowZer</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-vpn">zrok VPN</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d">Deploy OpenZiti in Kubernetes with Ease Using k3d</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/signing-executables-from-github-actions">Signing Executables From GitHub Actions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-nodejs-zrok-sdk">The NodeJS zrok SDK</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/no-listening-ports">No Listening Ports?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/announcing-openziti-v1">Announcing OpenZiti v1.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/pixy-dust-for-web-applications-pkce">Pixy Dust For Web Applications</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/secure-remote-development-with-zrok-and-jetbrains">Secure Remote Development with zrok and JetBrains</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-permission-modes">zrok Permission Modes</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-zrok-socks-backend">The zrok SOCKS Backend</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-python-zrok-sdk">The Python zrok SDK</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-dedicated-palworld-server-with-zrok">Securing a Dedicated  Palworld Server For My Family with zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/fun-with-adaptive-rate-limiting">Fun with Adaptive Rate Limiting</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-zrok-drives-cli-preview">The zrok Drives CLI Preview</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/minecraft-over-zrok">Minecraft Over zrok</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/go-is-amazing-for-zero-trust">Go is Amazing for Zero Trust</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-frontdoor">zrok frontdoor</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/business-rule-driven-just-in-time-network-access">Business Rule Driven Just-in-Time Network Access</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-drives-an-early-preview">zrok Drives (an Early Preview)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/put-some-ziti-in-your-caddy">Put some Ziti in your Caddy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-zrok-oauth-public-frontend">The zrok OAuth Public Frontend</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-azure-openai-applications-with-openziti">Securing Azure OpenAI Applications with OpenZiti</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openziti-zero-trust-iot-wi-fi-gateway">OpenZiti Zero Trust IoT Wi-Fi Gateway</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-with-the-power-of-caddy">zrok with the Power of Caddy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-zrok-sdk">The zrok SDK</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/got-5-minutes-secure-your-python-website-with-zero-trust">Got 5 Minutes? Secure Your Python Website with Zero Trust.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/announcing-the-zrok-public-beta">Announcing the zrok Public Beta!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-v040-released">zrok v0.4.0 Released!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/commercial-open-source-and-ethical-and-practical-community-engagement">Commercial Open Source and Ethical (and practical) Community Engagement</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/my-pi-day-journey-with-go-64-bit-alignment">My Pi Day Journey with Go 64-bit alignment</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/private-dns-on-windows">Private DNS on Windows</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/websockets-over-zrok">Websockets over zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openapi-python-clients">OpenAPI Python Clients</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/postman-mgmt">Postman and the Management API</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-road-ahead-for-zrok">The Road Ahead for zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/auto-complete">Ziti Shell Auto-Complete</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/introducing-zrok">Introducing zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/connecting-to-local-development-environment-from-cloud-hosts-with-zrok">Connecting to Local Development Environment from Cloud Hosts with zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/lessons-learned-writing-a-zero-trust-nginx-module">Lessons Learned Writing a Zero Trust NGINX Module</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zero-trust-monitoring-with-openziti">Zero Trust Monitoring with OpenZiti</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2022</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/its-a-zitiful-life">It&#x27;s A Zitiful Life</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/nginx-zerotrust-api-security">NGINX &amp; ZeroTrust API Security</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/using-ebpf-tc-to-securely-mangle-packets-in-the-kernel-and-pass-them-to-my-secure-networking-application">Using eBPF-TC to securely mangle packets in the kernel, and pass them to my secure networking application</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/browzer-gateway-fqdn-certs">OpenZiti BrowZer Gateway</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openziti-authentication-api-integrations">OpenZiti Authentication API Integrations</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/high-level-publicprivate-cryptography">High-Level Public/Private Cryptography</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/set-up-a-secure-multiplayer-minecraft-server">Set Up a Secure Multiplayer Minecraft Server</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/setting-up-oracle-cloud-to-host-openziti">Setting Up Oracle Cloud To Host OpenZiti</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/integrating-ziti-is-easy">Integrating Ziti is Easy! How we got our app tested with go-httpbin</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/docs/openziti/blog/golang-aha-moments-generics">Golang Aha! Moments: Generics</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-nodejs-applications">Securing NodeJS Applications — An Introduction to the OpenZiti SDK for NodeJS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openziti-is-participating-in-hacktoberfest-prost">OpenZiti is Participating in Hacktoberfest, Prost!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openziti-python-sdk-introduction">OpenZiti Python SDK: Introduction</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/free-secure-access-to-nas-from-anywhere">Free Secure Access to NAS From Anywhere</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/introducing-openziti-browzer">Introducing OpenZiti BrowZer</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/golang-aha-moments-channels">Golang Aha! Moments: Channels</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zero-trust-overlay-network-to-access-homeassistant">I Created a Zero Trust Overlay Network to Access HomeAssistant</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/my-intern-assignment-call-a-dark-webhook-from-aws-lambda">My Intern Assignment - Call a Dark Webhook from AWS Lambda</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/extrovert-wednesday">Extrovert Wednesday</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-web-apis-with-openziti">Securing Web APIs With OpenZiti — Zero Trust For Web APIs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/tunneling-voip-over-openziti">Tunneling VoIP over OpenZiti</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-5-bootstrapping-trust">Bootstrapping Trust Part 5</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-4-certificate-authorities-chains-of-trust">Bootstrapping Trust Part 4</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-3-certificates">Bootstrapping Trust Part 3 - Certificates</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-2-a-primer-on-public-key-cryptography">Bootstrapping Trust Part 2 - PKI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-1-encryption-everywhere">Bootstrapping Trust Part 1 - Encryption Everywhere</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/configuring-openziti-to-enable-prometheus">Configuring OpenZiti to Enable Prometheus</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/prometheus-scrape-anything-from-anywhere">Prometheus - Scrape Anything from Anywhere</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/scraping-anything-anywhere-in-action">Scraping Anything, Anywhere in Action</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2021</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/kubernetes">Tunneling Ingress to Kubernetes Workloads</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zitifying-scp">Zitifying SCP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zitifying-ssh">Zitifying SSH</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zitification">Zitification</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2020</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/mobile-point-of-sale-mpos-app-ziti-android-java-sdk-integration">Mobile Point of Sale (mPOS) app – embed zero trust networking</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Golang Aha! Moments: Generics</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-10-06T17:46:21.000Z">October 6, 2022</time> · <!-- -->14 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/plorenz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/plorenz" alt="Paul Lorenz"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/plorenz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Paul Lorenz</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2>
<p>I work with Golang every day as a developer on the <a href="http://openziti.io" target="_blank" rel="noopener noreferrer">OpenZiti project</a>. In learning Go,
I&#x27;ve hit various stumbling blocks, settled on some best practices and hopefully gotten better at writing Go code.
This series exists to share some of the &#x27;Aha!&#x27; moments I&#x27;ve had overcoming obstacles and finding solutions that
sparked joy.</p>
<p>This <a href="/docs/openziti/blog/tags/golang-aha">series</a> is targeted both at new team members and for anyone in the Go community who might be interested. I&#x27;m very happy to hear from others about their own &#x27;aha&#x27;
moments and also how the solutions presented strike your sensibilities. Suggested improvements, corrections and constructive criticism are welcome.</p>
<p>This second installment will cover various topics related to Go generics.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="generics-overview">Generics Overview<a href="#generics-overview" class="hash-link" aria-label="Direct link to Generics Overview" title="Direct link to Generics Overview">​</a></h2>
<p>Generics were introduced into the Go language in version 1.18 after years of debate and discussion.</p>
<p>This article assumes you are already familiar with generics from other languages and is not focused on the basics of using generics. Other than a brief overview, it it is focused on shortcomings, workarounds and considerations more specific to Go. For some links to more introductory works, please see the <a href="/docs/openziti/blog/golang-aha-moments-generics#further-readingviewing">further reading</a> section at the end.</p>
<p>The initial release of Go generics seems focused on two things.</p>
<ul>
<li>Reducing copy/paste code</li>
<li>Better type safety and removing casts for container types</li>
</ul>
<p>If you&#x27;re already familiar with these, feel free to skip ahead to the <a href="/docs/openziti/blog/golang-aha-moments-generics#generics-learnings">learnings section</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="copypaste-reduction">Copy/Paste Reduction<a href="#copypaste-reduction" class="hash-link" aria-label="Direct link to Copy/Paste Reduction" title="Direct link to Copy/Paste Reduction">​</a></h3>
<p>For an example of copy/paste reduction, take the classic <code>math.Min</code> function. The standard library (as of Go 1.19) only has <code>math.Min(x, y float64) float64</code>. If you want to find the minimum of any other types you either need to do some casting or write your own.
This is admittedly trivial code to write, but there are likely many implementations scattered across many code bases at this point. With generics you can write the following code</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;golang.org/x/exp/constraints&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func Min[T constraints.Ordered](x, y T) T {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if x &lt; y {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>While this code isn&#x27;t in the standard library yet (and neither is the useful constraints package) it likely will be in a future release. At a minimum, developers now only need to write a single <code>Min</code> function now, instead of writing one each time a new type needs to compared.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="container-types">Container Types<a href="#container-types" class="hash-link" aria-label="Direct link to Container Types" title="Direct link to Container Types">​</a></h3>
<p>Before generics if you wanted a custom container, such as a b-tree implementation, copy-on-write data structures or some concurrency friendly map, it would generally be implemented in terms of <code>interface{}</code>, requiring values to be cast when extracted. An API that looked like:</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type MyMap interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Put(key, value interface{})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Get(key interface{}) (interface{}, bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Delete(key interface{}) bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Each(func (key, value interface{}))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>can now instead look like:</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type MyGenericMap[K comparable, V any] interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Put(key K, value V)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Get(key K) (V, bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Delete(key K) bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Each(func (key K, value V))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>OpenZiti has some data structures using generics <a href="https://github.com/openziti/foundation/blob/main/concurrenz/" target="_blank" rel="noopener noreferrer">in the foundation library</a>, including:</p>
<ul>
<li>CopyOnWriteMap - <a href="https://github.com/openziti/foundation/blob/v2.0.4/concurrenz/copy_on_write_map.go" target="_blank" rel="noopener noreferrer">https://github.com/openziti/foundation/blob/v2.0.4/concurrenz/copy_on_write_map.go</a></li>
<li>CopyOnWriteSlice - <a href="https://github.com/openziti/foundation/blob/v2.0.4/concurrenz/copy_on_write_slice.go" target="_blank" rel="noopener noreferrer">https://github.com/openziti/foundation/blob/v2.0.4/concurrenz/copy_on_write_slice.go</a></li>
</ul>
<p>Over time I expect more of these types to be in the standard library.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="generics-learnings">Generics Learnings<a href="#generics-learnings" class="hash-link" aria-label="Direct link to Generics Learnings" title="Direct link to Generics Learnings">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="no-generic-methods">No Generic Methods<a href="#no-generic-methods" class="hash-link" aria-label="Direct link to No Generic Methods" title="Direct link to No Generic Methods">​</a></h3>
<p>As of Go 1.19, generic functions are supported, but not generic methods (funcs defined on a type).</p>
<p>So for a Tree type, with the given partial implementation:</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type node[E any] struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	value E</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	children []*node[E]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *node[E]) Add(elem E) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	self.children = append(self.children, &amp;node[E]{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		value: elem,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>If you wanted to define a <code>Map</code> method to map a Tree of values from one type to another, you couldn&#x27;t define a generic method with the following signature:</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// not allowed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *node[E]) Map[T any](f func(E) T) *node[T] { ... }</span><br></span></code></pre></div></div>
<p>The workaround is to convert the method into a func. For example, the above method could be rewritten as func:</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// legal version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func Map[E any, T any](self *node[E], f func(E) T) *node[T] { ... }</span><br></span></code></pre></div></div>
<p>If you had a tree and wanted map it, you&#x27;d have to write:</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var tree *node[string]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var result *node[int] := Map(tree, func(s string) { return len(s) })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// instead of </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var result *node[int] := tree.Map(func(s string) { return len(s) })</span><br></span></code></pre></div></div>
<p>While not ideal, it means that this functionality is within reach, even if the syntax is not what I would have preferred.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="new-instances-of-generic-types">New Instances of Generic Types<a href="#new-instances-of-generic-types" class="hash-link" aria-label="Direct link to New Instances of Generic Types" title="Direct link to New Instances of Generic Types">​</a></h3>
<p>A common need is to be able to return a valid instance of a generic type. In the simplest case you might just need to return some default value to satisfy the method contract. Let&#x27;s start with the generic Tree implementation we were using above.</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type node[E any] struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	value E</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	children []*node[E]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Let&#x27;s add a method to find the first value in the tree matching a given predicate. The basic implementation is straightforward.</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func (self *node[E]) GetFirstMatch(f func(E) bool) (E, bool) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if f(self.value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return self.value, true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	for _, child := range self.children {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if val, found := child.GetFirstMatch(f); found {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			return val, found</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // what to return here? </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>What do we return at the end, if nothing is found? We can&#x27;t return nil, since E maybe a primitive or non-pointer struct. Fortunately we can just declare a <code>var</code> of type <code>E</code> and it will be assigned the default value for that type.</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func (self *node[E]) GetFirstMatch(f func(E) bool) (E, bool) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if f(self.value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return self.value, true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	for _, child := range self.children {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if val, found := child.GetFirstMatch(f); found {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			return val, found</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	var defaultValue E</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return defaultValue, false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>There are also some cases where we want to create new instances of structs. This gets a little complicated. Let&#x27;s use a type factory as an example. This example is not necessarily realistic, but it is concise.</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type Example interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Init(config map[string]interface{})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type ExampleFactory[T Example] struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	config map[string]interface{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *ExampleFactory[T]) Get() T {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	result := new(T)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	result.Init(self.config)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>When we compile this, we see:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./scratch_2.go:14:9: result.Init undefined (type *T is pointer to type parameter, not type parameter)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./scratch_2.go:15:9: cannot use result (variable of type *T) as type T in return statement</span><br></span></code></pre></div></div>
<p>In order to resolve this we need two type parameters. One for the underlying type and one for the pointer type.</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type Example[T any] interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   *T // indicates that Example must be a pointer type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Init(config map[string]interface{})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type ExampleFactory[T any, P Example[T]] struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   config map[string]interface{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *ExampleFactory[T,P]) Get() P {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   var result P = new(T) // result := new(T) won&#x27;t work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   result.Init(self.config)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   return result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>The <code>Example</code> interface now has a type parameter. That type parameter is used to indicate that the interface must be implemented by a pointer type. We also need to include both types on the factory. Otherwise, when we call <code>new</code>, we don&#x27;t have the correct type to call it with.</p>
<p>Finally, <code>result := new(T)</code> doesn&#x27;t work due to apparent limitations in the type inferencing, the explicit type must be provided.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="case-study-command-decoding">Case Study: Command Decoding<a href="#case-study-command-decoding" class="hash-link" aria-label="Direct link to Case Study: Command Decoding" title="Direct link to Case Study: Command Decoding">​</a></h3>
<p>To pull some of these threads together, I thought it would be useful to look at a place where we introduced generics, in an attempt to reduce boilerplate.</p>
<p>Our software has two main server side components: controllers and routers. While you can run any number of routers to form a network mesh, up till now you&#x27;ve only been able to run a single controller. We&#x27;re working on allowing the controller to be run in a cluster for better availability and performance. Part of that work has been moving most of our model into Raft (using the excellent <a href="https://github.com/hashicorp/raft/" target="_blank" rel="noopener noreferrer">Raft library</a> from Hashicorp). We had to move the create/update/delete logic into commands, which get applied as entries to the Raft log. We need to be able to marshal/unmarshal these commands to and from binary, both so we can ship them to the leader and so the Raft library can propagate them.</p>
<p><strong>TL;DR</strong>: We need to be able to decode binary encoded commands. Can we reduce the boilerplate for doing that?</p>
<p>We&#x27;re going to take a look at a simplified version of the code. We&#x27;re using protobufs for the binary format.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="supporting-types-reference">Supporting Types Reference<a href="#supporting-types-reference" class="hash-link" aria-label="Direct link to Supporting Types Reference" title="Direct link to Supporting Types Reference">​</a></h4>
<p>Here are some of the primary interfaces, which you can reference when looking at the decoder implementations:</p>
<ul>
<li><code>TypedMessage</code> - message interface which is just a protobuf message which knows its command type</li>
<li><code>Command</code> - types we&#x27;re marshalling/unmarshalling</li>
<li><code>DeleteEntityCommand</code> - example command for deleting entities</li>
<li><code>Decoder</code> -  func for decoding a binary messages back into a Command</li>
<li><code>DecoderRegistry</code> - place to lookup the Decoder for a give message</li>
</ul>
<p>This implementation has some interfaces for types messages, which extend the protobuf message</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// TypedMessage instances are protobuf messages which know their command type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type TypedMessage interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	proto.Message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	GetCommandType() int32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Next we&#x27;ve got the Command interface and the delete entity command, which covers all model types.</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type Command interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Apply() error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Encode() ([]byte, error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type DeleteEntityCommand struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Id         string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	EntityType string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *DeleteEntityCommand) Apply() error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// implemention elided for brevity </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *DeleteEntityCommand) Encode() ([]byte, error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // EncodeProtobuf marshalls the msg to bytes and prefixes the command type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return cmd_pb.EncodeProtobuf(&amp;cmd_pb.DeleteEntityCommand{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		EntityId:   self.Id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		EntityType: self.EntityType,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (self *DeleteEntityCommand) Decode(msg *cmd_pb.DeleteEntityCommand) error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	self.Id = msg.EntityId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	self.EntityType = msg.EntityType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>So encoding is straightforward, we can just create the appropriate protobuf type and serialize them. Decoding is a little more complicated because we&#x27;re starting with the raw bytes and need a way to rebuild our types. We&#x27;re going to need a <code>Registry</code> of things that can decode our various commands for us. To  keep things simple, let&#x27;s just use <code>funcs</code>.</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type Decoder func(data []byte) (Command, error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type DecoderRegistry interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	AddDecoder(commandType int32, decoder Decoder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="decoder-no-generics">Decoder: No Generics<a href="#decoder-no-generics" class="hash-link" aria-label="Direct link to Decoder: No Generics" title="Direct link to Decoder: No Generics">​</a></h4>
<p>Now we can create a decoder for our <code>DeleteEntityCommand</code> and register it.</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func decodeDeleteEntityCommand(data []byte) (Command, error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Unmarshal to a protobuf message type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	msg := &amp;cmd_pb.DeleteEntityCommand{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if err := proto.Unmarshal(data, msg); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return nil, err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Populate the command using the protobuf message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	cmd := &amp;DeleteEntityCommand{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if err := cmd.Decode(msg); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return nil, err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return cmd, nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func registerDecodeDeleteCommand(registry DecoderRegistry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	registry.AddDecoder(int32(cmd_pb.CommandType_DeleteEntityType), decodeDeleteEntityCommand)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>However, there&#x27;s not much special going on here. This function will be essentially the same for every command. It needs to create an instance of the protobuf command, Unmarshal it, and then pass that off to a new instance of the model Command.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="decoder-generics--reflection">Decoder: Generics + Reflection<a href="#decoder-generics--reflection" class="hash-link" aria-label="Direct link to Decoder: Generics + Reflection" title="Direct link to Decoder: Generics + Reflection">​</a></h4>
<p>Here&#x27;s a first pass at using generics to take care of this boilerplate.</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func RegisterCommand[M TypedMessage, C decodableCommand[M]](registry DecoderRegistry, cmdType C, msgType M) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	decoder := func(data []byte) (Command, error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		msg := proto.MessageV1(proto.MessageV2(msgType).ProtoReflect().New()).(M)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if err := proto.Unmarshal(data, msg); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			return nil, err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		cmd := reflect.New(reflect.TypeOf(cmdType).Elem()).Interface().(C)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if err := cmd.Decode(msg); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			return nil, err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return cmd, nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	registry.AddDecoder(msgType.GetCommandType(), decoder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func registerDecodeDeleteCommand(registry DecoderRegistry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	RegisterCommand(registry, &amp;DeleteEntityCommand{}, &amp;cmd_pb.DeleteEntityCommand{})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>This works for removing the boilerplate. We have a single line where we register the decoder, with the two types it needs to know about.</p>
<p>Unfortunately, the implementation is ugly and employs both some sketchy protobuf library reflection and regular reflection. This is both hard to read and not terribly efficient.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="decoder-pure-generics">Decoder: Pure Generics<a href="#decoder-pure-generics" class="hash-link" aria-label="Direct link to Decoder: Pure Generics" title="Direct link to Decoder: Pure Generics">​</a></h4>
<p>We can do better using what we learned about instantiating generic types above.</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type commandMsg[T any] interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	TypedMessage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	*T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type decodableCommand[T any, M any] interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Decode(msg M) error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	*T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func RegisterCommand[MT any, CT any, M commandMsg[MT], C decodableCommand[CT, M]](registry DecoderRegistry, _ C, msg M) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	decoder := func(data []byte) (Command, error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		var msg M = new(MT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if err := proto.Unmarshal(data, msg); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			return nil, err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		cmd := C(new(CT))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		if err := cmd.Decode(msg); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			return nil, err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return cmd, nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	registry.AddDecoder(msg.GetCommandType(), decoder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func registerDecodeDeleteCommand(registry DecoderRegistry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	RegisterCommand(registry, &amp;DeleteEntityCommand{}, &amp;cmd_pb.DeleteEntityCommand{})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="performance">Performance<a href="#performance" class="hash-link" aria-label="Direct link to Performance" title="Direct link to Performance">​</a></h5>
<p>This is better from an efficiency perspective, though admittedly not by much. The reflection based code results:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">BenchmarkRegisterCommand-16         1013774          1259 ns/op</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BenchmarkRegisterCommand-16         1012059          1267 ns/op</span><br></span></code></pre></div></div>
<p>vs the generics based code:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">BenchmarkRegisterCommand-16         1165557          1144 ns/op</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BenchmarkRegisterCommand-16         1143402          1134 ns/op</span><br></span></code></pre></div></div>
<p>However, the code is less fragile, as it&#x27;s not relying on protobuf tricks, and is likely to get faster over time as generics support improves.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="complexity">Complexity<a href="#complexity" class="hash-link" aria-label="Direct link to Complexity" title="Direct link to Complexity">​</a></h5>
<p>It is still hard code to read. However, that ugliness is balanced by a relatively clean API and reduced code externally. Personally I&#x27;ll trade some encapsulated ugliness for reduced code and complexity elsewhere. This is an area where reasonable people can disagree, though.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="generic-parameters-vs-args">Generic parameters vs args<a href="#generic-parameters-vs-args" class="hash-link" aria-label="Direct link to Generic parameters vs args" title="Direct link to Generic parameters vs args">​</a></h5>
<p>This method could also be written with a different type signature:</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func RegisterCommand[MT any, CT any, M commandMsg[MT], C decodableCommand[CT, M]](registry DecoderRegistry) { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func registerDecodeDeleteCommand(registry DecoderRegistry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	RegisterCommand[cmd_pb.DeleteEntityCommand, DeleteEntityCommand](registry)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>So we&#x27;ve replaced the arguments, which weren&#x27;t strictly necessary and are explicitly providing the generic types instead. This is another matter of taste. As someone calling the library, I found it easier to provide function parameters than generic types, since it was easier to figure out what was required. Others might reach different conclusions.</p>
<p>To look at the actual implementation in OpenZiti, here are some starting points:</p>
<ul>
<li><a href="https://github.com/openziti/fabric/tree/v0.21.0/controller/command" target="_blank" rel="noopener noreferrer">https://github.com/openziti/fabric/tree/v0.21.0/controller/command</a></li>
<li><a href="https://github.com/openziti/fabric/blob/v0.21.0/controller/network/command.go" target="_blank" rel="noopener noreferrer">https://github.com/openziti/fabric/blob/v0.21.0/controller/network/command.go</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="case-study-entity-managers">Case Study: Entity Managers<a href="#case-study-entity-managers" class="hash-link" aria-label="Direct link to Case Study: Entity Managers" title="Direct link to Case Study: Entity Managers">​</a></h3>
<p>There are also places where the the complexity tradeoff goes the other way. Let&#x27;s look at an entity manager type. We&#x27;ve got an interface for Entities which know how to load themselves from a data store. Our model is persisted in <a href="https://github.com/etcd-io/bbolt" target="_blank" rel="noopener noreferrer">bbolt</a>, but the pattern should be broadly applicable.</p>
<p>We want our base entity manager type to be able to load entities. For that, it must be able to create new instances of the entity type.</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type Entity interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	GetId() string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Load(store DataStore, entityData *Bucket)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type baseEntityManager[E Entity] struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	store DataStore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (mgr *baseEntityManager[E]) Load(id string) (E, error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	var entity E // need to get new instance of E somehow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// load entity, if it exists, otherwise return an error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return entity, nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>If our base manager type can create new instances of the Entity type, it can load them in a generic fashion. We could use the same pattern from above to allow new instances of the entity type to be created using generics. That would look something like:</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type EntityP[T any] interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Entity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	*T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type baseEntityManager[E any, PE EntityP[E]] struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	store DataStore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (mgr *baseEntityManager[E, PE]) Load(id string) (PE, error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	var entity PE = new(E) // init using generics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// load entity, if it exists, otherwise return an error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return entity, nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>So this works,but it also requires a more complex generics parameters and those more complex parameters have to be on every method we define on the type. So by making the one method slightly simpler, we have incurred a complexity penalty in many places. This will also spread to anywhere were the type is used.</p>
<p>Given this we decided to go for a simpler solution: providing a <code>func</code> which can create new entity instances.</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type baseEntityManager[E Entity] struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	store DataStore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	newEntity func() E</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (mgr *baseEntityManager[E]) Load(id string) (E, error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	var entity E = mgr.newEntity() // init using a constructor function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// load entity, if it exists, otherwise return an error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return entity, nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>While this requires us to provide logic at construction time, it keeps the rest of the code cleaner.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>While not perfect, generics in Go have let us remove a lot of boilerplate from the OpenZiti project. We&#x27;ve also found and fixed some bugs when we switched to type safe collections.</p>
<p>We&#x27;re generally still trying to be somewhat conservative with where we use generics. When we add it, as with the examples above, we want to be sure that we&#x27;re getting good value for the extra complexity.</p>
<p>It will be interesting to see where generics make their way into the standard libraries and what best practices emerge around Go generics.</p>
<p>If you&#x27;ve got any feedback, maybe better ways to accomplish the things outlined above, let me know!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="further-readingviewing">Further Reading/Viewing<a href="#further-readingviewing" class="hash-link" aria-label="Direct link to Further Reading/Viewing" title="Direct link to Further Reading/Viewing">​</a></h2>
<ul>
<li><a href="https://go.dev/blog/intro-generics" target="_blank" rel="noopener noreferrer">https://go.dev/blog/intro-generics</a></li>
<li><a href="https://go.dev/doc/tutorial/generics" target="_blank" rel="noopener noreferrer">https://go.dev/doc/tutorial/generics</a></li>
<li><a href="https://gobyexample.com/generics" target="_blank" rel="noopener noreferrer">https://gobyexample.com/generics</a></li>
</ul>
<p>Here&#x27;s a video some of my coworkers did around the time of the initial generics release on our weekly video stream:</p>
<p></p><article class="yt-lite" data-title="YouTube video" style="background-image:url(https://i.ytimg.com/vi/4JFA31O2UaE/hqdefault.jpg);--aspect-ratio:56.25%"><button type="button" class="lty-playbtn" aria-label="Watch YouTube video"></button></article><p></p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Go/Golang content" class="tag_zVej tagRegular_sFm0" href="/docs/openziti/blog/tags/golang">golang</a></li><li class="tag_QGVx"><a rel="tag" title="Developer topics" class="tag_zVej tagRegular_sFm0" href="/docs/openziti/blog/tags/developer">Developer</a></li><li class="tag_QGVx"><a rel="tag" title="Programming generics" class="tag_zVej tagRegular_sFm0" href="/docs/openziti/blog/tags/generics">Generics</a></li><li class="tag_QGVx"><a rel="tag" title="OpenZiti related content" class="tag_zVej tagRegular_sFm0" href="/docs/openziti/blog/tags/openziti">OpenZiti</a></li><li class="tag_QGVx"><a rel="tag" title="Golang Ahas!" class="tag_zVej tagRegular_sFm0" href="/docs/openziti/blog/tags/golang-aha">golang-aha</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/openziti/blog/integrating-ziti-is-easy"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Integrating Ziti is Easy! How we got our app tested with go-httpbin</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/openziti/blog/securing-nodejs-applications"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Securing NodeJS Applications — An Introduction to the OpenZiti SDK for NodeJS</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#generics-overview" class="table-of-contents__link toc-highlight">Generics Overview</a><ul><li><a href="#copypaste-reduction" class="table-of-contents__link toc-highlight">Copy/Paste Reduction</a></li><li><a href="#container-types" class="table-of-contents__link toc-highlight">Container Types</a></li></ul></li><li><a href="#generics-learnings" class="table-of-contents__link toc-highlight">Generics Learnings</a><ul><li><a href="#no-generic-methods" class="table-of-contents__link toc-highlight">No Generic Methods</a></li><li><a href="#new-instances-of-generic-types" class="table-of-contents__link toc-highlight">New Instances of Generic Types</a></li><li><a href="#case-study-command-decoding" class="table-of-contents__link toc-highlight">Case Study: Command Decoding</a></li><li><a href="#case-study-entity-managers" class="table-of-contents__link toc-highlight">Case Study: Entity Managers</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li><li><a href="#further-readingviewing" class="table-of-contents__link toc-highlight">Further Reading/Viewing</a></li></ul></div></div></div></div><footer class="styles-module_ozFooter__vHkQA"><section class="styles-module_footer__Qk0iB styles-module_ozHorizontalSectionRoot__QwWz0 styles-module_ozhsContent__haNeV"><div class="styles-module_footerContainer__azQkg"><div class="styles-module_footerGrid__fsf9C"><div class="styles-module_footerColumn__tK2bv"><h3>NetFoundry</h3><p>An open source project enabling developers to embed zero trust networking directly into applications.</p><div class="styles-module_footerSocialLinks__b1FcV"><a href="https://github.com/openziti/ziti" target="_blank" class="styles-module_footerSocialLink__iAElV" rel="noreferrer"><svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"></path></svg></a><a href="https://www.linkedin.com/in/netfoundry/" target="_blank" class="styles-module_footerSocialLink__iAElV" rel="noreferrer"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.996 16V10.1C15.996 7.5 15.375 5.49999 12.025 5.49999C10.4 5.49999 9.325 6.39999 8.875 7.29999H8.825V5.79999H5.65V16H8.95V10.7C8.95 9.30001 9.2 7.9 10.925 7.9C12.65 7.9 12.675 9.59999 12.675 10.8V16H15.996Z"></path><path d="M0.25 5.79999H3.575V16H0.25V5.79999Z"></path><path d="M1.9 0C0.85 0 0 0.85 0 1.9C0 2.95 0.85 3.8 1.9 3.8C2.95 3.8 3.8 2.95 3.8 1.9C3.8 0.85 2.95 0 1.9 0Z"></path></svg></a><a href="https://youtube.com/openziti/" target="_blank" class="styles-module_footerSocialLink__iAElV" rel="noreferrer"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.969 4.69c-.183-1.358-1.062-2.275-2.361-2.46C12.371 2 8 2 8 2S3.629 2 2.362 2.229c-1.3.186-2.179 1.103-2.361 2.461C0 6.03 0 10 0 10s0 3.97.2 5.31c.183 1.358 1.062 2.275 2.361 2.46C3.63 18 8 18 8 18s4.371 0 5.638-.23c1.3-.185 2.178-1.102 2.361-2.46.2-1.34.2-5.31.2-5.31s0-3.97-.23-5.31zm-8.36, 8.57V6.73l3.76 2.27-3.76 2.26z"></path></svg></a><a href="https://twitter.com/openziti/" target="_blank" class="styles-module_footerSocialLink__iAElV" rel="noreferrer"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.996 3.038c-.59.262-1.219.44-1.885.52.677-.406 1.194-1.05 1.438-1.815-.634.375-1.337.648-2.085.795-.598-.638-1.45-1.038-2.396-1.038-1.813 0-3.283 1.469-3.283 3.282 0 .257.03.507.085.748-2.728-.137-5.147-1.445-6.766-3.43-.282.485-.444 1.05-.444 1.651 0 1.14.58 2.143 1.46 2.732-.538-.017-1.044-.164-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.219-.276.075-.567.116-.866.116-.211 0-.416-.021-.617-.06.418 1.304 1.63 2.254 3.066 2.28-1.124.883-2.539 1.406-4.077 1.406-.265 0-.526-.015-.785-.046 1.453.933 3.178 1.475 5.032 1.475 6.038 0 9.34-5.002 9.34-9.34 0-.142-.004-.284-.01-.425.641-.463 1.198-1.039 1.638-1.696"></path></svg></a></div></div><div class="styles-module_footerColumn__tK2bv"><h3>Community</h3><ul class="styles-module_footerLinks__eOmJ9"><li><a href="https://github.com/openziti/ziti">GitHub</a></li><li><a href="https://openziti.discourse.group/">Discourse Forum</a></li><li><a href="/docs/openziti/policies/CONTRIBUTING">Contributing</a></li></ul></div><div class="styles-module_footerColumn__tK2bv"><h3>Resources</h3><ul class="styles-module_footerLinks__eOmJ9"><li><a href="https://blog.openziti.io">OpenZiti Tech Blog</a></li><li><a href="https://netfoundry.io/">NetFoundry</a></li></ul></div></div></div><div class="styles-module_footerCopyright__nWyvc"><p>© 2025 NetFoundry Inc. OpenZiti is an open source project sponsored by NetFoundry. All rights reserved.</p></div></section></footer></div></div>
</body>
</html>