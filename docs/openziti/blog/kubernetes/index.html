<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true"></title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:url" content="http://localhost:3000/docs/openziti/blog/kubernetes"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="robots" content="index, follow"><meta data-rh="true" property="og:title" content="Tunneling Ingress to Kubernetes Workloads | OpenZiti"><meta data-rh="true" name="description" content="The previous post showed how to use a zero trust overlay like Ziti for transferring files by"><meta data-rh="true" property="og:description" content="The previous post showed how to use a zero trust overlay like Ziti for transferring files by"><meta data-rh="true" property="og:image" content="http://localhost:3000/@site/blogs/openziti/v1653224137964/I7QcSkiM3.jpeg"><meta data-rh="true" name="twitter:image" content="http://localhost:3000/@site/blogs/openziti/v1653224137964/I7QcSkiM3.jpeg"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-10-21T00:49:30.000Z"><meta data-rh="true" property="article:author" content="https://github.com/dovholuknf"><meta data-rh="true" property="article:tag" content="Security,Kubernetes,Uncategorized"><meta data-rh="true" data-rh="true" name="nf-layout-version" content="0.0.168"><meta data-rh="true" name="twitter:card" content="summary_large_image"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="http://localhost:3000/docs/openziti/blog/kubernetes"><link data-rh="true" rel="alternate" href="http://localhost:3000/docs/openziti/blog/kubernetes" hreflang="en"><link data-rh="true" rel="alternate" href="http://localhost:3000/docs/openziti/blog/kubernetes" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EXWPKK5PV4-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"http://localhost:3000/docs/openziti/blog/kubernetes","mainEntityOfPage":"http://localhost:3000/docs/openziti/blog/kubernetes","url":"http://localhost:3000/docs/openziti/blog/kubernetes","headline":"Tunneling Ingress to Kubernetes Workloads","name":"Tunneling Ingress to Kubernetes Workloads","description":"The previous post showed how to use a zero trust overlay like Ziti for transferring files by","datePublished":"2021-10-21T00:49:30.000Z","author":{"@type":"Person","name":"Clint Dovholuk","description":"Author","url":"https://github.com/dovholuknf","image":"https://avatars.githubusercontent.com/dovholuknf"},"image":{"@type":"ImageObject","@id":"http://localhost:3000/@site/blogs/openziti/v1653224137964/I7QcSkiM3.jpeg","url":"http://localhost:3000/@site/blogs/openziti/v1653224137964/I7QcSkiM3.jpeg","contentUrl":"http://localhost:3000/@site/blogs/openziti/v1653224137964/I7QcSkiM3.jpeg","caption":"title image for the blog post: Tunneling Ingress to Kubernetes Workloads"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"http://localhost:3000/docs/openziti/blog","name":"Blog"}}</script><script>!function(t,h,e,j,s,n){t.hj=t.hj||function(){(t.hj.q=t.hj.q||[]).push(arguments)},t._hjSettings={hjid:3576473,hjsv:6},s=h.getElementsByTagName("head")[0],(n=h.createElement("script")).async=1,n.src="https://static.hotjar.com/c/hotjar-"+t._hjSettings.hjid+".js?sv="+t._hjSettings.hjsv,s.appendChild(n)}(window,document)</script>
<link rel="alternate" type="application/rss+xml" href="/docs/openziti/blog/rss.xml" title="OpenZiti RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/openziti/blog/atom.xml" title="OpenZiti Atom Feed">

<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-5SF399H3",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>





<link rel="search" type="application/opensearchdescription+xml" title="OpenZiti" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.273075c6.css">
<script src="/assets/js/runtime~main.5c8b5ad4.js" defer="defer"></script>
<script src="/assets/js/main.f686f705.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5SF399H3" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>



<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/ziti-logo-dark.svg"><link rel="preload" as="image" href="/img/ziti-logo-light.svg"><link rel="preload" as="image" href="https://avatars.githubusercontent.com/dovholuknf"><link rel="preload" href="https://i.ytimg.com/vi/CRoansolpR0/hqdefault.jpg" as="image"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/"><div class="navbar__logo"><img src="/img/ziti-logo-dark.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/ziti-logo-light.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item"><a class="navbar__item navbar__link header-netfoundry-link" href="https://netfoundry.io/products/netfoundry-cloud-30-day-free-trial/" target="_blank">NetFoundry</a></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/openziti/learn/introduction/">Documentation</a><a class="navbar__item navbar__link" href="/docs/openziti/downloads">Downloads</a><div class="navbar__item"><a class="navbar__item navbar__link header-netfoundry-link" href="https://blog.openziti.io/" target="_blank">Blog</a></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Links</a><ul class="dropdown__menu"><li class=""><div class="text-divider"><p>Socials</p></div></li><li class=""><a href="https://www.youtube.com/OpenZiti" target="_blank" title="OpenZiti on YouTube"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/yt.svg" alt="YouTube logo">YouTube</span></a></li><li class=""><a href="https://x.com/OpenZiti" target="_blank" title="OpenZiti on X(formerly Twitter)"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/twit.svg" alt="X/Twitter logo">X (Twitter)</span></a></li><li class=""><a href="https://www.reddit.com/r/openziti" target="_blank" title="OpenZiti Subreddit"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/reddit-logo.png" alt="Reddit logo">Reddit</span></a></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/ziggy.png" alt="X/Twitter Ziggy logo"><a href="https://x.com/OpenZiggy" target="_blank" title="OpenZiggy on X(formerly Twitter)">Ziggy</a></span></li><li class=""><div class="text-divider"><p>Other</p></div></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/blog-icon.png" alt="OpenZiti blog logo"><a href="https://blog.openziti.io/" target="_blank" title="Blog">Blog</a></span></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/oz-test-kitchen.png" alt="OpenZiti Test Kitchen logo"><a href="https://github.com/openziti-test-kitchen" target="_blank" title="Git project for the test kitchen">Test Kitchen</a></span></li></ul></div><a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discourse-link" title="Discourse"></a><a href="https://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="styles-module_starUsRoot__hMNZp"><span style="color:whitesmoke">Star Us on GitHub<!-- -->Â </span><span style="height:20px"><span><a href="https://github.com/openziti/ziti" data-icon="octicon-star" data-show-count="true" aria-label="Star buttons/github-buttons on GitHub">Star</a></span></span></div><div class="main-wrapper NetFoundryLayout-module_ozLayoutMainWrapper__a2vwh"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/introducing-zrok-10">Introducing zrok 1.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-unleashed-top-10-uses-explored">zrok Unleashed: Top 10 Uses Explored</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-ziti-identities-with-hsmtpm">Securing Ziti Identities with HSM/TPM</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-custom-domains">zrok Custom Domains</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/golang-aha-moments-oop">Golang Aha! Moments: OOP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-safest-way-to-make-portainer-internet-accessible">The safest way to make Portainer Internet accessible</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/multifactor-zero-trust-ssh">Multifactor Zero Trust ssh</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zero-trust-sshclient">Zero Trust *ssh.Client</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/effortless-docker-management-with-private-web-access">Effortless Docker Management</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-is-growing-up">zrok is Growing Up</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-vpn-linux-service">Easy Steps to Install a Private VPN on Linux with zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/jitsi-meet-zrok">Jitsi, meet zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/extend-access-to-a-private-s3-bucket-using-python">Extend Access to a Private S3 Bucket Using Python</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/why-we-verify-github-commits">Why We Verify GitHub Commits</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/limitless-zrok-with-docker">Limitless zrok with Docker</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/how-to-prevent-path-traversal-attacks-with-openziti-browzer">How to Prevent Path Traversal Attacks with OpenZiti BrowZer</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-vpn">zrok VPN</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d">Deploy OpenZiti in Kubernetes with Ease Using k3d</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/signing-executables-from-github-actions">Signing Executables From GitHub Actions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-nodejs-zrok-sdk">The NodeJS zrok SDK</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/no-listening-ports">No Listening Ports?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/announcing-openziti-v1">Announcing OpenZiti v1.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/pixy-dust-for-web-applications-pkce">Pixy Dust For Web Applications</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/secure-remote-development-with-zrok-and-jetbrains">Secure Remote Development with zrok and JetBrains</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-permission-modes">zrok Permission Modes</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-zrok-socks-backend">The zrok SOCKS Backend</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-python-zrok-sdk">The Python zrok SDK</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-dedicated-palworld-server-with-zrok">Securing a Dedicated  Palworld Server For My Family with zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/fun-with-adaptive-rate-limiting">Fun with Adaptive Rate Limiting</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-zrok-drives-cli-preview">The zrok Drives CLI Preview</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/minecraft-over-zrok">Minecraft Over zrok</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/go-is-amazing-for-zero-trust">Go is Amazing for Zero Trust</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-frontdoor">zrok frontdoor</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/business-rule-driven-just-in-time-network-access">Business Rule Driven Just-in-Time Network Access</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-drives-an-early-preview">zrok Drives (an Early Preview)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/put-some-ziti-in-your-caddy">Put some Ziti in your Caddy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-zrok-oauth-public-frontend">The zrok OAuth Public Frontend</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-azure-openai-applications-with-openziti">Securing Azure OpenAI Applications with OpenZiti</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openziti-zero-trust-iot-wi-fi-gateway">OpenZiti Zero Trust IoT Wi-Fi Gateway</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-with-the-power-of-caddy">zrok with the Power of Caddy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-zrok-sdk">The zrok SDK</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/got-5-minutes-secure-your-python-website-with-zero-trust">Got 5 Minutes? Secure Your Python Website with Zero Trust.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/announcing-the-zrok-public-beta">Announcing the zrok Public Beta!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-v040-released">zrok v0.4.0 Released!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/commercial-open-source-and-ethical-and-practical-community-engagement">Commercial Open Source and Ethical (and practical) Community Engagement</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/my-pi-day-journey-with-go-64-bit-alignment">My Pi Day Journey with Go 64-bit alignment</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/private-dns-on-windows">Private DNS on Windows</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/websockets-over-zrok">Websockets over zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openapi-python-clients">OpenAPI Python Clients</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/postman-mgmt">Postman and the Management API</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-road-ahead-for-zrok">The Road Ahead for zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/auto-complete">Ziti Shell Auto-Complete</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/introducing-zrok">Introducing zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/connecting-to-local-development-environment-from-cloud-hosts-with-zrok">Connecting to Local Development Environment from Cloud Hosts with zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/lessons-learned-writing-a-zero-trust-nginx-module">Lessons Learned Writing a Zero Trust NGINX Module</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zero-trust-monitoring-with-openziti">Zero Trust Monitoring with OpenZiti</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2022</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/its-a-zitiful-life">It&#x27;s A Zitiful Life</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/nginx-zerotrust-api-security">NGINX &amp; ZeroTrust API Security</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/using-ebpf-tc-to-securely-mangle-packets-in-the-kernel-and-pass-them-to-my-secure-networking-application">Using eBPF-TC to securely mangle packets in the kernel, and pass them to my secure networking application</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/browzer-gateway-fqdn-certs">OpenZiti BrowZer Gateway</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openziti-authentication-api-integrations">OpenZiti Authentication API Integrations</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/high-level-publicprivate-cryptography">High-Level Public/Private Cryptography</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/set-up-a-secure-multiplayer-minecraft-server">Set Up a Secure Multiplayer Minecraft Server</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/setting-up-oracle-cloud-to-host-openziti">Setting Up Oracle Cloud To Host OpenZiti</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/integrating-ziti-is-easy">Integrating Ziti is Easy! How we got our app tested with go-httpbin</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/golang-aha-moments-generics">Golang Aha! Moments: Generics</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-nodejs-applications">Securing NodeJS Applications â€” An Introduction to the OpenZiti SDK for NodeJS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openziti-is-participating-in-hacktoberfest-prost">OpenZiti is Participating in Hacktoberfest, Prost!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openziti-python-sdk-introduction">OpenZiti Python SDK: Introduction</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/free-secure-access-to-nas-from-anywhere">Free Secure Access to NAS From Anywhere</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/introducing-openziti-browzer">Introducing OpenZiti BrowZer</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/golang-aha-moments-channels">Golang Aha! Moments: Channels</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zero-trust-overlay-network-to-access-homeassistant">I Created a Zero Trust Overlay Network to Access HomeAssistant</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/my-intern-assignment-call-a-dark-webhook-from-aws-lambda">My Intern Assignment - Call a Dark Webhook from AWS Lambda</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/extrovert-wednesday">Extrovert Wednesday</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-web-apis-with-openziti">Securing Web APIs With OpenZiti â€” Zero Trust For Web APIs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/tunneling-voip-over-openziti">Tunneling VoIP over OpenZiti</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-5-bootstrapping-trust">Bootstrapping Trust Part 5</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-4-certificate-authorities-chains-of-trust">Bootstrapping Trust Part 4</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-3-certificates">Bootstrapping Trust Part 3 - Certificates</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-2-a-primer-on-public-key-cryptography">Bootstrapping Trust Part 2 - PKI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-1-encryption-everywhere">Bootstrapping Trust Part 1 - Encryption Everywhere</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/configuring-openziti-to-enable-prometheus">Configuring OpenZiti to Enable Prometheus</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/prometheus-scrape-anything-from-anywhere">Prometheus - Scrape Anything from Anywhere</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/scraping-anything-anywhere-in-action">Scraping Anything, Anywhere in Action</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2021</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/docs/openziti/blog/kubernetes">Tunneling Ingress to Kubernetes Workloads</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zitifying-scp">Zitifying SCP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zitifying-ssh">Zitifying SSH</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zitification">Zitification</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2020</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/mobile-point-of-sale-mpos-app-ziti-android-java-sdk-integration">Mobile Point of Sale (mPOS) app â€“ embed zero trust networking</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Tunneling Ingress to Kubernetes Workloads</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-10-21T00:49:30.000Z">October 21, 2021</time> Â· <!-- -->14 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/dovholuknf" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/dovholuknf" alt="Clint Dovholuk"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/dovholuknf" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Clint Dovholuk</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>The <a href="/docs/openziti/blog/zitifying-scp">previous post</a> showed how to use a zero trust overlay like Ziti for transferring files by
zitifying <code>scp</code>. Next up in the list of zitifications is <code>kubectl</code>. <a href="https://Kubernetes.io/" target="_blank" rel="noopener noreferrer">Kubernetes</a> is a
container orchestration system. Its purpose is to deploy, scale, and manage the deployment containers. Containers
are self-contained, pre-built images of software generally with a singular purpose.
<a href="https://appfleet.com/blog/10-reasons-why-developers-love-docker/" target="_blank" rel="noopener noreferrer">Developers often like using containers for various reasons</a>.
One major reason developers like containers is because it simplifies the deployment of the solutions
they are developing. This is where Kubernetes starts to come into focus.</p>
<p>In this article we&#x27;ll use a cloud provider to create a Kubernetes cluster to use. I&#x27;m using Oracle OKE in this article but there are <a href="https://www.google.com/search?q=kubernetes+cloud+providers&amp;oq=kubernetes+cloud+providers" target="_blank" rel="noopener noreferrer">numerous Kubernetes providers</a> and any of them will work but clearly the commands I&#x27;m running here are Oracle specific. Once created we will then access the cluster three ways:</p>
<ol>
<li>
<p>Via the public Kubernetes API secured via mTLS. This is the default, out-of-the-box mechanism provided by Kubernetes.</p>
</li>
<li>
<p>Via a tunneling app. I run Windows, so I&#x27;ll use the Ziti Desktop Edge for Windows.</p>
</li>
<li>
<p>Via a zitified <code>kubectl</code>.</p>
</li>
</ol>
<p>Here&#x27;s where we&#x27;ll get to see the power of a truly zitified application. We&#x27;ll be able to access our cluster extremely securely using the Ziti overlay network without installing an additional agent. Once access to the cluster comes entirely from the <a href="https://openziti.github.io/ziti/overview.html#overview-of-a-ziti-network" target="_blank" rel="noopener noreferrer">Ziti Network</a>, we will be able to turn public access to the Kubernetes management API <strong>off</strong> entirely!</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="about-kubernetes">About Kubernetes<a href="#about-kubernetes" class="hash-link" aria-label="Direct link to About Kubernetes" title="Direct link to About Kubernetes">â€‹</a></h2>
<p>If you aren&#x27;t already familiar with Kubernetes then it&#x27;s probably best for you to stop reading and learn a little about it first. Though this article only expects you to understand the most rudimentary of commands, it won&#x27;t teach you enough about Kubernetes to understand the what&#x27;s and why&#x27;s. Lots of documentation on this topic already exist and are just a search away in your search engine of choice.</p>
<p>Kubernetes itself is not a container engine, it&#x27;s an orchestrator. This means that Kubernetes knows how to interface with container engines to perform deployments and management of workloads on the behalf of operators. This provides people with a common abstraction to use when doing this management and deployment. Interacting with the Kubernetes API is made easy by using the command-line tool: <code>kubectl</code>.</p>
<p><a href="https://Kubernetes.io/docs/reference/kubectl/overview/" target="_blank" rel="noopener noreferrer">kubectl</a> provides numerous commands and utilities to interact with your Kubernetes cluster. It does this by creating REST requests to a well-known endpoint. This endpoint is a highly-valuable target as it is the entry-point to the cluster. Plenty of blogs exist already on the internet addressing how to secure this endpoint but in this post we&#x27;ll take it one step further than ever before by removing the Kubernetes control plane from the internet entirely. Following that we will even go one step further by replacing the existing <code>kubectl</code> command with a zero-trust implementation leveraging the ziti golang sdk.</p>
<p>If you&#x27;d prefer to watch a video that goes over the same content contained in the rest of this article you can go ahead and click here to watch.</p>
<p></p><article class="yt-lite" data-title="YouTube video" style="background-image:url(https://i.ytimg.com/vi/CRoansolpR0/hqdefault.jpg);--aspect-ratio:56.25%"><button type="button" class="lty-playbtn" aria-label="Watch YouTube video"></button></article><p></p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup">Setup<a href="#setup" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">â€‹</a></h2>
<p>Below is an overview of the <a href="https://openziti.github.io/ziti/overview.html#overview-of-a-ziti-network" target="_blank" rel="noopener noreferrer">Ziti Network</a> I created for this article. On the left you can see that the client, my computer, runs Windows 10. Inside Windows 10 I run linux and bash using Ubuntu via <a href="https://docs.microsoft.com/en-us/windows/wsl/install" target="_blank" rel="noopener noreferrer">Windows Subsystem For Linux (WSL)</a>. If you run Windows and don&#x27;t have WSL installed I would encourage you to install and learn it! In my bash shell I have downloaded the linux version of <code>kubectl</code> created by combining the Ziti Golang SDK into it. You can grab it from <a href="https://github.com/openziti-incubator/kubectl/releases/latest/download/kubectl-linux-amd64" target="_blank" rel="noopener noreferrer">this link</a> if you like or go check out <a href="https://github.com/openziti-incubator/kubectl" target="_blank" rel="noopener noreferrer">the code on GitHub</a> and build it yourself!</p>
<p><img decoding="async" loading="lazy" alt="ðŸ™‚" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAMAAABiM0N1AAAAVFBMVEVHcEz/zE3/zE3/zE3/zE3/zE3/zE3/zE3/zE3/zE3/zE3/zE3/zE3/zE2ziSdwTQVmRQDPojX1xEifeB2MZxPsu0ODXg55VgrZqjrGmTCWbxjisz+dUJF3AAAADXRSTlMA36/PgFCPIJ/vQL9g4e8akwAAAbpJREFUeF7tmNluwyAQRcGJWWxfvGfr//9nrTQuSsCYTEftS4+Ul4l0NQx4NpFAN6qWeCBr1WhBoDQSAdKU4i20stjAqny/qgJJiirPG4NdTIZXR4sM7HHPnQMyOSSdKi2ysWXiWHiLzeMZvIlJ6DAoGRAwe/Ghx6kEkZe70xZE7PN7OoDMIQgQlWPiYNTDGQSQ3kCFH7LmpzCP9eeuO/fItRePCIU63Z0+146vKCm8MLTdnXbIswPqLhRcmeseuDw7YOMfx2kVOu3YPWX07rtvEvbwBciE0Jy2e2RwZ0SPoEXDI9QIBY5gQ4kaoF+/p/axpj1IH20AhE8kxAsRP1ovROCvhf6FJFiQogYLtVBgQYkGLDRCgwUteKItNwp/2/bYoG/bjfJfIppsbzMizLflr62+zSJg7Bam62tiu07dwogAGy/ZwLwm59FdFj6WnxtPvhbFS7ZGIm2HOIRo39aEh9tgREiRarTGfB1Uydavb0OZ+KswO83o4M7PMmc37HXaR8S5uGmtZZO7IM6Rq2FnHSH4hxr6mMU4+NGV+Idawzyu8y8Q6CsN/iULfe3DtYjiX43xL+vY1oefIwTWrJDpq5sAAAAASUVORK5CYII=" width="72" height="72" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution-overview">Solution Overview<a href="#solution-overview" class="hash-link" aria-label="Direct link to Solution Overview" title="Direct link to Solution Overview">â€‹</a></h3>
<p><img decoding="async" loading="lazy" alt="image.png" src="/assets/images/D7i8n0NOP-744bb76ad472d08feef2392765e30aa0.png" width="1087" height="474" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="basic-ziti-setup">Basic Ziti Setup<a href="#basic-ziti-setup" class="hash-link" aria-label="Direct link to Basic Ziti Setup" title="Direct link to Basic Ziti Setup">â€‹</a></h3>
<p>To accomplish our stated goals, we will need not only an existing <a href="https://openziti.github.io/ziti/overview.html#overview-of-a-ziti-network" target="_blank" rel="noopener noreferrer">Ziti Network</a> but we&#x27;ll also have to configure that network accordingly. Here&#x27;s a list of the components necessary to deliver Kubernetes with our zero-trust network:</p>
<ol>
<li>
<p>A configuration for the <code>Bind</code> side of the service. This informs the identity within Kubernetes where to send traffic and how.</p>
</li>
<li>
<p>A configuration for the <code>Dial</code> side of the service. This is strictly <strong>only</strong> necessary for tunneling apps. In this example, for the Ziti Desktop Edge for Windows and specifies what host and port will be intercepted on the machine running the stock <code>kubectl</code>. for Windows.</p>
</li>
<li>
<p>The service itself which ties our polices mentioned above together.</p>
</li>
<li>
<p>A <code>Bind</code> service-policy which specifies which identities are allowed to act as a &quot;host&quot; for the service (meaning an identity to send traffic to which knows where and how to offload that traffic). In our example this will be the <code>ziti-edge-tunnel</code> running in a Kubernetes pod.</p>
</li>
<li>
<p>A <code>Dial</code> service-policy which specifies the identities allowed to access the service. This will be the identity using<br>
<code>kubectl</code>.</p>
</li>
<li>
<p>Create two identities - one for the <code>Bind</code> side of the service (deployed within the Kubernetes cluster) and one for the <code>Dial</code> or client side.</p>
</li>
</ol>
<p>Here are some example commands using the <a href="https://github.com/openziti/ziti/releases/latest" target="_blank" rel="noopener noreferrer">ziti cli</a> which illustrate how to create these services. Some things of note worth mentioning. I&#x27;m setting a variable to make my configuration easier. I reuse these code blocks a lot and by extracting some variables it makes it easy for me to delete/recreate services. First I set the <code>service_name</code><br>
<!-- -->variable. I use this variable in all the names of the Ziti objects I create just to make it more clear and obvious if I have to look back at my configuration again.</p>
<p>Since I&#x27;m going to be accessing my Kubernetes API which I&#x27;ve deployed using the Oracle cloud I chose to use <code>k8s.oci</code><br>
<!-- -->as my service name. When deployed by a cloud provider, the Kubernetes API is generated or updated with numerous SANS and IP address I can choose from to represent the <code>Dial</code> side which will be intercepted by the Ziti Desktop Edge for Windows. The Oracle cloud console informs me that the private IP of <code>10.0.0.6</code> was assigned to my cluster when I click on the &#x27;Access Cluster&#x27; button which is why I chose to use that value below. I could have choosen to use any of the DNS names provided by OKE. There are at least five I could choose from, all visible as SANS on the cert that the server returns: <code>kubernetes</code>, <code>kubernetes.default</code>, <code>kubernetes.default.svc</code>, <code>kubernetes.default.svc.cluster</code><br>
<!-- -->, <code>kubernetes.default.svc.cluster.local</code>. I chose the IP since it&#x27;s pretty obvious that it&#x27;s an internal IP, not on my local network. Also worth pointing out is that I&#x27;m mapping the port as well, changing it from the port that the server provides, 6443, to the common HTTPS port of 443 for the local intercept. With zitified <code>kubectl</code> we don&#x27;t even need these intercepts, but we&#x27;ll keep it here so that we can use the unmodified <code>kubectl</code> as well. Finally, these commands are all executed inside a bash shell since I&#x27;m using WSL.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-ziti-cli-commands">Example Ziti CLI commands<a href="#example-ziti-cli-commands" class="hash-link" aria-label="Direct link to Example Ziti CLI commands" title="Direct link to Example Ziti CLI commands">â€‹</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># the name of the service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">service_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">k8s.oci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># the name of the identity you&#x27;d like to see on the kubectl client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">the_user_identity</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">.client&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># the name of the identity deployed into the kubernetes cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">the_kubernetes_identity</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">.private&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">-host.v1&quot;</span><span class="token plain"> host.v1 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;{&quot;protocol&quot;:&quot;tcp&quot;, &quot;address&quot;:&quot;10.0.0.6&quot;,&quot;port&quot;:6443 }&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">-client-config&quot;</span><span class="token plain"> intercept.v1 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;{&quot;protocols&quot;:[&quot;tcp&quot;],&quot;addresses&quot;:[&quot;10.0.0.6&quot;,&quot;kubernetes&quot;], &quot;portRanges&quot;:[{&quot;low&quot;:443, &quot;high&quot;:443}]}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--configs</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">-client-config,</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">-host.v1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">-binding&quot;</span><span class="token plain"> Bind </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --service-roles </span><span class="token string" style="color:#e3116c">&quot;@</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --identity-roles </span><span class="token string" style="color:#e3116c">&quot;#</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">ServerEndpoints&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">-dialing&quot;</span><span class="token plain"> Dial </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --service-roles </span><span class="token string" style="color:#e3116c">&quot;@</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --identity-roles </span><span class="token string" style="color:#e3116c">&quot;#</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">ClientEndpoints&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create identity device </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${the_kubernetes_identity}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">ServerEndpoints&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${the_kubernetes_identity}</span><span class="token string" style="color:#e3116c">.jwt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create identity device </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${the_user_identity}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${service_name}</span><span class="token string" style="color:#e3116c">ClientEndpoints&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${the_user_identity}</span><span class="token string" style="color:#e3116c">.jwt&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes-config-files">Kubernetes Config Files<a href="#kubernetes-config-files" class="hash-link" aria-label="Direct link to Kubernetes Config Files" title="Direct link to Kubernetes Config Files">â€‹</a></h2>
<p>Once we have established the pieces of the <a href="https://openziti.github.io/ziti/overview.html#overview-of-a-ziti-network" target="_blank" rel="noopener noreferrer">Ziti Network</a>, we&#x27;ll want to get the Kubernetes config files from OKE so that we can test access, make sure the cluster works etc. Oracle provides a CLI command which makes it pretty easy to get those config files called <code>oci</code>. As of this writing - the guide from <a href="https://docs.oracle.com/en-us/iaas/Content/API/SDKDocs/cliinstall.htm" target="_blank" rel="noopener noreferrer">Oracle is here</a>. Once <code>oci</code> is installed and configured the Oracle cloud gives you very easy commands to run which will generate two files. One file will be for accessing the Kubernetes API through the public endpoint. The other will get you the file for private access. We&#x27;re going to want both since we&#x27;re on a journey here from &quot;public API endpoint&quot; to tunneling-app-based access, to the final stage of app-embedded zero-trust directly into <code>kubeztl</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="getting-the-kubernetes-config-files">Getting the Kubernetes Config Files<a href="#getting-the-kubernetes-config-files" class="hash-link" aria-label="Direct link to Getting the Kubernetes Config Files" title="Direct link to Getting the Kubernetes Config Files">â€‹</a></h3>
<p>Notice that we are changing the file location output by these commands and they are being output as two separate Kubernetes config files. If you prefer to merge them all into one big config file and change contexts - feel free. I left them as separate files here because it provides a very clear separation as to which config is being used or modified.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Get this value directly from Oracle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">oci_cluster_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;put-your-cluster-id-here&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oci ce cluster create-kubeconfig </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster-id </span><span class="token variable" style="color:#36acaa">${oci_cluster_id}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--file</span><span class="token plain"> /tmp/oci/config.oci.public </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--region</span><span class="token plain"> us-ashburn-1 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --token-version </span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain">.0 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --kube-endpoint PUBLIC_ENDPOINT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> /tmp/oci/config.oci.public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oci ce cluster create-kubeconfig </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster-id </span><span class="token variable" style="color:#36acaa">${oci_cluster_id}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--file</span><span class="token plain"> /tmp/oci/config.oci.private </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--region</span><span class="token plain"> us-ashburn-1 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --token-version </span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain">.0 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --kube-endpoint PRIVATE_ENDPOINT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> /tmp/oci/config.oci.private</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="connecting-the-pieces">Connecting the Pieces<a href="#connecting-the-pieces" class="hash-link" aria-label="Direct link to Connecting the Pieces" title="Direct link to Connecting the Pieces">â€‹</a></h2>
<p>At this point we should have all the pieces in place so that we can start putting them together to test the overall solution. In this section we&#x27;ll access our public Kubernetes api to make sure it works. Then we&#x27;ll install Ziti into the Kubernetes cluster and verify private access works. Finally we&#x27;ll disable public access <strong>entirely</strong> and use the zitified <code>kubeztl</code> command to access the cluster with true, app-embedded zero-trust binary.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing-the-public-api">Testing the Public API<a href="#testing-the-public-api" class="hash-link" aria-label="Direct link to Testing the Public API" title="Direct link to Testing the Public API">â€‹</a></h3>
<p>This step is very straight-forward for anyone who&#x27;s used Kubernetes before. Issue the following commands, making sure the path is correct for your public Kubernetes config file, and verify Kubernetes works as expected.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">KUBECONFIG</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/tmp/oci/config.oci.public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods </span><span class="token parameter variable" style="color:#36acaa">-v6</span><span class="token plain"> --request-timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I1019 </span><span class="token number" style="color:#36acaa">13</span><span class="token plain">:57:31.910962    </span><span class="token number" style="color:#36acaa">3211</span><span class="token plain"> loader.go:372</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Config loaded from file:  /tmp/oci/config.oci.public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I1019 </span><span class="token number" style="color:#36acaa">13</span><span class="token plain">:57:33.676047    </span><span class="token number" style="color:#36acaa">3211</span><span class="token plain"> round_trippers.go:454</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> GET https://150.230.150.0:6443/api/v1/namespaces/default/pods?limit</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">500</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">5s </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1752</span><span class="token plain"> milliseconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                        READY   STATUS    RESTARTS   AGE</span><br></span></code></pre></div></div>
<p>If your output looks something similar to the above (with or without the pods you expect to see) then great! That means your Kubernetes cluster is indeed up and running. Let&#x27;s move on!</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-ziti-to-kubernetes">Deploying Ziti to Kubernetes<a href="#deploying-ziti-to-kubernetes" class="hash-link" aria-label="Direct link to Deploying Ziti to Kubernetes" title="Direct link to Deploying Ziti to Kubernetes">â€‹</a></h4>
<ol>
<li>
<p>install the <code>helm</code> CLI tool <a href="https://helm.sh/docs/intro/install/" target="_blank" rel="noopener noreferrer">using this guide</a></p>
</li>
<li>
<p>add the OpenZiti Helm repo:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> openziti https://openziti.github.io/helm-charts/</span><br></span></code></pre></div></div>
</li>
<li>
<p>locate the jwt file for the Kubernetes identity. If you followed the steps above the file will be named: <code>&quot;${the_kubernetes_identity}&quot;.jwt</code> (make sure you replace the variable with the correct value)</p>
</li>
<li>
<p>enroll the Kubernetes identity. This exchanges the temporary JWT for a permanent identity JSON file. Several Ziti CLIs have an <code>enroll</code> command for this purpose. Here&#x27;s one way to obtain the identity that doesn&#x27;t require you to download a CLI if you already have Docker:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># start with JWT file on Docker host in </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#  /tmp/${the_kubernetes_identity}.jwt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#36acaa">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--volume</span><span class="token plain"> /tmp:/mnt </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    openziti/quickstart /openziti/ziti-bin/ziti edge enroll </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;/mnt/</span><span class="token string variable" style="color:#36acaa">${the_kubernetes_identity}</span><span class="token string" style="color:#e3116c">.jwt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># now you will have a new file </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># /tmp/${the_kubernetes_identity}.json</span><br></span></code></pre></div></div>
</li>
<li>
<p>use the Kubernetes identity JSON file when you install the Helm chart:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> ziti-host openziti/ziti-host </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set-file </span><span class="token assign-left variable" style="color:#36acaa">zitiIdentity</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/tmp/</span><span class="token string variable" style="color:#36acaa">${the_kubernetes_identity}</span><span class="token string" style="color:#e3116c">.json&quot;</span><br></span></code></pre></div></div>
</li>
</ol>
<p>Again, make sure you replace the variable name</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="addenroll-the-client-identity">Add/Enroll the Client Identity<a href="#addenroll-the-client-identity" class="hash-link" aria-label="Direct link to Add/Enroll the Client Identity" title="Direct link to Add/Enroll the Client Identity">â€‹</a></h4>
<p>Now consume the one time token (the jwt file) to enroll and create a client-side identity using the Ziti Desktop Edge for Windows (or MacOS or via the <code>ziti-edge-tunnel</code> if you prefer). Once you can see the identity in your tunneling app, you should be able to use the private kubernetes config file to access the same exact cluster. Remember though, we have mapped the port on the client side to use 443. That means you&#x27;ll need to update your config file and change 6443 --&gt; 443. Now when you run <code>get pods</code> you&#x27;ll see the ziti-host pod deployed:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">KUBECONFIG</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/tmp/oci/config.oci.private</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                        READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti-host-976b84c66-kr4bc   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          90m</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-big-finale---zitified-kubectl">The Big Finale - Zitified kubectl<a href="#the-big-finale---zitified-kubectl" class="hash-link" aria-label="Direct link to The Big Finale - Zitified kubectl" title="Direct link to The Big Finale - Zitified kubectl">â€‹</a></h2>
<p>If you have made it this far, you&#x27;ve seen us access the Kubernetes API via the public IP. We&#x27;ve even accessed it via the private IP (which btw - is pretty cool in my opinion!). Now we&#x27;re going to download the zitified kubectl command, turn off the public IP and even turn off the locally running tunneling app and still access the API!</p>
<ol>
<li>
<p>Disable the cluster&#x27;s public IP address in OKE (go to the cluster in Oracle Cloud, click Edit and remove the public IP and click save)</p>
</li>
<li>
<p>Turn off the Ziti Desktop Edge for Windows</p>
</li>
<li>
<p>Download <code>kubeztl</code> (you don&#x27;t need to call the executable <code>kubeztl</code> - you can keep it named <code>kubectl</code> if you want)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-L</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> kubeztl https://github.com/openziti-incubator/kubectl/releases/download/v0.0.4/kubectl-linux-amd64</span><br></span></code></pre></div></div>
</li>
<li>
<p>Use <code>kubeztl</code> to get pods!</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./kubeztl get pods </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> id.json </span><span class="token parameter variable" style="color:#36acaa">-S</span><span class="token plain"> k8s.oci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                        READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti-host-976b84c66-kr4bc   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          101m</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="modifying-kubeconfig">Modifying KUBECONFIG<a href="#modifying-kubeconfig" class="hash-link" aria-label="Direct link to Modifying KUBECONFIG" title="Direct link to Modifying KUBECONFIG">â€‹</a></h3>
</li>
</ol>
<p>The <code>kubeztl</code> command has also been modified to allow you to add the service name and config file directly into the file itself. This is convenient since you will not need to supply the ziti identity file, nor will you need to specify which service to use. Modifying the file is straight-forward. Open the config file, find the context listed under the contexts root and add two rows as shown here.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">contexts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cluster</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cluster</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cjw4arxuolq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cjw4arxuolq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">zConfig</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /tmp/oci/k8s.id.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> k8s.oci</span><br></span></code></pre></div></div>
<p>Once done - you can now simply use the context the same way you have always - <code>kubeztl get pods</code>!!!</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./kubeztl get pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                        READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti-host-976b84c66-kr4bc   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          114m</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">â€‹</a></h2>
<p>We&#x27;ve seen in this post how you can not only secure your Kubernetes API with the normal Kubernetes mechanisms. You can also take your Kubernetes API off the internet <strong>ENTIRELY</strong>. No need to deploy and maintain a special bastion node. Now by having a secure, zero-trust overlay in place you can safely and securely access your Kubernetes API without the fear of that public, high-value API getting attacked.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/XaHdVbzL4-0f839598d7548c20486dc4e18035a6ed.jpeg" width="250" height="249" class="img_ev3q"></p>
<p>Once you&#x27;ve deployed Ziti into the Kubernetes cluster you&#x27;re not done there. Now you can also use Ziti to span cloud networks. You can use it to easily link private data centers or other private Kubernetes clusters all into one secure, zero-trust overlay network! Use Ziti to expose workloads that are <strong>TRULY</strong> private! In future articles we might explore how we can bring Ziti to bear on these topics, stay tuned!</p>
<hr></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Security-related posts" class="tag_zVej tagRegular_sFm0" href="/docs/openziti/blog/tags/security">Security</a></li><li class="tag_QGVx"><a rel="tag" title="Kubernetes content" class="tag_zVej tagRegular_sFm0" href="/docs/openziti/blog/tags/kubernetes">Kubernetes</a></li><li class="tag_QGVx"><a rel="tag" title="Uncategorized posts" class="tag_zVej tagRegular_sFm0" href="/docs/openziti/blog/tags/uncategorized">Uncategorized</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/openziti/blog/scraping-anything-anywhere-in-action"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Scraping Anything, Anywhere in Action</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/openziti/blog/zitifying-scp"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Zitifying SCP</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#about-kubernetes" class="table-of-contents__link toc-highlight">About Kubernetes</a></li><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a><ul><li><a href="#solution-overview" class="table-of-contents__link toc-highlight">Solution Overview</a></li><li><a href="#basic-ziti-setup" class="table-of-contents__link toc-highlight">Basic Ziti Setup</a></li></ul></li><li><a href="#kubernetes-config-files" class="table-of-contents__link toc-highlight">Kubernetes Config Files</a><ul><li><a href="#getting-the-kubernetes-config-files" class="table-of-contents__link toc-highlight">Getting the Kubernetes Config Files</a></li></ul></li><li><a href="#connecting-the-pieces" class="table-of-contents__link toc-highlight">Connecting the Pieces</a><ul><li><a href="#testing-the-public-api" class="table-of-contents__link toc-highlight">Testing the Public API</a></li></ul></li><li><a href="#the-big-finale---zitified-kubectl" class="table-of-contents__link toc-highlight">The Big Finale - Zitified kubectl</a><ul><li><a href="#modifying-kubeconfig" class="table-of-contents__link toc-highlight">Modifying KUBECONFIG</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div><footer class="styles-module_ozFooter__vHkQA"><section class="styles-module_footer__Qk0iB styles-module_ozHorizontalSectionRoot__QwWz0 styles-module_ozhsContent__haNeV"><div class="styles-module_footerContainer__azQkg"><div class="styles-module_footerGrid__fsf9C"><div class="styles-module_footerColumn__tK2bv"><h3>NetFoundry</h3><p>An open source project enabling developers to embed zero trust networking directly into applications.</p><div class="styles-module_footerSocialLinks__b1FcV"><a href="https://github.com/openziti/ziti" target="_blank" class="styles-module_footerSocialLink__iAElV" rel="noreferrer"><svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"></path></svg></a><a href="https://www.linkedin.com/in/netfoundry/" target="_blank" class="styles-module_footerSocialLink__iAElV" rel="noreferrer"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.996 16V10.1C15.996 7.5 15.375 5.49999 12.025 5.49999C10.4 5.49999 9.325 6.39999 8.875 7.29999H8.825V5.79999H5.65V16H8.95V10.7C8.95 9.30001 9.2 7.9 10.925 7.9C12.65 7.9 12.675 9.59999 12.675 10.8V16H15.996Z"></path><path d="M0.25 5.79999H3.575V16H0.25V5.79999Z"></path><path d="M1.9 0C0.85 0 0 0.85 0 1.9C0 2.95 0.85 3.8 1.9 3.8C2.95 3.8 3.8 2.95 3.8 1.9C3.8 0.85 2.95 0 1.9 0Z"></path></svg></a><a href="https://youtube.com/openziti/" target="_blank" class="styles-module_footerSocialLink__iAElV" rel="noreferrer"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.969 4.69c-.183-1.358-1.062-2.275-2.361-2.46C12.371 2 8 2 8 2S3.629 2 2.362 2.229c-1.3.186-2.179 1.103-2.361 2.461C0 6.03 0 10 0 10s0 3.97.2 5.31c.183 1.358 1.062 2.275 2.361 2.46C3.63 18 8 18 8 18s4.371 0 5.638-.23c1.3-.185 2.178-1.102 2.361-2.46.2-1.34.2-5.31.2-5.31s0-3.97-.23-5.31zm-8.36, 8.57V6.73l3.76 2.27-3.76 2.26z"></path></svg></a><a href="https://twitter.com/openziti/" target="_blank" class="styles-module_footerSocialLink__iAElV" rel="noreferrer"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.996 3.038c-.59.262-1.219.44-1.885.52.677-.406 1.194-1.05 1.438-1.815-.634.375-1.337.648-2.085.795-.598-.638-1.45-1.038-2.396-1.038-1.813 0-3.283 1.469-3.283 3.282 0 .257.03.507.085.748-2.728-.137-5.147-1.445-6.766-3.43-.282.485-.444 1.05-.444 1.651 0 1.14.58 2.143 1.46 2.732-.538-.017-1.044-.164-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.219-.276.075-.567.116-.866.116-.211 0-.416-.021-.617-.06.418 1.304 1.63 2.254 3.066 2.28-1.124.883-2.539 1.406-4.077 1.406-.265 0-.526-.015-.785-.046 1.453.933 3.178 1.475 5.032 1.475 6.038 0 9.34-5.002 9.34-9.34 0-.142-.004-.284-.01-.425.641-.463 1.198-1.039 1.638-1.696"></path></svg></a></div></div><div class="styles-module_footerColumn__tK2bv"><h3>Community</h3><ul class="styles-module_footerLinks__eOmJ9"><li><a href="https://github.com/openziti/ziti">GitHub</a></li><li><a href="https://openziti.discourse.group/">Discourse Forum</a></li><li><a href="/docs/openziti/policies/CONTRIBUTING">Contributing</a></li></ul></div><div class="styles-module_footerColumn__tK2bv"><h3>Resources</h3><ul class="styles-module_footerLinks__eOmJ9"><li><a href="https://blog.openziti.io">OpenZiti Tech Blog</a></li><li><a href="https://netfoundry.io/">NetFoundry</a></li></ul></div></div></div><div class="styles-module_footerCopyright__nWyvc"><p>Â© 2025 NetFoundry Inc. OpenZiti is an open source project sponsored by NetFoundry. All rights reserved.</p></div></section></footer></div></div>
</body>
</html>