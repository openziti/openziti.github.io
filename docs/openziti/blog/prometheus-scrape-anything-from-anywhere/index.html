<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true"></title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:url" content="http://localhost:3000/docs/openziti/blog/prometheus-scrape-anything-from-anywhere"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="robots" content="index, follow"><meta data-rh="true" property="og:title" content="Prometheus - Scrape Anything from Anywhere | OpenZiti"><meta data-rh="true" name="description" content="This is part one of a three-part article. This article provides the necessary background and rationale for the series. The next article will be a detailed explanation of the actual steps necessary to implement the solution. In the final article, we will explore what we have just created and understand what was just created"><meta data-rh="true" property="og:description" content="This is part one of a three-part article. This article provides the necessary background and rationale for the series. The next article will be a detailed explanation of the actual steps necessary to implement the solution. In the final article, we will explore what we have just created and understand what was just created"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-04-23T04:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/dovholuknf"><meta data-rh="true" property="article:tag" content="Kubernetes,Prometheus,Zero Trust"><meta data-rh="true" data-rh="true" name="nf-layout-version" content="0.0.168"><meta data-rh="true" name="twitter:card" content="summary_large_image"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="http://localhost:3000/docs/openziti/blog/prometheus-scrape-anything-from-anywhere"><link data-rh="true" rel="alternate" href="http://localhost:3000/docs/openziti/blog/prometheus-scrape-anything-from-anywhere" hreflang="en"><link data-rh="true" rel="alternate" href="http://localhost:3000/docs/openziti/blog/prometheus-scrape-anything-from-anywhere" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EXWPKK5PV4-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"http://localhost:3000/docs/openziti/blog/prometheus-scrape-anything-from-anywhere","mainEntityOfPage":"http://localhost:3000/docs/openziti/blog/prometheus-scrape-anything-from-anywhere","url":"http://localhost:3000/docs/openziti/blog/prometheus-scrape-anything-from-anywhere","headline":"Prometheus - Scrape Anything from Anywhere","name":"Prometheus - Scrape Anything from Anywhere","description":"This is part one of a three-part article. This article provides the necessary background and rationale for the series. The next article will be a detailed explanation of the actual steps necessary to implement the solution. In the final article, we will explore what we have just created and understand what was just created","datePublished":"2022-04-23T04:00:00.000Z","author":{"@type":"Person","name":"Clint Dovholuk","description":"Author","url":"https://github.com/dovholuknf","image":"https://avatars.githubusercontent.com/dovholuknf"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"http://localhost:3000/docs/openziti/blog","name":"Blog"}}</script><script>!function(t,h,e,j,s,n){t.hj=t.hj||function(){(t.hj.q=t.hj.q||[]).push(arguments)},t._hjSettings={hjid:3576473,hjsv:6},s=h.getElementsByTagName("head")[0],(n=h.createElement("script")).async=1,n.src="https://static.hotjar.com/c/hotjar-"+t._hjSettings.hjid+".js?sv="+t._hjSettings.hjsv,s.appendChild(n)}(window,document)</script>
<link rel="alternate" type="application/rss+xml" href="/docs/openziti/blog/rss.xml" title="OpenZiti RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/openziti/blog/atom.xml" title="OpenZiti Atom Feed">

<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-5SF399H3",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>





<link rel="search" type="application/opensearchdescription+xml" title="OpenZiti" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.273075c6.css">
<script src="/assets/js/runtime~main.6236f723.js" defer="defer"></script>
<script src="/assets/js/main.d05d9df4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5SF399H3" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>



<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/ziti-logo-dark.svg"><link rel="preload" as="image" href="/img/ziti-logo-light.svg"><link rel="preload" as="image" href="https://avatars.githubusercontent.com/dovholuknf"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/"><div class="navbar__logo"><img src="/img/ziti-logo-dark.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/ziti-logo-light.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item"><a class="navbar__item navbar__link header-netfoundry-link" href="https://netfoundry.io/products/netfoundry-cloud-30-day-free-trial/" target="_blank">NetFoundry</a></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/openziti/learn/introduction/">Documentation</a><a class="navbar__item navbar__link" href="/docs/openziti/downloads">Downloads</a><div class="navbar__item"><a class="navbar__item navbar__link header-netfoundry-link" href="https://blog.openziti.io/" target="_blank">Blog</a></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Links</a><ul class="dropdown__menu"><li class=""><div class="text-divider"><p>Socials</p></div></li><li class=""><a href="https://www.youtube.com/OpenZiti" target="_blank" title="OpenZiti on YouTube"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/yt.svg" alt="YouTube logo">YouTube</span></a></li><li class=""><a href="https://x.com/OpenZiti" target="_blank" title="OpenZiti on X(formerly Twitter)"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/twit.svg" alt="X/Twitter logo">X (Twitter)</span></a></li><li class=""><a href="https://www.reddit.com/r/openziti" target="_blank" title="OpenZiti Subreddit"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/reddit-logo.png" alt="Reddit logo">Reddit</span></a></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/ziggy.png" alt="X/Twitter Ziggy logo"><a href="https://x.com/OpenZiggy" target="_blank" title="OpenZiggy on X(formerly Twitter)">Ziggy</a></span></li><li class=""><div class="text-divider"><p>Other</p></div></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/blog-icon.png" alt="OpenZiti blog logo"><a href="https://blog.openziti.io/" target="_blank" title="Blog">Blog</a></span></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/docs/openziti/img/oz-test-kitchen.png" alt="OpenZiti Test Kitchen logo"><a href="https://github.com/openziti-test-kitchen" target="_blank" title="Git project for the test kitchen">Test Kitchen</a></span></li></ul></div><a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discourse-link" title="Discourse"></a><a href="https://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="styles-module_starUsRoot__hMNZp"><span style="color:whitesmoke">Star Us on GitHub<!-- --> </span><span style="height:20px"><span><a href="https://github.com/openziti/ziti" data-icon="octicon-star" data-show-count="true" aria-label="Star buttons/github-buttons on GitHub">Star</a></span></span></div><div class="main-wrapper NetFoundryLayout-module_ozLayoutMainWrapper__a2vwh"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/introducing-zrok-10">Introducing zrok 1.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-unleashed-top-10-uses-explored">zrok Unleashed: Top 10 Uses Explored</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-ziti-identities-with-hsmtpm">Securing Ziti Identities with HSM/TPM</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-custom-domains">zrok Custom Domains</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/golang-aha-moments-oop">Golang Aha! Moments: OOP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-safest-way-to-make-portainer-internet-accessible">The safest way to make Portainer Internet accessible</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/multifactor-zero-trust-ssh">Multifactor Zero Trust ssh</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zero-trust-sshclient">Zero Trust *ssh.Client</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/effortless-docker-management-with-private-web-access">Effortless Docker Management</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-is-growing-up">zrok is Growing Up</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-vpn-linux-service">Easy Steps to Install a Private VPN on Linux with zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/jitsi-meet-zrok">Jitsi, meet zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/extend-access-to-a-private-s3-bucket-using-python">Extend Access to a Private S3 Bucket Using Python</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/why-we-verify-github-commits">Why We Verify GitHub Commits</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/limitless-zrok-with-docker">Limitless zrok with Docker</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/how-to-prevent-path-traversal-attacks-with-openziti-browzer">How to Prevent Path Traversal Attacks with OpenZiti BrowZer</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-vpn">zrok VPN</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/deploy-openziti-in-kubernetes-with-ease-using-k3d">Deploy OpenZiti in Kubernetes with Ease Using k3d</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/signing-executables-from-github-actions">Signing Executables From GitHub Actions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-nodejs-zrok-sdk">The NodeJS zrok SDK</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/no-listening-ports">No Listening Ports?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/announcing-openziti-v1">Announcing OpenZiti v1.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/pixy-dust-for-web-applications-pkce">Pixy Dust For Web Applications</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/secure-remote-development-with-zrok-and-jetbrains">Secure Remote Development with zrok and JetBrains</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-permission-modes">zrok Permission Modes</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-zrok-socks-backend">The zrok SOCKS Backend</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-python-zrok-sdk">The Python zrok SDK</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-dedicated-palworld-server-with-zrok">Securing a Dedicated  Palworld Server For My Family with zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/fun-with-adaptive-rate-limiting">Fun with Adaptive Rate Limiting</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-zrok-drives-cli-preview">The zrok Drives CLI Preview</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/minecraft-over-zrok">Minecraft Over zrok</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/go-is-amazing-for-zero-trust">Go is Amazing for Zero Trust</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-frontdoor">zrok frontdoor</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/business-rule-driven-just-in-time-network-access">Business Rule Driven Just-in-Time Network Access</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-drives-an-early-preview">zrok Drives (an Early Preview)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/put-some-ziti-in-your-caddy">Put some Ziti in your Caddy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-zrok-oauth-public-frontend">The zrok OAuth Public Frontend</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-azure-openai-applications-with-openziti">Securing Azure OpenAI Applications with OpenZiti</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openziti-zero-trust-iot-wi-fi-gateway">OpenZiti Zero Trust IoT Wi-Fi Gateway</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-with-the-power-of-caddy">zrok with the Power of Caddy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-zrok-sdk">The zrok SDK</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/got-5-minutes-secure-your-python-website-with-zero-trust">Got 5 Minutes? Secure Your Python Website with Zero Trust.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/announcing-the-zrok-public-beta">Announcing the zrok Public Beta!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zrok-v040-released">zrok v0.4.0 Released!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/commercial-open-source-and-ethical-and-practical-community-engagement">Commercial Open Source and Ethical (and practical) Community Engagement</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/my-pi-day-journey-with-go-64-bit-alignment">My Pi Day Journey with Go 64-bit alignment</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/private-dns-on-windows">Private DNS on Windows</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/websockets-over-zrok">Websockets over zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openapi-python-clients">OpenAPI Python Clients</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/postman-mgmt">Postman and the Management API</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/the-road-ahead-for-zrok">The Road Ahead for zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/auto-complete">Ziti Shell Auto-Complete</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/introducing-zrok">Introducing zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/connecting-to-local-development-environment-from-cloud-hosts-with-zrok">Connecting to Local Development Environment from Cloud Hosts with zrok</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/lessons-learned-writing-a-zero-trust-nginx-module">Lessons Learned Writing a Zero Trust NGINX Module</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zero-trust-monitoring-with-openziti">Zero Trust Monitoring with OpenZiti</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2022</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/its-a-zitiful-life">It&#x27;s A Zitiful Life</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/nginx-zerotrust-api-security">NGINX &amp; ZeroTrust API Security</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/using-ebpf-tc-to-securely-mangle-packets-in-the-kernel-and-pass-them-to-my-secure-networking-application">Using eBPF-TC to securely mangle packets in the kernel, and pass them to my secure networking application</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/browzer-gateway-fqdn-certs">OpenZiti BrowZer Gateway</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openziti-authentication-api-integrations">OpenZiti Authentication API Integrations</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/high-level-publicprivate-cryptography">High-Level Public/Private Cryptography</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/set-up-a-secure-multiplayer-minecraft-server">Set Up a Secure Multiplayer Minecraft Server</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/setting-up-oracle-cloud-to-host-openziti">Setting Up Oracle Cloud To Host OpenZiti</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/integrating-ziti-is-easy">Integrating Ziti is Easy! How we got our app tested with go-httpbin</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/golang-aha-moments-generics">Golang Aha! Moments: Generics</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-nodejs-applications">Securing NodeJS Applications — An Introduction to the OpenZiti SDK for NodeJS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openziti-is-participating-in-hacktoberfest-prost">OpenZiti is Participating in Hacktoberfest, Prost!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/openziti-python-sdk-introduction">OpenZiti Python SDK: Introduction</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/free-secure-access-to-nas-from-anywhere">Free Secure Access to NAS From Anywhere</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/introducing-openziti-browzer">Introducing OpenZiti BrowZer</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/golang-aha-moments-channels">Golang Aha! Moments: Channels</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zero-trust-overlay-network-to-access-homeassistant">I Created a Zero Trust Overlay Network to Access HomeAssistant</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/my-intern-assignment-call-a-dark-webhook-from-aws-lambda">My Intern Assignment - Call a Dark Webhook from AWS Lambda</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/extrovert-wednesday">Extrovert Wednesday</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/securing-web-apis-with-openziti">Securing Web APIs With OpenZiti — Zero Trust For Web APIs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/tunneling-voip-over-openziti">Tunneling VoIP over OpenZiti</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-5-bootstrapping-trust">Bootstrapping Trust Part 5</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-4-certificate-authorities-chains-of-trust">Bootstrapping Trust Part 4</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-3-certificates">Bootstrapping Trust Part 3 - Certificates</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-2-a-primer-on-public-key-cryptography">Bootstrapping Trust Part 2 - PKI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/bootstrapping-trust-part-1-encryption-everywhere">Bootstrapping Trust Part 1 - Encryption Everywhere</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/configuring-openziti-to-enable-prometheus">Configuring OpenZiti to Enable Prometheus</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/docs/openziti/blog/prometheus-scrape-anything-from-anywhere">Prometheus - Scrape Anything from Anywhere</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/scraping-anything-anywhere-in-action">Scraping Anything, Anywhere in Action</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2021</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/kubernetes">Tunneling Ingress to Kubernetes Workloads</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zitifying-scp">Zitifying SCP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zitifying-ssh">Zitifying SSH</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/zitification">Zitification</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2020</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/openziti/blog/mobile-point-of-sale-mpos-app-ziti-android-java-sdk-integration">Mobile Point of Sale (mPOS) app – embed zero trust networking</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Prometheus - Scrape Anything from Anywhere</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-04-23T04:00:00.000Z">April 23, 2022</time> · <!-- -->13 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/dovholuknf" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/dovholuknf" alt="Clint Dovholuk"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/dovholuknf" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Clint Dovholuk</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p><em>This is part one of a three-part article. This article provides the necessary background and rationale for the series.</em> <a href="/docs/openziti/blog/configuring-openziti-to-enable-prometheus"><em>The next article</em></a> <em>will be a detailed explanation of the actual steps necessary to implement the solution. In</em> <a href="/docs/openziti/blog/scraping-anything-anywhere-in-action"><em>the final article</em></a><em>, we will explore what we have just created and understand what was just created</em></p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-problem-with-pulling">The Problem With Pulling<a href="#the-problem-with-pulling" class="hash-link" aria-label="Direct link to The Problem With Pulling" title="Direct link to The Problem With Pulling">​</a></h2>
<p>Prometheus is a server which wants to reach out and pull data from &quot;scrape targets&quot;. It will generally do this using http requests. One problem with this design is that these targets are often inaccessible, hidden from Prometheus behind a firewall.</p>
<p>If not hidden, it means some port was exposed on some network, thereby giving Prometheus the ability to pull the data it needs. Exposing that port on a &quot;trusted&quot; network is a possible attack vector for bad actors. Exposing that port on the open internet (as is often the case) is an open invitation for attack. It&#x27;s much better to keep these servers totally dark to all networks.</p>
<p>OpenZiti solves this problem of reach elegantly and natively while also keeping your service dark to all networks. This gives an OpenZiti-enabled Prometheus the ability to literally scrape any target, anywhere. As long as the target is participates on an OpenZiti overlay network, and as long as the proper polices are in place allowing the traffic to flow, Prometheus will be able to reach out and pull the data it needs from anything, anywhere.</p>
<p>It doesn&#x27;t matter if the target is in some private cloud data center, some private data center protected by a corporate firewall, or heck even running inside my local docker environment! As long as the target participates on that OpenZiti Prometheus can scrape it! That sort of reach is impossible with classic networks.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prometheus">Prometheus<a href="#prometheus" class="hash-link" aria-label="Direct link to Prometheus" title="Direct link to Prometheus">​</a></h2>
<p><a href="https://prometheus.io/" target="_blank" rel="noopener noreferrer">Prometheus</a> is an incredibly popular <a href="https://www.cncf.io/projects/prometheus/" target="_blank" rel="noopener noreferrer">CNCF</a> project, which has graduated the gauntlet of progressions to emerge as a &quot;graduated&quot; CNCF project. If you&#x27;re familiar with Prometheus, there are probably a couple of reasons people mainly choose to deploy it: metrics collection, visualization and alerting.</p>
<p>Prometheus is also tremendously flexible. It has numerous available plugins and supports integrating with a wide number of systems. According to <a href="https://www.cncf.io/blog/2022/03/08/cloud-native-observability-microsurvey-prometheus-leads-the-way-but-hurdles-remain-to-understanding-the-health-of-systems/" target="_blank" rel="noopener noreferrer">this CNCF survey</a>, Prometheus leads the pack when it comes to the project people go to for observability. Its popularity is probably because Prometheus is a CNCF project and is often considered the &quot;default&quot; solution to deploy on another wildly popular CNCF project called <a href="https://kubernetes.io" target="_blank" rel="noopener noreferrer">Kubernetes</a>. One interesting aspect of Prometheus is that it generally favors a poll-based approach to metrics collection instead of a push-based model.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="poll-based">Poll-based?<a href="#poll-based" class="hash-link" aria-label="Direct link to Poll-based?" title="Direct link to Poll-based?">​</a></h3>
<p>I don&#x27;t know about you, but historically, when I&#x27;ve thought about a metrics collection agent, I tend to think of an agent that reads a log file or some library that pushes rows into a giant data lake in the cloud. I don&#x27;t generally think about a solution that implements poll-based metrics. This is often because the target of a poll-based collecting agent will probably be behind a firewall.</p>
<p><img decoding="async" loading="lazy" src="https://github.com/dovholuknf/ziti-doc/raw/main/docusaurus/blog/zitification/prometheus/fw.png" alt="FW" class="img_ev3q"></p>
<p>As you would expect, firewalls make it exceptionally difficult to implement a poll-based solution as firewalls have been known to make a habit of preventing external actors from accessing random http servers behind it! After all, that is their primary function!</p>
<p>The Prometheus project makes <a href="https://prometheus.io/docs/practices/pushing/" target="_blank" rel="noopener noreferrer">strong arguments</a> explaining the benefits of a poll-based solution. They also realize that firewalls are important in creating a safe network and understand the challenges firewalls create for such a solution. To deal with these situations, the project also provides a <a href="https://prometheus.io/docs/instrumenting/pushing/" target="_blank" rel="noopener noreferrer">PushGateway</a>. This allows solutions to push their data to a location outbound of the firewall. Pushing data out of the firewall allows metrics and alerting to function without the worry (and maintenance heartache) of an open, inbound firewall hole.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="acceptable-risk">Acceptable Risk<a href="#acceptable-risk" class="hash-link" aria-label="Direct link to Acceptable Risk" title="Direct link to Acceptable Risk">​</a></h3>
<p>Prometheus is often deployed into Kubernetes clusters, but it can be deployed anywhere. Taking the operational differences out of the equation, there is little difference between deploying Prometheus in a Kubernetes cluster and deploying it in one&#x27;s data center. Once deployed, the needs will be the same. Prometheus will need to be authorized to reach out and scrape the targets it needs to scrape. All too often, this is done with relatively open network permissions. Even though we all know it&#x27;s not the most secure way of authorizing Prometheus, this is often considered &quot;safe enough&quot; because we deployed Prometheus into a zone considered &quot;safe&quot;. Managing firewall rules to all the computers Prometheus needs access to, feels like an impossible feat. There are just too many.</p>
<p>To add to our acceptable risk, we will need to be able to access the Prometheus server in some way. We&#x27;ll want to get at the UI, see the charts and graphs and data it provides and use the server to its fullest. For that, we&#x27;ll <strong>of course</strong> need a hole in our firewall, or in the case of Kubernetes we will probably deploy some form of <a href="https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/" target="_blank" rel="noopener noreferrer">Kubernetes Ingress Controller</a> to provide users access the service.</p>
<p>What we need are better and richer controls over our network. We need a better way of authorizing Prometheus without the hassle of maintaining firewall rules on individual machines. We also need a way to do this across multiple clouds, multiple Kubernetes clusters and multiple data centers. Let&#x27;s see how OpenZiti can solve this problem while also enhancing our overall security.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="openziti">OpenZiti<a href="#openziti" class="hash-link" aria-label="Direct link to OpenZiti" title="Direct link to OpenZiti">​</a></h2>
<p>The <a href="https://openziti.github.io" target="_blank" rel="noopener noreferrer">OpenZiti</a> project allows us to solve all the problems outlined above. It is a fully-featured, zero trust overlay network and enables <a href="https://en.wikipedia.org/wiki/Zero_trust_security_model" target="_blank" rel="noopener noreferrer">zero trust networking principles</a> to be applied anywhere. This includes bringing those zero trust principles directly into your application through one of the many SDKs provided by the project. Let&#x27;s look at an example and see what a setup might look like before and after applying OpenZiti.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h3>
<p>Let&#x27;s imagine that we have already deployed a solution using two Kubernetes clusters, ClusterA and ClusterB. It doesn&#x27;t matter where the clusters are deployed. We are trying to illustrate a real-world situation where we have two separate Kubernetes clusters that we want to manage. The clusters could be deployed in the same cloud provider, in a private data center, in different cloud providers, it really does not matter. What is important, is that these clusters are available over the network. To enable access to the workloads inside the clusters, some form of Kubernetes ingress controller will be required on both clusters. In our example, we will have a workload deployed which exposes a prometheus scrape target we want Prometheus to monitor.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="figure-1---before-openziti">Figure 1 - Before OpenZiti<a href="#figure-1---before-openziti" class="hash-link" aria-label="Direct link to Figure 1 - Before OpenZiti" title="Direct link to Figure 1 - Before OpenZiti">​</a></h4>
<p><img decoding="async" loading="lazy" src="https://github.com/dovholuknf/ziti-doc/raw/main/docusaurus/blog/zitification/prometheus/kubernetes-prometheus-before.svg" alt="Before OpenZiti" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="taking-a-closer-look">Taking a Closer Look<a href="#taking-a-closer-look" class="hash-link" aria-label="Direct link to Taking a Closer Look" title="Direct link to Taking a Closer Look">​</a></h3>
<p>Looking at the diagram above with a discerning eye towards security, there are some immediate observations one can make.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="listening-ports">Listening Ports<a href="#listening-ports" class="hash-link" aria-label="Direct link to Listening Ports" title="Direct link to Listening Ports">​</a></h4>
<p>One observation we have already accepted from the overview, is that these clusters must be exposed via the internet. At first that doesn&#x27;t seem like a big deal, we expose workloads like this to the internet all the time. This is a perfectly normal action, it&#x27;s likely done every day somewhere in the world. It&#x27;s so common, we almost don&#x27;t even think about it until the time comes when we <strong>need</strong> to think about it. This ends up in an exposed port, listening somewhere in the world. There might be a firewall with complex rules to protect this port, but it&#x27;s just as likely that this isn&#x27;t the case. People might need to access the resources inside these clusters from anywhere.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes-api-exposed">Kubernetes API Exposed<a href="#kubernetes-api-exposed" class="hash-link" aria-label="Direct link to Kubernetes API Exposed" title="Direct link to Kubernetes API Exposed">​</a></h4>
<p>Another observation is that the Kubernetes API is fully exposed to the internet. This API is a very high-value target and should be secured as strongly as possible. That probably means yet another complex firewall rule to maintain.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="trusted-intra-cluster-traffic">&quot;Trusted&quot; Intra-cluster Traffic<a href="#trusted-intra-cluster-traffic" class="hash-link" aria-label="Direct link to &quot;Trusted&quot; Intra-cluster Traffic" title="Direct link to &quot;Trusted&quot; Intra-cluster Traffic">​</a></h4>
<p>The final point to note is that the traffic within the cluster is considered safe. As mentioned above, the Prometheus server needs to be able to scrape the target workloads. That traffic is necessary to be considered safe. Also, notice that the pod for Prometheus contains a container named &quot;configmap-reload&quot; which is used to trigger a webhook on the Prometheus server when the <a href="https://kubernetes.io/docs/concepts/configuration/configmap/" target="_blank" rel="noopener noreferrer">Kubernetes config map</a> changes. This is necessary when changing the Prometheus config, adding new scrape configs etc.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="applying-zero-trust-networking-principles-using-openziti">Applying Zero Trust Networking Principles Using OpenZiti<a href="#applying-zero-trust-networking-principles-using-openziti" class="hash-link" aria-label="Direct link to Applying Zero Trust Networking Principles Using OpenZiti" title="Direct link to Applying Zero Trust Networking Principles Using OpenZiti">​</a></h3>
<p>Now that we understand the basic setup and understand some possible problems, let&#x27;s see if OpenZiti can address one or more of these issues. When applying OpenZiti, the goal will be to strengthen our security posture for each of the above items.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="figure-2---after-openziti">Figure 2 - After OpenZiti<a href="#figure-2---after-openziti" class="hash-link" aria-label="Direct link to Figure 2 - After OpenZiti" title="Direct link to Figure 2 - After OpenZiti">​</a></h4>
<p><img decoding="async" loading="lazy" src="https://github.com/dovholuknf/ziti-doc/raw/main/docusaurus/blog/zitification/prometheus/kubernetes-prometheus-after.svg" alt="after" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="taking-a-closer-look-after-openziti">Taking a Closer Look After OpenZiti<a href="#taking-a-closer-look-after-openziti" class="hash-link" aria-label="Direct link to Taking a Closer Look After OpenZiti" title="Direct link to Taking a Closer Look After OpenZiti">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="no-external-listening-ports">No External Listening Ports<a href="#no-external-listening-ports" class="hash-link" aria-label="Direct link to No External Listening Ports" title="Direct link to No External Listening Ports">​</a></h4>
<p>With a classic deployment as shown in the initial design, we know there will be ports exposed to the open internet. In an ideal scenario, there would be absolutely no ports exposed on the open internet <strong>nor</strong> in the &quot;trusted networking zone&quot;. It&#x27;s immediately obvious after applying a solution using OpenZiti that those listening ports exposed by the Kubernetes ingress controller are no longer deployed and thus are no longer exposed to the internet. That&#x27;s one attack vector eliminated. OpenZiti will initiate outbound mTLS connections among all the constituent pieces of the overlay network. This means connections will begin inside the trusted network zone and only create outbound links. Once established, those connections can be used to safely transfer data between any participating edge node.</p>
<p>This capability really can&#x27;t be emphasized enough. With OpenZiti and with applications that use an OpenZiti SDK, such as the ones shown, there are no open ports to attack. This network is nearly impervious to the classical &quot;land and expand&quot; technique so many bad actors look to exploit.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes-api-no-longer-exposed">Kubernetes API no Longer Exposed<a href="#kubernetes-api-no-longer-exposed" class="hash-link" aria-label="Direct link to Kubernetes API no Longer Exposed" title="Direct link to Kubernetes API no Longer Exposed">​</a></h4>
<p>Another significant benefit provided by OpenZiti is starting to come into focus. By having access to our clusters provided through OpenZiti, we can <strong>stop exposing</strong> the Kubernetes APIs for both clusters to the open internet. Prometheus will still be able to monitor each Kubernetes cluster through the private Kubernetes network. Accessing Prometheus will be provided via OpenZiti, instead of using a Kubernetes ingress controller. Later, we can ues the built-in capability Prometheus already provides to federate information from the clusters to a centralized, <a href="/docs/openziti/blog/zitification">zitified</a> Prometheus server.</p>
<p>Once no longer exposed to the open internet, to maintain our Kubernetes cluster we could then turn to [zitified] (/zitification.md) tools. The OpenZiti project provides zitified versions of <code>kubectl</code> - <a href="https://github.com/openziti-test-kitchen/kubectl" target="_blank" rel="noopener noreferrer">kubeztl</a> and <code>helm</code> - <a href="https://github.com/openziti-test-kitchen/helm" target="_blank" rel="noopener noreferrer">helmz</a>. Each of these tools have an OpenZiti SDK embedded inside them. This allows both tools to connect to the private Kubernetes API over the OpenZiti overlay network. To use them, you will need a strong, OpenZiti identity as well as be authorized to access the service. Also note that we&#x27;re also not replacing the existing security constraints the Kubernetes ecosystem already provides. You can (and should) still secure your Kubernetes clusters using namespaces, roles, etc.</p>
<p>We&#x27;ll explore <code>kubeztl</code> and <code>helmz</code> in future articles.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="trusted-intra-cluster-traffic-1">&quot;Trusted&quot; Intra-cluster Traffic<a href="#trusted-intra-cluster-traffic-1" class="hash-link" aria-label="Direct link to &quot;Trusted&quot; Intra-cluster Traffic" title="Direct link to &quot;Trusted&quot; Intra-cluster Traffic">​</a></h4>
<p>Lastly, let&#x27;s turn our eyes toward the traffic running inside the Kubernetes cluster. Pay attention to the lines in orange and the lines in dark blue. Orange lines represent &quot;private&quot; traffic, traffic that needs to traverse the private network space.</p>
<p>At this point we cannot send traffic to the Kubernetes API via the overlay network. The Kubernetes API doesn&#x27;t have an OpenZiti SDK embedded within it. That means when we deploy Prometheus into ClusterA and ClusterB to monitor the cluster, Prometheus will be forced to connect to a port exposed on the cluster&#x27;s underlay network. Still, while not ideal, we have greatly improved the overall security posture of the cluster. We&#x27;re no longer able to access the Kubernetes API without first gaining access to the zero trust overlay network. Accessing the Kubernetes API will also require the identity to be properly authorized to access the service attaching to the Kubernetes API.</p>
<p>Let&#x27;s now focus on ClusterA. It contains a Prometheus server that decided against listening on the OpenZiti overlay. This means it will need to expose ports to the Kubernetes underlay network. The container inside the Prometheus pod will watch for configmap changes. To trigger the webhook, it will be forced to send unauthenticated webhook traffic to the Prometheus server on the underlay network in order to trigger the config to reload.</p>
<p>Still, accessing this cluster and the listening Prometheus server will require being on the OpenZiti overlay. Also, this Prometheus server does have an OpenZiti SDK built into it. We also deployed the &quot;reflectz&quot; workload with an OpenZiti SDK built into it as well. That means the Prometheus server must scrape the &quot;reflectz&quot; workload exclusively over the OpenZiti overlay. <strong>Only</strong> authorized identities can access that scrape data.</p>
<p>Contrast ClusterA with ClusterB. ClusterB deployed a Prometheus server with an embedded OpenZiti SDK and chose to provide its services exclusively on the OpenZiti overlay. We&#x27;ve also deployed a zitified &quot;reflectz&quot; workload here. Notice how little traffic traverses the Kubernetes cluster underlay network. The only traffic which needs to traverse the cluster&#x27;s underlay network in ClusterB is the traffic which monitors the Kubernetes API. All other traffic in the cluster is now secured by the OpenZiti overlay network. You will need a strong identity, and you will need to be authorized on the overlay before even being allowed to connect to the target service.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="openziti-enabled-prometheus">OpenZiti-Enabled Prometheus<a href="#openziti-enabled-prometheus" class="hash-link" aria-label="Direct link to OpenZiti-Enabled Prometheus" title="Direct link to OpenZiti-Enabled Prometheus">​</a></h2>
<p>We are now coming to the final piece of the puzzle. We have protected both Kubernetes clusters using OpenZiti. Now we want to bring all this data back to a centralized Prometheus server to make it easier on our user base. To do this, we&#x27;ll again deploy an OpenZiti-enabled Prometheus server. This time we don&#x27;t care where it is deployed except that we know we are not deploying it into either of the Kubernetes clusters we are already using. Since the Prometheus servers are all now accessible via the overlay network, we can literally deploy our server anywhere in the world. It could be on development server, it could be deployed in some other cloud, it could be deployed in our private data center. Because it&#x27;s part of the overlay network, it no longer matters where we deploy the server. Wherever deployed, all it will need is outbound internet access, a strong identity, and access and authorization to services defined in the OpenZiti overlay network. Once that&#x27;s done, OpenZiti will take care of the rest.</p>
<p>If you have made it this far, you might want to try all this for yourself. The <a href="/docs/openziti/blog/configuring-openziti-to-enable-prometheus">next article</a> will go into the details necessary to implement this solution. When complete you&#x27;ll be able to deploy a zitified version of Prometheus and give Prometheus the power to scrape anything from anywhere using OpenZiti.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Kubernetes content" class="tag_zVej tagRegular_sFm0" href="/docs/openziti/blog/tags/kubernetes">Kubernetes</a></li><li class="tag_QGVx"><a rel="tag" title="Prometheus monitoring" class="tag_zVej tagRegular_sFm0" href="/docs/openziti/blog/tags/prometheus">Prometheus</a></li><li class="tag_QGVx"><a rel="tag" title="Zero Trust Networking" class="tag_zVej tagRegular_sFm0" href="/docs/openziti/blog/tags/zerotrust">Zero Trust</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/openziti/blog/configuring-openziti-to-enable-prometheus"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Configuring OpenZiti to Enable Prometheus</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/openziti/blog/scraping-anything-anywhere-in-action"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Scraping Anything, Anywhere in Action</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-problem-with-pulling" class="table-of-contents__link toc-highlight">The Problem With Pulling</a></li><li><a href="#prometheus" class="table-of-contents__link toc-highlight">Prometheus</a><ul><li><a href="#poll-based" class="table-of-contents__link toc-highlight">Poll-based?</a></li><li><a href="#acceptable-risk" class="table-of-contents__link toc-highlight">Acceptable Risk</a></li></ul></li><li><a href="#openziti" class="table-of-contents__link toc-highlight">OpenZiti</a><ul><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#taking-a-closer-look" class="table-of-contents__link toc-highlight">Taking a Closer Look</a></li><li><a href="#applying-zero-trust-networking-principles-using-openziti" class="table-of-contents__link toc-highlight">Applying Zero Trust Networking Principles Using OpenZiti</a></li><li><a href="#taking-a-closer-look-after-openziti" class="table-of-contents__link toc-highlight">Taking a Closer Look After OpenZiti</a></li></ul></li><li><a href="#openziti-enabled-prometheus" class="table-of-contents__link toc-highlight">OpenZiti-Enabled Prometheus</a></li></ul></div></div></div></div><footer class="styles-module_ozFooter__vHkQA"><section class="styles-module_footer__Qk0iB styles-module_ozHorizontalSectionRoot__QwWz0 styles-module_ozhsContent__haNeV"><div class="styles-module_footerContainer__azQkg"><div class="styles-module_footerGrid__fsf9C"><div class="styles-module_footerColumn__tK2bv"><h3>NetFoundry</h3><p>An open source project enabling developers to embed zero trust networking directly into applications.</p><div class="styles-module_footerSocialLinks__b1FcV"><a href="https://github.com/openziti/ziti" target="_blank" class="styles-module_footerSocialLink__iAElV" rel="noreferrer"><svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"></path></svg></a><a href="https://www.linkedin.com/in/netfoundry/" target="_blank" class="styles-module_footerSocialLink__iAElV" rel="noreferrer"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.996 16V10.1C15.996 7.5 15.375 5.49999 12.025 5.49999C10.4 5.49999 9.325 6.39999 8.875 7.29999H8.825V5.79999H5.65V16H8.95V10.7C8.95 9.30001 9.2 7.9 10.925 7.9C12.65 7.9 12.675 9.59999 12.675 10.8V16H15.996Z"></path><path d="M0.25 5.79999H3.575V16H0.25V5.79999Z"></path><path d="M1.9 0C0.85 0 0 0.85 0 1.9C0 2.95 0.85 3.8 1.9 3.8C2.95 3.8 3.8 2.95 3.8 1.9C3.8 0.85 2.95 0 1.9 0Z"></path></svg></a><a href="https://youtube.com/openziti/" target="_blank" class="styles-module_footerSocialLink__iAElV" rel="noreferrer"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.969 4.69c-.183-1.358-1.062-2.275-2.361-2.46C12.371 2 8 2 8 2S3.629 2 2.362 2.229c-1.3.186-2.179 1.103-2.361 2.461C0 6.03 0 10 0 10s0 3.97.2 5.31c.183 1.358 1.062 2.275 2.361 2.46C3.63 18 8 18 8 18s4.371 0 5.638-.23c1.3-.185 2.178-1.102 2.361-2.46.2-1.34.2-5.31.2-5.31s0-3.97-.23-5.31zm-8.36, 8.57V6.73l3.76 2.27-3.76 2.26z"></path></svg></a><a href="https://twitter.com/openziti/" target="_blank" class="styles-module_footerSocialLink__iAElV" rel="noreferrer"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.996 3.038c-.59.262-1.219.44-1.885.52.677-.406 1.194-1.05 1.438-1.815-.634.375-1.337.648-2.085.795-.598-.638-1.45-1.038-2.396-1.038-1.813 0-3.283 1.469-3.283 3.282 0 .257.03.507.085.748-2.728-.137-5.147-1.445-6.766-3.43-.282.485-.444 1.05-.444 1.651 0 1.14.58 2.143 1.46 2.732-.538-.017-1.044-.164-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.219-.276.075-.567.116-.866.116-.211 0-.416-.021-.617-.06.418 1.304 1.63 2.254 3.066 2.28-1.124.883-2.539 1.406-4.077 1.406-.265 0-.526-.015-.785-.046 1.453.933 3.178 1.475 5.032 1.475 6.038 0 9.34-5.002 9.34-9.34 0-.142-.004-.284-.01-.425.641-.463 1.198-1.039 1.638-1.696"></path></svg></a></div></div><div class="styles-module_footerColumn__tK2bv"><h3>Community</h3><ul class="styles-module_footerLinks__eOmJ9"><li><a href="https://github.com/openziti/ziti">GitHub</a></li><li><a href="https://openziti.discourse.group/">Discourse Forum</a></li><li><a href="/docs/openziti/policies/CONTRIBUTING">Contributing</a></li></ul></div><div class="styles-module_footerColumn__tK2bv"><h3>Resources</h3><ul class="styles-module_footerLinks__eOmJ9"><li><a href="https://blog.openziti.io">OpenZiti Tech Blog</a></li><li><a href="https://netfoundry.io/">NetFoundry</a></li></ul></div></div></div><div class="styles-module_footerCopyright__nWyvc"><p>© 2025 NetFoundry Inc. OpenZiti is an open source project sponsored by NetFoundry. All rights reserved.</p></div></section></footer></div></div>
</body>
</html>