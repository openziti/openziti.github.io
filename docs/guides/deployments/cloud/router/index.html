<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/deployments/cloud/router" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Run a Router in a Public Cloud | OpenZiti</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openziti.io/docs/guides/deployments/cloud/router"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="robots" content="index, follow"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Run a Router in a Public Cloud | OpenZiti"><meta data-rh="true" name="description" content="2.0 Configure a Router"><meta data-rh="true" property="og:description" content="2.0 Configure a Router"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://openziti.io/docs/guides/deployments/cloud/router"><link data-rh="true" rel="alternate" href="https://openziti.io/docs/guides/deployments/cloud/router" hreflang="en"><link data-rh="true" rel="alternate" href="https://openziti.io/docs/guides/deployments/cloud/router" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EXWPKK5PV4-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Deployments","item":"https://openziti.io/docs/category/deployments"},{"@type":"ListItem","position":2,"name":"Cloud","item":"https://openziti.io/docs/category/cloud"},{"@type":"ListItem","position":3,"name":"Router","item":"https://openziti.io/docs/guides/deployments/cloud/router"}]}</script><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-5SF399H3",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>





<link rel="search" type="application/opensearchdescription+xml" title="OpenZiti" href="/opensearch.xml">

<script>!function(t,h,e,j,s,n){t.hj=t.hj||function(){(t.hj.q=t.hj.q||[]).push(arguments)},t._hjSettings={hjid:3576473,hjsv:6},s=h.getElementsByTagName("head")[0],(n=h.createElement("script")).async=1,n.src="https://static.hotjar.com/c/hotjar-"+t._hjSettings.hjid+".js?sv="+t._hjSettings.hjsv,s.appendChild(n)}(window,document)</script><link rel="stylesheet" href="/assets/css/styles.f2cef296.css">
<script src="/assets/js/runtime~main.86b52ee0.js" defer="defer"></script>
<script src="/assets/js/main.b172e386.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5SF399H3" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>




<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/ziti-logo-dark.svg"><link rel="preload" as="image" href="/img/ziti-logo-light.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="starUsRoot_Cir2"><span style="color:whitesmoke">Star us on GitHubÂ </span><span style="height:20px"><span><a href="https://github.com/openziti/ziti" data-icon="octicon-star" data-show-count="true" aria-label="Star buttons/github-buttons on GitHub">Star</a></span></span></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/"><div class="navbar__logo"><img src="/img/ziti-logo-dark.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/ziti-logo-light.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item"><a class="navbar__item navbar__link header-netfoundry-link" href="https://netfoundry.io/products/netfoundry-cloud-30-day-free-trial/" target="_blank">NetFoundry</a></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/learn/introduction/">Documentation</a><a class="navbar__item navbar__link" href="/docs/downloads">Downloads</a><div class="navbar__item"><a class="navbar__item navbar__link header-netfoundry-link" href="https://blog.openziti.io/" target="_blank">Blog</a></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Links</a><ul class="dropdown__menu"><li class=""><div class="text-divider"><p>Socials</p></div></li><li class=""><a href="https://www.youtube.com/OpenZiti" target="_blank" title="OpenZiti on YouTube"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/yt.svg" alt="YouTube logo">YouTube</span></a></li><li class=""><a href="https://x.com/OpenZiti" target="_blank" title="OpenZiti on X(formerly Twitter)"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/twit.svg" alt="X/Twitter logo">X (Twitter)</span></a></li><li class=""><a href="https://www.reddit.com/r/openziti" target="_blank" title="OpenZiti Subreddit"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/reddit-logo.png" alt="Reddit logo">Reddit</span></a></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/ziggy.png" alt="X/Twitter Ziggy logo"><a href="https://x.com/OpenZiggy" target="_blank" title="OpenZiggy on X(formerly Twitter)">Ziggy</a></span></li><li class=""><div class="text-divider"><p>Other</p></div></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/blog-icon.png" alt="OpenZiti blog logo"><a href="https://blog.openziti.io/" target="_blank" title="Blog">Blog</a></span></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/oz-test-kitchen.png" alt="OpenZiti Test Kitchen logo"><a href="https://github.com/openziti-test-kitchen" target="_blank" title="Git project for the test kitchen">Test Kitchen</a></span></li></ul></div><a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discourse-link" title="Discourse"></a><a href="https://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper ozLayoutMainWrapper_maOX"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 sidebar-title"><a class="menu__link" href="/docs/learn/introduction">LEARN</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/learn/introduction/">What is OpenZiti?</a><button aria-label="Expand sidebar category &#x27;What is OpenZiti?&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/learn/quickstarts/">Quickstarts</a><button aria-label="Expand sidebar category &#x27;Quickstarts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/core-concepts">Core Concepts</a><button aria-label="Expand sidebar category &#x27;Core Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learn/identity-providers/">Identity Providers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 sidebar-title"><a class="menu__link" href="/docs/reference">REFERENCE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference/configuration/conventions">Configuration</a><button aria-label="Expand sidebar category &#x27;Configuration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/reference/ha/overview">Controller Clustering</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference/tunnelers/">Tunnelers</a><button aria-label="Expand sidebar category &#x27;Tunnelers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/command-line/login">CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/logging">Logging</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference/config-types/">Config Types</a><button aria-label="Expand sidebar category &#x27;Config Types&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/events">Events</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference/developer/">Developer</a><button aria-label="Expand sidebar category &#x27;Developer&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 sidebar-title"><a class="menu__link" href="/docs/guides">GUIDES</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guides/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/deployments">Deployments</a><button aria-label="Collapse sidebar category &#x27;Deployments&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/linux">Linux</a><button aria-label="Expand sidebar category &#x27;Linux&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/docker">Docker</a><button aria-label="Expand sidebar category &#x27;Docker&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/kubernetes">Kubernetes</a><button aria-label="Expand sidebar category &#x27;Kubernetes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/cloud">Cloud</a><button aria-label="Collapse sidebar category &#x27;Cloud&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/deployments/cloud/controller">Controller</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/guides/deployments/cloud/router">Router</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/deployments/console">Alternative Server Certificates</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/guides/external-auth/">Configuring OIDC</a><button aria-label="Expand sidebar category &#x27;Configuring OIDC&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/guides/hsm/">Hardware Keys</a><button aria-label="Expand sidebar category &#x27;Hardware Keys&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/topologies">Topologies</a><button aria-label="Expand sidebar category &#x27;Topologies&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/troubleshooting">Troubleshooting</a><button aria-label="Expand sidebar category &#x27;Troubleshooting&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/deployments"><span>Deployments</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/cloud"><span>Cloud</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Router</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Run a Router in a Public Cloud</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="20-configure-a-router">2.0 Configure a Router<a href="#20-configure-a-router" class="hash-link" aria-label="Direct link to 2.0 Configure a Router" title="Direct link to 2.0 Configure a Router">â</a></h2>
<p>In this section, we are describing how to setup the edge router (pub-er) for our <a href="/docs/guides/topologies/services#311-network-diagram-1">test network</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="21-create-the-edge-router-vm">2.1 Create the Edge Router VM<a href="#21-create-the-edge-router-vm" class="hash-link" aria-label="Direct link to 2.1 Create the Edge Router VM" title="Direct link to 2.1 Create the Edge Router VM">â</a></h2>
<p>Please follow <strong>Create a VM section</strong> of the controller cloud guide to setup a VM to be used as router.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="22-login-and-update-the-repo-and-apps-on-vm">2.2 Login and Update the repo and apps on VM<a href="#22-login-and-update-the-repo-and-apps-on-vm" class="hash-link" aria-label="Direct link to 2.2 Login and Update the repo and apps on VM" title="Direct link to 2.2 Login and Update the repo and apps on VM">â</a></h2>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Azure</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">AWS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Google</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Digital Ocean</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Oracle</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">IBM</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><ul>
<li>Once the VM is created, we can get the IP address of the VM from the Virtual machine screen.</li>
<li>Login to the VM by using defined user &quot;username&quot; (default username is azureuser) and the private sshkey:</li>
</ul><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh -i &lt;private_key&gt; &lt;username&gt;@&lt;ip&gt;</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>Once the VM is created, we can get the IP address of the VM from the Instance(s) screen.</li>
</ul><p>Login to the VM by using user name &quot;ubuntu&quot;:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh -i &lt;private_key&gt; ubuntu@&lt;ip&gt;</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>Once the VM is created, we can login through <strong>SSH</strong> button on the VM instances screen. Make sure <strong>ssh is allow</strong> on the firewall before you do this. Alternatively, you can <a href="#29-firewall">configure firewall</a> first.</li>
</ul><p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/GCP-login1-4a85ef6f0b3a16ea562e33e71692d37f.jpg" width="951" height="227" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>Once the VM is created, get the IP address of the droplet from the Resources screen. Login to the VM by using user &quot;root&quot; and IP address:</li>
</ul><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh root@&lt;ip&gt;</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>Once the VM is created, we can get the IP address of the VM from the instance details screen.</li>
<li>Login to the VM by using user name &quot;ubuntu&quot; and the IP address:</li>
</ul><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh -i &lt;private_key&gt; ubuntu@&lt;ip&gt;</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>Once the VM is created, we can get the IP address of the VM from the Devices screen.</li>
<li>Login to the VM by using user name &quot;ubuntu&quot; and the IP address:</li>
</ul><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh -i &lt;private_key&gt; ubuntu@&lt;ip&gt;</span><br></span></code></pre></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="221-apt-update">2.2.1 apt update<a href="#221-apt-update" class="hash-link" aria-label="Direct link to 2.2.1 apt update" title="Direct link to 2.2.1 apt update">â</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt upgrade</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="222-download-ziti_router_auto_enroll-binary">2.2.2 Download ziti_router_auto_enroll binary<a href="#222-download-ziti_router_auto_enroll-binary" class="hash-link" aria-label="Direct link to 2.2.2 Download ziti_router_auto_enroll binary" title="Direct link to 2.2.2 Download ziti_router_auto_enroll binary">â</a></h3>
<p><strong>ziti_router_auto_enroll</strong> is an easy way to setup your router automatically.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://github.com/netfoundry/ziti_router_auto_enroll/releases/latest/download/ziti_router_auto_enroll.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar xf ziti_router_auto_enroll.tar.gz</span><br></span></code></pre></div></div>
<p>You should have a file <strong>ziti_router_auto_enroll</strong> under the directory.</p>
<p>For detail info on ziti_router_auto_enroll, please checkout the <a href="https://github.com/netfoundry/ziti_router_auto_enroll" target="_blank" rel="noopener noreferrer">ziti_router_auto_enroll github page</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="23-create-and-set-up-router-directly-on-router-vm">2.3 Create and Set Up Router Directly on Router VM<a href="#23-create-and-set-up-router-directly-on-router-vm" class="hash-link" aria-label="Direct link to 2.3 Create and Set Up Router Directly on Router VM" title="Direct link to 2.3 Create and Set Up Router Directly on Router VM">â</a></h2>
<p>You can setup the router directly on the router VM with one command if you did not block your controller&#x27;s edge-management port. At this time, the quickstart for setting up controller does not separate edge-management port from edge-client port, so the edge-management port has to be open. You may continue this section if you know your controller&#x27;s management password, Fabric Port (default 8440) and Management Port (default 8441).</p>
<p>You can also choose to create router on the controller and then register with the jwt file (created when creating the router) on the router. The procedure for this is detailed in <a href="#24-creating-router-on-the-controller-first">&quot;Create Router On the Controller&quot;</a> section.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="231-info-needed-for-creating-router">2.3.1 Info needed for creating Router<a href="#231-info-needed-for-creating-router" class="hash-link" aria-label="Direct link to 2.3.1 Info needed for creating Router" title="Direct link to 2.3.1 Info needed for creating Router">â</a></h3>
<p>In order to create the Router, the VM needs to contact controller. We need the following information before we can continue:</p>
<ul>
<li>Controller IP or Controller NDS</li>
<li>Controller Fabric Port: On the controller, issue this command <strong>echo $ZITI_CTRL_PORT</strong></li>
<li>Controller Management Port: On the controller, issue this command <strong>echo $ZITI_EDGE_CONTROLLER_PORT</strong></li>
<li>Controller Passwd: On the controller, issue this command <strong>echo $ZITI_PWD</strong></li>
<li>Router Name: Name for this router</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="232-info-gathered-for-creating-router">2.3.2 Info gathered for creating Router<a href="#232-info-gathered-for-creating-router" class="hash-link" aria-label="Direct link to 2.3.2 Info gathered for creating Router" title="Direct link to 2.3.2 Info gathered for creating Router">â</a></h3>
<p>Here is information I gathered from previous step:</p>
<ul>
<li>Controller IP: 68.183.52.206</li>
<li>Controller Fabric Port: 8440 <strong>(default value if following controller setup guide)</strong></li>
<li>Controller Management Port: 8441 <strong>(default value if following controller setup guide)</strong></li>
<li>Controller Passwd: Test@123</li>
<li>Router Name: pub-er</li>
</ul>
<p>We are also going to create the router without healthcheck section, so the following option will be used to create the router:</p>
<ul>
<li>--disableHealthChecks</li>
</ul>
<p>If you choose to explore these two functionalities, you can remove the options (from command line) when creating router.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="233-create-the-router-with-link-listener">2.3.3 Create the Router with link listener<a href="#233-create-the-router-with-link-listener" class="hash-link" aria-label="Direct link to 2.3.3 Create the Router with link listener" title="Direct link to 2.3.3 Create the Router with link listener">â</a></h3>
<p>Use this procedure to create a Public Router with link listener (but without tunnel).</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./ziti_router_auto_enroll -f -n --controller 68.183.52.206 --controllerFabricPort 8440 --controllerMgmtPort 8441 --adminUser admin --adminPassword Test@123 --assumePublic --disableHealthChecks --routerName pub-er </span><br></span></code></pre></div></div>
<p><strong>output</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:44-INFO-Writing jwt file: pub-er_enrollment.jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:44-INFO-Version not specified, going to check with controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:45-INFO-Found version 0.27.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:45-INFO-Downloading file: https://github.com/openziti/ziti/releases/download/v0.27.7/ziti-linux-amd64-0.27.7.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Downloading: 100%|ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ| 115M/115M [00:01&lt;00:00, 67.3MiB/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:47-INFO-Successfully downloaded file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:47-INFO-Starting binary install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:50-INFO-Installing service unit file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:50-INFO-Creating config file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:50-INFO-Starting Router Enrollment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:54-INFO-Successfully enrolled Ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:54-INFO-Service ziti-router.service start successful.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created symlink /etc/systemd/system/multi-user.target.wants/ziti-router.service â /etc/systemd/system/ziti-router.service.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:55-INFO-Service ziti-router.service enable successful.</span><br></span></code></pre></div></div>
<p><strong>Alternative way of creating router</strong></p>
<p>Instead of passing parameters through the command line to create routers, the parameters can be specified via environmental variables. Here is example on how to accomplish that.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export CONTROLLER=&quot;68.183.52.206&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export CONTROLLERFABRICPORT=&quot;8440&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export CONTROLLERMGMTPORT=&quot;8441&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ADMINUSER=&quot;admin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ADMINPASSWORD=&quot;Test@123&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo -E ./ziti_router_auto_enroll -f -n --assumePublic --disableHealthChecks --routerName pub-er</span><br></span></code></pre></div></div>
<hr>
<p><strong>NOTE</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">When using the environmental variable for ziti_router_auto_enroll, you must</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use &quot;-E&quot; option to pass the environmental value to sudo.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="234-other-router-creation-options">2.3.4 Other Router creation options<a href="#234-other-router-creation-options" class="hash-link" aria-label="Direct link to 2.3.4 Other Router creation options" title="Direct link to 2.3.4 Other Router creation options">â</a></h3>
<p>If you need to create router with difference options than the one mentioned above, please choose one of the options from this section.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2341-create-the-router-with-link-listener-and-tunneler">2.3.4.1 Create the Router with link listener and tunneler<a href="#2341-create-the-router-with-link-listener-and-tunneler" class="hash-link" aria-label="Direct link to 2.3.4.1 Create the Router with link listener and tunneler" title="Direct link to 2.3.4.1 Create the Router with link listener and tunneler">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./ziti_router_auto_enroll -f -n --controller 68.183.52.206 --controllerFabricPort 8440 --controllerMgmtPort 8441 --adminUser admin --adminPassword Test@123 --assumePublic --disableHealthChecks --autoTunnelListener --routerName pub-er</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2342-create-the-router-with-edge-listener-only-no-link-listener">2.3.4.2 Create the Router with edge listener only (no link listener)<a href="#2342-create-the-router-with-edge-listener-only-no-link-listener" class="hash-link" aria-label="Direct link to 2.3.4.2 Create the Router with edge listener only (no link listener)" title="Direct link to 2.3.4.2 Create the Router with edge listener only (no link listener)">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./ziti_router_auto_enroll -f -n --controller 68.183.52.206 --controllerFabricPort 8440 --controllerMgmtPort 8441 --adminUser admin --adminPassword Test@123 --disableHealthChecks --routerName pub-er </span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2343-create-the-router-with-edge-listener-and-tunneler">2.3.4.3 Create the Router with edge listener and tunneler<a href="#2343-create-the-router-with-edge-listener-and-tunneler" class="hash-link" aria-label="Direct link to 2.3.4.3 Create the Router with edge listener and tunneler" title="Direct link to 2.3.4.3 Create the Router with edge listener and tunneler">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./ziti_router_auto_enroll -f -n --controller 68.183.52.206 --controllerFabricPort 8440 --controllerMgmtPort 8441 --adminUser admin --adminPassword Test@123 --disableHealthChecks --autoTunnelListener --routerName pub-er</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="24-creating-router-on-the-controller-first">2.4 Creating Router on the Controller first<a href="#24-creating-router-on-the-controller-first" class="hash-link" aria-label="Direct link to 2.4 Creating Router on the Controller first" title="Direct link to 2.4 Creating Router on the Controller first">â</a></h2>
<p><strong>If you already setup the router directly on the VM, you can skip to the next <a href="#25-auto-start-the-router">section 2.5</a></strong></p>
<p>You can create the router on the controller first then register the router on the router VM.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="241-creating-router-on-the-controller-using-zac">2.4.1 Creating Router on the controller Using ZAC<a href="#241-creating-router-on-the-controller-using-zac" class="hash-link" aria-label="Direct link to 2.4.1 Creating Router on the controller Using ZAC" title="Direct link to 2.4.1 Creating Router on the controller Using ZAC">â</a></h3>
<p><strong>If you prefer to create router using CLI, you can jump to <a href="#242-creating-router-on-the-controller-using-cli">cli section</a>.</strong></p>
<p><strong>In order to complete the procedures in this section, you need to install ZAC first and have access to the controller using the ZAC. If you have trouble using ZAC, you can use the <a href="#242-creating-router-on-the-controller-using-cli">CLI procedures</a> to create router.</strong></p>
<p>From the ZAC welcome screen, choose the <strong>ROUTERS</strong></p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/ZAC01-router-d367a52a762e51de055184325befc14f.png" width="323" height="638" class="img_ev3q"></p>
<p>Click on <strong>+</strong> to bring up the <strong>CREATE EDGE ROUTER</strong> widget. The <strong>NAME</strong> of Router is required, and it has to be unique. Also choose whether you want the tunneler to be enable or not on the router.  Enter other optional fields and hit <strong>SAVE</strong></p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/ZAC02-router-59cc68474610a575820fb58aff745b01.jpg" width="665" height="812" class="img_ev3q"></p>
<p>If the router is created successfully, you will be back to the <strong>MANAGE EDGE ROUTERS</strong> screen.  From the list of edge routers, you will see the <strong>JWT</strong> icon on the newly created router. You need this JWT for the registration.</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/ZAC03-router-3a7e9d22b3ee246e62ae44864cfeb2f6.jpg" width="1084" height="333" class="img_ev3q"></p>
<p>Click on the <strong>JWT ICON</strong>, the JWT will be downloaded to your machine. On Chrome browser, the downloaded file will appear on the bottom left corner of the browser like picture below.</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/2wBDAQMEBAUEBQkFBQkUDQsNFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBT/wAARCAAxAPMDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD54/t3Uv8AoIXX/f8Ab/Gj+3dS/wCghdf9/wBv8ao0V+88q7H49zPuXv7d1L/oIXX/AH/b/Gj+3dS/6CF1/wB/2/xqjRRyrsHM+5e/t3Uv+ghdf9/2/wAaP7d1L/oIXX/f9v8AGqNFHKuwcz7l7+3dS/6CF1/3/b/Gj+3dS/6CF1/3/b/GqNFHKuwcz7l7+3dS/wCghdf9/wBv8aP7d1L/AKCF1/3/AG/xqjRRyrsHM+5e/t3Uv+ghdf8Af9v8aP7d1L/oIXX/AH/b/GqNFHKuwcz7l7+3dS/6CF1/3/b/ABo/t3Uv+ghdf9/2/wAao0Ucq7BzPuXv7d1L/oIXX/f9v8aP7d1L/oIXX/f9v8ao0Ucq7BzPuXv7d1L/AKCF1/3/AG/xo/t3Uv8AoIXX/f8Ab/GqNFHKuwcz7l7+3dS/6CF1/wB/2/xo/t3Uv+ghdf8Af9v8ao0Ucq7BzPuXv7d1L/oIXX/f9v8AGj+3dS/6CF1/3/b/ABqjRRyrsHM+5e/t3Uv+ghdf9/2/xo/t3Uv+ghdf9/2/xqjRRyrsHM+5e/t3Uv8AoIXX/f8Ab/Gj+3dS/wCghdf9/wBv8ao0Ucq7BzPuXv7d1L/oIXX/AH/b/Gj+3dS/6CF1/wB/2/xqjRRyrsHM+5e/t3Uv+ghdf9/2/wAacNY1Vo2kF9eGNSFL+a+ATnAznqcH8jWfWlb/APIt3/8A192//oE9JpLoNNvqR/27qX/QQuv+/wC3+NFUaKfKuwuZ9woooqiS9oWjz+ItasdLtSouLydII2kyFBYgZOATgZyeOle7yfsR+PbVYTdi1t93l+Z++jby932fdnD87fNn6dfszY++mfPfgLY/afiJbXJx5djBLcNn/d8tf/HpFP4V+iXirVhtfgf98f8A2FfMZrjq+HqwhRdrrXQ9LDU6UqcpVFsfmx8RfhjqvwzutOg1VoTJeW4mCxNkxsMB0btlWyMgkHGc9q5Gvo79syz+x3XgJymx7jSp7huMZ3XcpB6D+HbXzjXp5biJ4rCxq1N7yX3Sa/QwxVNUanKuyf3pP9Qor33wZ8HfAmraJ8LbfVJPEQ13x19qhW6s7iEWthIlzJBE5iMJeVSQm5d6YAY7ucClofwL0W+8V/D/AEm5vL7y9e0K91K8eGVMrND9r2iIlOEP2dM5BPLcjjG0sZShz81/d5v/ACXmvb/wF/0zSODqzaUbbJ/e4pffzI8Por6k+IXg/wAK+PbjwzpE/wDbFr4pj+HNlqVtfpNGbFTb2PmiGSHyy+GSN/3vmLhmUbDjJ84+FvwU0fxxr8MUvjLSb+yt9PuNU1C00+Sa1uYYoo9xjM13BHboxYqm8uyrkscgcqOMhyylNNWv56JtX/BinhJxcVF3vp21tF21/wAS/q55FRX0T/wpH4f2lpr2tXOoX93p2neHhqz6Ro/iDT764t7r7WsHkS3UKPGVYMrhhGCA/wB1ipBwPg34N0XxZ4W8VTajq+uaP4eGu6LZT2drfqsbwXE8y758x7ZHiChlbaADu4GeH9chKEpxWzS+bko/m/TztqJ4Wcd33/CPN8tGt9UeK0V9Nt+yjpfh/RLG91+91EzaY+oyeJobOWNTBBEly1q0W6M7TL9lP3t3+sTgZrhf2oNP8M6T440u28N6JLoinRdPnnQzxPHIZLSJ1IRIY8Pyd7EnexLYXpUU8dSrVFTp6+fb/hxywc4wc5NaK+9+qXT1R49RRRXonCFFFFABRRRQAUUUUAFFFFABRRRQAUV9A6d8Kvhp4P0+18L+PtfltfHWuRLKt9YSCWy8O7gGhW5wcSNJkb8Z2KQeOp8X8Z+EdQ8B+KNS0DVBD9usJTFI1vKJY24BDKw4KkEEH0PauWliIVpOMf8Ah13Xdf1s0dFShOmk5f8ADeT/AK/FMxq0rf8A5Fu//wCvu3/9AnrNrSt/+Rbv/wDr7t//AECet5bGMdzNoooqyQooooA2vC3jLVvBd5NdaRcR2080flO0lvHMCuQ2MOrDqB+Ve+t+25qEiATeBdDmbGCzXF1z7/6yvmiivPxOAw+LadaOq7Nr8mr/ADOmliJ0b8lte6T/ADTPSfjZ8br3413+iXF3pFloyaTZCwggsSxXywxIzuJJPPXNebUUVvh8PTwtNUaKtFer3d+uu5FatOvN1Kju3+mnQ9gm/aE1LR/hr4H8O+GZm02/0Wzv7a6vZbC2eVGuJ5G3Ws7BpYSY5NrMhjOQOuAawPDPx88c+DtCtdI0jV4LaztYZ7aBm021lmihmYtLGszxGQIzEkqGxnnFefUUnhaMuZSgnzNt3V9W2/1dvJl/WKt01JqySVtNrf5I76++O3jfUvDv9iz6tD9j/s2PRvNi0+2juvsKbdtt9pWMTeV8oym/Dc7gcnPM+EfGGseBdet9Z0K9aw1GAMFlVVdSrAqysjAq6kEgqwIIOCKx6K1VKmk0oqz3039TKVScrczvbY628+KfiG7XVkWTT7CLVrNNPvYdM0i0so5oVlEoBSGJFB3qp3gBjgAnHFdbrnxhh1H4Pv4dfUdT1TXL3+zredrixgtrazs7JZhDDEyOzSnM2S7Kh+XHNeS0VEsPTkkrWs0/u1X4mkK9SDbUt0196s/w/q6Vu61r44eOPEUniZ9R16S6bxLFbw6rugiAuUgx5QwEGzbjqmCec5yc4nirx1rXjWPTF1m4hu3062S0gnFpDHMYlVVRZJUQPLtVVAMhYgDjqawKKqNGnCzjFK3l5W/LT0JlWqSVpSb+f9dl9wUUUVsYhRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABWlb/wDIt3//AF92/wD6BPWbWlb/APIt3/8A192//oE9RLYqO5m0UUVZIUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABWlb/APIt3/8A192//oE9FFRLYqO5m0UUVZJ//9k=" width="243" height="49" class="img_ev3q"></p>
<p>Open the JWT file, and copy the content.  Now you are ready for the registration.</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/ZAC05-router-ef86cd6359ce2f0e68c6ef0c620397ff.jpg" width="562" height="84" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="242-creating-router-on-the-controller-using-cli">2.4.2 Creating Router on the controller Using CLI<a href="#242-creating-router-on-the-controller-using-cli" class="hash-link" aria-label="Direct link to 2.4.2 Creating Router on the controller Using CLI" title="Direct link to 2.4.2 Creating Router on the controller Using CLI">â</a></h3>
<p><strong>If you already created router using ZAC, you can skip ahead to <a href="#243-register-the-router-with-link-listener">register the router</a>.</strong></p>
<p>Otherwise, this section provides CLI commands to create routers on the controller.</p>
<p><strong>login to controller</strong></p>
<p>login to CLI first</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">zitiLogin</span><br></span></code></pre></div></div>
<p>To create an edge router (no tunneler)</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create edge-router pub-er -o pub-er.jwt</span><br></span></code></pre></div></div>
<p><strong>output</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">New edge router pub-er2 created with id: BzUtjC7E.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enrollment expires at 2023-04-07T03:52:03.997Z</span><br></span></code></pre></div></div>
<p>To create an edge router with tunneler</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create edge-router pub-er -t -o pub-er.jwt</span><br></span></code></pre></div></div>
<p>Cat out the content of the jwt file. We will need to use the jwt to register router</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># cat  pub-er.jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbSI6ImVyb3R0IiwiZXhwIjoxNjgwODM5NjA4LCJpc3MiOiJodHRwczovLzE2MS4zNS4xMDguMjE4Ojg0NDEiLCJqdGkiOiJhNDg5N2Q0ZS1lZTY4LTQ1M2UtYjY1NS03MGU0YjgyZTllNDciLCJzdWIiOiJpY2JLakM3RS5QIn0.Y6DohYyWEeJQmRMe29v4cL3Y1APCnBlrv_-S_941au2OESuQdt2CS4C4djvESYzV5vbnbgZgyU5xtNvb4lW5Uv2HP3XUGQNVsWjpwZbazNoTXg1IX6hhWb7T6u1AhS4xnJ3jpoapKsdOkUSqeQNUMSiN3aeLNcGVA_XK1-utCYjVsHDC90M1ZYZqgd8C9IKziDI10XQVlKTqosv8hoJD0OKIu7WZMslweRSMBtQUA2lZ2QSkIhFr2bvtgPll-5aBnG7eo6Ka_WtEW6EikU2fxgpNaVVBEIdZs1tkdGU6dfBDA6j5wA1TBI0FZnuKlNW24bMZCWKy2B_AMqJW1a80I0qNDx-QHEy-pt8FzZ-eqXWyfhc_nYzwT9kr6hO9VJrrD81hboCeTl8G6EXZjwCi2lPbKHROtkQu08-Ns1Kps7R3GILeNMltW9tKApP746ek4DVxm2cKqiB1Axcb0tNjDWTthjyp8m40aSiiqOPIoQbwa43JLqbHcuhZOSBLQNb_bwzkxBSf34D2w5eVETWy9VX-lgHwM-uhT5SfZIWdnWtO7-Cxn-cqgz89twtOim-yc5j0p0ieAbrOArbjKFBXiQjP8yWkorQKlj5PTSk7vyb3X4q6p--RxP2Z5F8alCPQx3XiVcohvIJnrJiEP86myNIYcKhhJ4OB4r9iOr0qTc8</span><br></span></code></pre></div></div>
<p>We also need the management port (default 8441) and fabric port (default 8440) of the controller to register the router</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># echo $ZITI_EDGE_CONTROLLER_PORT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8441</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># echo $ZITI_CTRL_PORT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8440</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="243-register-the-router-with-link-listener">2.4.3 Register the Router with link listener<a href="#243-register-the-router-with-link-listener" class="hash-link" aria-label="Direct link to 2.4.3 Register the Router with link listener" title="Direct link to 2.4.3 Register the Router with link listener">â</a></h3>
<p><strong>Perform this on the Router VM</strong></p>
<p>Use this procedure to create a Public Router with link listener (but without tunnel).</p>
<p><strong>command</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441 --assumePublic --disableHealthChecks &lt;jwt content&gt;</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441 --assumePublic --disableHealthChecks eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbSI6ImVyb3R0IiwiZXhwIjoxNjgwODM5NjA4LCJpc3MiOiJodHRwczovLzE2MS4zNS4xMDguMjE4Ojg0NDEiLCJqdGkiOiJhNDg5N2Q0ZS1lZTY4LTQ1M2UtYjY1NS03MGU0YjgyZTllNDciLCJzdWIiOiJpY2JLakM3RS5QIn0.Y6DohYyWEeJQmRMe29v4cL3Y1APCnBlrv_-S_941au2OESuQdt2CS4C4djvESYzV5vbnbgZgyU5xtNvb4lW5Uv2HP3XUGQNVsWjpwZbazNoTXg1IX6hhWb7T6u1AhS4xnJ3jpoapKsdOkUSqeQNUMSiN3aeLNcGVA_XK1-utCYjVsHDC90M1ZYZqgd8C9IKziDI10XQVlKTqosv8hoJD0OKIu7WZMslweRSMBtQUA2lZ2QSkIhFr2bvtgPll-5aBnG7eo6Ka_WtEW6EikU2fxgpNaVVBEIdZs1tkdGU6dfBDA6j5wA1TBI0FZnuKlNW24bMZCWKy2B_AMqJW1a80I0qNDx-QHEy-pt8FzZ-eqXWyfhc_nYzwT9kr6hO9VJrrD81hboCeTl8G6EXZjwCi2lPbKHROtkQu08-Ns1Kps7R3GILeNMltW9tKApP746ek4DVxm2cKqiB1Axcb0tNjDWTthjyp8m40aSiiqOPIoQbwa43JLqbHcuhZOSBLQNb_bwzkxBSf34D2w5eVETWy9VX-lgHwM-uhT5SfZIWdnWtO7-Cxn-cqgz89twtOim-yc5j0p0ieAbrOArbjKFBXiQjP8yWkorQKlj5PTSk7vyb3X4q6p--RxP2Z5F8alCPQx3XiVcohvIJnrJiEP86myNIYcKhhJ4OB4r9iOr0qTc8 </span><br></span></code></pre></div></div>
<p><strong>output</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:49-INFO-Version not specified, going to check with controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:49-INFO-Found version 0.27.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:49-INFO-Downloading file: https://github.com/openziti/ziti/releases/download/v0.27.7/ziti-linux-amd64-0.27.7.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Downloading: 100%|ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ| 115M/115M [00:01&lt;00:00, 68.9MiB/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:51-INFO-Successfully downloaded file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:51-INFO-Starting binary install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:54-INFO-Installing service unit file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:55-INFO-Service ziti-router daemon-reload successful.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:55-INFO-Creating config file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:55-INFO-Starting Router Enrollment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:57-INFO-Successfully enrolled Ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:57-INFO-Service ziti-router.service start successful.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:57-INFO-Service ziti-router.service enable successful.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="244-other-router-creation-options">2.4.4 Other Router creation options<a href="#244-other-router-creation-options" class="hash-link" aria-label="Direct link to 2.4.4 Other Router creation options" title="Direct link to 2.4.4 Other Router creation options">â</a></h3>
<p>If you need to create router with difference options than the one mentioned above, please choose one of the options from this section.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2441-register-the-router-with-link-listener-and-tunneler">2.4.4.1 Register the Router with link listener and tunneler<a href="#2441-register-the-router-with-link-listener-and-tunneler" class="hash-link" aria-label="Direct link to 2.4.4.1 Register the Router with link listener and tunneler" title="Direct link to 2.4.4.1 Register the Router with link listener and tunneler">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441 --assumePublic --disableHealthChecks --autoTunnelListener &lt;jwt content&gt;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2442-register-the-router-with-edge-listener-only-no-link-listener">2.4.4.2 Register the Router with edge listener only (no link listener)<a href="#2442-register-the-router-with-edge-listener-only-no-link-listener" class="hash-link" aria-label="Direct link to 2.4.4.2 Register the Router with edge listener only (no link listener)" title="Direct link to 2.4.4.2 Register the Router with edge listener only (no link listener)">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441 --disableHealthChecks  &lt;jwt content&gt;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2443-register-the-router-with-edge-listener-and-tunneler">2.4.4.3 Register the Router with edge listener and tunneler<a href="#2443-register-the-router-with-edge-listener-and-tunneler" class="hash-link" aria-label="Direct link to 2.4.4.3 Register the Router with edge listener and tunneler" title="Direct link to 2.4.4.3 Register the Router with edge listener and tunneler">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441 --disableHealthChecks --autoTunnelListener &lt;jwt content&gt;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="25-auto-start-the-router">2.5 Auto start the router<a href="#25-auto-start-the-router" class="hash-link" aria-label="Direct link to 2.5 Auto start the router" title="Direct link to 2.5 Auto start the router">â</a></h2>
<p>After enroll the router, a systemd service file is automatically created and enabled. To check the status of the service file, issue the following command:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl status ziti-router.service</span><br></span></code></pre></div></div>
<p><strong>Output</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">â ziti-router.service - Ziti-Router</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Loaded: loaded (/etc/systemd/system/ziti-router.service; enabled; vendor preset: enabled)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Active: active (running) since Wed 2023-04-05 14:45:59 UTC; 4s ago</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Main PID: 18381 (ziti)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tasks: 6 (limit: 2323)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Memory: 16.5M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CPU: 222ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     CGroup: /system.slice/ziti-router.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             ââ18381 ziti router run /opt/ziti/config.yaml</span><br></span></code></pre></div></div>
<p>If the status shows <strong>active (running)</strong>, then the setup finished correctly.</p>
<p>On the controller, you can check the status of the routers. Please refer to the controller guide (useful command for the Router) section for more information.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="26-fix-the-resolver">2.6 Fix the resolver<a href="#26-fix-the-resolver" class="hash-link" aria-label="Direct link to 2.6 Fix the resolver" title="Direct link to 2.6 Fix the resolver">â</a></h2>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Azure</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">AWS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Google</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Digital Ocean</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Oracle</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">IBM</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>If you run router without tunneler enabled, you can skip this section.</p><p>We need to remove the digital ocean resolver for tunnel resolver to work correctly.</p><p>Check resolver before any changes:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># resolvectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Global</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resolv.conf mode: stub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current DNS Server: 67.207.67.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       DNS Servers: 67.207.67.2 67.207.67.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre></div></div><p>Under the Global DNS servers, it should say something like &quot;67.207.67.2 67.207.67.3&quot;</p><p><strong>Now, make changes to the resolver:</strong></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /etc/systemd/resolved.conf.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm DigitalOcean.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ln -s /dev/null DigitalOcean.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart systemd-resolved.service</span><br></span></code></pre></div></div><p>Check resolver again</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># resolvectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Global</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resolv.conf mode: stub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current DNS Server: 146.190.120.86</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       DNS Servers: 146.190.120.86</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre></div></div><p>Now the Global DNS servers should be the IP address on your local interface.</p></div><div role="tabpanel" class="tabItem_Ymn6"><p><strong>Not applicable</strong></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><strong>Not applicable</strong></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><strong>Not applicable</strong></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><strong>Not applicable</strong></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><strong>Not applicable</strong></p></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="27-route-table">2.7 Route Table<a href="#27-route-table" class="hash-link" aria-label="Direct link to 2.7 Route Table" title="Direct link to 2.7 Route Table">â</a></h2>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Azure</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">AWS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Google</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Digital Ocean</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Oracle</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">IBM</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><ul>
<li>
<p>For any router setup as a local gateway (i.e. local-er in <a href="/docs/guides/topologies/services#312-network-diagram-2">test network 2</a>), you will need to setup routes in Azure.</p>
</li>
<li>
<p>First you need to create a <strong>Route Table</strong> from Marketplace.
<img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/RouteTable-Azure1-d46d7120b7b04c6ea7f312b3641fec10.jpg" width="428" height="596" class="img_ev3q"></p>
</li>
<li>
<p>Then go to your subnet of your VM, associate the Route Table just created to the subnet.
<img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/RouteTable-Azure2-1bda9d65fff3f71edc37555b06af9e4a.jpg" width="1465" height="541" class="img_ev3q"></p>
</li>
<li>
<p>Click on the route table, then choose <strong>Routes</strong> from the left side menu.</p>
</li>
<li>
<p>Now you will be presented a screen like below, you can then add your route.</p>
</li>
<li>
<p>Following is an example route for intercepting traffic destine for ip: 11.11.11.11/32.</p>
</li>
<li>
<p>The <strong>Next hop address</strong> is local IP of our local gateway ER.</p>
</li>
</ul><p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/RouteTable-Azure3-3c60d56fe0b920915b08374beec1ba48.jpg" width="1472" height="468" class="img_ev3q"></p><p>The following routes are required:</p><ul>
<li>any intercept address cidr</li>
<li>100.64.0.0/10 (for DNS based intercept)</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>For any router setup as local gateway (i.e. local-er in <a href="/docs/guides/topologies/services#312-network-diagram-2">test network 2</a>), you will need to setup routes for your VPC.</li>
<li>To get to the route table, click on <strong>Subnet</strong> from your Instances screen</li>
<li>From the Subnet screen, click on <strong>Router table</strong></li>
<li>Then you can use <strong>Edit routes</strong> to add routes to the table.</li>
<li>Following is an example routes for intercepting traffic destine for IP subnet: 10.10.0.0/24 and 100.64.0.1/32.</li>
<li>The Target is <strong>Instance</strong> (our local gateway ER).</li>
</ul><p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/RouteTable-AWS1-8c7d0330294f7ac985b9d9cd0e82e4f7.jpg" width="1052" height="604" class="img_ev3q"></p><p>The following routes are required:</p><ul>
<li>any intercept address CIDR</li>
<li>100.64.0.0/10 (for DNS based intercept)</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>For any router setup as local gateway (i.e. local-er in <a href="/docs/guides/topologies/services#312-network-diagram-2">test network 2</a>), you will need to setup routes in GCP.</p><ul>
<li>Go to your VM screen, click on the <strong>Network interfaces</strong> name (i.e. nic0)</li>
<li>Click on <strong>Routes</strong> menu on the left side to bring up the Routes screen</li>
<li>Click <strong>ROUTE MANAGEMENT</strong> and <strong>+ CREATE ROUTE</strong> to bring up a dialog to create a route</li>
<li>Specify your <strong>Network</strong> and <strong>Destination IP range</strong></li>
<li><strong>Next hop</strong> is our <strong>local-er</strong> instance.</li>
<li>Click <strong>CREATE</strong> to generate the route.</li>
</ul><p>Following is an example route for intercepting traffic destine for ip: 11.11.11.11/32. The next hop is our local gateway ER.
<img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/RouteTable-GCP-b801e6157d7608207592ce4df4ba07a2.jpg" width="564" height="708" class="img_ev3q"></p><p>The following routes are required:</p><ul>
<li>any intercept address CIDR</li>
<li>100.64.0.0/10 (for DNS based intercept)</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>DigitalOcean does not have route table.  The routes are setup directly on the VM. The example is in the <a href="/docs/guides/topologies/services#367-verify-the-connection">test section</a></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>
<p>For any router setup as local gateway (i.e. local-er in <a href="/docs/guides/topologies/services#312-network-diagram-2">test network 2</a>), you will need to setup routes in Oracle Cloud.</p>
</li>
<li>
<p>To setup your route, choose the default route table from your VCN.
<img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/RouteTable-OCI1-7120f298d102481fb925fc44c7989f54.jpg" width="1340" height="567" class="img_ev3q"></p>
</li>
<li>
<p><strong>Add Router Rules</strong></p>
</li>
<li>
<p>Following is an example route for traffic destine for 100.64.0.0/10 subnet.</p>
</li>
<li>
<p>The <strong>Target Type</strong> is <strong>Private IP</strong></p>
</li>
<li>
<p>The <strong>Destination Type</strong> is <strong>CIDR Block</strong></p>
</li>
<li>
<p>The <strong>Destination CIDR Block</strong> is the example traffic (100.64.0.0/10)</p>
</li>
<li>
<p>The <strong>Target Selection</strong> is the IP of our local gateway ER.
<img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/RouteTable-OCI2-af7c8cf49c88c5d4ec565f9e82e07f72.jpg" width="1301" height="578" class="img_ev3q"></p>
</li>
</ul><p>The following routes are required:</p><ul>
<li>any intercept address CIDR</li>
<li>100.64.0.0/10 (for DNS based intercept)</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>IBM Cloud does not have route table.  The routes are setup directly on the VM. The example is in the <a href="/docs/guides/topologies/services#367-verify-the-connection">test section</a></p></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="28-source-and-destination-check">2.8 Source and Destination Check<a href="#28-source-and-destination-check" class="hash-link" aria-label="Direct link to 2.8 Source and Destination Check" title="Direct link to 2.8 Source and Destination Check">â</a></h2>
<p>Most cloud provider checks the source and destination of the traffic to make sure it is either originated or terminated at the VM. When our ER is used as a local GW, it is neither the source or the destination of the traffic. Therefore, the source and destination check must be disabled.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Azure</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">AWS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Google</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Digital Ocean</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Oracle</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">IBM</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><ul>
<li>In Azure, the &quot;Source and Destination Check&quot; is called <strong>IP forwarding</strong></li>
<li>From your Virtual machine screen, click on the <strong>Network Interface</strong> of that VM.</li>
<li>On the left side menu, choose <strong>IP configurations</strong> (like the picture below).</li>
<li><strong>Enable</strong> the <strong>IP forwarding</strong></li>
<li><strong>Save</strong>
<img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/SrcDestCheck-Azure-0f586382d32075bae2891e4ce35e6a4a.jpg" width="1067" height="516" class="img_ev3q"></li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>From your Instance screen, Under <strong>Networking</strong> tab, click on the <strong>Network Interface</strong> of that VM.</li>
<li>Click on <strong>Actions</strong> on the right side to bring up a dropdown menu.</li>
<li>Select <strong>Change source/dest. check</strong></li>
<li><strong>uncheck</strong> Enable and then press <strong>Save</strong></li>
</ul><p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/SrcDestCheck-AWS1-0cc52d570b0892006aa24ab5ad8afc2c.jpg" width="1069" height="543" class="img_ev3q">
<img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/SrcDestCheck-AWS2-d3c916b492165dc04ab7f7887e86783b.jpg" width="607" height="269" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>
<p>In GCP, the &quot;Source and Destination Check&quot; is named <strong>IP forwarding</strong></p>
</li>
<li>
<p>During the VM creation, from the VM configuration screen, choose the <strong>ADVANCED OPTIONS</strong> &amp; under the <strong>NETWORKING</strong> section (like the picture below). <strong>Enable</strong> the <strong>IP forwarding</strong>
<img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/SrcDestCheck-GCP-e6108395d8be74cac6340f68af2787c7.jpg" width="671" height="367" class="img_ev3q"></p>
</li>
<li>
<p>If the <strong>IP forwarding</strong> was not enabled during VM creation, you can follow <a href="https://cloud.google.com/compute/docs/instances/update-instance-properties" target="_blank" rel="noopener noreferrer">this procedure</a> to enable it.</p>
</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>DigitalOcean does not have this feature.</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>
<p>From the Instance details screen, click on the <strong>Attached VNICs</strong> from the left side menu</p>
</li>
<li>
<p>On the right side menu, choose <strong>3 dots</strong> (like the picture below), Click <strong>Edit VNIC</strong>
<img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/SrcDestCheck-OCI1-36ef8ee6722ceeebb8311abe4fc5d24b.jpg" width="1348" height="556" class="img_ev3q"></p>
</li>
<li>
<p>Select <strong>Skip Source/Destination Check</strong></p>
</li>
<li>
<p>Click <strong>Save changes</strong>
<img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/SrcDestCheck-OCI2-a86d305c2da1e43e5d9441307c14c75f.jpg" width="1337" height="555" class="img_ev3q"></p>
</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>IBM Cloud does not have this feature.</p></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="29-firewall">2.9 Firewall<a href="#29-firewall" class="hash-link" aria-label="Direct link to 2.9 Firewall" title="Direct link to 2.9 Firewall">â</a></h2>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Azure</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">AWS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Google</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Digital Ocean</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Oracle</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">IBM</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>Azure&#x27;s default firewall is blocking all incoming access to the VM. You will need the following ports open for your ERs:</p><ul>
<li>443/TCP (default port for edge listener)</li>
<li>80/TCP (default port for link listener)</li>
<li>53/UDP (when using as local gw)</li>
<li>any intercept ports. (i.e. if you want to intercept RDP traffic, you will need to open port 3389)</li>
</ul><p>To open ports:</p><ul>
<li>From your Virtual machine page, click on <strong>Networking</strong> from the left side menu.</li>
<li>Under the <strong>Inbound port rules</strong>, you can click on <strong>Add inbound port rule</strong> to allow traffic in. Like example here.
<img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Firewall-Azure-a7fa5397c0f4f5a9db306efac301e823.jpg" width="1077" height="308" class="img_ev3q"></li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>AWS default firewall is blocking all incoming access to the VM. You will need the following ports open for your ERs:</p><ul>
<li>443/TCP (default port for edge listener)</li>
<li>80/TCP (default port for link listener)</li>
<li>53/UDP (when using as local gw)</li>
<li>any intercept ports. (i.e. if you want to intercept RDP traffic, you will need to open port 3389)</li>
</ul><p>Following is the firewall setting for edge router which serves as the GW for non ziti client.
<img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Firewall-AWS-ER-nonziti-99a242e262cbf580885cbffc5228ff1c.jpg" width="980" height="259" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>GCP default firewall is blocking all incoming access to the VM. You will need the following ports open for your ERs:</p><ul>
<li>443/TCP (default port for edge listener)</li>
<li>80/TCP (default port for link listener)</li>
<li>53/UDP (when using as local gw)</li>
<li>any intercept ports. (i.e. if you want to intercept RDP traffic, you will need to open port 3389)</li>
</ul><p>Following is example firewall configuration for public ER and local ER.
<img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/ER-Firewall-GCP-c59ea55f5085952f8c51e851f3a9df77.jpg" width="819" height="95" class="img_ev3q"></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>DigitalOcean by default does not setup firewall for the VM.</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>Oracle Cloud default firewall is s blocking all incoming access to the VM. You will need the following ports open for your ERs:</p><ul>
<li>443/TCP (default port for edge listener)</li>
<li>80/TCP (default port for link listener)</li>
<li>53/UDP (when using as local gw)</li>
<li>22/TCP (SSH access, this rule by default allowed in iptable rule)</li>
<li>any intercept ports. (i.e. if you want to intercept RDP traffic, you will need to open port 3389)</li>
</ul><p><strong>To setup the security group</strong></p><ul>
<li>From <strong>Networking</strong> category, select the <strong>Virtual cloud networks</strong>.</li>
<li>Select the VCN your VM is in.</li>
<li>On the left side menu, select the <strong>Network Security Group</strong>.</li>
<li>Select <strong>Create Network Security Group</strong>.</li>
<li>Name the security group and select the next.</li>
<li>Now create rules for ingress traffic (port listed above).</li>
<li>Also create a rule to allow all traffic outbound (<strong>Egress</strong>).</li>
</ul><p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/ER-Firewall-OCI1-0625031db42fb7ec6a540a987c871d5d.jpg" width="1311" height="590" class="img_ev3q"></p><p><strong>Then attach the created security group to the instance</strong></p><ul>
<li>Select <strong>Edit</strong> under the <strong>Network security groups</strong> section.</li>
<li>Select the security group from the drop down and press <strong>Save changes</strong>.</li>
</ul><p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/ER-Firewall-OCI2-329667c52918ab4e842823746dcd1c13.jpg" width="1006" height="564" class="img_ev3q"></p><hr><p><strong>NOTE 1</strong></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Oracle Cloud also uses Security Lists (on the subnet) to marshal the traffic, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">please make sure the setting under Security Lists is not conflicting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with your security group rules.</span><br></span></code></pre></div></div><hr><p><strong>NOTE 2</strong></p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">It is possible that after the security group configuration, the ufw does not</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">work correctly on the VM.</span><br></span></code></pre></div></div><p>You should <strong>Turn on ufw</strong> and <strong>restart the VM</strong> after the security group configuration.</p><ul>
<li>ufw must be turned on for traffic to get to the VM.</li>
<li>after ufw is enabled, setup <strong>allow</strong> traffic for ports:</li>
</ul><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow 80/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow 443/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow 53/udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo shutdown -r 0</span><br></span></code></pre></div></div><ul>
<li>you also need to allow the intercept ports on the ufw also.</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>If you turn on the firewall feature, you will need to config firewall rules.</p><ul>
<li>Open the Instance detail screen</li>
<li>Find the <strong>Firewall details</strong> at the bottom right. Open it.</li>
</ul><p>Add the following rules.</p><ul>
<li>443/TCP (default port for edge listener)</li>
<li>80/TCP (default port for link listener)</li>
<li>53/UDP (when using as local gw)</li>
<li>22/TCP (SSH access)</li>
<li>any intercept ports. (i.e. if you want to intercept RDP traffic, you will need to open port 3389)</li>
<li>Deny rules to deny all other traffic</li>
</ul><p>Make sure the firewall is active, it should display <strong>Processing all rules</strong> if it is active.</p><p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Firewall-IBM-er-7ee5bb0385d61a3af392078bdb06776b.jpg" width="1634" height="499" class="img_ev3q"></p></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/guides/deployments/40-cloud/20-router.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-08-19T12:39:36.000Z" itemprop="dateModified">Aug 19, 2025</time></b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/guides/deployments/cloud/controller"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Controller</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/guides/deployments/console"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Alternative Server Certificates</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#20-configure-a-router" class="table-of-contents__link toc-highlight">2.0 Configure a Router</a></li><li><a href="#21-create-the-edge-router-vm" class="table-of-contents__link toc-highlight">2.1 Create the Edge Router VM</a></li><li><a href="#22-login-and-update-the-repo-and-apps-on-vm" class="table-of-contents__link toc-highlight">2.2 Login and Update the repo and apps on VM</a><ul><li><a href="#221-apt-update" class="table-of-contents__link toc-highlight">2.2.1 apt update</a></li><li><a href="#222-download-ziti_router_auto_enroll-binary" class="table-of-contents__link toc-highlight">2.2.2 Download ziti_router_auto_enroll binary</a></li></ul></li><li><a href="#23-create-and-set-up-router-directly-on-router-vm" class="table-of-contents__link toc-highlight">2.3 Create and Set Up Router Directly on Router VM</a><ul><li><a href="#231-info-needed-for-creating-router" class="table-of-contents__link toc-highlight">2.3.1 Info needed for creating Router</a></li><li><a href="#232-info-gathered-for-creating-router" class="table-of-contents__link toc-highlight">2.3.2 Info gathered for creating Router</a></li><li><a href="#233-create-the-router-with-link-listener" class="table-of-contents__link toc-highlight">2.3.3 Create the Router with link listener</a></li><li><a href="#234-other-router-creation-options" class="table-of-contents__link toc-highlight">2.3.4 Other Router creation options</a></li></ul></li><li><a href="#24-creating-router-on-the-controller-first" class="table-of-contents__link toc-highlight">2.4 Creating Router on the Controller first</a><ul><li><a href="#241-creating-router-on-the-controller-using-zac" class="table-of-contents__link toc-highlight">2.4.1 Creating Router on the controller Using ZAC</a></li><li><a href="#242-creating-router-on-the-controller-using-cli" class="table-of-contents__link toc-highlight">2.4.2 Creating Router on the controller Using CLI</a></li><li><a href="#243-register-the-router-with-link-listener" class="table-of-contents__link toc-highlight">2.4.3 Register the Router with link listener</a></li><li><a href="#244-other-router-creation-options" class="table-of-contents__link toc-highlight">2.4.4 Other Router creation options</a></li></ul></li><li><a href="#25-auto-start-the-router" class="table-of-contents__link toc-highlight">2.5 Auto start the router</a></li><li><a href="#26-fix-the-resolver" class="table-of-contents__link toc-highlight">2.6 Fix the resolver</a></li><li><a href="#27-route-table" class="table-of-contents__link toc-highlight">2.7 Route Table</a></li><li><a href="#28-source-and-destination-check" class="table-of-contents__link toc-highlight">2.8 Source and Destination Check</a></li><li><a href="#29-firewall" class="table-of-contents__link toc-highlight">2.9 Firewall</a></li></ul></div></div></div></div></main></div></div><footer class="ozLayoutFooter_Elxg ozFooter_Avh_"><section class="footer_TVlg ozHorizontalSectionRoot_MIa6 ozhsContent_Tzp1"><div class="footerContainer_otJT"><div class="footerGrid_DfDa"><div class="footerColumn_aKLl"><h3>OpenZiti</h3><p>An open source project enabling developers to embed zero trust networking directly into applications.</p><div class="footerSocialLinks_HWin"><a href="https://github.com/openziti/ziti" target="_blank" class="footerSocialLink_t5Hs"><svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"></path></svg></a><a href="https://www.linkedin.com/company/netfoundry" target="_blank" class="footerSocialLink_t5Hs"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.996 16V10.1C15.996 7.5 15.375 5.49999 12.025 5.49999C10.4 5.49999 9.325 6.39999 8.875 7.29999H8.825V5.79999H5.65V16H8.95V10.7C8.95 9.30001 9.2 7.9 10.925 7.9C12.65 7.9 12.675 9.59999 12.675 10.8V16H15.996Z"></path><path d="M0.25 5.79999H3.575V16H0.25V5.79999Z"></path><path d="M1.9 0C0.85 0 0 0.85 0 1.9C0 2.95 0.85 3.8 1.9 3.8C2.95 3.8 3.8 2.95 3.8 1.9C3.8 0.85 2.95 0 1.9 0Z"></path></svg></a><a href="https://www.youtube.com/OpenZiti" target="_blank" class="footerSocialLink_t5Hs"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.969 4.69c-.183-1.358-1.062-2.275-2.361-2.46C12.371 2 8 2 8 2S3.629 2 2.362 2.229c-1.3.186-2.179 1.103-2.361 2.461C0 6.03 0 10 0 10s0 3.97.2 5.31c.183 1.358 1.062 2.275 2.361 2.46C3.63 18 8 18 8 18s4.371 0 5.638-.23c1.3-.185 2.178-1.102 2.361-2.46.2-1.34.2-5.31.2-5.31s0-3.97-.23-5.31zm-8.36, 8.57V6.73l3.76 2.27-3.76 2.26z"></path></svg></a><a href="https://x.com/OpenZiti" target="_blank" class="footerSocialLink_t5Hs"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.996 3.038c-.59.262-1.219.44-1.885.52.677-.406 1.194-1.05 1.438-1.815-.634.375-1.337.648-2.085.795-.598-.638-1.45-1.038-2.396-1.038-1.813 0-3.283 1.469-3.283 3.282 0 .257.03.507.085.748-2.728-.137-5.147-1.445-6.766-3.43-.282.485-.444 1.05-.444 1.651 0 1.14.58 2.143 1.46 2.732-.538-.017-1.044-.164-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.219-.276.075-.567.116-.866.116-.211 0-.416-.021-.617-.06.418 1.304 1.63 2.254 3.066 2.28-1.124.883-2.539 1.406-4.077 1.406-.265 0-.526-.015-.785-.046 1.453.933 3.178 1.475 5.032 1.475 6.038 0 9.34-5.002 9.34-9.34 0-.142-.004-.284-.01-.425.641-.463 1.198-1.039 1.638-1.696"></path></svg></a></div></div><div class="footerColumn_aKLl"><h3>Documentation</h3><ul class="footerLinks_fOY0"><li><a href="/docs/learn/quickstarts/services/ztha">Getting Started</a></li><li><a href="/docs/reference/developer/api/">API Reference</a></li><li><a href="/docs/reference/developer/sdk/">SDK Integration</a></li></ul></div><div class="footerColumn_aKLl"><h3>Community</h3><ul class="footerLinks_fOY0"><li><a href="https://github.com/openziti/ziti">GitHub</a></li><li><a href="https://openziti.discourse.group/">Discourse Forum</a></li><li><a href="/policies/CONTRIBUTING">Contributing</a></li></ul></div><div class="footerColumn_aKLl"><h3>Resources</h3><ul class="footerLinks_fOY0"><li><a href="https://blog.openziti.io">Blog</a></li><li><a href="https://netfoundry.io/">NetFoundry</a></li></ul></div></div></div><div class="footerCopyright_W7lP"><p>Â© 2025 NetFoundry Inc. OpenZiti is an open source project sponsored by NetFoundry. All rights reserved.</p></div></section></footer></div></div>
</body>
</html>