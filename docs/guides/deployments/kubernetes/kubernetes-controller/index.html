<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/deployments/kubernetes/kubernetes-controller" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Install the Controller in Kubernetes | OpenZiti</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openziti.io/docs/guides/deployments/kubernetes/kubernetes-controller"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="description" content="open source zero trust"><meta data-rh="true" name="robots" content="index, follow"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Install the Controller in Kubernetes | OpenZiti"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://openziti.io/docs/guides/deployments/kubernetes/kubernetes-controller"><link data-rh="true" rel="alternate" href="https://openziti.io/docs/guides/deployments/kubernetes/kubernetes-controller" hreflang="en"><link data-rh="true" rel="alternate" href="https://openziti.io/docs/guides/deployments/kubernetes/kubernetes-controller" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EXWPKK5PV4-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Deployments","item":"https://openziti.io/docs/category/deployments"},{"@type":"ListItem","position":2,"name":"Kubernetes","item":"https://openziti.io/docs/category/kubernetes"},{"@type":"ListItem","position":3,"name":"Controller","item":"https://openziti.io/docs/guides/deployments/kubernetes/kubernetes-controller"}]}</script><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-5SF399H3",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>





<link rel="search" type="application/opensearchdescription+xml" title="OpenZiti" href="/opensearch.xml">

<script>!function(t,h,e,j,s,n){t.hj=t.hj||function(){(t.hj.q=t.hj.q||[]).push(arguments)},t._hjSettings={hjid:3576473,hjsv:6},s=h.getElementsByTagName("head")[0],(n=h.createElement("script")).async=1,n.src="https://static.hotjar.com/c/hotjar-"+t._hjSettings.hjid+".js?sv="+t._hjSettings.hjsv,s.appendChild(n)}(window,document)</script><link rel="stylesheet" href="/assets/css/styles.f2cef296.css">
<script src="/assets/js/runtime~main.9a9b566e.js" defer="defer"></script>
<script src="/assets/js/main.d8f14419.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5SF399H3" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>




<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/ziti-logo-dark.svg"><link rel="preload" as="image" href="/img/ziti-logo-light.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="starUsRoot_Cir2"><span style="color:whitesmoke">Star us on GitHub </span><span style="height:20px"><span><a href="https://github.com/openziti/ziti" data-icon="octicon-star" data-show-count="true" aria-label="Star buttons/github-buttons on GitHub">Star</a></span></span></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/"><div class="navbar__logo"><img src="/img/ziti-logo-dark.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/ziti-logo-light.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item"><a class="navbar__item navbar__link header-netfoundry-link" href="https://netfoundry.io/products/netfoundry-cloud-30-day-free-trial/" target="_blank">NetFoundry</a></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/learn/introduction/">Documentation</a><a class="navbar__item navbar__link" href="/docs/downloads">Downloads</a><div class="navbar__item"><a class="navbar__item navbar__link header-netfoundry-link" href="https://blog.openziti.io/" target="_blank">Blog</a></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Links</a><ul class="dropdown__menu"><li class=""><div class="text-divider"><p>Socials</p></div></li><li class=""><a href="https://www.youtube.com/OpenZiti" target="_blank" title="OpenZiti on YouTube"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/yt.svg" alt="YouTube logo">YouTube</span></a></li><li class=""><a href="https://x.com/OpenZiti" target="_blank" title="OpenZiti on X(formerly Twitter)"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/twit.svg" alt="X/Twitter logo">X (Twitter)</span></a></li><li class=""><a href="https://www.reddit.com/r/openziti" target="_blank" title="OpenZiti Subreddit"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/reddit-logo.png" alt="Reddit logo">Reddit</span></a></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/ziggy.png" alt="X/Twitter Ziggy logo"><a href="https://x.com/OpenZiggy" target="_blank" title="OpenZiggy on X(formerly Twitter)">Ziggy</a></span></li><li class=""><div class="text-divider"><p>Other</p></div></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/blog-icon.png" alt="OpenZiti blog logo"><a href="https://blog.openziti.io/" target="_blank" title="Blog">Blog</a></span></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/oz-test-kitchen.png" alt="OpenZiti Test Kitchen logo"><a href="https://github.com/openziti-test-kitchen" target="_blank" title="Git project for the test kitchen">Test Kitchen</a></span></li></ul></div><a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discourse-link" title="Discourse"></a><a href="https://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper ozLayoutMainWrapper_maOX"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 sidebar-title"><a class="menu__link" href="/docs/learn/introduction">LEARN</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/learn/introduction/">What is OpenZiti?</a><button aria-label="Expand sidebar category &#x27;What is OpenZiti?&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/learn/quickstarts/">Quickstarts</a><button aria-label="Expand sidebar category &#x27;Quickstarts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/core-concepts">Core Concepts</a><button aria-label="Expand sidebar category &#x27;Core Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learn/identity-providers/">Identity Providers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 sidebar-title"><a class="menu__link" href="/docs/reference">REFERENCE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference/configuration/conventions">Configuration</a><button aria-label="Expand sidebar category &#x27;Configuration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/reference/ha/overview">Controller Clustering</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference/tunnelers/">Tunnelers</a><button aria-label="Expand sidebar category &#x27;Tunnelers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/command-line/login">CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/logging">Logging</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference/config-types/">Config Types</a><button aria-label="Expand sidebar category &#x27;Config Types&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/events">Events</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference/developer/">Developer</a><button aria-label="Expand sidebar category &#x27;Developer&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 sidebar-title"><a class="menu__link" href="/docs/guides">GUIDES</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guides/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/deployments">Deployments</a><button aria-label="Collapse sidebar category &#x27;Deployments&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/linux">Linux</a><button aria-label="Expand sidebar category &#x27;Linux&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/docker">Docker</a><button aria-label="Expand sidebar category &#x27;Docker&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/kubernetes">Kubernetes</a><button aria-label="Collapse sidebar category &#x27;Kubernetes&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/guides/deployments/kubernetes/kubernetes-controller">Controller</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/deployments/kubernetes/kubernetes-router">Router</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/deployments/kubernetes/kubernetes-console">Console</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/cloud">Cloud</a><button aria-label="Expand sidebar category &#x27;Cloud&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/deployments/console">Alternative Server Certificates</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/guides/external-auth/">Configuring OIDC</a><button aria-label="Expand sidebar category &#x27;Configuring OIDC&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/guides/hsm/">Hardware Keys</a><button aria-label="Expand sidebar category &#x27;Hardware Keys&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/topologies">Topologies</a><button aria-label="Expand sidebar category &#x27;Topologies&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/troubleshooting">Troubleshooting</a><button aria-label="Expand sidebar category &#x27;Troubleshooting&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/deployments"><span>Deployments</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/kubernetes"><span>Kubernetes</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Controller</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Install the Controller in Kubernetes</h1></header><header><h1>ziti-controller</h1></header>
<p><img decoding="async" loading="lazy" src="https://img.shields.io/badge/Version-2.0.3-informational?style=flat-square" alt="Version: 2.0.3" class="img_ev3q"> <img decoding="async" loading="lazy" src="https://img.shields.io/badge/Type-application-informational?style=flat-square" alt="Type: application" class="img_ev3q"> <img decoding="async" loading="lazy" src="https://img.shields.io/badge/AppVersion-1.6.5-informational?style=flat-square" alt="AppVersion: 1.6.5" class="img_ev3q"></p>
<p>Host an OpenZiti controller in Kubernetes</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a href="#requirements" class="hash-link" aria-label="Direct link to Requirements" title="Direct link to Requirements">​</a></h2>
<p>Add the OpenZiti Charts Repo with Helm.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> openziti https://docs.openziti.io/helm-charts/</span><br></span></code></pre></div></div>
<p>This chart runs a Ziti controller in Kubernetes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mutual-tls">Mutual TLS<a href="#mutual-tls" class="hash-link" aria-label="Direct link to Mutual TLS" title="Direct link to Mutual TLS">​</a></h3>
<p>Ziti&#x27;s TLS server ports must be published with a TLS passthrough to allow the controller to validate the client certificates from routers and identities. This may be done with a Traefik IngressRouteTCP, Gateway API TLSRoute, Ingress, NodePort, LoadBalancer, etc. The ctrl plane and management API share the client API&#x27;s TLS listener by default, so there&#x27;s one TCP port by default that must be published with TLS passthrough enabled.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="certificates">Certificates<a href="#certificates" class="hash-link" aria-label="Direct link to Certificates" title="Direct link to Certificates">​</a></h3>
<p>It is not normally necessary to obtain publicly trusted certificates for Ziti&#x27;s TLS servers. Ziti manages the trust relationships between the controller and routers and clients independent of the web&#x27;s root authorities. See the <a href="#alternative-web-server-certificates">Alternative Web Server Certificates</a> section for more information.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deployment">Deployment<a href="#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment">​</a></h3>
<p>The deployment must have exactly one replica.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="custom-resources">Custom Resources<a href="#custom-resources" class="hash-link" aria-label="Direct link to Custom Resources" title="Direct link to Custom Resources">​</a></h3>
<p>This chart requires the custom resources provided by <a href="https://cert-manager.io/docs/installation/" target="_blank" rel="noopener noreferrer">cert-manager</a> and <a href="https://cert-manager.io/docs/projects/trust-manager/#installation" target="_blank" rel="noopener noreferrer">trust-manager</a>, i.e., Issuer, Certificate, and Bundle. It is a limitation of Trust Manager to have one instance per cluster and one namespace from which trust Bundle inputs may be sourced, so a single Ziti controller may occupy the cluster unless your use case allows for controllers from multiple networks to share a namespace. You must set the Trust Manager&#x27;s &quot;trust namespace&quot; to the namespace of the Ziti controller so that it will be able to compose a trust Bundle resource from Ziti&#x27;s root CA cert(s).</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> jetstack https://charts.jetstack.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade </span><span class="token parameter variable" style="color:#36acaa">--install</span><span class="token plain"> cert-manager jetstack/cert-manager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> cert-manager --create-namespace </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">crds.enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create namespace ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade </span><span class="token parameter variable" style="color:#36acaa">--install</span><span class="token plain"> trust-manager jetstack/trust-manager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> cert-manager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">crds.keep</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">app.trust.namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ziti</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="breaking-change">Breaking Change<a href="#breaking-change" class="hash-link" aria-label="Direct link to Breaking Change" title="Direct link to Breaking Change">​</a></h3>
<p>Version 2 of this chart introduces a breaking change. You must decouple cert-manager and trust-manager from the Ziti controller chart if they were previously installed as subcharts. This allows them to be upgraded and configured independently of the Ziti controller chart.</p>
<p><strong>Symptom</strong></p>
<blockquote>
<p>Error: Unable to continue with install: CustomResourceDefinition &quot;certificaterequests.cert-manager.io&quot; in namespace &quot;&quot; exists and cannot be imported into the current release: invalid ownership metadata; label validation error: missing key &quot;app.kubernetes.io/managed-by&quot;: must be set to &quot;Helm&quot;; annotation validation error: missing key &quot;meta.helm.sh/release-name&quot;: must be set to &quot;cert-manager&quot;; annotation validation error: missing key &quot;meta.helm.sh/release-namespace&quot;: must be set to &quot;cert-manager&quot;</p>
</blockquote>
<p><strong>Cause</strong></p>
<p>Cert Manager and Trust Manager are no longer included as subcharts, so upgrading the Ziti controller chart will delete the cert-manager and trust-manager Operators along with their respective CRDs and associated resources which are critical for the Ziti controller.</p>
<p><strong>Solution</strong></p>
<ol>
<li>As with any controller upgrade, you are advised to back up the database before proceeding so that you will have the option to roll back to a snapshot prior to any irreversible database schema migrations that may occur during an upgrade.</li>
<li>Upgrade the Ziti controller Helm release to chart v2. This will temporarily uninstall the CM and TM Helm releases if they were originally installed as dependencies of the Ziti controller chart.</li>
<li>Install or upgrade as desired the cert-manager and trust-manager Helm releases (see <a href="#custom-resources">Custom Resources</a> section above for an example that is compatible with this upgrade path).</li>
<li>If the cert-manager or trust-manager charts fail to install with the &quot;symptom&quot; above, then run the provided BASH script (<code>chown-cert-manager.bash</code>) to set the owner labels and annotations on existing cert-manager and trust-manager CRDs and resources.</li>
<li>Retry installing cert-manager and trust-manager Helm charts. When they are installed successfully, their respective Helm releases will own the CRDs that were annotated and labeled by the provided BASH script.</li>
</ol>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>You must use the same values for CM and TM Helm release names and namespaces when you run the provided script and when you re-install the cert-manager and trust-manager Helm charts.</p></div></div>
<p>Assuming your future CM release will be named &quot;cert-manager,&quot; your future TM release will be named &quot;trust-manager,&quot; and both will be installed in namespace &quot;cert-manager,&quot; and your Ziti controller is installed in namespace &quot;ziti,&quot; you can use these example values to run the provided script to pave the way to installing the version 2 ziti-controller chart, which will delete the cert-manager and trust-manager Operators, preserving the CRDs and their associated resources.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm pull openziti/ziti-controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-xvf</span><span class="token plain"> ziti-controller-*.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CM_NAMESPACE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">cert-manager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CM_RELEASE_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">cert-manager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TM_NAMESPACE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">cert-manager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TM_RELEASE_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">trust-manager </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ZITI_NAMESPACE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ziti </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./ziti-controller/files/chown-cert-manager.bash</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="nodeport-service-example">NodePort Service Example<a href="#nodeport-service-example" class="hash-link" aria-label="Direct link to NodePort Service Example" title="Direct link to NodePort Service Example">​</a></h2>
<table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>clientApi.advertisedHost</td><td>the address that clients and routers will use to reach this controller</td></tr><tr><td>clientApi.advertisedPort</td><td>the TCP port associated with the advertisedHost</td></tr><tr><td>clientApi.service.type</td><td>the service type for the client API and router control plane</td></tr></tbody></table>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade ziti-controller openziti/ziti-controller </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--install</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> ziti </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --create-namespace </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">clientApi.advertisedHost</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ctrl1.ziti.example.com </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">clientApi.advertisedPort</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">32171</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">clientApi.service.type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">NodePort</span><br></span></code></pre></div></div>
<p>Here&#x27;s the YAML representation of the same set of input values.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">clientApi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">advertisedHost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ctrl1.ziti.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">advertisedPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32171</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NodePort</span><br></span></code></pre></div></div>
<p>Visit the Ziti Administration Console (ZAC): <a href="https://ctrl1.ziti.example.com:32171/zac/" target="_blank" rel="noopener noreferrer">https://ctrl1.ziti.example.com:32171/zac/</a></p>
<p>Log in with the <code>ziti</code> CLI.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge login ctrl1.ziti.example.com:32171 </span><span class="token parameter variable" style="color:#36acaa">--yes</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--username</span><span class="token plain"> admin </span><span class="token parameter variable" style="color:#36acaa">--password</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">    kubectl </span><span class="token variable parameter variable" style="color:#36acaa">-n</span><span class="token variable" style="color:#36acaa"> ziti get secrets ziti-controller-admin-secret </span><span class="token variable parameter variable" style="color:#36acaa">-o</span><span class="token variable" style="color:#36acaa"> go-template</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&#x27;{{index .data &quot;admin-password&quot; | base64decode }}&#x27;</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa"></span><span class="token variable" style="color:#36acaa">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="nginx-ingress-example">Nginx Ingress Example<a href="#nginx-ingress-example" class="hash-link" aria-label="Direct link to Nginx Ingress Example" title="Direct link to Nginx Ingress Example">​</a></h2>
<p>Here&#x27;s an example of using <a href="https://docs.nginx.com/nginx-ingress-controller/installation/installing-nic/installation-with-helm/" target="_blank" rel="noopener noreferrer">the community <code>ingress-nginx</code> chart</a> to provision ingresses for the controller&#x27;s <code>ClusterIP</code> services.</p>
<p>Ensure you have the <code>ingress-nginx</code> chart installed with <code>controller.extraArgs.enable-ssl-passthrough=true</code>. You can verify this feature is enabled by running <code>kubectl describe pods {ingress-nginx-controller pod}</code> and checking the args for <code>--enable-ssl-passthrough=true</code>.</p>
<p>If necessary, patch the <code>ingress-nginx</code> deployment to enable TLS passthrough.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl patch deployment </span><span class="token string" style="color:#e3116c">&quot;ingress-nginx-controller&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> ingress-nginx </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--type</span><span class="token plain"> json </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--patch</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;[{&quot;op&quot;: &quot;add&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;path&quot;: &quot;/spec/template/spec/containers/0/args/-&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        &quot;value&quot;:&quot;--enable-ssl-passthrough&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    }]&#x27;</span><br></span></code></pre></div></div>
<p>Create a Helm chart values file like this.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ziti-controller-values.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">clientApi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">advertisedHost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ctrl1.ziti.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">advertisedPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ingress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ingressClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/ingress.allow-http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;false&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">nginx.ingress.kubernetes.io/ssl-passthrough</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><br></span></code></pre></div></div>
<p>Now install or upgrade this controller chart with your values file.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade ziti-controller openziti/ziti-controller </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--install</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> ziti </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--values</span><span class="token plain"> ziti-controller-values.yml</span><br></span></code></pre></div></div>
<p>Visit the Ziti Administration Console (ZAC): <a href="https://ctrl1.ziti.example.com/zac/" target="_blank" rel="noopener noreferrer">https://ctrl1.ziti.example.com/zac/</a></p>
<p>Log in with the <code>ziti</code> CLI.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge login ctrl1.ziti.example.com:443 </span><span class="token parameter variable" style="color:#36acaa">--yes</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--username</span><span class="token plain"> admin </span><span class="token parameter variable" style="color:#36acaa">--password</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">    kubectl </span><span class="token variable parameter variable" style="color:#36acaa">-n</span><span class="token variable" style="color:#36acaa"> ziti get secrets ziti-controller-admin-secret </span><span class="token variable parameter variable" style="color:#36acaa">-o</span><span class="token variable" style="color:#36acaa"> go-template</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&#x27;{{index .data &quot;admin-password&quot; | base64decode }}&#x27;</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa"></span><span class="token variable" style="color:#36acaa">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="traefik-ingressroutetcp-example">Traefik IngressRouteTCP Example<a href="#traefik-ingressroutetcp-example" class="hash-link" aria-label="Direct link to Traefik IngressRouteTCP Example" title="Direct link to Traefik IngressRouteTCP Example">​</a></h2>
<p>This will create a Traefik IngressRouteTCP with TLS passthrough for the client API&#x27;s ClusterIP service.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade ziti-controller openziti/ziti-controller </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--install</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> ziti </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --create-namespace </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">clientApi.advertisedHost</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ctrl1.ziti.example.com </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">clientApi.advertisedPort</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">443</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">clientApi.service.type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ClusterIP </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">clientApi.traefikTcpRoute.enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><br></span></code></pre></div></div>
<p>Visit the Ziti Administration Console (ZAC): <a href="https://ctrl1.ziti.example.com/zac/" target="_blank" rel="noopener noreferrer">https://ctrl1.ziti.example.com/zac/</a></p>
<p>Log in with the <code>ziti</code> CLI.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge login ctrl1.ziti.example.com:443 </span><span class="token parameter variable" style="color:#36acaa">--yes</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--username</span><span class="token plain"> admin </span><span class="token parameter variable" style="color:#36acaa">--password</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">    kubectl </span><span class="token variable parameter variable" style="color:#36acaa">-n</span><span class="token variable" style="color:#36acaa"> ziti get secrets ziti-controller-admin-secret </span><span class="token variable parameter variable" style="color:#36acaa">-o</span><span class="token variable" style="color:#36acaa"> go-template</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&#x27;{{index .data &quot;admin-password&quot; | base64decode }}&#x27;</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa"></span><span class="token variable" style="color:#36acaa">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="admin-user-and-password">Admin User and Password<a href="#admin-user-and-password" class="hash-link" aria-label="Direct link to Admin User and Password" title="Direct link to Admin User and Password">​</a></h2>
<p>A default admin user and password will be generated and saved to a secret during installation. The credentials can be retrieved using this command.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get secret </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> ziti ziti-controller-admin-secret </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> go-template</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;{{range $k,$v := .data}}{{printf &quot;%s: &quot; $k}}{{if not $v}}{{$v}}{{else}}{{$v | base64decode}}{{end}}{{&quot;\n&quot;}}{{end}}&#x27;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="extra-security-for-the-management-api">Extra Security for the Management API<a href="#extra-security-for-the-management-api" class="hash-link" aria-label="Direct link to Extra Security for the Management API" title="Direct link to Extra Security for the Management API">​</a></h2>
<p>You can split the client and management APIs into separate cluster services by setting <code>managementApi.service.enabled=true</code>. With this configuration, you&#x27;ll have an additional cluster service named <code>{release}-mgmt</code> that is the management API, and the client API will not have management features.</p>
<p>This Helm chart&#x27;s values allow for both operational scenarios: combined and split. The default choice is to expose the combined client and management APIs as the cluster service named <code>{release}-client</code>, which is convenient because you can use the <code>ziti</code> CLI immediately. For additional security, you may shelter the management API by splitting these two sets of features, exposing them as separate API servers. After the split, you can access the management API in several ways:</p>
<ul>
<li>deploy a tunneler to bind a Ziti service targeting <code>{release}-mgmt.{namespace}.svc:{port}</code>.</li>
<li><code>kubectl -n {namespace} port-forward deployments/{release}-mgmt 8443:{port}</code></li>
</ul>
<p>The web console (ZAC) is always bound to the same web listener as the management API, so you can access it at that <code>/zac/</code> path on the same URL.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="advanced-pki">Advanced PKI<a href="#advanced-pki" class="hash-link" aria-label="Direct link to Advanced PKI" title="Direct link to Advanced PKI">​</a></h2>
<p>The default configuration generates a singular PKI root of trust for all the controller&#x27;s servers and the edge signer CA. Optionally, you may provide the name of a cert-manager Issuer or ClusterIssuer to become the root of trust for the Ziti controller&#x27;s identity.</p>
<p>Merge this with your Helm chart values file before installing or upgrading.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">ctrlPlane</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">issuer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterIssuer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alternative</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cluster</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">issuer</span><br></span></code></pre></div></div>
<p>You may also configure the Ziti controller to use separate PKI roots of trust for its three main identities: control plane, edge signer, and web bindings.</p>
<p>For example, to use a separate CA for the edge signer function, merge this with your Helm chart values file before installing or upgrading.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">edgeSignerPki</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prometheus-monitoring">Prometheus Monitoring<a href="#prometheus-monitoring" class="hash-link" aria-label="Direct link to Prometheus Monitoring" title="Direct link to Prometheus Monitoring">​</a></h2>
<p>This chart provides a default disabled <code>ziti-controller-prometheus</code> k8s service for prometheus,
which can be enabled with <code>prometheus.service.enabled</code>. Enabling it will create a prometheus ServiceMonitor
for configuring the prometheus endpoint. It is also important that you enable
<code>fabric.events.enabled</code> for getting a full set of metrics.</p>
<p>For more information, please check <a href="https://openziti.io/docs/learn/core-concepts/metrics/prometheus/" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="values-reference">Values Reference<a href="#values-reference" class="hash-link" aria-label="Direct link to Values Reference" title="Direct link to Values Reference">​</a></h2>
<table><thead><tr><th>Key</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>additionalConfigs</td><td>object</td><td><code>{&quot;ctrl&quot;:{},&quot;events&quot;:{},&quot;healthChecks&quot;:{},&quot;network&quot;:{},&quot;web&quot;:{}}</code></td><td>Append additional config blocks in specific top-level keys: edge, web, network, ctrl. If events are defined here, they replace the default events section entirely.</td></tr><tr><td>additionalVolumes</td><td>list</td><td><code>[]</code></td><td>additional volumes to mount to ziti-controller container</td></tr><tr><td>affinity</td><td>object</td><td><code>{}</code></td><td>deployment template spec affinity</td></tr><tr><td>ca.clusterDomain</td><td>string</td><td><code>&quot;cluster.local&quot;</code></td><td>Set a custom cluster domain if other than cluster.local</td></tr><tr><td>ca.duration</td><td>string</td><td><code>&quot;87840h&quot;</code></td><td>Go time.Duration string format</td></tr><tr><td>ca.renewBefore</td><td>string</td><td><code>&quot;720h&quot;</code></td><td>Go time.Duration string format</td></tr><tr><td>cert.duration</td><td>string</td><td><code>&quot;87840h&quot;</code></td><td>server certificate duration as Go time.Duration string format</td></tr><tr><td>cert.renewBefore</td><td>string</td><td><code>&quot;720h&quot;</code></td><td>rewnew server certificates before expiry as Go time.Duration string format</td></tr><tr><td>clientApi.advertisedHost</td><td>string</td><td><code>&quot;&quot;</code></td><td>global DNS name by which routers can resolve a reachable IP for this service</td></tr><tr><td>clientApi.advertisedPort</td><td>int</td><td><code>443</code></td><td>cluster service, node port, load balancer, and ingress port</td></tr><tr><td>clientApi.altDnsNames</td><td>list</td><td><code>[]</code></td><td>besides advertisedHost and dnsNames, add these DNS SANs to any ingresses but not the web identity</td></tr><tr><td>clientApi.containerPort</td><td>int</td><td><code>1280</code></td><td>cluster service target port on the container</td></tr><tr><td>clientApi.dnsNames</td><td>list</td><td><code>[]</code></td><td>besides advertisedHost, add these DNS SANs to the web identity and any ingresses</td></tr><tr><td>clientApi.ingress.annotations</td><td>object</td><td><code>{}</code></td><td>ingress annotations, e.g., to configure ingress-nginx</td></tr><tr><td>clientApi.ingress.enabled</td><td>bool</td><td><code>false</code></td><td>create a TLS-passthrough ingress for the client API&#x27;s ClusterIP service</td></tr><tr><td>clientApi.ingress.ingressClassName</td><td>string</td><td><code>&quot;&quot;</code></td><td>ingress class name, e.g., &quot;nginx&quot;</td></tr><tr><td>clientApi.ingress.labels</td><td>object</td><td><code>{}</code></td><td>ingress labels</td></tr><tr><td>clientApi.ingress.tls</td><td>object</td><td><code>{}</code></td><td>deprecated: tls passthrough is required</td></tr><tr><td>clientApi.service.enabled</td><td>bool</td><td><code>true</code></td><td>create a cluster service for the deployment</td></tr><tr><td>clientApi.service.type</td><td>string</td><td><code>&quot;LoadBalancer&quot;</code></td><td>expose the service as a ClusterIP, NodePort, or LoadBalancer</td></tr><tr><td>clientApi.traefikTcpRoute.enabled</td><td>bool</td><td><code>false</code></td><td>enable Traefik IngressRouteTCP</td></tr><tr><td>clientApi.traefikTcpRoute.entryPoints</td><td>list</td><td><code>[&quot;websecure&quot;]</code></td><td>IngressRouteTCP entrypoints</td></tr><tr><td>clientApi.traefikTcpRoute.labels</td><td>object</td><td><code>{}</code></td><td>IngressRouteTCP labels</td></tr><tr><td>consoleAltIngress</td><td>object</td><td><code>{}</code></td><td>override the address printed in Helm release notes if you configured an alternative DNS SAN for the console</td></tr><tr><td>ctrlPlane.advertisedHost</td><td>string</td><td><code>&quot;{{ .Values.clientApi.advertisedHost }}&quot;</code></td><td>global DNS name by which routers can resolve a reachable IP for this service: default is cluster service DNS name which assumes all routers are inside the same cluster</td></tr><tr><td>ctrlPlane.advertisedPort</td><td>string</td><td><code>&quot;{{ .Values.clientApi.advertisedPort }}&quot;</code></td><td>cluster service, node port, load balancer, and ingress port</td></tr><tr><td>ctrlPlane.alternativeIssuer</td><td>object</td><td><code>{}</code></td><td>obtain the ctrl plane identity from an existing issuer instead of generating a new PKI</td></tr><tr><td>ctrlPlane.containerPort</td><td>string</td><td><code>&quot;{{ .Values.clientApi.containerPort }}&quot;</code></td><td>cluster service target port on the container</td></tr><tr><td>ctrlPlane.dnsNames</td><td>list</td><td><code>[]</code></td><td>besides advertisedHost, add these DNS SANs to the ctrl plane identity and any ctrl plane ingresses</td></tr><tr><td>ctrlPlane.ingress.annotations</td><td>object</td><td><code>{}</code></td><td>ingress annotations, e.g., to configure ingress-nginx</td></tr><tr><td>ctrlPlane.ingress.enabled</td><td>bool</td><td><code>false</code></td><td>create an ingress for the cluster service</td></tr><tr><td>ctrlPlane.ingress.ingressClassName</td><td>string</td><td><code>&quot;&quot;</code></td><td>ingress class name, e.g., &quot;nginx&quot;</td></tr><tr><td>ctrlPlane.ingress.labels</td><td>object</td><td><code>{}</code></td><td>ingress labels</td></tr><tr><td>ctrlPlane.ingress.tls</td><td>object</td><td><code>{}</code></td><td>deprecated: tls passthrough is required</td></tr><tr><td>ctrlPlane.service.enabled</td><td>bool</td><td><code>false</code></td><td>create a separate cluster service for the ctrl plane; enabling this requires you to also set the host and port for a separate ctrl plane TLS listener</td></tr><tr><td>ctrlPlane.service.type</td><td>string</td><td><code>&quot;ClusterIP&quot;</code></td><td>expose the service as a ClusterIP, NodePort, or LoadBalancer</td></tr><tr><td>ctrlPlane.traefikTcpRoute.enabled</td><td>bool</td><td><code>false</code></td><td>enable Traefik IngressRouteTCP</td></tr><tr><td>ctrlPlane.traefikTcpRoute.entryPoints</td><td>list</td><td><code>[&quot;websecure&quot;]</code></td><td>IngressRouteTCP entrypoints</td></tr><tr><td>ctrlPlane.traefikTcpRoute.labels</td><td>object</td><td><code>{}</code></td><td>IngressRouteTCP labels</td></tr><tr><td>ctrlPlaneCasBundle.namespaceSelector</td><td>object</td><td><code>{}</code></td><td>namespaces where trust-manager will create the Bundle resource containing Ziti&#x27;s trusted CA certs (default: empty means all namespaces)</td></tr><tr><td>customAdminSecretName</td><td>string</td><td><code>&quot;&quot;</code></td><td>set the admin user and password from a custom secret The custom admin secret must be of the following format: apiVersion: v1 kind: Secret metadata:   name: myCustomAdminSecret type: Opaque data:   admin-user:   admin-password:</td></tr><tr><td>dbFile</td><td>string</td><td><code>&quot;ctrl.db&quot;</code></td><td>name of the BoltDB file</td></tr><tr><td>edgeSignerPki.admin_client_cert</td><td>object</td><td><code>{&quot;duration&quot;:&quot;8760h&quot;,&quot;enabled&quot;:false,&quot;renewBefore&quot;:&quot;720h&quot;}</code></td><td>metadata name of the alternative issuer name:</td></tr><tr><td>edgeSignerPki.admin_client_cert.duration</td><td>string</td><td><code>&quot;8760h&quot;</code></td><td>admin client certificate duration as Go time.Duration</td></tr><tr><td>edgeSignerPki.admin_client_cert.enabled</td><td>bool</td><td><code>false</code></td><td>create a client certificate for the admin user</td></tr><tr><td>edgeSignerPki.admin_client_cert.renewBefore</td><td>string</td><td><code>&quot;720h&quot;</code></td><td>renew admin client certificate before expiry as Go time.Duration</td></tr><tr><td>edgeSignerPki.alternativeIssuer</td><td>object</td><td><code>{}</code></td><td>obtain the edge signer intermediate CA from an existing issuer instead of generating a new PKI</td></tr><tr><td>edgeSignerPki.enabled</td><td>bool</td><td><code>true</code></td><td>generate a separate PKI root of trust for the edge signer CA</td></tr><tr><td>env</td><td>object</td><td><code>{}</code></td><td>set name to value in containers&#x27; environment</td></tr><tr><td>envSecrets</td><td>object</td><td><code>{}</code></td><td>set secrets as environment variables in the container</td></tr><tr><td>fabric.events.enabled</td><td>bool</td><td><code>false</code></td><td>enable fabric event logger and file handler</td></tr><tr><td>fabric.events.fileName</td><td>string</td><td><code>&quot;fabric-events.json&quot;</code></td><td></td></tr><tr><td>fabric.events.mountDir</td><td>string</td><td><code>&quot;/var/run/ziti&quot;</code></td><td></td></tr><tr><td>fabric.events.network.intervalAgeThreshold</td><td>string</td><td><code>&quot;5s&quot;</code></td><td>matching interval age and reporting interval ensures coherent metrics from fabric events</td></tr><tr><td>fabric.events.network.metricsReportInterval</td><td>string</td><td><code>&quot;5s&quot;</code></td><td>matching interval age and reporting interval ensures coherent metrics from fabric events</td></tr><tr><td>fabric.events.subscriptions[0].type</td><td>string</td><td><code>&quot;fabric.circuits&quot;</code></td><td></td></tr><tr><td>fabric.events.subscriptions[1].type</td><td>string</td><td><code>&quot;fabric.links&quot;</code></td><td></td></tr><tr><td>fabric.events.subscriptions[2].type</td><td>string</td><td><code>&quot;fabric.routers&quot;</code></td><td></td></tr><tr><td>fabric.events.subscriptions[3].type</td><td>string</td><td><code>&quot;fabric.terminators&quot;</code></td><td></td></tr><tr><td>fabric.events.subscriptions[4].metricFilter</td><td>string</td><td><code>&quot;.*&quot;</code></td><td></td></tr><tr><td>fabric.events.subscriptions[4].sourceFilter</td><td>string</td><td><code>&quot;.*&quot;</code></td><td></td></tr><tr><td>fabric.events.subscriptions[4].type</td><td>string</td><td><code>&quot;metrics&quot;</code></td><td></td></tr><tr><td>fabric.events.subscriptions[5].type</td><td>string</td><td><code>&quot;edge.sessions&quot;</code></td><td></td></tr><tr><td>fabric.events.subscriptions[6].type</td><td>string</td><td><code>&quot;edge.apiSessions&quot;</code></td><td></td></tr><tr><td>fabric.events.subscriptions[7].type</td><td>string</td><td><code>&quot;fabric.usage&quot;</code></td><td></td></tr><tr><td>fabric.events.subscriptions[7].version</td><td>int</td><td><code>3</code></td><td></td></tr><tr><td>fabric.events.subscriptions[8].type</td><td>string</td><td><code>&quot;services&quot;</code></td><td></td></tr><tr><td>fabric.events.subscriptions[9].interval</td><td>string</td><td><code>&quot;5s&quot;</code></td><td></td></tr><tr><td>fabric.events.subscriptions[9].type</td><td>string</td><td><code>&quot;edge.entityCounts&quot;</code></td><td></td></tr><tr><td>highAvailability.mode</td><td>string</td><td><code>&quot;standalone&quot;</code></td><td>Ziti controller HA mode</td></tr><tr><td>highAvailability.replicas</td><td>int</td><td><code>1</code></td><td>Ziti controller HA swarm replicas</td></tr><tr><td>image.additionalArgs</td><td>list</td><td><code>[]</code></td><td>additional arguments can be passed directly to the container to modify ziti runtime arguments</td></tr><tr><td>image.args</td><td>list</td><td><code>[&quot;{{ include \&quot;configMountDir\&quot; . }}/ziti-controller.yaml&quot;]</code></td><td>args for the entrypoint command</td></tr><tr><td>image.command</td><td>list</td><td><code>[&quot;ziti&quot;,&quot;controller&quot;,&quot;run&quot;]</code></td><td>container entrypoint command</td></tr><tr><td>image.homeDir</td><td>string</td><td><code>&quot;/home/ziggy&quot;</code></td><td>homeDir for admin login shell must align with container image&#x27;s ~/.bashrc for ziti CLI auto-complete to work</td></tr><tr><td>image.pullPolicy</td><td>string</td><td><code>&quot;IfNotPresent&quot;</code></td><td>deployment image pull policy</td></tr><tr><td>image.repository</td><td>string</td><td><code>&quot;docker.io/openziti/ziti-controller&quot;</code></td><td>container image repository for app deployment</td></tr><tr><td>image.tag</td><td>string</td><td><code>&quot;&quot;</code></td><td>override the container image tag specified in the chart</td></tr><tr><td>managementApi</td><td>object</td><td><code>{&quot;advertisedHost&quot;:&quot;{{ .Values.clientApi.advertisedHost }}&quot;,&quot;advertisedPort&quot;:&quot;{{ .Values.clientApi.advertisedPort }}&quot;,&quot;altDnsNames&quot;:[],&quot;containerPort&quot;:1281,&quot;dnsNames&quot;:[],&quot;ingress&quot;:{&quot;annotations&quot;:{},&quot;enabled&quot;:false,&quot;ingressClassName&quot;:&quot;&quot;,&quot;labels&quot;:{},&quot;tls&quot;:{}},&quot;service&quot;:{&quot;enabled&quot;:false,&quot;type&quot;:&quot;ClusterIP&quot;},&quot;traefikTcpRoute&quot;:{&quot;enabled&quot;:false,&quot;entryPoints&quot;:[&quot;websecure&quot;],&quot;labels&quot;:{}}}</code></td><td>by default, there&#x27;s no need for a separate cluster service, ingress, or load balancer for the management API because it shares a TLS listener with the client API, and is reachable at the same address and presents the same web identity cert; you may configure a separate service, ingress, load balancer, etc.  for the management API by setting managementApi.service.enabled=true</td></tr><tr><td>managementApi.advertisedHost</td><td>string</td><td><code>&quot;{{ .Values.clientApi.advertisedHost }}&quot;</code></td><td>global DNS name by which routers can resolve a reachable IP for this service</td></tr><tr><td>managementApi.advertisedPort</td><td>string</td><td><code>&quot;{{ .Values.clientApi.advertisedPort }}&quot;</code></td><td>cluster service, node port, load balancer, and ingress port</td></tr><tr><td>managementApi.altDnsNames</td><td>list</td><td><code>[]</code></td><td>besides advertisedHost and dnsNames, add these DNS SANs to any mgmt api ingresses, but not the web identity</td></tr><tr><td>managementApi.containerPort</td><td>int</td><td><code>1281</code></td><td>cluster service target port on the container</td></tr><tr><td>managementApi.dnsNames</td><td>list</td><td><code>[]</code></td><td>besides advertisedHost, add these DNS SANs to the web identity and any mgmt api ingresses</td></tr><tr><td>managementApi.ingress.annotations</td><td>object</td><td><code>{}</code></td><td>ingress annotations, e.g., to configure ingress-nginx</td></tr><tr><td>managementApi.ingress.enabled</td><td>bool</td><td><code>false</code></td><td>create a TLS-passthrough ingress for the client API&#x27;s ClusterIP service</td></tr><tr><td>managementApi.ingress.ingressClassName</td><td>string</td><td><code>&quot;&quot;</code></td><td>ingress class name, e.g., &quot;nginx&quot;</td></tr><tr><td>managementApi.ingress.labels</td><td>object</td><td><code>{}</code></td><td>ingress labels</td></tr><tr><td>managementApi.ingress.tls</td><td>object</td><td><code>{}</code></td><td>deprecated: tls passthrough is required</td></tr><tr><td>managementApi.service.enabled</td><td>bool</td><td><code>false</code></td><td>create a cluster service for the deployment</td></tr><tr><td>managementApi.service.type</td><td>string</td><td><code>&quot;ClusterIP&quot;</code></td><td>expose the service as a ClusterIP, NodePort, or LoadBalancer</td></tr><tr><td>managementApi.traefikTcpRoute.enabled</td><td>bool</td><td><code>false</code></td><td>enable Traefik IngressRouteTCP</td></tr><tr><td>managementApi.traefikTcpRoute.entryPoints</td><td>list</td><td><code>[&quot;websecure&quot;]</code></td><td>IngressRouteTCP entrypoints</td></tr><tr><td>managementApi.traefikTcpRoute.labels</td><td>object</td><td><code>{}</code></td><td>IngressRouteTCP labels</td></tr><tr><td>network.createCircuitRetries</td><td>int</td><td><code>2</code></td><td>createCircuitRetries controls the number of retries that will be attempted to create a path (and terminate it) for new circuits.</td></tr><tr><td>network.cycleSeconds</td><td>int</td><td><code>15</code></td><td>Defines the period that the controller re-evaluates the performance of all of the circuits running on the network.</td></tr><tr><td>network.initialLinkLatency</td><td>string</td><td><code>&quot;65s&quot;</code></td><td>Sets the latency of link when it&#x27;s first created. Will be overwritten as soon as latency from the link is actually reported from the routers. Defaults to 65 seconds.</td></tr><tr><td>network.minRouterCost</td><td>int</td><td><code>10</code></td><td>Sets router minimum cost. Defaults to 10</td></tr><tr><td>network.pendingLinkTimeoutSeconds</td><td>int</td><td><code>10</code></td><td>pendingLinkTimeoutSeconds controls how long we&#x27;ll wait before creating a new link between routers where there isn&#x27;t an established link, but a link request has been sent</td></tr><tr><td>network.routeTimeoutSeconds</td><td>int</td><td><code>10</code></td><td>routeTimeoutSeconds controls the number of seconds the controller will wait for a route attempt to succeed.</td></tr><tr><td>network.routerConnectChurnLimit</td><td>string</td><td><code>&quot;1m&quot;</code></td><td>Sets how often a new control channel connection can take over for a router with an existing control channel connection Defaults to 1 minute</td></tr><tr><td>network.smart.rerouteCap</td><td>int</td><td><code>4</code></td><td>Defines the hard upper limit of underperforming circuits that are candidates to be re-routed. If smart routing detects 100 circuits that are underperforming, and <code>smart.rerouteCap</code> is set to <code>1</code>, and <code>smart.rerouteFraction</code> is set to <code>0.02</code>, then the upper limit of circuits that will be re-routed in this <code>cycleSeconds</code> period will be limited to 1.</td></tr><tr><td>network.smart.rerouteFraction</td><td>float</td><td><code>0.02</code></td><td>Defines the fractional upper limit of underperforming circuits that are candidates to be re-routed. If smart routing detects 100 circuits that are underperforming, and <code>smart.rerouteFraction</code> is set to <code>0.02</code>, then the upper limit of circuits that will be re-routed in this <code>cycleSeconds</code> period will be limited to 2 (2% of 100).</td></tr><tr><td>nodeSelector</td><td>object</td><td><code>{}</code></td><td>deployment template spec node selector</td></tr><tr><td>persistence.VolumeName</td><td>string</td><td><code>&quot;&quot;</code></td><td>PVC volume name</td></tr><tr><td>persistence.accessMode</td><td>string</td><td><code>&quot;ReadWriteOnce&quot;</code></td><td>PVC access mode: ReadWriteOnce (concurrent mounts not allowed), ReadWriteMany (concurrent allowed)</td></tr><tr><td>persistence.annotations</td><td>object</td><td><code>{}</code></td><td>annotations for the PVC</td></tr><tr><td>persistence.enabled</td><td>bool</td><td><code>true</code></td><td>required: place a storage claim for the BoltDB persistent volume</td></tr><tr><td>persistence.existingClaim</td><td>string</td><td><code>&quot;&quot;</code></td><td>A manually managed Persistent Volume and Claim Requires persistence.enabled=true. If defined, PVC must be created manually before volume will be bound.</td></tr><tr><td>persistence.size</td><td>string</td><td><code>&quot;2Gi&quot;</code></td><td>2GiB is enough for tens of thousands of entities, but feel free to make it larger</td></tr><tr><td>persistence.storageClass</td><td>string</td><td><code>&quot;&quot;</code></td><td>Storage class of PV to bind. By default it looks for the default storage class. If the PV uses a different storage class, specify that here.</td></tr><tr><td>podAnnotations</td><td>object</td><td><code>{}</code></td><td>annotations to apply to all pods deployed by this chart</td></tr><tr><td>podSecurityContext</td><td>object</td><td><code>{&quot;fsGroup&quot;:2171}</code></td><td>deployment template spec security context</td></tr><tr><td>podSecurityContext.fsGroup</td><td>int</td><td><code>2171</code></td><td>the GID of the group that should own any files created by the container, especially the BoltDB file</td></tr><tr><td>prometheus.advertisedHost</td><td>string</td><td><code>&quot;&quot;</code></td><td>DNS name to advertise in place of the default internal cluster name built from the Helm release name</td></tr><tr><td>prometheus.advertisedPort</td><td>int</td><td><code>443</code></td><td>cluster service, node port, load balancer, and ingress port</td></tr><tr><td>prometheus.containerPort</td><td>int</td><td><code>9090</code></td><td>cluster service target port on the container</td></tr><tr><td>prometheus.maxTLSVersion</td><td>string</td><td><code>&quot;TLS1.3&quot;</code></td><td>maximum TLS version to offer to clients</td></tr><tr><td>prometheus.minTLSVersion</td><td>string</td><td><code>&quot;TLS1.2&quot;</code></td><td>minimum TLS version to offer to clients</td></tr><tr><td>prometheus.service.annotations</td><td>object</td><td><code>{}</code></td><td></td></tr><tr><td>prometheus.service.enabled</td><td>bool</td><td><code>false</code></td><td>create a cluster service for the deployment</td></tr><tr><td>prometheus.service.labels</td><td>object</td><td><code>{&quot;app&quot;:&quot;prometheus&quot;}</code></td><td>extra labels for matching only this service, ie. serviceMonitor</td></tr><tr><td>prometheus.service.type</td><td>string</td><td><code>&quot;ClusterIP&quot;</code></td><td>expose the service as a ClusterIP, NodePort, or LoadBalancer</td></tr><tr><td>prometheus.serviceMonitor.annotations</td><td>object</td><td><code>{}</code></td><td>ServiceMonitor annotations</td></tr><tr><td>prometheus.serviceMonitor.enabled</td><td>bool</td><td><code>true</code></td><td>If enabled, and prometheus service is enabled, ServiceMonitor resources for Prometheus Operator are created</td></tr><tr><td>prometheus.serviceMonitor.interval</td><td>string</td><td><code>nil</code></td><td>ServiceMonitor scrape interval</td></tr><tr><td>prometheus.serviceMonitor.labels</td><td>object</td><td><code>{}</code></td><td>Additional ServiceMonitor labels</td></tr><tr><td>prometheus.serviceMonitor.metricRelabelings</td><td>list</td><td><code>[]</code></td><td>ServiceMonitor relabel configs to apply to samples as the last step before ingestion (<a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration" target="_blank" rel="noopener noreferrer">reference</a>)</td></tr><tr><td>prometheus.serviceMonitor.namespace</td><td>string</td><td><code>nil</code></td><td>Alternative namespace for ServiceMonitor resources</td></tr><tr><td>prometheus.serviceMonitor.namespaceSelector</td><td>object</td><td><code>{}</code></td><td>Namespace selector for ServiceMonitor resources</td></tr><tr><td>prometheus.serviceMonitor.relabelings</td><td>list</td><td><code>[]</code></td><td>ServiceMonitor relabel configs to apply to samples before scraping (defines <code>relabel_configs</code>;  <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration" target="_blank" rel="noopener noreferrer">reference</a>)</td></tr><tr><td>prometheus.serviceMonitor.scheme</td><td>string</td><td><code>&quot;https&quot;</code></td><td>ServiceMonitor will use http by default, but you can pick https as well</td></tr><tr><td>prometheus.serviceMonitor.scrapeTimeout</td><td>string</td><td><code>nil</code></td><td>ServiceMonitor scrape timeout in Go duration format (e.g. 15s)</td></tr><tr><td>prometheus.serviceMonitor.targetLabels</td><td>list</td><td><code>[]</code></td><td>ServiceMonitor will add labels from the service to the Prometheus metric (<a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration" target="_blank" rel="noopener noreferrer">reference</a>)</td></tr><tr><td>prometheus.serviceMonitor.tlsConfig</td><td>object</td><td><code>{&quot;insecureSkipVerify&quot;:true}</code></td><td>ServiceMonitor will use these tlsConfig settings to make the health check requests</td></tr><tr><td>prometheus.serviceMonitor.tlsConfig.insecureSkipVerify</td><td>bool</td><td><code>true</code></td><td>set TLS skip verify, because the SAN will not match with the pod IP</td></tr><tr><td>resources</td><td>object</td><td><code>{}</code></td><td>deployment container resources</td></tr><tr><td>securityContext</td><td>object</td><td><code>{}</code></td><td>deployment container security context</td></tr><tr><td>spireAgent.enabled</td><td>bool</td><td><code>false</code></td><td>if you are running a container with the spire-agent binary installed then this will allow you to add the hostpath necessary for connecting to the spire socket</td></tr><tr><td>spireAgent.spireSocketMnt</td><td>string</td><td><code>&quot;/run/spire/sockets&quot;</code></td><td>file path of the spire socket mount</td></tr><tr><td>tolerations</td><td>list</td><td><code>[]</code></td><td>deployment template spec tolerations</td></tr><tr><td>trustDomain</td><td>string</td><td><code>&quot;&quot;</code></td><td>permanent SPIFFE ID to use for this controller&#x27;s trust domain (default: random, fixed for the life of the chart release)</td></tr><tr><td>useCustomAdminSecret</td><td>bool</td><td><code>false</code></td><td>allow for using a custom admin secret, which has to be created beforehand if enabled, the admin secret will not be generated by this Helm chart</td></tr><tr><td>webBindingPki.altServerCerts</td><td>list</td><td><code>[]</code></td><td></td></tr><tr><td>webBindingPki.alternativeIssuer</td><td>object</td><td><code>{}</code></td><td>obtain the web identity from an existing issuer instead of generating a new PKI</td></tr><tr><td>webBindingPki.enabled</td><td>bool</td><td><code>true</code></td><td>generate a separate PKI root of trust for web bindings, i.e., client, management, and prometheus APIs</td></tr><tr><td>webBindingPki.maxTLSVersion</td><td>string</td><td><code>&quot;TLS1.3&quot;</code></td><td>maximum TLS version to offer to clients</td></tr><tr><td>webBindingPki.minTLSVersion</td><td>string</td><td><code>&quot;TLS1.2&quot;</code></td><td>minimum TLS version to offer to clients</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="todos">TODO&#x27;s<a href="#todos" class="hash-link" aria-label="Direct link to TODO&#x27;s" title="Direct link to TODO&#x27;s">​</a></h2>
<ul>
<li>High availability clustered mode</li>
<li>Deploy Prometheus scraper configuration when <code>prometheus.enabled = true</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="alternative-web-server-certificates">Alternative Web Server Certificates<a href="#alternative-web-server-certificates" class="hash-link" aria-label="Direct link to Alternative Web Server Certificates" title="Direct link to Alternative Web Server Certificates">​</a></h2>
<p>The purpose of the <code>alt_server_certs</code> feature is to bind a publicly trusted server certificate to the controller&#x27;s web listener. This is useful for publishing the controller&#x27;s client API with a different DNS name for BrowZer and console clients that must verify the controller&#x27;s identity with their OS trusted root store.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="request-an-alternative-server-certificate-from-a-cert-manager-issuer">Request an alternative server certificate from a cert-manager issuer<a href="#request-an-alternative-server-certificate-from-a-cert-manager-issuer" class="hash-link" aria-label="Direct link to Request an alternative server certificate from a cert-manager issuer" title="Direct link to Request an alternative server certificate from a cert-manager issuer">​</a></h3>
<p>The most automatic way to bind an alt cert is the certManager mode provided by this chart. This example implies you have separately created a cert-manager ClusterIssuer named &quot;cloudflare-dns01-issuer&quot; that is able to obtain a certificate for the specified DNS name. If publishing the client API&#x27;s alternative DNS name as a separate Ingress, you may reference that advertised host when requesting the alternative server certificate as shown here with an inline template to ensure they match.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">clientApi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">advertisedHost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> edge.ziti.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ingress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ingressClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/ingress.allow-http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;false&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">nginx.ingress.kubernetes.io/ssl-passthrough</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">altDnsNames</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;alt-edge.ziti.example.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">webBindingPki</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">altServerCerts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> certManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">secretName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">dnsNames</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ .Values.clientApi.altDnsNames[0] }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">issuerRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">group</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cert</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">manager.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterIssuer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cloudflare</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dns01</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">issuer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/ziti/alt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cert</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-an-alternative-certificate-and-key-from-a-tls-secret">Use an alternative certificate and key from a tls secret<a href="#use-an-alternative-certificate-and-key-from-a-tls-secret" class="hash-link" aria-label="Direct link to Use an alternative certificate and key from a tls secret" title="Direct link to Use an alternative certificate and key from a tls secret">​</a></h3>
<p>The alternative server certificate and key may also be provided from a Kubernetes TLS secret. Declare the tls secret in the additionalVolumes section and reference it in the altServerCerts section.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">additionalVolumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumeType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/ziti/my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">secretName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">webBindingPki</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">altServerCerts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">secretName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cert</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/guides/deployments/30-kubernetes/kubernetes-controller.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-08-06T20:38:23.000Z" itemprop="dateModified">Aug 6, 2025</time></b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/kubernetes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Kubernetes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/guides/deployments/kubernetes/kubernetes-router"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Router</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a><ul><li><a href="#mutual-tls" class="table-of-contents__link toc-highlight">Mutual TLS</a></li><li><a href="#certificates" class="table-of-contents__link toc-highlight">Certificates</a></li><li><a href="#deployment" class="table-of-contents__link toc-highlight">Deployment</a></li><li><a href="#custom-resources" class="table-of-contents__link toc-highlight">Custom Resources</a></li><li><a href="#breaking-change" class="table-of-contents__link toc-highlight">Breaking Change</a></li></ul></li><li><a href="#nodeport-service-example" class="table-of-contents__link toc-highlight">NodePort Service Example</a></li><li><a href="#nginx-ingress-example" class="table-of-contents__link toc-highlight">Nginx Ingress Example</a></li><li><a href="#traefik-ingressroutetcp-example" class="table-of-contents__link toc-highlight">Traefik IngressRouteTCP Example</a></li><li><a href="#admin-user-and-password" class="table-of-contents__link toc-highlight">Admin User and Password</a></li><li><a href="#extra-security-for-the-management-api" class="table-of-contents__link toc-highlight">Extra Security for the Management API</a></li><li><a href="#advanced-pki" class="table-of-contents__link toc-highlight">Advanced PKI</a></li><li><a href="#prometheus-monitoring" class="table-of-contents__link toc-highlight">Prometheus Monitoring</a></li><li><a href="#values-reference" class="table-of-contents__link toc-highlight">Values Reference</a></li><li><a href="#todos" class="table-of-contents__link toc-highlight">TODO&#39;s</a></li><li><a href="#alternative-web-server-certificates" class="table-of-contents__link toc-highlight">Alternative Web Server Certificates</a><ul><li><a href="#request-an-alternative-server-certificate-from-a-cert-manager-issuer" class="table-of-contents__link toc-highlight">Request an alternative server certificate from a cert-manager issuer</a></li><li><a href="#use-an-alternative-certificate-and-key-from-a-tls-secret" class="table-of-contents__link toc-highlight">Use an alternative certificate and key from a tls secret</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="ozLayoutFooter_Elxg ozFooter_Avh_"><section class="footer_TVlg ozHorizontalSectionRoot_MIa6 ozhsContent_Tzp1"><div class="footerContainer_otJT"><div class="footerGrid_DfDa"><div class="footerColumn_aKLl"><h3>OpenZiti</h3><p>An open source project enabling developers to embed zero trust networking directly into applications.</p><div class="footerSocialLinks_HWin"><a href="https://github.com/openziti/ziti" target="_blank" class="footerSocialLink_t5Hs"><svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"></path></svg></a><a href="https://www.linkedin.com/company/netfoundry" target="_blank" class="footerSocialLink_t5Hs"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.996 16V10.1C15.996 7.5 15.375 5.49999 12.025 5.49999C10.4 5.49999 9.325 6.39999 8.875 7.29999H8.825V5.79999H5.65V16H8.95V10.7C8.95 9.30001 9.2 7.9 10.925 7.9C12.65 7.9 12.675 9.59999 12.675 10.8V16H15.996Z"></path><path d="M0.25 5.79999H3.575V16H0.25V5.79999Z"></path><path d="M1.9 0C0.85 0 0 0.85 0 1.9C0 2.95 0.85 3.8 1.9 3.8C2.95 3.8 3.8 2.95 3.8 1.9C3.8 0.85 2.95 0 1.9 0Z"></path></svg></a><a href="https://www.youtube.com/OpenZiti" target="_blank" class="footerSocialLink_t5Hs"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.969 4.69c-.183-1.358-1.062-2.275-2.361-2.46C12.371 2 8 2 8 2S3.629 2 2.362 2.229c-1.3.186-2.179 1.103-2.361 2.461C0 6.03 0 10 0 10s0 3.97.2 5.31c.183 1.358 1.062 2.275 2.361 2.46C3.63 18 8 18 8 18s4.371 0 5.638-.23c1.3-.185 2.178-1.102 2.361-2.46.2-1.34.2-5.31.2-5.31s0-3.97-.23-5.31zm-8.36, 8.57V6.73l3.76 2.27-3.76 2.26z"></path></svg></a><a href="https://x.com/OpenZiti" target="_blank" class="footerSocialLink_t5Hs"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.996 3.038c-.59.262-1.219.44-1.885.52.677-.406 1.194-1.05 1.438-1.815-.634.375-1.337.648-2.085.795-.598-.638-1.45-1.038-2.396-1.038-1.813 0-3.283 1.469-3.283 3.282 0 .257.03.507.085.748-2.728-.137-5.147-1.445-6.766-3.43-.282.485-.444 1.05-.444 1.651 0 1.14.58 2.143 1.46 2.732-.538-.017-1.044-.164-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.219-.276.075-.567.116-.866.116-.211 0-.416-.021-.617-.06.418 1.304 1.63 2.254 3.066 2.28-1.124.883-2.539 1.406-4.077 1.406-.265 0-.526-.015-.785-.046 1.453.933 3.178 1.475 5.032 1.475 6.038 0 9.34-5.002 9.34-9.34 0-.142-.004-.284-.01-.425.641-.463 1.198-1.039 1.638-1.696"></path></svg></a></div></div><div class="footerColumn_aKLl"><h3>Documentation</h3><ul class="footerLinks_fOY0"><li><a href="/docs/learn/quickstarts/services/ztha">Getting Started</a></li><li><a href="/docs/reference/developer/api/">API Reference</a></li><li><a href="/docs/reference/developer/sdk/">SDK Integration</a></li></ul></div><div class="footerColumn_aKLl"><h3>Community</h3><ul class="footerLinks_fOY0"><li><a href="https://github.com/openziti/ziti">GitHub</a></li><li><a href="https://openziti.discourse.group/">Discourse Forum</a></li><li><a href="/policies/CONTRIBUTING">Contributing</a></li></ul></div><div class="footerColumn_aKLl"><h3>Resources</h3><ul class="footerLinks_fOY0"><li><a href="https://blog.openziti.io">Blog</a></li><li><a href="https://netfoundry.io/">NetFoundry</a></li></ul></div></div></div><div class="footerCopyright_W7lP"><p>© 2025 NetFoundry Inc. OpenZiti is an open source project sponsored by NetFoundry. All rights reserved.</p></div></section></footer></div></div>
</body>
</html>