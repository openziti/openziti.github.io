<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/topologies/services" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Service Topologies | OpenZiti</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openziti.io/docs/guides/topologies/services"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="robots" content="index, follow"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Service Topologies | OpenZiti"><meta data-rh="true" name="description" content="3.0 Ziti services"><meta data-rh="true" property="og:description" content="3.0 Ziti services"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://openziti.io/docs/guides/topologies/services"><link data-rh="true" rel="alternate" href="https://openziti.io/docs/guides/topologies/services" hreflang="en"><link data-rh="true" rel="alternate" href="https://openziti.io/docs/guides/topologies/services" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EXWPKK5PV4-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Topologies","item":"https://openziti.io/docs/category/topologies"},{"@type":"ListItem","position":2,"name":"Services","item":"https://openziti.io/docs/guides/topologies/services"}]}</script><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-5SF399H3",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>





<link rel="search" type="application/opensearchdescription+xml" title="OpenZiti" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.90eb4e20.css">
<script src="/assets/js/runtime~main.784a4a05.js" defer="defer"></script>
<script src="/assets/js/main.aba3a404.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5SF399H3" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>




<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/ziti-logo-dark.svg"><link rel="preload" as="image" href="/img/ziti-logo-light.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="starUsRoot_Cir2"><span style="color:whitesmoke">Star us on GitHubÂ </span><span style="height:20px"><span><a href="https://github.com/openziti/ziti" data-icon="octicon-star" data-show-count="true" aria-label="Star buttons/github-buttons on GitHub">Star</a></span></span></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://openziti.io" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/ziti-logo-dark.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/ziti-logo-light.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item"><a class="navbar__item navbar__link header-netfoundry-link" href="https://netfoundry.io/products/netfoundry-cloud-30-day-free-trial/" target="_blank">NetFoundry</a></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/learn/introduction/">Documentation</a><a class="navbar__item navbar__link" href="/docs/downloads">Downloads</a><div class="navbar__item"><a class="navbar__item navbar__link header-netfoundry-link" href="https://blog.openziti.io/" target="_blank">Blog</a></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Links</a><ul class="dropdown__menu"><li class=""><div class="text-divider"><p>Socials</p></div></li><li class=""><a href="https://www.youtube.com/OpenZiti" target="_blank" title="OpenZiti on YouTube"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/yt.svg">YouTube</span></a></li><li class=""><a href="https://x.com/OpenZiti" target="_blank" title="OpenZiti on X(formerly Twitter)"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/twit.svg">X (Twitter)</span></a></li><li class=""><a href="https://www.reddit.com/r/openziti" target="_blank" title="OpenZiti Subreddit"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/reddit-logo.png">Reddit</span></a></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/ziggy.png"><a href="https://x.com/OpenZiggy" target="_blank" title="OpenZiggy on X(formerly Twitter)">Ziggy</a></span></li><li class=""><div class="text-divider"><p>Other</p></div></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/blog-icon.png"><a href="https://blog.openziti.io/" target="_blank" title="Blog">Blog</a></span></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/oz-test-kitchen.png"><a href="https://github.com/openziti-test-kitchen" target="_blank" title="Git project for the test kitchen">Test Kitchen</a></span></li></ul></div><a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discourse-link" title="Discourse"></a><a href="https://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_eExm"><div class="wrapperDiv_MU_d"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 sidebar-title"><a class="menu__link" href="/docs/learn/introduction/">LEARN</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/learn/introduction/">What is OpenZiti?</a><button aria-label="Expand sidebar category &#x27;What is OpenZiti?&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/learn/quickstarts/">Quickstarts</a><button aria-label="Expand sidebar category &#x27;Quickstarts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/core-concepts">Core Concepts</a><button aria-label="Expand sidebar category &#x27;Core Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learn/identity-providers/">Identity Providers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 sidebar-title"><a class="menu__link" href="/docs/reference/">REFERENCE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference/configuration/conventions">Configuration</a><button aria-label="Expand sidebar category &#x27;Configuration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/reference/ha/overview">Controller Clustering</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference/tunnelers/">Tunnelers</a><button aria-label="Expand sidebar category &#x27;Tunnelers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/command-line/login">CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/logging">Logging</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference/config-types/">Config Types</a><button aria-label="Expand sidebar category &#x27;Config Types&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/events">Events</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference/developer/">Developer</a><button aria-label="Expand sidebar category &#x27;Developer&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 sidebar-title"><a class="menu__link" href="/docs/guides/">GUIDES</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guides/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/deployments">Deployments</a><button aria-label="Expand sidebar category &#x27;Deployments&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/guides/external-auth/">Configuring OIDC</a><button aria-label="Expand sidebar category &#x27;Configuring OIDC&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/guides/hsm/">Hardware Keys</a><button aria-label="Expand sidebar category &#x27;Hardware Keys&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/topologies">Topologies</a><button aria-label="Collapse sidebar category &#x27;Topologies&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/guides/topologies/services">Services</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/gateway">Gateway</a><button aria-label="Expand sidebar category &#x27;Gateway&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/troubleshooting">Troubleshooting</a><button aria-label="Expand sidebar category &#x27;Troubleshooting&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/topologies"><span>Topologies</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Services</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Service Topologies</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="30-ziti-services">3.0 Ziti services<a href="#30-ziti-services" class="hash-link" aria-label="Direct link to 3.0 Ziti services" title="Direct link to 3.0 Ziti services">â</a></h2>
<p>Ziti services take several forms in deployment environments. In this guide, we will highlight a few examples.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="31-introduction">3.1 Introduction<a href="#31-introduction" class="hash-link" aria-label="Direct link to 3.1 Introduction" title="Direct link to 3.1 Introduction">â</a></h2>
<p>In this guide, we will demonstrate ziti services with the following examples:</p>
<ul>
<li>connection between two identities running ziti-edge-tunnel (<a href="#311-network-diagram-1">Network Diagram 1</a>)</li>
<li>connection between ziti-edge-tunnel and a ziti-router (with tunnel enabled)(<a href="#312-network-diagram-2">Network Diagram 2</a>)</li>
<li>connection from a non-OpenZiti endpoint using router as GW(<a href="#312-network-diagram-2">Network Diagram 2</a>)</li>
<li>access a server from a SDK enabled application (<a href="#313-network-diagram-3">Network Diagram 3</a>)</li>
<li>access a SDK enabled application with an ziti client (<a href="#314-network-diagram-4">Network Diagram 4</a>)</li>
<li>SDK client connects to SDK server (<a href="#315-network-diagram-5">Network Diagram 5</a>)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="311-network-diagram-1">3.1.1 Network Diagram 1<a href="#311-network-diagram-1" class="hash-link" aria-label="Direct link to 3.1.1 Network Diagram 1" title="Direct link to 3.1.1 Network Diagram 1">â</a></h3>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services01-61792245b6072a2f6661db90a3661c8b.jpg" width="663" height="262" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="312-network-diagram-2">3.1.2 Network Diagram 2<a href="#312-network-diagram-2" class="hash-link" aria-label="Direct link to 3.1.2 Network Diagram 2" title="Direct link to 3.1.2 Network Diagram 2">â</a></h3>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services02-74cf8238fe137e14aa6ce35cd4b2751c.jpg" width="790" height="267" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="313-network-diagram-3">3.1.3 Network Diagram 3<a href="#313-network-diagram-3" class="hash-link" aria-label="Direct link to 3.1.3 Network Diagram 3" title="Direct link to 3.1.3 Network Diagram 3">â</a></h3>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services02-3-36e782ab138c2980d452073808f2c2b8.jpg" width="663" height="272" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="314-network-diagram-4">3.1.4 Network Diagram 4<a href="#314-network-diagram-4" class="hash-link" aria-label="Direct link to 3.1.4 Network Diagram 4" title="Direct link to 3.1.4 Network Diagram 4">â</a></h3>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services02-4-6e4a971bace90f40b329639943ee4122.jpg" width="688" height="282" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="315-network-diagram-5">3.1.5 Network Diagram 5<a href="#315-network-diagram-5" class="hash-link" aria-label="Direct link to 3.1.5 Network Diagram 5" title="Direct link to 3.1.5 Network Diagram 5">â</a></h3>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services02-5-c86479d34ff4112a02f80bf713168b55.jpg" width="713" height="224" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="32-set-up-vms-for-ziti-network">3.2 Set up VMs for ziti network<a href="#32-set-up-vms-for-ziti-network" class="hash-link" aria-label="Direct link to 3.2 Set up VMs for ziti network" title="Direct link to 3.2 Set up VMs for ziti network">â</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="321-controller">3.2.1 Controller<a href="#321-controller" class="hash-link" aria-label="Direct link to 3.2.1 Controller" title="Direct link to 3.2.1 Controller">â</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3212-cli">3.2.1.2 CLI<a href="#3212-cli" class="hash-link" aria-label="Direct link to 3.2.1.2 CLI" title="Direct link to 3.2.1.2 CLI">â</a></h4>
<p>You will need to login to controller to provision identities and service. Please make sure you are performing the action on the right node.</p>
<p>On the controller, before performing the CLI command, you will need to login first:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">zitiLogin</span><br></span></code></pre></div></div>
<p>The login token expires after some period of time. If the token expired, you will need to login again via the same command. You will see error message like this when the token expired:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">error: error listing https://161.35.108.218:8441/edge/management/v1/config-types?filter=id%3D%22host.v1%22 in Ziti Edge Controller. Status code: 401 Unauthorized, Server returned: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;error&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;code&quot;: &quot;UNAUTHORIZED&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;message&quot;: &quot;The request could not be completed. The session is not authorized or the credentials are invalid&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;requestId&quot;: &quot;7zxWCy7Vx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;meta&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;apiEnrollmentVersion&quot;: &quot;0.0.1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;apiVersion&quot;: &quot;0.0.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="322-router">3.2.2 Router<a href="#322-router" class="hash-link" aria-label="Direct link to 3.2.2 Router" title="Direct link to 3.2.2 Router">â</a></h3>
<p>We need two routers to complete our example in this guide.</p>
<ul>
<li>Public edge router (<strong>pub-er</strong>) was setup in the <a href="/docs/guides/deployments/cloud/router#23-create-and-set-up-router-directly-on-router-vm">Router setup section</a>, this router provides fabric and edge connection. It does not have tunneler functionality. Make sure you also modify the <a href="/docs/guides/deployments/cloud/router#29-firewall">Firewall</a> for this router.</li>
<li>Local edge router (<strong>local-er</strong>). Please follow the <a href="/docs/guides/deployments/cloud/router">Router guide</a> to setup a <a href="/docs/guides/deployments/cloud/router#2343-create-the-router-with-edge-listener-and-tunneler">Router with edge listener and tunneler</a>. For this router, you will need to setup <a href="/docs/guides/deployments/cloud/router#26-fix-the-resolver">Resolver</a>, <a href="/docs/guides/deployments/cloud/router#27-route-table">Route Table</a>, <a href="/docs/guides/deployments/cloud/router#28-source-and-destination-check">Source and Destination Check</a> and <a href="/docs/guides/deployments/cloud/router#29-firewall">Firewall</a>.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3221-zac">3.2.2.1 ZAC<a href="#3221-zac" class="hash-link" aria-label="Direct link to 3.2.2.1 ZAC" title="Direct link to 3.2.2.1 ZAC">â</a></h4>
<p>On the ZAC <strong>ROUTERS</strong> screen, you can check your router and make sure it is created correctly. You can also check the identity associated with the router by clicked on <strong>IDENTITIES</strong></p>
<p>On the <strong>ROUTERS</strong> screen, you will see two routers we created.</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services03-router-958eb8f321360ea5cebca5fd44fa60b1.jpg" width="1072" height="377" class="img_ev3q"></p>
<p>On the <strong>IDENTITIES</strong> screen, you will see an identity match &quot;local-er&quot; router name. If you perform the provisioning correctly, you should <strong>not</strong> see an identity name &quot;pub-er&quot;.</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services04-router-59da96bc899e178e00b7f6121496d003.jpg" width="1081" height="384" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3222-cli">3.2.2.2 CLI<a href="#3222-cli" class="hash-link" aria-label="Direct link to 3.2.2.2 CLI" title="Direct link to 3.2.2.2 CLI">â</a></h4>
<p>You can also check the provisioning on the <strong>controller</strong>.</p>
<p>You should see two routers named <strong>pub-er</strong> and <strong>local-er</strong></p>
<div class="language-buttonless codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Example</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-buttonless codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list edge-routers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â­âââââââââââââ¬ââââââââââââââââââââââââââââââ¬âââââââââ¬ââââââââââââââââ¬âââââââ¬âââââââââââââ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â ID         â NAME                        â ONLINE â ALLOW TRANSIT â COST â ATTRIBUTES â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââ¼ââââââââââââââââââââââââââââââ¼âââââââââ¼ââââââââââââââââ¼âââââââ¼âââââââââââââ¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â MvQnOZj4au â Public-Cloud-NC-edge-router â true   â true          â    0 â public     â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â k06PffZjT  â pub-er                      â true   â true          â    0 â            â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â nIaTfUZjT  â local-er                    â true   â true          â    0 â            â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â°âââââââââââââ´ââââââââââââââââââââââââââââââ´âââââââââ´ââââââââââââââââ´âââââââ´âââââââââââââ¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-3 of 3</span><br></span></code></pre></div></div>
<p>You should also see an identity named <strong>local-er</strong></p>
<div class="language-buttonless codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Example</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-buttonless codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list identities</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â­âââââââââââââ¬ââââââââââââââââââââââââââââââ¬âââââââââ¬âââââââââââââ¬ââââââââââââââ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â ID         â NAME                        â TYPE   â ATTRIBUTES â AUTH-POLICY â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââ¼ââââââââââââââââââââââââââââââ¼âââââââââ¼âââââââââââââ¼ââââââââââââââ¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â MvQnOZj4au â Public-Cloud-NC-edge-router â Router â            â default     â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â nIaTfUZjT  â local-er                    â Router â            â default     â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â oJCCNs6Xo  â Default Admin               â User   â            â default     â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â°âââââââââââââ´ââââââââââââââââââââââââââââââ´âââââââââ´âââââââââââââ´ââââââââââââââ¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-3 of 3</span><br></span></code></pre></div></div>
<p>Since the <strong>pub-er</strong> is also a link listener, you should also check the link listener function is correctly setup. Check the router on fabric to make sure it has LISTENERS (tls:****) displayed for the <strong>pub-er</strong>.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti fabric list routers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â­âââââââââââââ¬ââââââââââââââââââââââââââââââ¬âââââââââ¬âââââââ¬âââââââââââââââ¬âââââââââââ¬âââââââââââââââââââââââââ¬âââââââââââââââââââââââââââââ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â ID         â NAME                        â ONLINE â COST â NO TRAVERSAL â DISABLED â VERSION                â LISTENERS                  â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââ¼ââââââââââââââââââââââââââââââ¼âââââââââ¼âââââââ¼âââââââââââââââ¼âââââââââââ¼âââââââââââââââââââââââââ¼âââââââââââââââââââââââââââââ¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â MvQnOZj4au â Public-Cloud-NC-edge-router â true   â    0 â false        â false    â v0.27.9 on linux/amd64 â 1: tls:68.183.52.206:10080 â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â k06PffZjT  â pub-er                      â true   â    0 â false        â false    â v0.27.9 on linux/amd64 â 1: tls:159.203.175.189:80  â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â nIaTfUZjT  â local-er                    â true   â    0 â false        â false    â v0.27.9 on linux/amd64 â                            â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â°âââââââââââââ´ââââââââââââââââââââââââââââââ´âââââââââ´âââââââ´âââââââââââââââ´âââââââââââ´âââââââââââââââââââââââââ´âââââââââââââââââââââââââââââ¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-3 of 3</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="323-tunnelersidentities">3.2.3 Tunnelers/Identities<a href="#323-tunnelersidentities" class="hash-link" aria-label="Direct link to 3.2.3 Tunnelers/Identities" title="Direct link to 3.2.3 Tunnelers/Identities">â</a></h3>
<p>We need two tunnelers for our testing. Please follow <strong><a href="/docs/guides/deployments/cloud/controller#11-create-a-vm-to-be-used-as-the-controller">Create a VM section</a></strong> of the Controller Guide to create two VMs running Ubuntu 22.04.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3231-create-identity-with-zac">3.2.3.1 Create Identity with ZAC<a href="#3231-create-identity-with-zac" class="hash-link" aria-label="Direct link to 3.2.3.1 Create Identity with ZAC" title="Direct link to 3.2.3.1 Create Identity with ZAC">â</a></h4>
<p>To create Identities on ZAC, go to the Identities screen, and press <strong>+</strong> icon. On the <strong>CREATE IDENTITY</strong> widget, enter the <strong>NAME</strong> of the identity (Required and has to be unique). Leave the <strong>IDENTITY TYPE</strong> as &quot;Device&quot;. Leave the <strong>ENROLLMENT TYPE</strong> as &quot;One Time Token&quot;. Fill in other optional fields and press <strong>SAVE</strong>.</p>
<p>Create two identities:</p>
<ul>
<li>ingress-tunnel</li>
<li>egress-tunnel</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services05-CreateService-14fc00ea875e65dd6338082808248bf6.jpg" width="1085" height="1082" class="img_ev3q"></p>
<p>Once the identities are created, you can check the identities and download the <strong>JWT</strong> from the <strong>MANAGE IDENTITIES</strong> screen</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services06-CreateService-5b98a3fb5217a17fcb19187ffbc7c5f8.jpg" width="1084" height="487" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3232-create-identity-with-cli">3.2.3.2 Create Identity with CLI<a href="#3232-create-identity-with-cli" class="hash-link" aria-label="Direct link to 3.2.3.2 Create Identity with CLI" title="Direct link to 3.2.3.2 Create Identity with CLI">â</a></h4>
<p>Create two identities (ingress-tunnel, egress-tunnel) on the <strong>controller</strong>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create identity ingress-tunnel -o ingress-tunnel.jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create identity egress-tunnel -o egress-tunnel.jwt</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3233-register-identities">3.2.3.3 Register Identities<a href="#3233-register-identities" class="hash-link" aria-label="Direct link to 3.2.3.3 Register Identities" title="Direct link to 3.2.3.3 Register Identities">â</a></h4>
<p>Login to your VMs created earlier, follow <a href="/docs/reference/tunnelers/linux/">Install Linux Package</a> <strong>Ubuntu Jammy 22.04</strong> section to install and register your ziti-edge-tunnel.</p>
<p>After the tunnel is registered, check the status and make sure it is running</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># systemctl status ziti-edge-tunnel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â ziti-edge-tunnel.service - Ziti Edge Tunnel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Loaded: loaded (/etc/systemd/system/ziti-edge-tunnel.service; enabled; vendor preset: enabled)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Active: active (running) since Wed 2023-04-05 20:57:04 UTC; 1min 41s ago</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Process: 2640 ExecStartPre=/opt/openziti/bin/ziti-edge-tunnel.sh (code=exited, status=0/SUCCESS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Main PID: 2641 (ziti-edge-tunne)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tasks: 5 (limit: 2323)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Memory: 6.5M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CPU: 752ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     CGroup: /system.slice/ziti-edge-tunnel.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             ââ2641 /opt/openziti/bin/ziti-edge-tunnel run --verbose=2 --dns-ip-range=100.64.0.1/10 --identity-dir=/opt/openziti/etc/identities</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="33-create-edge-router-policy">3.3 Create Edge Router Policy<a href="#33-create-edge-router-policy" class="hash-link" aria-label="Direct link to 3.3 Create Edge Router Policy" title="Direct link to 3.3 Create Edge Router Policy">â</a></h2>
<p>By default, the system created an edge router policy to bind all identities to any routers tag with <strong>#public</strong> attribute. So, we need to add #public to our router (pub-er).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="331-zac">3.3.1 ZAC<a href="#331-zac" class="hash-link" aria-label="Direct link to 3.3.1 ZAC" title="Direct link to 3.3.1 ZAC">â</a></h3>
<p>From the <strong>ROUTERS</strong> screen, you can choose <strong>Router Policies</strong> to display the edge router policies. As you can see, the default policy is already in place.</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services07-router-policy-76c57aae0a8b456f15ccb274520be869.jpg" width="1400" height="637" class="img_ev3q"></p>
<p>To add attribute &quot;public&quot; to the router, choose your router from the <strong>ROUTERS</strong> screen, click on <strong>...</strong> and choose <strong>Edit</strong></p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services08-router-update-33fa2ee102671b37607ac640c057261a.jpg" width="1076" height="468" class="img_ev3q"></p>
<p>On the <strong>EDIT EDGE ROUTER</strong> screen, you can add <strong>public</strong> attribute and then press <strong>SAVE</strong></p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services09-router-update-891a0bc324577d0677b602e1642f78a6.jpg" width="663" height="828" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="332-cli">3.3.2 CLI<a href="#332-cli" class="hash-link" aria-label="Direct link to 3.3.2 CLI" title="Direct link to 3.3.2 CLI">â</a></h3>
<p>On the <strong>controller</strong>:</p>
<p>Check the edge router policy. Make sure &quot;allEdgeRouters&quot; policy is present.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list edge-router-policies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â­âââââââââââââââââââââââââ¬ââââââââââââââââââââââââââââââââ¬âââââââââââââââââââââââââââââââ¬âââââââââââââââââââââââââââââââ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â ID                     â NAME                          â EDGE ROUTER ROLES            â IDENTITY ROLES               â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââââââââââââââ¼ââââââââââââââââââââââââââââââââ¼âââââââââââââââââââââââââââââââ¼âââââââââââââââââââââââââââââââ¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 2YkzdKlvqraTF3VX6r9pJk â allEdgeRouters                â #public                      â #all                         â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â MvQnOZj4au             â edge-router-MvQnOZj4au-system â @Public-Cloud-NC-edge-router â @Public-Cloud-NC-edge-router â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â nIaTfUZjT              â edge-router-nIaTfUZjT-system  â @local-er                    â @local-er                    â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â°âââââââââââââââââââââââââ´ââââââââââââââââââââââââââââââââ´âââââââââââââââââââââââââââââââ´âââââââââââââââââââââââââââââââ¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-3 of 3</span><br></span></code></pre></div></div>
<p>Check the edge router attribute.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list edge-routers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â­âââââââââââââ¬ââââââââââââââââââââââââââââââ¬âââââââââ¬ââââââââââââââââ¬âââââââ¬âââââââââââââ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â ID         â NAME                        â ONLINE â ALLOW TRANSIT â COST â ATTRIBUTES â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââ¼ââââââââââââââââââââââââââââââ¼âââââââââ¼ââââââââââââââââ¼âââââââ¼âââââââââââââ¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â MvQnOZj4au â Public-Cloud-NC-edge-router â true   â true          â    0 â public     â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â k06PffZjT  â pub-er                      â true   â true          â    0 â            â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â nIaTfUZjT  â local-er                    â true   â true          â    0 â            â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â°âââââââââââââ´ââââââââââââââââââââââââââââââ´âââââââââ´ââââââââââââââââ´âââââââ´âââââââââââââ¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-3 of 3</span><br></span></code></pre></div></div>
<p>Add &quot;public&quot; attribute to &quot;pub-er&quot; router.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge update edge-router pub-er -a &quot;public&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list edge-routers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â­âââââââââââââ¬ââââââââââââââââââââââââââââââ¬âââââââââ¬ââââââââââââââââ¬âââââââ¬âââââââââââââ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â ID         â NAME                        â ONLINE â ALLOW TRANSIT â COST â ATTRIBUTES â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââ¼ââââââââââââââââââââââââââââââ¼âââââââââ¼ââââââââââââââââ¼âââââââ¼âââââââââââââ¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â MvQnOZj4au â Public-Cloud-NC-edge-router â true   â true          â    0 â public     â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â k06PffZjT  â pub-er                      â true   â true          â    0 â public     â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â nIaTfUZjT  â local-er                    â true   â true          â    0 â            â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â°âââââââââââââ´ââââââââââââââââââââââââââââââ´âââââââââ´ââââââââââââââââ´âââââââ´âââââââââââââ¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-3 of 3</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="34-set-up-tunneled-ssh-connection">3.4 Set up Tunneled SSH Connection<a href="#34-set-up-tunneled-ssh-connection" class="hash-link" aria-label="Direct link to 3.4 Set up Tunneled SSH Connection" title="Direct link to 3.4 Set up Tunneled SSH Connection">â</a></h2>
<p>In this section, we will be showing how to configure ziti to establish ssh service via our network. We will be using a pseudo dns name (t2tssh.ziti) to establish this connection.  The intercept side (ingress) will be ingress-tunnel, the server side (egress) will be egress-tunnel.</p>
<p>For CLI procedures, all commands are done on the <strong>controller</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="341-create-a-hostv1-config">3.4.1 Create a host.v1 config<a href="#341-create-a-hostv1-config" class="hash-link" aria-label="Direct link to 3.4.1 Create a host.v1 config" title="Direct link to 3.4.1 Create a host.v1 config">â</a></h3>
<p>This config instructs the server-side tunneler how to offload the traffic from the overlay, back to the underlay. We are dropping the traffic off our loopback interface, so we use the address &quot;127.0.0.1â</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3411-zac">3.4.1.1 ZAC<a href="#3411-zac" class="hash-link" aria-label="Direct link to 3.4.1.1 ZAC" title="Direct link to 3.4.1.1 ZAC">â</a></h4>
<p>Create the configuration from <strong>MANAGE CONFIGURATIONS</strong> screen.</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services10-655bc71be07a63761fc0696f4bf26f01.png" width="670" height="1175" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3412-cli">3.4.1.2 CLI<a href="#3412-cli" class="hash-link" aria-label="Direct link to 3.4.1.2 CLI" title="Direct link to 3.4.1.2 CLI">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config t2thostconf host.v1 &#x27;{&quot;protocol&quot;:&quot;tcp&quot;, &quot;address&quot;:&quot;127.0.0.1&quot;, &quot;port&quot;:22}&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="342-create-an-interceptv1-config">3.4.2 Create an intercept.v1 config<a href="#342-create-an-interceptv1-config" class="hash-link" aria-label="Direct link to 3.4.2 Create an intercept.v1 config" title="Direct link to 3.4.2 Create an intercept.v1 config">â</a></h3>
<p>This config is used to instruct the intercept-side tunneler how to correctly intercept the targeted traffic and put it onto the overlay. We are setting up intercept on dns name &quot;t2tssh.ziti&quot;</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3421-zac">3.4.2.1 ZAC<a href="#3421-zac" class="hash-link" aria-label="Direct link to 3.4.2.1 ZAC" title="Direct link to 3.4.2.1 ZAC">â</a></h4>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services11-362ff69194eb84b5d7874525425d22dd.png" width="630" height="979" class="img_ev3q"></p>
<p>Check the provisioned configs on the configuration screen:</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services12-a4ab3663ce31dbffd8294dbbfc0d3755.png" width="1350" height="290" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3422-cli">3.4.2.2 CLI<a href="#3422-cli" class="hash-link" aria-label="Direct link to 3.4.2.2 CLI" title="Direct link to 3.4.2.2 CLI">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config t2tintconf intercept.v1 &#x27;{&quot;protocols&quot;: [&quot;tcp&quot;], &quot;addresses&quot;: [&quot;t2tssh.ziti&quot;], &quot;portRanges&quot;: [{&quot;low&quot;: 22, &quot;high&quot;: 22}]}&#x27;</span><br></span></code></pre></div></div>
<p>If the command finished successfully, you will see two configs.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list configs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â­âââââââââââââââââââââââââ¬ââââââââââââââ¬âââââââââââââââ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â ID                     â NAME        â CONFIG TYPE  â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââââââââââââââ¼ââââââââââââââ¼âââââââââââââââ¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 1R9iDpU7OvREH6LNxQapPO â t2tintconf  â intercept.v1 â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â gIeZ1KgilGXzkY4RxDF2f  â t2thostconf â host.v1      â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â°âââââââââââââââââââââââââ´ââââââââââââââ´âââââââââââââââ¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-2 of 2</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="343-create-service">3.4.3 Create Service<a href="#343-create-service" class="hash-link" aria-label="Direct link to 3.4.3 Create Service" title="Direct link to 3.4.3 Create Service">â</a></h3>
<p>Now we need to put these two configs into a service. We going to name the service &quot;t2tssh&quot;:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3431-zac">3.4.3.1 ZAC<a href="#3431-zac" class="hash-link" aria-label="Direct link to 3.4.3.1 ZAC" title="Direct link to 3.4.3.1 ZAC">â</a></h4>
<p>Create service from <strong>Services</strong> menu from <strong>MANAGE EDGE SERVICES</strong> screen.</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services13-ea447061d73ef380988bac6bf5a508cd.png" width="1021" height="773" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3432-cli">3.4.3.2 CLI<a href="#3432-cli" class="hash-link" aria-label="Direct link to 3.4.3.2 CLI" title="Direct link to 3.4.3.2 CLI">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service t2tssh -c t2tintconf,t2thostconf</span><br></span></code></pre></div></div>
<p><strong>Check Service</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â­ââââââââââââââââââââââââ¬âââââââââ¬âââââââââââââ¬ââââââââââââââââââââââ¬âââââââââââââ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â ID                    â NAME   â ENCRYPTION â TERMINATOR STRATEGY â ATTRIBUTES â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â                       â        â  REQUIRED  â                     â            â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">âââââââââââââââââââââââââ¼âââââââââ¼âââââââââââââ¼ââââââââââââââââââââââ¼âââââââââââââ¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â CZJi5tDxTk8C8XymCbu7f â t2tssh â true       â smartrouting        â            â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â°ââââââââââââââââââââââââ´âââââââââ´âââââââââââââ´ââââââââââââââââââââââ´âââââââââââââ¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-1 of 1</span><br></span></code></pre></div></div>
<p>Please note, the <strong>Encryption = true</strong> and <strong>smartrouting</strong> are default setting.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="344-create-bind-service-policy">3.4.4 Create Bind Service policy<a href="#344-create-bind-service-policy" class="hash-link" aria-label="Direct link to 3.4.4 Create Bind Service policy" title="Direct link to 3.4.4 Create Bind Service policy">â</a></h3>
<p>Now we need to specify which tunneler (in our case, <strong>egress-tunnel</strong>)is going to host the service by setting up a bind service policy</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3441-zac">3.4.4.1 ZAC<a href="#3441-zac" class="hash-link" aria-label="Direct link to 3.4.4.1 ZAC" title="Direct link to 3.4.4.1 ZAC">â</a></h4>
<p>Create a <strong>service policy</strong> from <strong>MANAGE SERVICE POLICIES</strong> screen:</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services15-Bind-cd66dd2e890796bb1c2f18375c2a49cf.jpg" width="655" height="928" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3442-cli">3.4.4.2 CLI<a href="#3442-cli" class="hash-link" aria-label="Direct link to 3.4.4.2 CLI" title="Direct link to 3.4.4.2 CLI">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy t2tssh.bind Bind --service-roles &#x27;@t2tssh&#x27; --identity-roles &quot;@egress-tunnel&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="345-create-dial-service-policy">3.4.5 Create Dial Service policy<a href="#345-create-dial-service-policy" class="hash-link" aria-label="Direct link to 3.4.5 Create Dial Service policy" title="Direct link to 3.4.5 Create Dial Service policy">â</a></h3>
<p>Now we need to specify the intercept side tunneler (<strong>ingress-tunnel</strong>) for the service by setting up a dial service policy</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3451-zac">3.4.5.1 ZAC<a href="#3451-zac" class="hash-link" aria-label="Direct link to 3.4.5.1 ZAC" title="Direct link to 3.4.5.1 ZAC">â</a></h4>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services16-Dial-85baa03e9e62404507d6e31661b4e442.jpg" width="676" height="954" class="img_ev3q"></p>
<p>We should have two service policies created. The services name should match on two policies.  One policy is Bind and the other ons is Dial.  They should be set to different identities.</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services17-2a73e11039bda1f973c41c41fca5fe9b.jpg" width="1077" height="318" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3452-cli">3.4.5.2 CLI<a href="#3452-cli" class="hash-link" aria-label="Direct link to 3.4.5.2 CLI" title="Direct link to 3.4.5.2 CLI">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy t2tssh.dial Dial --service-roles &#x27;@t2tssh&#x27; --identity-roles &quot;@ingress-tunnel&quot;</span><br></span></code></pre></div></div>
<p>Make sure both policies are setup correctly.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list service-policies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â­âââââââââââââââââââââââââ¬ââââââââââââââ¬âââââââââââ¬ââââââââââââââââ¬ââââââââââââââââââ¬ââââââââââââââââââââââ®</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â ID                     â NAME        â SEMANTIC â SERVICE ROLES â IDENTITY ROLES  â POSTURE CHECK ROLES â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ââââââââââââââââââââââââââ¼ââââââââââââââ¼âââââââââââ¼ââââââââââââââââ¼ââââââââââââââââââ¼ââââââââââââââââââââââ¤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 3wATDMvDv1LBRlNrYgsrjf â t2tssh.bind â AllOf    â @t2tssh       â @egress-tunnel  â                     â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â VKIyQz9ZWf0euSDRikNh0  â t2tssh.dial â AllOf    â @t2tssh       â @ingress-tunnel â                     â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â°âââââââââââââââââââââââââ´ââââââââââââââ´âââââââââââ´ââââââââââââââââ´ââââââââââââââââââ´ââââââââââââââââââââââ¯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-2 of 2</span><br></span></code></pre></div></div>
<p>You should also make sure the policy advisor display correctly.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge policy-advisor services |grep t2tssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OKAY : egress-tunnel (2) -&gt; t2tssh (2) Common Routers: (2/2) Dial: N Bind: Y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OKAY : ingress-tunnel (2) -&gt; t2tssh (2) Common Routers: (2/2) Dial: Y Bind: N</span><br></span></code></pre></div></div>
<p>Make sure there is a &quot;Dial&quot; line and a &quot;Bind&quot; line. They are both &quot;OKAY&quot; and has at least 1 Common Routers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="346-verify-the-connection">3.4.6 Verify the connection<a href="#346-verify-the-connection" class="hash-link" aria-label="Direct link to 3.4.6 Verify the connection" title="Direct link to 3.4.6 Verify the connection">â</a></h3>
<p>Login to the intercept side tunneler (<strong>ingress-tunnel</strong>) node, you should be able to ssh to the server (<strong>egress-tunnel</strong>) by using dns name &quot;t2tssh.ziti&quot;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@ingress-tunnel:~# ssh t2tssh.ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-67-generic x86_64)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Documentation:  https://help.ubuntu.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Management:     https://landscape.canonical.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Support:        https://ubuntu.com/advantage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  System information as of Mon May 15 19:30:46 UTC 2023</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  System load:  0.0               Users logged in:       1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Usage of /:   3.3% of 48.27GB   IPv4 address for eth0: 104.131.9.28</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Memory usage: 11%               IPv4 address for eth0: 10.17.0.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Swap usage:   0%                IPv4 address for eth1: 10.108.0.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Processes:    93                IPv4 address for tun0: 100.64.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Introducing Expanded Security Maintenance for Applications.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Receive updates to over 25,000 software packages with your</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Ubuntu Pro subscription. Free for personal use.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     https://ubuntu.com/pro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Expanded Security Maintenance for Applications is not enabled.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">17 updates can be applied immediately.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">13 of these updates are standard security updates.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To see these additional updates run: apt list --upgradable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enable ESM Apps to receive additional future security updates.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">See https://ubuntu.com/esm or run: sudo pro status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The list of available updates is more than a week old.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To check for new updates run: sudo apt update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Last login: Mon May 15 19:08:51 2023 from 45.17.199.35</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@egress-tunnel:~# &lt;ctrl-d&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection to t2tssh.ziti closed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@ingress-tunnel:~#</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="35-setup-tunnel-to-ert-http-connection">3.5 Setup Tunnel to ERT http connection<a href="#35-setup-tunnel-to-ert-http-connection" class="hash-link" aria-label="Direct link to 3.5 Setup Tunnel to ERT http connection" title="Direct link to 3.5 Setup Tunnel to ERT http connection">â</a></h2>
<p>Routers have an optional tunneler function. In this section, we will demonstrate a connection between a tunneler and such a router with an enabled tunneler.</p>
<p>The procedure is similar to tunnel to tunnel service, so please refer to that section for a detailed explanation of each step.</p>
<p>Please refer to <a href="#312-network-diagram-2">Network Diagram 2</a> for our test setup.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="351-create-a-hostv1-config">3.5.1 Create a host.v1 config<a href="#351-create-a-hostv1-config" class="hash-link" aria-label="Direct link to 3.5.1 Create a host.v1 config" title="Direct link to 3.5.1 Create a host.v1 config">â</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3511-zac">3.5.1.1 ZAC<a href="#3511-zac" class="hash-link" aria-label="Direct link to 3.5.1.1 ZAC" title="Direct link to 3.5.1.1 ZAC">â</a></h4>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services20-4dbd9e18442fcfb6852aba33653602cf.png" width="677" height="1158" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3512-cli">3.5.1.2 CLI<a href="#3512-cli" class="hash-link" aria-label="Direct link to 3.5.1.2 CLI" title="Direct link to 3.5.1.2 CLI">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config t2ehostconf host.v1 &#x27;{&quot;protocol&quot;:&quot;tcp&quot;, &quot;address&quot;:&quot;127.0.0.1&quot;, &quot;port&quot;:8080}&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="352-create-an-interceptv1-config">3.5.2 Create an intercept.v1 config<a href="#352-create-an-interceptv1-config" class="hash-link" aria-label="Direct link to 3.5.2 Create an intercept.v1 config" title="Direct link to 3.5.2 Create an intercept.v1 config">â</a></h3>
<p>Use ip (10.124.0.2) as intercept address</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3521-zac">3.5.2.1 ZAC<a href="#3521-zac" class="hash-link" aria-label="Direct link to 3.5.2.1 ZAC" title="Direct link to 3.5.2.1 ZAC">â</a></h4>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services21-eb83684b9ed2767713217e2e0299544f.png" width="664" height="976" class="img_ev3q"></p>
<p>And you should have two configs:</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services22-61684fc739691d1ae4a0e39a71f09718.png" width="1367" height="311" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3522-cli">3.5.2.2 CLI<a href="#3522-cli" class="hash-link" aria-label="Direct link to 3.5.2.2 CLI" title="Direct link to 3.5.2.2 CLI">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config t2eintconf intercept.v1 &#x27;{&quot;protocols&quot;: [&quot;tcp&quot;], &quot;addresses&quot;: [&quot;10.124.0.2&quot;], &quot;portRanges&quot;: [{&quot;low&quot;: 80, &quot;high&quot;: 80}]}&#x27;</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list configs |grep t2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â IlgnlM2srnU7s8C3hiLJA  â t2eintconf  â intercept.v1 â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â uJUtyXI5XH1wSsSCiCARp  â t2ehostconf â host.v1      â</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="353-create-service">3.5.3 Create Service<a href="#353-create-service" class="hash-link" aria-label="Direct link to 3.5.3 Create Service" title="Direct link to 3.5.3 Create Service">â</a></h3>
<p>Now we need to put these two configs into a service. We going to name the service &quot;t2ehttp&quot;:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3531-zac">3.5.3.1 ZAC<a href="#3531-zac" class="hash-link" aria-label="Direct link to 3.5.3.1 ZAC" title="Direct link to 3.5.3.1 ZAC">â</a></h4>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services23-7283400f2e927e467cdf18a6c05e90d2.png" width="1034" height="766" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3532-cli">3.5.3.2 CLI<a href="#3532-cli" class="hash-link" aria-label="Direct link to 3.5.3.2 CLI" title="Direct link to 3.5.3.2 CLI">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service t2ehttp -c t2eintconf,t2ehostconf</span><br></span></code></pre></div></div>
<p><strong>Check Service</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list services |grep t2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 5FI8Aw0IQ7xaUMgH2rKvps â t2ehttp â true       â smartrouting        â            â</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="354-create-bind-service-policy">3.5.4 Create Bind Service policy<a href="#354-create-bind-service-policy" class="hash-link" aria-label="Direct link to 3.5.4 Create Bind Service policy" title="Direct link to 3.5.4 Create Bind Service policy">â</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3541-zac">3.5.4.1 ZAC<a href="#3541-zac" class="hash-link" aria-label="Direct link to 3.5.4.1 ZAC" title="Direct link to 3.5.4.1 ZAC">â</a></h4>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services25-Bind-fe90c916660c8e5d4831ba7309886bca.jpg" width="693" height="938" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3542-cli">3.5.4.2 CLI<a href="#3542-cli" class="hash-link" aria-label="Direct link to 3.5.4.2 CLI" title="Direct link to 3.5.4.2 CLI">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy t2ehttp.bind Bind --service-roles &#x27;@t2ehttp&#x27; --identity-roles &quot;@local-er&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="355-create-dial-service-policy">3.5.5 Create Dial Service policy<a href="#355-create-dial-service-policy" class="hash-link" aria-label="Direct link to 3.5.5 Create Dial Service policy" title="Direct link to 3.5.5 Create Dial Service policy">â</a></h3>
<p>Now we need to specify the intercept side tunneler (<strong>egress-tunnel</strong>) for the service by setting up a dial service policy</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3551-zac">3.5.5.1 ZAC<a href="#3551-zac" class="hash-link" aria-label="Direct link to 3.5.5.1 ZAC" title="Direct link to 3.5.5.1 ZAC">â</a></h4>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services26-Dial-3cf10c188b73a4638609901cad7e70a3.jpg" width="704" height="950" class="img_ev3q"></p>
<p>Check two service polices.</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services27-d325e87377f8fe2fbb66b4d6f699e28f.jpg" width="1079" height="321" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3552-cli">3.5.5.2 CLI<a href="#3552-cli" class="hash-link" aria-label="Direct link to 3.5.5.2 CLI" title="Direct link to 3.5.5.2 CLI">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy t2ehttp.dial Dial --service-roles &#x27;@t2ehttp&#x27; --identity-roles &quot;@egress-tunnel&quot;</span><br></span></code></pre></div></div>
<p>Ensure both policies are set up correctly.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list service-policies |grep t2e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 4XpyRyE6vKo2Rd2gb2x6il â t2ehttp.dial â AllOf    â @t2ehttp      â @egress-tunnel  â                     â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 6bGra4CxFtpe0GmTeACLy  â t2ehttp.bind â AllOf    â @t2ehttp      â @local-er       â                     â</span><br></span></code></pre></div></div>
<p>Ensure policy advisor reports &quot;OKAY.&quot;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge policy-advisor services |grep t2ehttp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OKAY : egress-tunnel (2) -&gt; t2ehttp (3) Common Routers: (2/2) Dial: Y Bind: N</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OKAY : local-er (3) -&gt; t2ehttp (3) Common Routers: (3/3) Dial: N Bind: Y</span><br></span></code></pre></div></div>
<p>Make sure there is a &quot;Dial&quot; line and a &quot;Bind&quot; line. They are both &quot;OKAY&quot; and has at least 1 Common Routers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="356-verify-the-connection">3.5.6 Verify the connection<a href="#356-verify-the-connection" class="hash-link" aria-label="Direct link to 3.5.6 Verify the connection" title="Direct link to 3.5.6 Verify the connection">â</a></h3>
<p>Login to the router (<strong>local-er</strong>), setup a file to send via http.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@local-er:~# cat &gt;hello.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ___ ___                  .___</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   /   |   \  ______  _  ____| _/__.__.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ______   ______ /    ~    \/  _ \ \/ \/ / __ &lt;   |  |  ______   ______</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /_____/  /_____/ \    Y    (  &lt;_&gt; )     / /_/ |\___  | /_____/  /_____/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   \___|_  / \____/ \/\_/\____ |/ ____|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         \/                   \/\/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This is hello from local-er.</span><br></span></code></pre></div></div>
<p>Then start the http server.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 -m http.server 8080</span><br></span></code></pre></div></div>
<p>Login to the intercept side tunneler (<strong>egress-tunnel</strong>) node.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@egress-tunnel:~# curl http://10.124.0.2/hello.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ___ ___                  .___</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   /   |   \  ______  _  ____| _/__.__.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ______   ______ /    ~    \/  _ \ \/ \/ / __ &lt;   |  |  ______   ______</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /_____/  /_____/ \    Y    (  &lt;_&gt; )     / /_/ |\___  | /_____/  /_____/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   \___|_  / \____/ \/\_/\____ |/ ____|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         \/                   \/\/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This is hello from local-er.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@egress-tunnel:~#</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="357-conclusion">3.5.7 Conclusion<a href="#357-conclusion" class="hash-link" aria-label="Direct link to 3.5.7 Conclusion" title="Direct link to 3.5.7 Conclusion">â</a></h3>
<p>In this section, we demonstrated intercepting http (port 80) request to an IP address and forward the request to a remote http server listening on the port 8080 via ziti network.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="36-setup-connection-from-a-non-openziti-client">3.6 Setup Connection from a non-OpenZiti client<a href="#36-setup-connection-from-a-non-openziti-client" class="hash-link" aria-label="Direct link to 3.6 Setup Connection from a non-OpenZiti client" title="Direct link to 3.6 Setup Connection from a non-OpenZiti client">â</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="361-introduction">3.6.1 Introduction<a href="#361-introduction" class="hash-link" aria-label="Direct link to 3.6.1 Introduction" title="Direct link to 3.6.1 Introduction">â</a></h3>
<p>In this section, we will demonstrate how to setup non-OpenZiti client to use the ziti service. Please refer to <a href="#312-network-diagram-2">Network Diagram 2</a> for our test setup.</p>
<p><strong>You need to create a VM (Non-OpenZiti-Client) in the same data center as &quot;local-er&quot; for this test.</strong></p>
<p>The following conditions need to be met in order for this connection to work correctly:</p>
<ul>
<li>The non-OpenZiti client has to be in the same data center as the edge router.</li>
<li>The edge router is created with tunneler enabled.</li>
</ul>
<p>We are also need to do the following to successfully demonstrate the connection:</p>
<ul>
<li>Create host and intercept config</li>
<li>Create service</li>
<li>Create dial and bind policy</li>
<li>Setup route on the non-OpenZiti client</li>
</ul>
<p>We will create an intercept at <strong>11.11.11.11:80</strong> and <strong>e2thttp.ziti</strong>, and drop off at loopback address (127.0.0.1) of <strong>egress-tunnel</strong> port (80).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="362-create-a-hostv1-config">3.6.2 Create a host.v1 config<a href="#362-create-a-hostv1-config" class="hash-link" aria-label="Direct link to 3.6.2 Create a host.v1 config" title="Direct link to 3.6.2 Create a host.v1 config">â</a></h3>
<p>Used address <strong>127.0.0.1</strong> as host side destination, and port <strong>80</strong> as destination port.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3621-zac">3.6.2.1 ZAC<a href="#3621-zac" class="hash-link" aria-label="Direct link to 3.6.2.1 ZAC" title="Direct link to 3.6.2.1 ZAC">â</a></h4>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services30-2f7951662615ae058a5aec5ad9d3dfbf.jpg" width="537" height="1021" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3622-cli">3.6.2.2 CLI<a href="#3622-cli" class="hash-link" aria-label="Direct link to 3.6.2.2 CLI" title="Direct link to 3.6.2.2 CLI">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config e2thostconf host.v1 &#x27;{&quot;protocol&quot;:&quot;tcp&quot;, &quot;address&quot;:&quot;127.0.0.1&quot;, &quot;port&quot;:80}&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="363-create-an-interceptv1-config">3.6.3 Create an intercept.v1 config<a href="#363-create-an-interceptv1-config" class="hash-link" aria-label="Direct link to 3.6.3 Create an intercept.v1 config" title="Direct link to 3.6.3 Create an intercept.v1 config">â</a></h3>
<p>Use a pseudo ip (11.11.11.11) and DNS name (e2thttp.ziti) as intercept address</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3631-zac">3.6.3.1 ZAC<a href="#3631-zac" class="hash-link" aria-label="Direct link to 3.6.3.1 ZAC" title="Direct link to 3.6.3.1 ZAC">â</a></h4>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services31-3b2edef6d1daa924f496fb44775c85ba.jpg" width="687" height="1087" class="img_ev3q"></p>
<p>And you should have two configs:</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services32-967db5763dcecd31513704d270be4ea9.jpg" width="1083" height="317" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3632-cli">3.6.3.2 CLI<a href="#3632-cli" class="hash-link" aria-label="Direct link to 3.6.3.2 CLI" title="Direct link to 3.6.3.2 CLI">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config e2tintconf intercept.v1 &#x27;{&quot;protocols&quot;: [&quot;tcp&quot;], &quot;addresses&quot;: [&quot;11.11.11.11&quot;,&quot;e2thttp.ziti&quot;], &quot;portRanges&quot;: [{&quot;low&quot;: 80, &quot;high&quot;: 80}]}&#x27;</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list configs |grep e2t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 1ANNy88ovJL6vAW6AwNbiM â e2thostconf â host.v1      â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 5kXnoEoMrfReOou8lty9zj â e2tintconf  â intercept.v1 â</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="364-create-service">3.6.4 Create Service<a href="#364-create-service" class="hash-link" aria-label="Direct link to 3.6.4 Create Service" title="Direct link to 3.6.4 Create Service">â</a></h3>
<p>Now we need to put these two configs into a service. We going to name the service &quot;t2ehttp&quot;:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3641-zac">3.6.4.1 ZAC<a href="#3641-zac" class="hash-link" aria-label="Direct link to 3.6.4.1 ZAC" title="Direct link to 3.6.4.1 ZAC">â</a></h4>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services33-5f974897564b8292eb2ddbd75b2326ae.jpg" width="880" height="641" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3642-cli">3.6.4.2 CLI<a href="#3642-cli" class="hash-link" aria-label="Direct link to 3.6.4.2 CLI" title="Direct link to 3.6.4.2 CLI">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service e2thttp -c e2thostconf,e2tintconf</span><br></span></code></pre></div></div>
<p><strong>Check Service</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list services  |grep e2t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 2uphDaBfIo7ubj6GhV8r93 â e2thttp â true       â smartrouting        â            â</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="365-create-bind-service-policy">3.6.5 Create Bind Service policy<a href="#365-create-bind-service-policy" class="hash-link" aria-label="Direct link to 3.6.5 Create Bind Service policy" title="Direct link to 3.6.5 Create Bind Service policy">â</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3651-zac">3.6.5.1 ZAC<a href="#3651-zac" class="hash-link" aria-label="Direct link to 3.6.5.1 ZAC" title="Direct link to 3.6.5.1 ZAC">â</a></h4>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services34-Bind-7797352cb193df37aa645d1fe70474c6.jpg" width="536" height="739" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3652-cli">3.6.5.2 CLI<a href="#3652-cli" class="hash-link" aria-label="Direct link to 3.6.5.2 CLI" title="Direct link to 3.6.5.2 CLI">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy e2thttp.bind Bind --service-roles &#x27;@e2thttp&#x27; --identity-roles &quot;@egress-tunnel&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="366-create-dial-service-policy">3.6.6 Create Dial Service policy<a href="#366-create-dial-service-policy" class="hash-link" aria-label="Direct link to 3.6.6 Create Dial Service policy" title="Direct link to 3.6.6 Create Dial Service policy">â</a></h3>
<p>Now we need to specify the intercept side tunneler (<strong>local-er</strong>) for the service by setting up a dial service policy</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3661-zac">3.6.6.1 ZAC<a href="#3661-zac" class="hash-link" aria-label="Direct link to 3.6.6.1 ZAC" title="Direct link to 3.6.6.1 ZAC">â</a></h4>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services35-Dial-dc7416b5a6539ced3781380536320d35.jpg" width="533" height="750" class="img_ev3q"></p>
<p>Check two service polices:</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/Services36-68cdf8113ba64653edc58846b9815359.jpg" width="1163" height="247" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3662-cli">3.6.6.2 CLI<a href="#3662-cli" class="hash-link" aria-label="Direct link to 3.6.6.2 CLI" title="Direct link to 3.6.6.2 CLI">â</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy e2thttp.dial Dial --service-roles &#x27;@e2thttp&#x27; --identity-roles &quot;@local-er&quot;</span><br></span></code></pre></div></div>
<p>Make sure both policies are setup correctlyï¼</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list service-policies |grep e2t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 305novDIduhXPEmA8gawpM â e2thttp.dial â AllOf    â @e2thttp      â @local-er       â                     â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 5zfoMaXKNDe3uIih8YHEWa â e2thttp.bind â AllOf    â @e2thttp      â @egress-tunnel  â                     â</span><br></span></code></pre></div></div>
<p>You should also make sure the policy advisor display correctly:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge policy-advisor services |grep e2thttp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OKAY : egress-tunnel (2) -&gt; e2thttp (3) Common Routers: (2/2) Dial: N Bind: Y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OKAY : local-er (3) -&gt; e2thttp (3) Common Routers: (3/3) Dial: Y Bind: N</span><br></span></code></pre></div></div>
<p>Make sure there is a &quot;Dial&quot; line and a &quot;Bind&quot; line. They are both &quot;OKAY&quot; and has at least 1 Common Routers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="367-verify-the-connection">3.6.7 Verify the connection<a href="#367-verify-the-connection" class="hash-link" aria-label="Direct link to 3.6.7 Verify the connection" title="Direct link to 3.6.7 Verify the connection">â</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3671-setup-server-side">3.6.7.1 Setup Server Side<a href="#3671-setup-server-side" class="hash-link" aria-label="Direct link to 3.6.7.1 Setup Server Side" title="Direct link to 3.6.7.1 Setup Server Side">â</a></h4>
<p>Login to the Client (<strong>egress-tunnel</strong>), setup a file to send via http.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@egress-tunnel:~# cat &gt;hello.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              _   _      _ _</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             | | | | ___| | | ___</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _____ _____| |_| |/ _ \ | |/ _ \ _____ _____</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> |_____|_____|  _  |  __/ | | (_) |_____|_____|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             |_| |_|\___|_|_|\___/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You have reached the &quot;egress-tunnel&quot;.</span><br></span></code></pre></div></div>
<p>Then start the http server.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo python3 -m http.server 80</span><br></span></code></pre></div></div>
<p>Then login to the non-OpenZiti client machine (<strong>Non-OpenZiti-Client</strong>).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3672-test-ip-intercept">3.6.7.2 Test IP intercept<a href="#3672-test-ip-intercept" class="hash-link" aria-label="Direct link to 3.6.7.2 Test IP intercept" title="Direct link to 3.6.7.2 Test IP intercept">â</a></h4>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Azure</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">AWS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Google</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Digital Ocean</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Oracle</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">IBM</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><strong>setup the route first</strong>. The route is via our ER in the same DC (10.124.0.2)</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@Non-OpenZiti-Client:~# sudo ip route add 11.11.11.11/32 via 10.124.0.2</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6"></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><strong>setup the route first</strong>. The route is via our ER in the same DC (10.162.209.220)</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@Non-OpenZiti-Client:~# sudo ip route add 11.11.11.11/32 via 10.162.209.220</span><br></span></code></pre></div></div></div></div></div>
<p><strong>test the connection</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@Non-OpenZiti-Client:~# curl http://11.11.11.11/hello.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              _   _      _ _</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             | | | | ___| | | ___</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _____ _____| |_| |/ _ \ | |/ _ \ _____ _____</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> |_____|_____|  _  |  __/ | | (_) |_____|_____|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             |_| |_|\___|_|_|\___/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You have reached the &quot;egress-tunnel&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@Non-OpenZiti-Client:~#</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3673-modify-the-resolver">3.6.7.3 Modify the resolver<a href="#3673-modify-the-resolver" class="hash-link" aria-label="Direct link to 3.6.7.3 Modify the resolver" title="Direct link to 3.6.7.3 Modify the resolver">â</a></h4>
<p>The <strong>Non-OpenZiti-Client</strong>&#x27;s resolver has to point to the local-er.  So it can resolve the DNS name from local-er.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Azure</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">AWS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Google</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Digital Ocean</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Oracle</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">IBM</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><ul>
<li>Modify <strong>/etc/systemd/resolved.conf</strong>.</li>
<li>Put local IP of the &quot;local-er&quot; into the file.</li>
<li>For example:<!-- -->
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DNS=10.5.0.4  #local private IP of the ER</span><br></span></code></pre></div></div>
</li>
</ul><p><strong>NOTE, the IP address should match your Next hop in the route table</strong></p><p>Restart the systemd-resolved service</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart systemd-resolved.service</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>Modify <strong>/etc/systemd/resolved.conf</strong>.</li>
<li>Put local IP of the &quot;local-er&quot; into the file.</li>
<li>For example:<!-- -->
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DNS=10.5.0.4  #local private IP of the ER</span><br></span></code></pre></div></div>
</li>
</ul><p><strong>NOTE, the IP address should match your Next hop in the route table</strong></p><p>Restart the systemd-resolved service</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart systemd-resolved.service</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>Modify <strong>/etc/systemd/resolved.conf</strong>.</li>
<li>Put local IP of the &quot;local-er&quot; into the file.</li>
<li>For example:<!-- -->
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DNS=10.138.0.2  #local private IP of the local ER</span><br></span></code></pre></div></div>
</li>
</ul><p><strong>NOTE, the IP address should match your Next hop in the route table</strong></p><p>Restart the systemd-resolved service</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart systemd-resolved.service</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>Modify &quot;/etc/systemd/resolved.conf.d/DigitalOcean.conf&quot; to point to the local IP of the &quot;local-er&quot;.</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@Non-OpenZiti-Client:~# cat /etc/systemd/resolved.conf.d/DigitalOcean.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Resolve]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DNS=144.126.220.15</span><br></span></code></pre></div></div><p>Restart the systemd-resolved service</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart systemd-resolved.service</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>Modify <strong>/etc/systemd/resolved.conf</strong>.</li>
<li>Put local IP of the &quot;local-er&quot; into the file.</li>
<li>For example:<!-- -->
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DNS=10.5.0.4  #local private IP of the ER</span><br></span></code></pre></div></div>
</li>
</ul><p><strong>NOTE, the IP address should match your &quot;Target Selection&quot; in the route table</strong></p><p>Restart the systemd-resolved service</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart systemd-resolved.service</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>
<p>Modify <strong>/etc/systemd/resolved.conf</strong>.</p>
</li>
<li>
<p>Put <strong>Public IP</strong> of the &quot;local-er&quot; into the file.</p>
</li>
<li>
<p>For example:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DNS=169.45.71.226    #Public IP of the ER</span><br></span></code></pre></div></div>
</li>
</ul><p>Restart the systemd-resolved service</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart systemd-resolved.service</span><br></span></code></pre></div></div></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3674-test-dns-intercept">3.6.7.4 Test DNS intercept<a href="#3674-test-dns-intercept" class="hash-link" aria-label="Direct link to 3.6.7.4 Test DNS intercept" title="Direct link to 3.6.7.4 Test DNS intercept">â</a></h4>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Azure</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">AWS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Google</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Digital Ocean</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Oracle</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">IBM</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><strong>Set up the route first</strong>.</p><ul>
<li>
<p>The route is via our ER in the same DC (10.124.0.2)</p>
</li>
<li>
<p>We need to setup the route for 100.64/10 subnet</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@Non-OpenZiti-Client:~# sudo ip route add 100.64.0.0/10 via 10.124.0.2</span><br></span></code></pre></div></div>
</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6"></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><strong>Set up the route first</strong>.</p><ul>
<li>
<p>The route is via our ER in the same DC (10.162.209.220)</p>
</li>
<li>
<p>We need to setup the route for 100.64/10 subnet</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@Non-OpenZiti-Client:~# sudo ip route add 100.64.0.0/10 via 10.162.209.220</span><br></span></code></pre></div></div>
</li>
</ul></div></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@Non-OpenZiti-Client:~# curl http://e2thttp.ziti/hello.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              _   _      _ _</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             | | | | ___| | | ___</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _____ _____| |_| |/ _ \ | |/ _ \ _____ _____</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> |_____|_____|  _  |  __/ | | (_) |_____|_____|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             |_| |_|\___|_|_|\___/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You have reached the &quot;egress-tunnel&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bye.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@Non-OpenZiti-Client:~# </span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="37-setup-sdk-enabled-application-to-access-a-server">3.7 Setup SDK enabled application to access a server<a href="#37-setup-sdk-enabled-application-to-access-a-server" class="hash-link" aria-label="Direct link to 3.7 Setup SDK enabled application to access a server" title="Direct link to 3.7 Setup SDK enabled application to access a server">â</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="371-introduction">3.7.1 Introduction<a href="#371-introduction" class="hash-link" aria-label="Direct link to 3.7.1 Introduction" title="Direct link to 3.7.1 Introduction">â</a></h3>
<p>In this section, we will demonstrate how to setup OpenZiti service to access a server from a SDK enabled application. Please refer to <a href="#313-network-diagram-3">Network Diagram 3</a> for our test setup.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="372-sdk-application-client">3.7.2 SDK Application client<a href="#372-sdk-application-client" class="hash-link" aria-label="Direct link to 3.7.2 SDK Application client" title="Direct link to 3.7.2 SDK Application client">â</a></h3>
<p>We are going to use an existing <a href="https://github.com/openziti/sdk-golang/tree/main/example/curlz" target="_blank" rel="noopener noreferrer">SDK implementation</a> for this guide.</p>
<p>Please create a linux server (i.e. Ubuntu22.04) that can compile golang. If you have followed the previous example, you can use any node you already created (i.e ingress-tunnel node) for this exercise.  Install <strong>go</strong> before you proceed further. To install latest go, please following <a href="https://go.dev/doc/install" target="_blank" rel="noopener noreferrer">go.dev installation link</a>.</p>
<p>Check out the code from the <a href="https://github.com/openziti/sdk-golang.git" target="_blank" rel="noopener noreferrer">github repo</a>.</p>
<p>example:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># git clone https://github.com/openziti/sdk-golang.git</span><br></span></code></pre></div></div>
<p>cd to the curlz directory (example/curlz).</p>
<p>example:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># cd sdk-golang/example/curlz</span><br></span></code></pre></div></div>
<p>build the curlz binary</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">go mod tidy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go build </span><span class="token builtin class-name">.</span><br></span></code></pre></div></div>
<p>If all goes well, you will find a <strong>curlz</strong> binary under that directory.</p>
<p>Next, you need to create an identity for this SDK Application.</p>
<p>Login to the controller</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># source the aliases for ziti (do it the first time you login to the VM)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">source</span><span class="token plain"> ~/.ziti/quickstart/</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">hostname</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-s</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">/</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">hostname</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-s</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">.env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># connect to ziti cli (do this when the token expired)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zitiLogin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># create identity for client</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create identity curlz-client </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> curlz.clients </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> curlz-client.jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># enroll identity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge enroll </span><span class="token parameter variable" style="color:#36acaa">--jwt</span><span class="token plain"> curlz-client.jwt</span><br></span></code></pre></div></div>
<p>Once the enrollment is complete, there will be a <strong>curlz-client.json</strong> file under the current directory. Transfer the file (<strong>curlz-client.json</strong>) to your SDK Application client machine, place it under the <strong>curlz</strong> directory.</p>
<p><strong>NOTE</strong> We will refer this node as &quot;sdk-application-client&quot;, we will come back to this node when we are ready to test the connection.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="373-create-a-hostv1-config">3.7.3 Create a host.v1 config<a href="#373-create-a-hostv1-config" class="hash-link" aria-label="Direct link to 3.7.3 Create a host.v1 config" title="Direct link to 3.7.3 Create a host.v1 config">â</a></h3>
<p>Used address <strong>loopback</strong> as host side destination, and port <strong>8000</strong> as destination port.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config curlz.hostv1 host.v1 </span><span class="token string" style="color:#e3116c">&#x27;{&quot;protocol&quot;:&quot;tcp&quot;, &quot;address&quot;:&quot;localhost&quot;,&quot;port&quot;:&#x27;</span><span class="token number" style="color:#36acaa">8000</span><span class="token string" style="color:#e3116c">&#x27;}&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="374-create-service">3.7.4 Create Service<a href="#374-create-service" class="hash-link" aria-label="Direct link to 3.7.4 Create Service" title="Direct link to 3.7.4 Create Service">â</a></h3>
<p>Now we need to put the config into a service. We going to name the service &quot;curlzService&quot;:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service curlzService --configs &quot;curlz.hostv1&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="375-create-bind-service-policy">3.7.5 Create Bind Service policy<a href="#375-create-bind-service-policy" class="hash-link" aria-label="Direct link to 3.7.5 Create Bind Service policy" title="Direct link to 3.7.5 Create Bind Service policy">â</a></h3>
<p>Specify host-side endpoints by using the &quot;Bind&quot; service policy</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy curlz-client-bind Bind --identity-roles </span><span class="token string" style="color:#e3116c">&#x27;@egress-tunnel&#x27;</span><span class="token plain"> --service-roles </span><span class="token string" style="color:#e3116c">&#x27;@curlzService&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="376-create-dial-service-policy">3.7.6 Create Dial Service policy<a href="#376-create-dial-service-policy" class="hash-link" aria-label="Direct link to 3.7.6 Create Dial Service policy" title="Direct link to 3.7.6 Create Dial Service policy">â</a></h3>
<p>Now we need to specify the intercept side SDK application (<strong>#curlz.clients</strong>) for the service by setting up a dial service policy</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy curlz-client-dial Dial --identity-roles </span><span class="token string" style="color:#e3116c">&#x27;#curlz.clients&#x27;</span><span class="token plain"> --service-roles </span><span class="token string" style="color:#e3116c">&#x27;@curlzService&#x27;</span><br></span></code></pre></div></div>
<p>Make sure both policies are setup correctlyï¼</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list service-policies |grep curlz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 1f169JyYjsljrkxWbAabNc â curlz-client-dial   â AllOf    â @curlzService      â #curlz.clients                   â                     â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 5xvUxAES5g2uQkjDolBOka â curlz-client-bind   â AllOf    â @curlzService      â @egress-tunnel                   â                     â</span><br></span></code></pre></div></div>
<p>You should also make sure the policy advisor display correctly:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge policy-advisor services |grep curlzService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OKAY : curlz-client (1) -&gt; curlzService (1) Common Routers: (1/1) Dial: Y Bind: N</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OKAY : egress-tunnel (1) -&gt; curlzService (1) Common Routers: (1/1) Dial: N Bind: Y</span><br></span></code></pre></div></div>
<p>Make sure there is a &quot;Dial&quot; line and a &quot;Bind&quot; line. They are both &quot;OKAY&quot; and has at least 1 Common Routers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="377-setup-server-side">3.7.7 Setup Server Side<a href="#377-setup-server-side" class="hash-link" aria-label="Direct link to 3.7.7 Setup Server Side" title="Direct link to 3.7.7 Setup Server Side">â</a></h3>
<p>Login to the Client (<strong>egress-tunnel</strong>), make sure &quot;hello.txt&quot; is still there from previous step. If not, <a href="#367-verify-the-connection">recreate it</a>.</p>
<p>Then start the http server.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> http.server </span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="378-verify-the-connection">3.7.8 Verify the connection<a href="#378-verify-the-connection" class="hash-link" aria-label="Direct link to 3.7.8 Verify the connection" title="Direct link to 3.7.8 Verify the connection">â</a></h3>
<p>Then login to the &quot;<a href="#372-sdk-application-client">sdk-application-client</a>&quot; node.</p>
<p>Make sure you are under the &quot;curlz&quot; directory, start the application by using the service name and the registered client identity.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./curlz http://&lt;service name&gt;/hello.txt &lt;identity&gt;</span><br></span></code></pre></div></div>
<p>example:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./curlz http://curlzService/hello.txt curlz-client.json</span><br></span></code></pre></div></div>
<p><strong>output</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ./curlz http://curlzService/hello.txt curlz-client.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              _   _      _ _</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             | | | | ___| | | ___</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _____ _____| |_| |/ _ \ | |/ _ \ _____ _____</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> |_____|_____|  _  |  __/ | | (_) |_____|_____|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             |_| |_|\___|_|_|\___/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You have reached the &quot;egress-tunnel&quot;.</span><br></span></code></pre></div></div>
<p>You have successfully connected SDK application to the server.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="38-access-a-sdk-enabled-application-via-ziti-tunnel">3.8 Access a SDK enabled application via ziti-tunnel<a href="#38-access-a-sdk-enabled-application-via-ziti-tunnel" class="hash-link" aria-label="Direct link to 3.8 Access a SDK enabled application via ziti-tunnel" title="Direct link to 3.8 Access a SDK enabled application via ziti-tunnel">â</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="381-introduction">3.8.1 Introduction<a href="#381-introduction" class="hash-link" aria-label="Direct link to 3.8.1 Introduction" title="Direct link to 3.8.1 Introduction">â</a></h3>
<p>In this section, we will demonstrate how to setup OpenZiti service to access a SDK enabled application via ziti-tunnel. Please refer to <a href="#314-network-diagram-4">Network Diagram 4</a> for our test setup.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="382-sdk-application-server">3.8.2 SDK Application server<a href="#382-sdk-application-server" class="hash-link" aria-label="Direct link to 3.8.2 SDK Application server" title="Direct link to 3.8.2 SDK Application server">â</a></h3>
<p>We are going to use an existing <a href="https://github.com/openziti/sdk-golang/tree/main/example/simple-server" target="_blank" rel="noopener noreferrer">SDK implementation</a> for this guide.</p>
<p>Please create a linux server (i.e. Ubuntu22.04) that can compile golang. If you have followed the previous example, you can use any node you already created (i.e egress-tunnel node) for this exercise.  Install <strong>go</strong> before you proceed further.</p>
<p>Check out the code from the <a href="https://github.com/openziti/sdk-golang.git" target="_blank" rel="noopener noreferrer">github repo</a>.</p>
<p>example:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># git clone https://github.com/openziti/sdk-golang.git</span><br></span></code></pre></div></div>
<p>cd to the simple-server directory (example/simple-server).</p>
<p>example:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># cd sdk-golang/example/simple-server</span><br></span></code></pre></div></div>
<p>build the simple-server binary</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">go mod tidy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go build </span><span class="token builtin class-name">.</span><br></span></code></pre></div></div>
<p>If all goes well, you will find a <strong>simple-server</strong> binary under that directory.</p>
<p>By examining the code (simple-server.go), you can see we are using port <strong>8080</strong> for our server. (Note, the port is also mentioned in README file). This port will be used to create host.v1 config later.</p>
<p>Next, you need to create an identity for this SDK Application server.</p>
<p>Login to the controller</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># source the aliases for ziti (do it the first time you login to the VM)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">source</span><span class="token plain"> ~/.ziti/quickstart/</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">hostname</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-s</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">/</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">hostname</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-s</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">.env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># connect to ziti cli (do this when the token expired)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zitiLogin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># create identity for server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create identity simple-server </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> simpleserver.servers </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> simple-server.jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># enroll identity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge enroll </span><span class="token parameter variable" style="color:#36acaa">--jwt</span><span class="token plain"> simple-server.jwt</span><br></span></code></pre></div></div>
<p>Once the enrollment is complete, there will be a <strong>simple-server.json</strong> file under the current directory. Transfer the file (<strong>simple-server.json</strong>) to your SDK Application server machine, place it under the <strong>simple-server</strong> directory.</p>
<p><strong>NOTE</strong> We will refer this node as &quot;sdk-application-server&quot;, we will come back to this node when we are ready to test the connection.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="383-hostv1-config">3.8.3 host.v1 config<a href="#383-hostv1-config" class="hash-link" aria-label="Direct link to 3.8.3 host.v1 config" title="Direct link to 3.8.3 host.v1 config">â</a></h3>
<p>Since the server is an SDK application, there is no need for <code>host.v1</code> config.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="384-create-an-interceptv1-config">3.8.4 Create an intercept.v1 config<a href="#384-create-an-interceptv1-config" class="hash-link" aria-label="Direct link to 3.8.4 Create an intercept.v1 config" title="Direct link to 3.8.4 Create an intercept.v1 config">â</a></h3>
<p>The intercept config is used to instruct the intercept-side tunneler how to correctly intercept the targeted traffic and put it onto the overlay. We are setting up intercept on dns name &quot;simpleService.ziti&quot;, and we are going to intercept on port 80.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config simple.interceptv1 intercept.v1 </span><span class="token string" style="color:#e3116c">&#x27;{&quot;protocols&quot;: [&quot;tcp&quot;], &quot;addresses&quot;: [&quot;simpleService.ziti&quot;], &quot;portRanges&quot;: [{&quot;low&quot;: 80, &quot;high&quot;: 80}]}&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="385-create-service">3.8.5 Create Service<a href="#385-create-service" class="hash-link" aria-label="Direct link to 3.8.5 Create Service" title="Direct link to 3.8.5 Create Service">â</a></h3>
<p>Usually we need to put two configs (host.v1 and intercept.v1) into a service. Since the SDK application server does not need a host.v1 config, we only need to put intercept.v1 (where the traffic comes from) into the service.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> simpleService </span><span class="token parameter variable" style="color:#36acaa">--configs</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;simple.interceptv1&quot;</span><span class="token plain"> --role-attributes simple-service</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="386-create-bind-service-policy">3.8.6 Create Bind Service policy<a href="#386-create-bind-service-policy" class="hash-link" aria-label="Direct link to 3.8.6 Create Bind Service policy" title="Direct link to 3.8.6 Create Bind Service policy">â</a></h3>
<p>Specify host side endpoints by using the &quot;Bind&quot; service policy</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy simple-client-bind Bind --identity-roles </span><span class="token string" style="color:#e3116c">&#x27;#simpleserver.servers&#x27;</span><span class="token plain"> --service-roles </span><span class="token string" style="color:#e3116c">&#x27;#simple-service&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="387-create-dial-service-policy">3.8.7 Create Dial Service policy<a href="#387-create-dial-service-policy" class="hash-link" aria-label="Direct link to 3.8.7 Create Dial Service policy" title="Direct link to 3.8.7 Create Dial Service policy">â</a></h3>
<p>The dial policy specifies intercept side endpoints.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy simple-client-dial Dial --identity-roles </span><span class="token string" style="color:#e3116c">&#x27;@ingress-tunnel&#x27;</span><span class="token plain"> --service-roles </span><span class="token string" style="color:#e3116c">&#x27;#simple-service&#x27;</span><br></span></code></pre></div></div>
<p>Make sure both policies are setup correctlyï¼</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list service-policies |grep simple-client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 2PQ7Ct6EvK7093qhTyhhe4 â simple-client-bind  â AllOf    â #simple-service    â #simpleserver.servers            â                     â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 7bq9Nag5t5fJyqEYJCiq18 â simple-client-dial  â AllOf    â #simple-service    â @ingress-tunnel                  â                     â</span><br></span></code></pre></div></div>
<p>You should also make sure the policy advisor display correctly:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge policy-advisor services |grep simpleService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OKAY : simple-server (1) -&gt; simpleService (1) Common Routers: (1/1) Dial: N Bind: Y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OKAY : ingress-tunnel (1) -&gt; simpleService (1) Common Routers: (1/1) Dial: Y Bind: N</span><br></span></code></pre></div></div>
<p>Make sure there is a &quot;Dial&quot; line and a &quot;Bind&quot; line. They are both &quot;OKAY&quot; and has at least 1 Common Routers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="388-setup-server-side">3.8.8 Setup Server Side<a href="#388-setup-server-side" class="hash-link" aria-label="Direct link to 3.8.8 Setup Server Side" title="Direct link to 3.8.8 Setup Server Side">â</a></h3>
<p>Login to the &quot;<a href="#382-sdk-application-server">sdk-application-server</a>&quot; node, make sure you are under the &quot;simple-server&quot; directory, start the server by using the registered server identity and service name.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./simple-server &lt;identity&gt; &lt;service name&gt;</span><br></span></code></pre></div></div>
<p>example:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./simple-server simple-server.json simpleService</span><br></span></code></pre></div></div>
<p><strong>output</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./simple-server simple-server.json simpleService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">listening for non-ziti requests on localhost:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Using the provided service name [simpleService]listening for requests for Ziti service simpleService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO[0000] new service session                           session token=806969a4-31d1-4c15-ac56-4998322f9b3e</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="389-verify-the-connection">3.8.9 Verify the connection<a href="#389-verify-the-connection" class="hash-link" aria-label="Direct link to 3.8.9 Verify the connection" title="Direct link to 3.8.9 Verify the connection">â</a></h3>
<p>Login to the Client (<strong>ingress-tunnel</strong>), try the service with the service name we create and any text in the &quot;name&quot; field.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl http://&lt;service name&gt;?name=&lt;any name&gt;</span><br></span></code></pre></div></div>
<p>example:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://simpleService.ziti?name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;the-greatest-show-on-earth&#x27;</span><br></span></code></pre></div></div>
<p><strong>output</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl http://simpleService.ziti?name=&#x27;the-greatest-show-on-earth&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello, the-greatest-show-on-earth, from ziti</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="39-setup-sdk-client-to-sdk-server-connection">3.9 Setup SDK Client to SDK Server connection<a href="#39-setup-sdk-client-to-sdk-server-connection" class="hash-link" aria-label="Direct link to 3.9 Setup SDK Client to SDK Server connection" title="Direct link to 3.9 Setup SDK Client to SDK Server connection">â</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="391-introduction">3.9.1 Introduction<a href="#391-introduction" class="hash-link" aria-label="Direct link to 3.9.1 Introduction" title="Direct link to 3.9.1 Introduction">â</a></h3>
<p>In this section, we will demonstrate how to connect a SDK enabled application to SDK enabled server. Please refer to <a href="#315-network-diagram-5">Network Diagram 5</a> for our test setup.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="392-sdk-application-client-and-server">3.9.2 SDK Application client and server<a href="#392-sdk-application-client-and-server" class="hash-link" aria-label="Direct link to 3.9.2 SDK Application client and server" title="Direct link to 3.9.2 SDK Application client and server">â</a></h3>
<p>We are going to use an existing <a href="https://github.com/openziti/sdk-golang/tree/main/example/chat" target="_blank" rel="noopener noreferrer">SDK implementation</a> for this guide. Since this example includes both client and server code, we will show how to compile it once. You can also copy the executable to the other server.</p>
<p>You will need two linux servers for this demo. You can use the &quot;ingress-tunnel&quot; (as SDK client) and &quot;egress-tunnel&quot; (as SDK server).</p>
<p>Install <strong>go</strong> before you proceed further.</p>
<p>Check out the code from the <a href="https://github.com/openziti/sdk-golang.git" target="_blank" rel="noopener noreferrer">github repo</a>.</p>
<p>example:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># git clone https://github.com/openziti/sdk-golang.git</span><br></span></code></pre></div></div>
<p>cd to the chat directory (example/chat).</p>
<p>example:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># cd sdk-golang/example/chat</span><br></span></code></pre></div></div>
<p>build the chat binaries</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go mod tidy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go build </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> build ./</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre></div></div>
<p>If all goes well, you will find a <strong>chat-client</strong> and <strong>chat-server</strong> binary under the &quot;build&quot; directory.</p>
<p>Next, you need to create identities for this SDK Application client (&quot;chat.client&quot;) and server (&quot;chat.server&quot;).</p>
<p>Login to the controller</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># source the aliases for ziti (do it the first time you login to the VM)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">source</span><span class="token plain"> ~/.ziti/quickstart/</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">hostname</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-s</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">/</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">hostname</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-s</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">.env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># connect to ziti cli (do this when the token expired)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zitiLogin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># create identities</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create identity chat-client </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> chat.clients </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> chat-client.jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create identity chat-server </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> chat.servers </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> chat-server.jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># enroll identities</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge enroll </span><span class="token parameter variable" style="color:#36acaa">--jwt</span><span class="token plain"> chat-client.jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge enroll </span><span class="token parameter variable" style="color:#36acaa">--jwt</span><span class="token plain"> chat-server.jwt</span><br></span></code></pre></div></div>
<p>Once the enrollment is complete, there will be two json files: <strong>chat-client.json</strong> and <strong>chat-server.json</strong> under the current directory. Transfer the client file (<strong>chat-client.json</strong>) to your SDK Application client machine and both files to your server machine, place them under the <strong>chat/build</strong> directory.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="393-create-service">3.9.3 Create Service<a href="#393-create-service" class="hash-link" aria-label="Direct link to 3.9.3 Create Service" title="Direct link to 3.9.3 Create Service">â</a></h3>
<p>For SDK clent connect to SDK client, there is no config needed. We just need to create a service. Please note, the service name has to be &quot;chat&quot;</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> chat --role-attributes chat-service</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="394-create-bind-service-policy">3.9.4 Create Bind Service policy<a href="#394-create-bind-service-policy" class="hash-link" aria-label="Direct link to 3.9.4 Create Bind Service policy" title="Direct link to 3.9.4 Create Bind Service policy">â</a></h3>
<p>Specify host side endpoints by using the &quot;Bind&quot; service policy</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy chat.dial Dial --identity-roles </span><span class="token string" style="color:#e3116c">&#x27;#chat.clients&#x27;</span><span class="token plain"> --service-roles </span><span class="token string" style="color:#e3116c">&#x27;#chat-service&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="395-create-dial-service-policy">3.9.5 Create Dial Service policy<a href="#395-create-dial-service-policy" class="hash-link" aria-label="Direct link to 3.9.5 Create Dial Service policy" title="Direct link to 3.9.5 Create Dial Service policy">â</a></h3>
<p>The dial policy specifies intercept side endpoints.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy chat.bind Bind --identity-roles </span><span class="token string" style="color:#e3116c">&#x27;#chat.servers&#x27;</span><span class="token plain"> --service-roles </span><span class="token string" style="color:#e3116c">&#x27;#chat-service&#x27;</span><br></span></code></pre></div></div>
<p>Make sure both policies are setup correctlyï¼</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge list service-policies |grep chat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 2u9hmMVIj4B3vk016DCWAW â chat.dial           â AllOf    â #chat-service      â #chat.clients                    â                     â</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â 7Pqk6mCdpyJ5A4cqcHaeXd â chat.bind           â AllOf    â #chat-service      â #chat.servers                    â                     â</span><br></span></code></pre></div></div>
<p>You should also make sure the policy advisor display correctly:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ziti edge policy-advisor services |grep chat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OKAY : chat-client (1) -&gt; chatService (1) Common Routers: (1/1) Dial: Y Bind: N</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OKAY : chat-server (1) -&gt; chatService (1) Common Routers: (1/1) Dial: N Bind: Y</span><br></span></code></pre></div></div>
<p>Make sure there is a &quot;Dial&quot; line and a &quot;Bind&quot; line. They are both &quot;OKAY&quot; and has at least 1 Common Routers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="396-chat-server">3.9.6 Chat Server<a href="#396-chat-server" class="hash-link" aria-label="Direct link to 3.9.6 Chat Server" title="Direct link to 3.9.6 Chat Server">â</a></h3>
<p>The Chat Server relays the communicates between clients. So, let&#x27;s start te server first.
Make sure you are under the directory: &quot;chat/build&quot;</p>
<p>Run the server:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./chat-server chat-server.json</span><br></span></code></pre></div></div>
<p>As the clients login to the server, you will see output like this:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">INFO[0000] binding service chat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO[0000] new service session                           session token=3a3fa473-0bac-42ed-8bff-ff3d91ef7b1f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO[0049] new connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO[0049] client &#x27;Adam&#x27; connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO[0196] new connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO[0196] client &#x27;Bryan&#x27; connected</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="397-test-chat">3.9.7 Test Chat<a href="#397-test-chat" class="hash-link" aria-label="Direct link to 3.9.7 Test Chat" title="Direct link to 3.9.7 Test Chat">â</a></h3>
<p>We will start the chat clients on different machines. Then you can start the chat.  Following is an example communication between two Clients (Adam and Bryan)</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">########### SDK Client (Adam) ############  ########### SDK Server (Bryan) ############</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># $ ./chat-client Adam chat-client.json  #  # $ ./chat-client Bryan chat-client.json  # </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># I am Adam                              #  #                                         #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#                                        #  # Adam: I am Adam                         #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#                                        #  # Hi Adam                                 #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Bryan: Hi Adam                         #  #                                         #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#                                        #  # I am Bryan                              #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Bryan: I am Bryan                      #  #                                         #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Nice to meet you                       #  #                                         #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#                                        #  # Adam: Nice to meet you                  #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#######################################################################################</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/guides/topologies/10-services.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-06-16T20:04:35.000Z" itemprop="dateModified">Jun 16, 2025</time></b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/topologies"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Topologies</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/gateway"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Gateway</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#30-ziti-services" class="table-of-contents__link toc-highlight">3.0 Ziti services</a></li><li><a href="#31-introduction" class="table-of-contents__link toc-highlight">3.1 Introduction</a><ul><li><a href="#311-network-diagram-1" class="table-of-contents__link toc-highlight">3.1.1 Network Diagram 1</a></li><li><a href="#312-network-diagram-2" class="table-of-contents__link toc-highlight">3.1.2 Network Diagram 2</a></li><li><a href="#313-network-diagram-3" class="table-of-contents__link toc-highlight">3.1.3 Network Diagram 3</a></li><li><a href="#314-network-diagram-4" class="table-of-contents__link toc-highlight">3.1.4 Network Diagram 4</a></li><li><a href="#315-network-diagram-5" class="table-of-contents__link toc-highlight">3.1.5 Network Diagram 5</a></li></ul></li><li><a href="#32-set-up-vms-for-ziti-network" class="table-of-contents__link toc-highlight">3.2 Set up VMs for ziti network</a><ul><li><a href="#321-controller" class="table-of-contents__link toc-highlight">3.2.1 Controller</a></li><li><a href="#322-router" class="table-of-contents__link toc-highlight">3.2.2 Router</a></li><li><a href="#323-tunnelersidentities" class="table-of-contents__link toc-highlight">3.2.3 Tunnelers/Identities</a></li></ul></li><li><a href="#33-create-edge-router-policy" class="table-of-contents__link toc-highlight">3.3 Create Edge Router Policy</a><ul><li><a href="#331-zac" class="table-of-contents__link toc-highlight">3.3.1 ZAC</a></li><li><a href="#332-cli" class="table-of-contents__link toc-highlight">3.3.2 CLI</a></li></ul></li><li><a href="#34-set-up-tunneled-ssh-connection" class="table-of-contents__link toc-highlight">3.4 Set up Tunneled SSH Connection</a><ul><li><a href="#341-create-a-hostv1-config" class="table-of-contents__link toc-highlight">3.4.1 Create a host.v1 config</a></li><li><a href="#342-create-an-interceptv1-config" class="table-of-contents__link toc-highlight">3.4.2 Create an intercept.v1 config</a></li><li><a href="#343-create-service" class="table-of-contents__link toc-highlight">3.4.3 Create Service</a></li><li><a href="#344-create-bind-service-policy" class="table-of-contents__link toc-highlight">3.4.4 Create Bind Service policy</a></li><li><a href="#345-create-dial-service-policy" class="table-of-contents__link toc-highlight">3.4.5 Create Dial Service policy</a></li><li><a href="#346-verify-the-connection" class="table-of-contents__link toc-highlight">3.4.6 Verify the connection</a></li></ul></li><li><a href="#35-setup-tunnel-to-ert-http-connection" class="table-of-contents__link toc-highlight">3.5 Setup Tunnel to ERT http connection</a><ul><li><a href="#351-create-a-hostv1-config" class="table-of-contents__link toc-highlight">3.5.1 Create a host.v1 config</a></li><li><a href="#352-create-an-interceptv1-config" class="table-of-contents__link toc-highlight">3.5.2 Create an intercept.v1 config</a></li><li><a href="#353-create-service" class="table-of-contents__link toc-highlight">3.5.3 Create Service</a></li><li><a href="#354-create-bind-service-policy" class="table-of-contents__link toc-highlight">3.5.4 Create Bind Service policy</a></li><li><a href="#355-create-dial-service-policy" class="table-of-contents__link toc-highlight">3.5.5 Create Dial Service policy</a></li><li><a href="#356-verify-the-connection" class="table-of-contents__link toc-highlight">3.5.6 Verify the connection</a></li><li><a href="#357-conclusion" class="table-of-contents__link toc-highlight">3.5.7 Conclusion</a></li></ul></li><li><a href="#36-setup-connection-from-a-non-openziti-client" class="table-of-contents__link toc-highlight">3.6 Setup Connection from a non-OpenZiti client</a><ul><li><a href="#361-introduction" class="table-of-contents__link toc-highlight">3.6.1 Introduction</a></li><li><a href="#362-create-a-hostv1-config" class="table-of-contents__link toc-highlight">3.6.2 Create a host.v1 config</a></li><li><a href="#363-create-an-interceptv1-config" class="table-of-contents__link toc-highlight">3.6.3 Create an intercept.v1 config</a></li><li><a href="#364-create-service" class="table-of-contents__link toc-highlight">3.6.4 Create Service</a></li><li><a href="#365-create-bind-service-policy" class="table-of-contents__link toc-highlight">3.6.5 Create Bind Service policy</a></li><li><a href="#366-create-dial-service-policy" class="table-of-contents__link toc-highlight">3.6.6 Create Dial Service policy</a></li><li><a href="#367-verify-the-connection" class="table-of-contents__link toc-highlight">3.6.7 Verify the connection</a></li></ul></li><li><a href="#37-setup-sdk-enabled-application-to-access-a-server" class="table-of-contents__link toc-highlight">3.7 Setup SDK enabled application to access a server</a><ul><li><a href="#371-introduction" class="table-of-contents__link toc-highlight">3.7.1 Introduction</a></li><li><a href="#372-sdk-application-client" class="table-of-contents__link toc-highlight">3.7.2 SDK Application client</a></li><li><a href="#373-create-a-hostv1-config" class="table-of-contents__link toc-highlight">3.7.3 Create a host.v1 config</a></li><li><a href="#374-create-service" class="table-of-contents__link toc-highlight">3.7.4 Create Service</a></li><li><a href="#375-create-bind-service-policy" class="table-of-contents__link toc-highlight">3.7.5 Create Bind Service policy</a></li><li><a href="#376-create-dial-service-policy" class="table-of-contents__link toc-highlight">3.7.6 Create Dial Service policy</a></li><li><a href="#377-setup-server-side" class="table-of-contents__link toc-highlight">3.7.7 Setup Server Side</a></li><li><a href="#378-verify-the-connection" class="table-of-contents__link toc-highlight">3.7.8 Verify the connection</a></li></ul></li><li><a href="#38-access-a-sdk-enabled-application-via-ziti-tunnel" class="table-of-contents__link toc-highlight">3.8 Access a SDK enabled application via ziti-tunnel</a><ul><li><a href="#381-introduction" class="table-of-contents__link toc-highlight">3.8.1 Introduction</a></li><li><a href="#382-sdk-application-server" class="table-of-contents__link toc-highlight">3.8.2 SDK Application server</a></li><li><a href="#383-hostv1-config" class="table-of-contents__link toc-highlight">3.8.3 host.v1 config</a></li><li><a href="#384-create-an-interceptv1-config" class="table-of-contents__link toc-highlight">3.8.4 Create an intercept.v1 config</a></li><li><a href="#385-create-service" class="table-of-contents__link toc-highlight">3.8.5 Create Service</a></li><li><a href="#386-create-bind-service-policy" class="table-of-contents__link toc-highlight">3.8.6 Create Bind Service policy</a></li><li><a href="#387-create-dial-service-policy" class="table-of-contents__link toc-highlight">3.8.7 Create Dial Service policy</a></li><li><a href="#388-setup-server-side" class="table-of-contents__link toc-highlight">3.8.8 Setup Server Side</a></li><li><a href="#389-verify-the-connection" class="table-of-contents__link toc-highlight">3.8.9 Verify the connection</a></li></ul></li><li><a href="#39-setup-sdk-client-to-sdk-server-connection" class="table-of-contents__link toc-highlight">3.9 Setup SDK Client to SDK Server connection</a><ul><li><a href="#391-introduction" class="table-of-contents__link toc-highlight">3.9.1 Introduction</a></li><li><a href="#392-sdk-application-client-and-server" class="table-of-contents__link toc-highlight">3.9.2 SDK Application client and server</a></li><li><a href="#393-create-service" class="table-of-contents__link toc-highlight">3.9.3 Create Service</a></li><li><a href="#394-create-bind-service-policy" class="table-of-contents__link toc-highlight">3.9.4 Create Bind Service policy</a></li><li><a href="#395-create-dial-service-policy" class="table-of-contents__link toc-highlight">3.9.5 Create Dial Service policy</a></li><li><a href="#396-chat-server" class="table-of-contents__link toc-highlight">3.9.6 Chat Server</a></li><li><a href="#397-test-chat" class="table-of-contents__link toc-highlight">3.9.7 Test Chat</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="layoutFooter_Rs4I ozFooter_Avh_"><section class="footer_TVlg ozHorizontalSectionRoot_MIa6 ozhsContent_Tzp1"><div class="footerContainer_otJT"><div class="footerGrid_DfDa"><div class="footerColumn_aKLl"><h3>OpenZiti</h3><p>An open source project enabling developers to embed zero trust networking directly into applications.</p><div class="footerSocialLinks_HWin"><a href="https://github.com/openziti/ziti" target="_blank" class="footerSocialLink_t5Hs"><svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"></path></svg></a><a href="https://www.linkedin.com/company/netfoundry" target="_blank" class="footerSocialLink_t5Hs"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.996 16V10.1C15.996 7.5 15.375 5.49999 12.025 5.49999C10.4 5.49999 9.325 6.39999 8.875 7.29999H8.825V5.79999H5.65V16H8.95V10.7C8.95 9.30001 9.2 7.9 10.925 7.9C12.65 7.9 12.675 9.59999 12.675 10.8V16H15.996Z"></path><path d="M0.25 5.79999H3.575V16H0.25V5.79999Z"></path><path d="M1.9 0C0.85 0 0 0.85 0 1.9C0 2.95 0.85 3.8 1.9 3.8C2.95 3.8 3.8 2.95 3.8 1.9C3.8 0.85 2.95 0 1.9 0Z"></path></svg></a><a href="https://www.youtube.com/OpenZiti" target="_blank" class="footerSocialLink_t5Hs"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.969 4.69c-.183-1.358-1.062-2.275-2.361-2.46C12.371 2 8 2 8 2S3.629 2 2.362 2.229c-1.3.186-2.179 1.103-2.361 2.461C0 6.03 0 10 0 10s0 3.97.2 5.31c.183 1.358 1.062 2.275 2.361 2.46C3.63 18 8 18 8 18s4.371 0 5.638-.23c1.3-.185 2.178-1.102 2.361-2.46.2-1.34.2-5.31.2-5.31s0-3.97-.23-5.31zm-8.36, 8.57V6.73l3.76 2.27-3.76 2.26z"></path></svg></a><a href="https://x.com/OpenZiti" target="_blank" class="footerSocialLink_t5Hs"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.996 3.038c-.59.262-1.219.44-1.885.52.677-.406 1.194-1.05 1.438-1.815-.634.375-1.337.648-2.085.795-.598-.638-1.45-1.038-2.396-1.038-1.813 0-3.283 1.469-3.283 3.282 0 .257.03.507.085.748-2.728-.137-5.147-1.445-6.766-3.43-.282.485-.444 1.05-.444 1.651 0 1.14.58 2.143 1.46 2.732-.538-.017-1.044-.164-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.219-.276.075-.567.116-.866.116-.211 0-.416-.021-.617-.06.418 1.304 1.63 2.254 3.066 2.28-1.124.883-2.539 1.406-4.077 1.406-.265 0-.526-.015-.785-.046 1.453.933 3.178 1.475 5.032 1.475 6.038 0 9.34-5.002 9.34-9.34 0-.142-.004-.284-.01-.425.641-.463 1.198-1.039 1.638-1.696"></path></svg></a></div></div><div class="footerColumn_aKLl"><h3>Documentation</h3><ul class="footerLinks_fOY0"><li><a href="/docs/learn/quickstarts/services/ztha">Getting Started</a></li><li><a href="/docs/reference/developer/api/">API Reference</a></li><li><a href="/docs/reference/developer/sdk/">SDK Integration</a></li></ul></div><div class="footerColumn_aKLl"><h3>Community</h3><ul class="footerLinks_fOY0"><li><a href="https://github.com/openziti/ziti">GitHub</a></li><li><a href="https://openziti.discourse.group/">Discourse Forum</a></li><li><a href="/policies/CONTRIBUTING">Contributing</a></li></ul></div><div class="footerColumn_aKLl"><h3>Resources</h3><ul class="footerLinks_fOY0"><li><a href="https://blog.openziti.io">Blog</a></li><li><a href="https://netfoundry.io/">NetFoundry</a></li></ul></div></div></div><div class="footerCopyright_W7lP"><p>Â© 2025 NetFoundry Inc. OpenZiti is an open source project sponsored by NetFoundry. All rights reserved.</p></div></section></footer></div></div>
</body>
</html>