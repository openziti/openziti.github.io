<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/topologies/gateway/router" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.0">
<title data-rh="true">Use a Router as a Local Gateway | OpenZiti</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://openziti.io/docs/guides/topologies/gateway/router"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="robots" content="index, follow"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Use a Router as a Local Gateway | OpenZiti"><meta data-rh="true" name="description" content="1.0 Introduction"><meta data-rh="true" property="og:description" content="1.0 Introduction"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://openziti.io/docs/guides/topologies/gateway/router"><link data-rh="true" rel="alternate" href="https://openziti.io/docs/guides/topologies/gateway/router" hreflang="en"><link data-rh="true" rel="alternate" href="https://openziti.io/docs/guides/topologies/gateway/router" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EXWPKK5PV4-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Topologies","item":"https://openziti.io/docs/category/topologies"},{"@type":"ListItem","position":2,"name":"Gateway","item":"https://openziti.io/docs/category/gateway"},{"@type":"ListItem","position":3,"name":"Router","item":"https://openziti.io/docs/guides/topologies/gateway/router"}]}</script><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-5SF399H3",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>





<link rel="search" type="application/opensearchdescription+xml" title="OpenZiti" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.776b8118.css">
<script src="/assets/js/runtime~main.51eff58e.js" defer="defer"></script>
<script src="/assets/js/main.52098041.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5SF399H3" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>




<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/ziti-logo-dark.svg"><link rel="preload" as="image" href="/img/ziti-logo-light.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="starUsRoot_Cir2"><span style="color:whitesmoke">Star us on GitHub </span><span style="height:20px"><span><a href="https://github.com/openziti/ziti" data-icon="octicon-star" data-show-count="true" aria-label="Star buttons/github-buttons on GitHub">Star</a></span></span></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://openziti.io" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/ziti-logo-dark.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/ziti-logo-light.svg" alt="The OpenZiti logo, an open source zero trust network overlay" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/learn/introduction/">Documentation</a><a class="navbar__item navbar__link" href="/docs/downloads">Downloads</a><a href="https://blog.openziti.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Links</a><ul class="dropdown__menu"><li class=""><div class="text-divider"><p>Socials</p></div></li><li class=""><a href="https://www.youtube.com/OpenZiti" target="_blank" title="OpenZiti on YouTube"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/yt.svg">YouTube</span></a></li><li class=""><a href="https://x.com/OpenZiti" target="_blank" title="OpenZiti on X(formerly Twitter)"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/twit.svg">Twitter</span></a></li><li class=""><a href="https://www.reddit.com/r/openziti" target="_blank" title="OpenZiti Subreddit"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/reddit-logo.png">Reddit</span></a></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/ziggy.png"><a href="https://x.com/OpenZiggy" target="_blank" title="OpenZiggy on Twitter">Ziggy</a></span></li><li class=""><div class="text-divider"><p>Other</p></div></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/blog-icon.png"><a href="https://blog.openziti.io/" target="_blank" title="Blog">Blog</a></span></li><li class=""><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/oz-test-kitchen.png"><a href="https://github.com/openziti-test-kitchen" target="_blank" title="Git project for the test kitchen">Test Kitchen</a></span></li></ul></div><a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discourse-link" title="Discourse"></a><a href="https://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_eExm"><div class="wrapperDiv_MU_d"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 sidebar-title"><a class="menu__link" href="/docs/learn/introduction/">LEARN</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/learn/introduction/">What is OpenZiti?</a><button aria-label="Expand sidebar category &#x27;What is OpenZiti?&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/learn/quickstarts/">Quickstarts</a><button aria-label="Expand sidebar category &#x27;Quickstarts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/core-concepts">Core Concepts</a><button aria-label="Expand sidebar category &#x27;Core Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learn/identity-providers/">Identity Providers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 sidebar-title"><a class="menu__link" href="/docs/reference/">REFERENCE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference/configuration/conventions">Configuration</a><button aria-label="Expand sidebar category &#x27;Configuration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/reference/ha/overview">Controller Clustering</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference/tunnelers/">Tunnelers</a><button aria-label="Expand sidebar category &#x27;Tunnelers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/command-line/login">CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/logging">Logging</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference/config-types/">Config Types</a><button aria-label="Expand sidebar category &#x27;Config Types&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/events">Events</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/reference/developer/">Developer</a><button aria-label="Expand sidebar category &#x27;Developer&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 sidebar-title"><a class="menu__link" href="/docs/guides/">GUIDES</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guides/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/deployments">Deployments</a><button aria-label="Expand sidebar category &#x27;Deployments&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/guides/external-auth/">Configuring OIDC</a><button aria-label="Expand sidebar category &#x27;Configuring OIDC&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/guides/hsm/">Hardware Keys</a><button aria-label="Expand sidebar category &#x27;Hardware Keys&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/topologies">Topologies</a><button aria-label="Collapse sidebar category &#x27;Topologies&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/topologies/services">Services</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/gateway">Gateway</a><button aria-label="Collapse sidebar category &#x27;Gateway&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/guides/topologies/gateway/router">Router</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/topologies/gateway/tunneler">Tunneler</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/troubleshooting">Troubleshooting</a><button aria-label="Expand sidebar category &#x27;Troubleshooting&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/topologies"><span>Topologies</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/gateway"><span>Gateway</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Router</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Use a Router as a Local Gateway</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="10-introduction">1.0 Introduction<a href="#10-introduction" class="hash-link" aria-label="Direct link to 1.0 Introduction" title="Direct link to 1.0 Introduction">​</a></h2>
<p>This article is about using <code>ziti router run</code> in TPROXY mode as an infrastructure gateway providing an IP route and nameserver for ziti services on a local subnet.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="11-network-description">1.1 Network Description<a href="#11-network-description" class="hash-link" aria-label="Direct link to 1.1 Network Description" title="Direct link to 1.1 Network Description">​</a></h2>
<iframe width="100%" height="315" src="https://www.youtube.com/embed/H0qGRBMGNIA" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"></iframe>
<p>In addition to the setup discussed in the video, this guide also demonstrates IP intercept in <a href="#50-http-service-configuration">Section 5.0 http Service Configuration</a>.</p>
<p>For the demonstration, we will set up the network like below:</p>
<hr>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/LocalGW01-989f642b8f73362db6324b3bc88d3c71.png" width="839" height="672" class="img_ev3q"></p>
<hr>
<ul>
<li>There are two Ziti-Edge-Routers (<strong>local-router</strong> and <strong>remote-router</strong>) as LAN gateways.</li>
<li>The Windows machine (<strong>Windows Client</strong>) is in the same subnet (172.16.31.0/24) as Router (<strong>local-router</strong>).</li>
<li>The Ubuntu 22.04 server (<strong>Ubuntu Server</strong>) is in the same subnet (172.16.240.0/24) as Router (<strong>remote-router</strong>).</li>
<li>The data (SSH) will be passed between the Windows Client and the Ubuntu Server.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="12-prerequisite">1.2 Prerequisite<a href="#12-prerequisite" class="hash-link" aria-label="Direct link to 1.2 Prerequisite" title="Direct link to 1.2 Prerequisite">​</a></h2>
<p>Complete the following steps first.</p>
<ul>
<li>An open-ziti network should be created already. If not, please follow this quickstart <a href="/docs/learn/quickstarts/network/hosted">Host OpenZiti Anywhere</a> guide to set up a ziti network first. <strong>NOTE</strong>, the router link listener port (<strong>10080</strong>) needs to be opened on the firewall if this is the only transit router you have on the network.</li>
<li>Get the controller IP or DNS name</li>
<li>Get the controller Fabric Port: On the controller, issue this command <strong>echo $ZITI_CTRL_ADVERTISED_PORT</strong></li>
<li>Get the controller Management Port: On the controller, issue this command <strong>echo $ZITI_CTRL_EDGE_ADVERTISED_PORT</strong></li>
<li>Get the controller Passwd: On the controller, issue this command <strong>echo $ZITI_PWD</strong></li>
<li>Created two target VMs to host <em>routers</em>. The VMs should be running on <strong>Ubuntu 22.04</strong>.</li>
<li>Created one <em>Windows client</em> already. Suggested Windows version Windows 10 or Windows 11. Windows servers should work fine as well.</li>
<li>Created one <em>ubuntu server</em> already. Or any Linux server capable of accepting SSH and http connection.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="20-set-up-routers">2.0 Set Up Routers<a href="#20-set-up-routers" class="hash-link" aria-label="Direct link to 2.0 Set Up Routers" title="Direct link to 2.0 Set Up Routers">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="21-set-up-the-router-for-windows-subnet">2.1 Set Up the Router For Windows Subnet<a href="#21-set-up-the-router-for-windows-subnet" class="hash-link" aria-label="Direct link to 2.1 Set Up the Router For Windows Subnet" title="Direct link to 2.1 Set Up the Router For Windows Subnet">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="211-retrieve-auto_enroll-script-and-gather-setup-info">2.1.1 Retrieve auto_enroll script and gather setup info<a href="#211-retrieve-auto_enroll-script-and-gather-setup-info" class="hash-link" aria-label="Direct link to 2.1.1 Retrieve auto_enroll script and gather setup info" title="Direct link to 2.1.1 Retrieve auto_enroll script and gather setup info">​</a></h3>
<p><strong>SSH</strong> into your router VM (<strong>local-router</strong>).</p>
<p>Retrieve <strong>ziti_router_auto_enroll</strong> to set up your router.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://github.com/netfoundry/ziti_router_auto_enroll/releases/latest/download/ziti_router_auto_enroll.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar xf ziti_router_auto_enroll.tar.gz</span><br></span></code></pre></div></div>
<p>You should have a file <strong>ziti_router_auto_enroll</strong> under the directory.</p>
<p>Here is information I gathered from <strong>Prerequisite</strong> step:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@LocalGWDemoNC:~# curl -s eth0.me</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">68.183.139.122  &lt;--- Controller IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@LocalGWDemoNC:~# echo $ZITI_CTRL_ADVERTISED_PORT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8440  &lt;--- Controller Fabric Port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@LocalGWDemoNC:~# echo $ZITI_CTRL_EDGE_ADVERTISED_PORT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8441  &lt;--- Controller Management Port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@LocalGWDemoNC:~# echo $ZITI_PWD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test@123  &lt;--- Controller Passwd</span><br></span></code></pre></div></div>
<p>We are going to use Router Name: <strong>local-router</strong></p>
<p>We are also going to create the router without healthcheck section, so the following option will be used to create the router:</p>
<ul>
<li>--disableHealthChecks</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="212-create-and-register-router">2.1.2 Create and Register Router<a href="#212-create-and-register-router" class="hash-link" aria-label="Direct link to 2.1.2 Create and Register Router" title="Direct link to 2.1.2 Create and Register Router">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2121-create-router-using-one-command">2.1.2.1 Create Router using one command<a href="#2121-create-router-using-one-command" class="hash-link" aria-label="Direct link to 2.1.2.1 Create Router using one command" title="Direct link to 2.1.2.1 Create Router using one command">​</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./ziti_router_auto_enroll -f -n --controller 68.183.139.122 --controllerFabricPort 8440 --controllerMgmtPort 8441 --adminUser admin --adminPassword Test@123 --disableHealthChecks --autoTunnelListener --routerName local-router</span><br></span></code></pre></div></div>
<p>What this command does:</p>
<ul>
<li>contacts the controller</li>
<li>creates a router named &quot;local-router&quot; (with tunneler enabled) on the controller</li>
<li>generates the conf.yml locally</li>
<li>downloads the jwt file for the router from controller</li>
<li>enrolls the router with the jwt and the generated conf.yml</li>
<li>creates the service file to start and stop the router</li>
<li>and configured the resolver</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2122-register-router-using-jwt">2.1.2.2 Register Router using jwt<a href="#2122-register-router-using-jwt" class="hash-link" aria-label="Direct link to 2.1.2.2 Register Router using jwt" title="Direct link to 2.1.2.2 Register Router using jwt">​</a></h4>
<p><em><strong>Skip this section if you already created router using one command</strong></em></p>
<p>An alternative way to register router is creating it on the controller first and then register it on the router VM.</p>
<p>Create Router and retrieve JWT on the <strong>controller</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">zitiLogin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># the followin will create a edge router with tunneler enabled on the controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create edge-router local-router -o local-router.jwt -t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat local-router.jwt</span><br></span></code></pre></div></div>
<p>Copy the output of &quot;local-router.jwt&quot; and register the router on the <strong>router VM</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441  --disableHealthChecks  --autoTunnelListener  &lt;jwt content&gt;</span><br></span></code></pre></div></div>
<p>What this command does:</p>
<ul>
<li>contacts the controller using info in the JWT.</li>
<li>generates the conf.yml locally</li>
<li>enrolls the router with the jwt and the generated conf.yml</li>
<li>creates the service file to start and stop the router</li>
<li>and configured the resolver</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="213-check-the-installation">2.1.3 Check the installation<a href="#213-check-the-installation" class="hash-link" aria-label="Direct link to 2.1.3 Check the installation" title="Direct link to 2.1.3 Check the installation">​</a></h3>
<p>You do not have to perform this step if your installation was successful.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2131-ziti-router-service">2.1.3.1 ziti-router service<a href="#2131-ziti-router-service" class="hash-link" aria-label="Direct link to 2.1.3.1 ziti-router service" title="Direct link to 2.1.3.1 ziti-router service">​</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl status ziti-router</span><br></span></code></pre></div></div>
<p><strong>expected output:</strong> The status should show &quot;active (running)&quot;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@local-gw:~$ systemctl status ziti-router</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">● ziti-router.service - Ziti-Router</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Loaded: loaded (/etc/systemd/system/ziti-router.service; enabled; vendor preset: enabled)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Active: active (running) since Mon 2023-05-01 19:51:54 UTC; 1min 48s ago</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;... output truncated ...&gt;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2132-resolver">2.1.3.2 resolver<a href="#2132-resolver" class="hash-link" aria-label="Direct link to 2.1.3.2 resolver" title="Direct link to 2.1.3.2 resolver">​</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">resolvectl</span><br></span></code></pre></div></div>
<div class="language-buttonless codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-buttonless codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@local-gw:~$ hostname -I</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">172.16.31.173</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@local-gw:~$ resolvectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Global</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resolv.conf mode: stub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current DNS Server: 172.16.31.173</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       DNS Servers: 172.16.31.173</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Link 2 (ens160)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Current Scopes: DNS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         Protocols: +DefaultRoute +LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current DNS Server: 8.8.8.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       DNS Servers: 8.8.8.8</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2133-check-router-and-identity">2.1.3.3 Check Router and Identity<a href="#2133-check-router-and-identity" class="hash-link" aria-label="Direct link to 2.1.3.3 Check Router and Identity" title="Direct link to 2.1.3.3 Check Router and Identity">​</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge login 68.183.139.122:8441 -u admin -p Test@123 -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge list edge-routers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge list identities</span><br></span></code></pre></div></div>
<div class="language-buttonless codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-buttonless codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@local-gw:~$ ziti edge login 68.183.139.122:8441 -u admin -p Test@123 -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Token: 0b3a8cc6-dc76-4a94-a502-04380586b49a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Saving identity &#x27;default&#x27; to /home/ziggy/.config/ziti/ziti-cli.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@local-gw:~$ ziti edge list edge-routers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╭────────────┬───────────────────────────┬────────┬───────────────┬──────┬────────────╮</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ID         │ NAME                      │ ONLINE │ ALLOW TRANSIT │ COST │ ATTRIBUTES │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────┼───────────────────────────┼────────┼───────────────┼──────┼────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ .t9Gno26Y  │ local-router              │ true   │ true          │    0 │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ xCW0lSWpcn │ LocalGWDemoNC-edge-router │ true   │ true          │    0 │ public     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╰────────────┴───────────────────────────┴────────┴───────────────┴──────┴────────────╯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-2 of 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@local-gw:~$ ziti edge list identities</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╭────────────┬───────────────────────────┬────────┬────────────┬─────────────╮</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ID         │ NAME                      │ TYPE   │ ATTRIBUTES │ AUTH-POLICY │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────┼───────────────────────────┼────────┼────────────┼─────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ .t9Gno26Y  │ local-router              │ Router │            │ default     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ lIend76Tu  │ Default Admin             │ User   │            │ default     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ xCW0lSWpcn │ LocalGWDemoNC-edge-router │ Router │            │ default     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╰────────────┴───────────────────────────┴────────┴────────────┴─────────────╯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-3 of 3</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="214-set-up-ufw">2.1.4 Set Up ufw<a href="#214-set-up-ufw" class="hash-link" aria-label="Direct link to 2.1.4 Set Up ufw" title="Direct link to 2.1.4 Set Up ufw">​</a></h3>
<p>The following steps turn on the ufw firewall and opens the ports for this demo.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to 172.16.31.173/32 port 53 proto udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to 172.16.31.173/32 port 22 proto tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to 172.16.31.173/32 port 80 proto tcp</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="215-add-attribute-clients-to-the-identity">2.1.5 add attribute &quot;clients&quot; to the identity<a href="#215-add-attribute-clients-to-the-identity" class="hash-link" aria-label="Direct link to 2.1.5 add attribute &quot;clients&quot; to the identity" title="Direct link to 2.1.5 add attribute &quot;clients&quot; to the identity">​</a></h3>
<p>We want to add attribute &quot;clients&quot; to the identity associated with the edge router.</p>
<p><em><strong>You do not need to login again if your token has not expired yet</strong></em></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge login 68.183.139.122:8441 -u admin -p Test@123 -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge update identity local-router -a clients</span><br></span></code></pre></div></div>
<div class="language-buttonless codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-buttonless codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@local-gw:~$ ziti edge update identity local-router -a clients</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@local-gw:~$ ziti edge list identities</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╭────────────┬───────────────────────────┬────────┬────────────┬─────────────╮</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ID         │ NAME                      │ TYPE   │ ATTRIBUTES │ AUTH-POLICY │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────┼───────────────────────────┼────────┼────────────┼─────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ .t9Gno26Y  │ local-router              │ Router │ clients    │ default     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ lIend76Tu  │ Default Admin             │ User   │            │ default     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ xCW0lSWpcn │ LocalGWDemoNC-edge-router │ Router │            │ default     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╰────────────┴───────────────────────────┴────────┴────────────┴─────────────╯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-3 of 3</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="22-set-up-the-router-for-ubuntu-server-subnet">2.2 Set Up the Router For Ubuntu Server Subnet<a href="#22-set-up-the-router-for-ubuntu-server-subnet" class="hash-link" aria-label="Direct link to 2.2 Set Up the Router For Ubuntu Server Subnet" title="Direct link to 2.2 Set Up the Router For Ubuntu Server Subnet">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="221-retrieve-auto_enroll-script-and-gather-setup-info">2.2.1 Retrieve auto_enroll script and gather setup info<a href="#221-retrieve-auto_enroll-script-and-gather-setup-info" class="hash-link" aria-label="Direct link to 2.2.1 Retrieve auto_enroll script and gather setup info" title="Direct link to 2.2.1 Retrieve auto_enroll script and gather setup info">​</a></h3>
<p><strong>SSH</strong> into your router VM (<strong>remote-router</strong>).</p>
<p>Retrieve <strong>ziti_router_auto_enroll</strong> to set up your router automatically.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://github.com/netfoundry/ziti_router_auto_enroll/releases/latest/download/ziti_router_auto_enroll.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar xf ziti_router_auto_enroll.tar.gz</span><br></span></code></pre></div></div>
<p><strong>Info for the controller is same as previous setup, please refer to section 2.1.1 for detail.</strong></p>
<p>We are going to use Router Name: <strong>remote-router</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="222-create-and-register-router">2.2.2 Create and Register Router<a href="#222-create-and-register-router" class="hash-link" aria-label="Direct link to 2.2.2 Create and Register Router" title="Direct link to 2.2.2 Create and Register Router">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2221-create-router-using-one-command">2.2.2.1 Create Router using one command<a href="#2221-create-router-using-one-command" class="hash-link" aria-label="Direct link to 2.2.2.1 Create Router using one command" title="Direct link to 2.2.2.1 Create Router using one command">​</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./ziti_router_auto_enroll -f -n --controller 68.183.139.122 --controllerFabricPort 8440 --controllerMgmtPort 8441 --adminUser admin --adminPassword Test@123 --disableHealthChecks --autoTunnelListener --routerName remote-router</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2222-register-router-using-jwt">2.2.2.2 Register Router using jwt<a href="#2222-register-router-using-jwt" class="hash-link" aria-label="Direct link to 2.2.2.2 Register Router using jwt" title="Direct link to 2.2.2.2 Register Router using jwt">​</a></h4>
<p><strong>Skip this section if you already created router using one command</strong></p>
<p>An alternative way to register router is creating it on the controller first and then register it on the router VM.</p>
<p>Create Router and retrieve JWT on the <strong>controller</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">zitiLogin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># the followin will create a edge router with tunneler enabled on the controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create edge-router remote-router -o remote-router.jwt -t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat remote-router.jwt</span><br></span></code></pre></div></div>
<p>Copy the output of &quot;remote-router.jwt&quot; and register the router on the <strong>router VM</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441  --disableHealthChecks  --autoTunnelListener  &lt;jwt content&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="223-check-the-installation">2.2.3 Check the installation<a href="#223-check-the-installation" class="hash-link" aria-label="Direct link to 2.2.3 Check the installation" title="Direct link to 2.2.3 Check the installation">​</a></h3>
<p>You do not have to perform this step if your installation was successful.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2231-ziti-router-service">2.2.3.1 ziti-router service<a href="#2231-ziti-router-service" class="hash-link" aria-label="Direct link to 2.2.3.1 ziti-router service" title="Direct link to 2.2.3.1 ziti-router service">​</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl status ziti-router</span><br></span></code></pre></div></div>
<p><strong>expected output:</strong> The status should show &quot;active (running)&quot;</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2232-resolver">2.2.3.2 resolver<a href="#2232-resolver" class="hash-link" aria-label="Direct link to 2.2.3.2 resolver" title="Direct link to 2.2.3.2 resolver">​</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">resolvectl</span><br></span></code></pre></div></div>
<p><strong>expected output:</strong> The resolver should be set to the IP of the local LAN.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2233-check-router-and-identity">2.2.3.3 Check Router and Identity<a href="#2233-check-router-and-identity" class="hash-link" aria-label="Direct link to 2.2.3.3 Check Router and Identity" title="Direct link to 2.2.3.3 Check Router and Identity">​</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge login 68.183.139.122:8441 -u admin -p Test@123 -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge list edge-routers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge list identities</span><br></span></code></pre></div></div>
<div class="language-buttonless codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-buttonless codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@remote-router:~$ ziti edge list edge-routers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╭────────────┬───────────────────────────┬────────┬───────────────┬──────┬────────────╮</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ID         │ NAME                      │ ONLINE │ ALLOW TRANSIT │ COST │ ATTRIBUTES │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────┼───────────────────────────┼────────┼───────────────┼──────┼────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ .t9Gno26Y  │ local-router              │ true   │ true          │    0 │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 967-JQe6s  │ remote-router             │ true   │ true          │    0 │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ xCW0lSWpcn │ LocalGWDemoNC-edge-router │ true   │ true          │    0 │ public     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╰────────────┴───────────────────────────┴────────┴───────────────┴──────┴────────────╯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-3 of 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@remote-router:~$ ziti edge list identities</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╭────────────┬───────────────────────────┬────────┬────────────┬─────────────╮</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ID         │ NAME                      │ TYPE   │ ATTRIBUTES │ AUTH-POLICY │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────┼───────────────────────────┼────────┼────────────┼─────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ .t9Gno26Y  │ local-router              │ Router │ clients    │ default     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 967-JQe6s  │ remote-router             │ Router │            │ default     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ lIend76Tu  │ Default Admin             │ User   │            │ default     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ xCW0lSWpcn │ LocalGWDemoNC-edge-router │ Router │            │ default     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╰────────────┴───────────────────────────┴────────┴────────────┴─────────────╯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-4 of 4</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="223-set-up-ufw">2.2.3 Set Up ufw<a href="#223-set-up-ufw" class="hash-link" aria-label="Direct link to 2.2.3 Set Up ufw" title="Direct link to 2.2.3 Set Up ufw">​</a></h3>
<p>For this demo, we only show the connection initiated from local-tunnel side towards remote-tunnel. The ufw rules below are not needed. If you want to have bidirectional connections, you will need to set up these rules.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to 172.16.240.128/32 port 53 proto udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to 172.16.240.128/32 port 22 proto tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to 172.16.240.128/32 port 80 proto tcp</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="224-add-attribute-hosts-to-the-identity">2.2.4 add attribute &quot;hosts&quot; to the identity<a href="#224-add-attribute-hosts-to-the-identity" class="hash-link" aria-label="Direct link to 2.2.4 add attribute &quot;hosts&quot; to the identity" title="Direct link to 2.2.4 add attribute &quot;hosts&quot; to the identity">​</a></h3>
<p>We want to add attribute &quot;hosts&quot; to the identity associated with the edge router.</p>
<p><strong>You do not need to login again if your token has not expired yet</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge login 68.183.139.122:8441 -u admin -p Test@123 -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge update identity remote-router -a hosts</span><br></span></code></pre></div></div>
<div class="language-buttonless codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-buttonless codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@local-gw:~$ ziti edge list identities</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╭────────────┬───────────────────────────┬────────┬────────────┬─────────────╮</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ID         │ NAME                      │ TYPE   │ ATTRIBUTES │ AUTH-POLICY │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────┼───────────────────────────┼────────┼────────────┼─────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ .t9Gno26Y  │ local-router              │ Router │ clients    │ default     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 967-JQe6s  │ remote-router             │ Router │ hosts      │ default     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ lIend76Tu  │ Default Admin             │ User   │            │ default     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ xCW0lSWpcn │ LocalGWDemoNC-edge-router │ Router │            │ default     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╰────────────┴───────────────────────────┴────────┴────────────┴─────────────╯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-4 of 4</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="30-set-up-client-and-server">3.0 Set Up Client and Server<a href="#30-set-up-client-and-server" class="hash-link" aria-label="Direct link to 3.0 Set Up Client and Server" title="Direct link to 3.0 Set Up Client and Server">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="31-ubuntu-server">3.1 Ubuntu Server<a href="#31-ubuntu-server" class="hash-link" aria-label="Direct link to 3.1 Ubuntu Server" title="Direct link to 3.1 Ubuntu Server">​</a></h2>
<p>The Ubuntu Server needs to support <strong>SSH</strong> (port 22) and <strong>http</strong> (port 8000) for our demo.</p>
<p>Make sure these ports are open on the firewall.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to 172.16.240.129/32 port 22 proto tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow from any to 172.16.240.129/32 port 8000 proto tcp</span><br></span></code></pre></div></div>
<p>Next, start the webserver. The web server will be listening on the port 8000.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;You have reached Remote Web Server.&quot; &gt;hello.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 -m http.server</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="32-windows-client">3.2 Windows Client<a href="#32-windows-client" class="hash-link" aria-label="Direct link to 3.2 Windows Client" title="Direct link to 3.2 Windows Client">​</a></h2>
<p>There are two changes we need to make on the Windows side.</p>
<p>The first one, we need to change the configuration of the preferred DNS to point to our <strong>local-router</strong> (172.16.31.173).</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/LocalGW09-d0a9dfe4c337f1bd0ee90fd6539463f8.png" width="369" height="521" class="img_ev3q"></p>
<p>The second change is to set up routing.</p>
<ul>
<li>We need to route the <strong>100.64.0.0/10</strong> traffic to our <strong>local-router</strong>. Any DNS based intercept resolved to the IP in the subnet 100.64.0.0/10.</li>
<li>We also need to route <strong>172.16.240.129/32</strong> to <strong>local-router</strong>.  <strong>172.16.240.129</strong> is IP we intended to intercept and pass through ziti fabric.</li>
</ul>
<p>To do this, open an cmd window as Administrator.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">route add 100.64.0.0 mask 255.192.0.0 172.16.31.173</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">route add 172.16.240.129 mask 255.255.255.255 172.16.31.173</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/LocalGW10-f121af06081418122cf1e07ede785ace.png" width="688" height="374" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="40-service-configuration">4.0 Service Configuration<a href="#40-service-configuration" class="hash-link" aria-label="Direct link to 4.0 Service Configuration" title="Direct link to 4.0 Service Configuration">​</a></h2>
<p>The service configuration can be done on either the local-router or the remote-router.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="41-create-an-interceptv1-config">4.1 Create an intercept.v1 config<a href="#41-create-an-interceptv1-config" class="hash-link" aria-label="Direct link to 4.1 Create an intercept.v1 config" title="Direct link to 4.1 Create an intercept.v1 config">​</a></h2>
<p>This config is used for local side connection. We are setting up intercept on dns name &quot;mysimpleservice.ziti&quot;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge login 68.183.139.122:8441 -u admin -p Test@123 -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config ssh-intercept-config intercept.v1 &#x27;{&quot;protocols&quot;: [&quot;tcp&quot;], &quot;addresses&quot;: [&quot;mysimpleservice.ziti&quot;], &quot;portRanges&quot;: [{&quot;low&quot;: 22, &quot;high&quot;: 22}]}&#x27;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="42-create-a-hostv1-config">4.2 Create a host.v1 config<a href="#42-create-a-hostv1-config" class="hash-link" aria-label="Direct link to 4.2 Create a host.v1 config" title="Direct link to 4.2 Create a host.v1 config">​</a></h2>
<p>This config is used for remote side connection. We are setting up the address the remote server can reach. In this demo, We are dropping the traffic off at &quot;172.16.240.129&quot;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config ssh-host-config host.v1 &#x27;{&quot;address&quot;:&quot;172.16.240.129&quot;, &quot;protocol&quot;:&quot;tcp&quot;, &quot;port&quot;:22}&#x27;</span><br></span></code></pre></div></div>
<p>If the config command were successfully, you will see two configs by using &quot;list configs&quot; command:</p>
<div class="language-buttonless codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-buttonless codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@local-gw:~$ ziti edge list configs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╭────────────────────────┬───────────────────────┬──────────────╮</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ID                     │ NAME                  │ CONFIG TYPE  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────────────────┼───────────────────────┼──────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 3FdpRUpQ2TYinEwURqArpD │ ssh-host-config       │ host.v1      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 3GAjRaE9CcAhdYZiRNpasa │ ssh-intercept-config  │ intercept.v1 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╰────────────────────────┴───────────────────────┴──────────────╯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-2 of 2</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="43-create-ssh-service">4.3 Create SSH Service<a href="#43-create-ssh-service" class="hash-link" aria-label="Direct link to 4.3 Create SSH Service" title="Direct link to 4.3 Create SSH Service">​</a></h2>
<p>Now we need to put these two configs into a service. We going to name the service &quot;ssh&quot; and assign an attribute &quot;rtrhosted&quot;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service &quot;ssh&quot; -c ssh-intercept-config,ssh-host-config -a rtrhosted</span><br></span></code></pre></div></div>
<p><strong>Check Service</strong> by using &quot;list service&quot;</p>
<div class="language-buttonless codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-buttonless codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@local-gw:~$ ziti edge list services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╭────────────────────────┬──────┬────────────┬─────────────────────┬────────────╮</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ID                     │ NAME │ ENCRYPTION │ TERMINATOR STRATEGY │ ATTRIBUTES │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                        │      │  REQUIRED  │                     │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────────────────┼──────┼────────────┼─────────────────────┼────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 48Z59WmcETzhmAwiUGpdwv │ ssh  │ true       │ smartrouting        │ rtrhosted  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╰────────────────────────┴──────┴────────────┴─────────────────────┴────────────╯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-1 of 1</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="44-create-service-edge-router-policy">4.4 Create Service Edge Router Policy<a href="#44-create-service-edge-router-policy" class="hash-link" aria-label="Direct link to 4.4 Create Service Edge Router Policy" title="Direct link to 4.4 Create Service Edge Router Policy">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-edge-router-policy ssh-serp --edge-router-roles &#x27;#all&#x27; --service-roles &#x27;#rtrhosted&#x27; --semantic &#x27;AnyOf&#x27;</span><br></span></code></pre></div></div>
<p>Check your service-edge-router-policy, and make sure the policy name &quot;ssh-serp&quot; is created. The automatically created one is called &quot;allSvcAllRouters&quot;.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@local-gw:~$ ziti edge list service-edge-router-policies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╭────────────────────────┬──────────────────┬───────────────┬───────────────────╮</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ID                     │ NAME             │ SERVICE ROLES │ EDGE ROUTER ROLES │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────────────────┼──────────────────┼───────────────┼───────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 5QzQPx6EUOJXT0hTm26Vuc │ allSvcAllRouters │ #all          │ #all              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ PElJS8hQ6E6ykYnRiCJyX  │ ssh-serp         │ #rtrhosted    │ #all              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╰────────────────────────┴──────────────────┴───────────────┴───────────────────╯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-2 of 2</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="45-create-bind-policies">4.5 Create Bind policies<a href="#45-create-bind-policies" class="hash-link" aria-label="Direct link to 4.5 Create Bind policies" title="Direct link to 4.5 Create Bind policies">​</a></h2>
<p>We need to specify which identity (in our case, <strong>#hosts</strong>) is going to host the service by setting up a bind service policy</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy ssh-bind Bind --identity-roles &quot;#hosts&quot; --service-roles &#x27;#rtrhosted&#x27; --semantic &#x27;AnyOf&#x27;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="46-create-dial-policies">4.6 Create Dial policies<a href="#46-create-dial-policies" class="hash-link" aria-label="Direct link to 4.6 Create Dial policies" title="Direct link to 4.6 Create Dial policies">​</a></h2>
<p>We also need to specify which identity (in this case, <strong>#clients</strong>) is going to intercept the service by setting up a dial service policy</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service-policy ssh-dial Dial --identity-roles &quot;#clients&quot; --service-roles &#x27;#rtrhosted&#x27; --semantic &#x27;AnyOf&#x27;</span><br></span></code></pre></div></div>
<p>If both policies are set up correctly, you should see two service-policies.</p>
<div class="language-buttonless codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-buttonless codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@local-gw:~$ ziti edge list service-policies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╭────────────────────────┬──────────┬──────────┬───────────────┬────────────────┬─────────────────────╮</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ID                     │ NAME     │ SEMANTIC │ SERVICE ROLES │ IDENTITY ROLES │ POSTURE CHECK ROLES │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────────────────┼──────────┼──────────┼───────────────┼────────────────┼─────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 5cEZw4ZJmoajO68yomA9Hd │ ssh-dial │ AnyOf    │ #rtrhosted    │ #clients       │                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 5ouEy4ArjXwkwu8xoZJGg5 │ ssh-bind │ AnyOf    │ #rtrhosted    │ #hosts         │                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╰────────────────────────┴──────────┴──────────┴───────────────┴────────────────┴─────────────────────╯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-2 of 2</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="47-test-the-service">4.7 Test the service<a href="#47-test-the-service" class="hash-link" aria-label="Direct link to 4.7 Test the service" title="Direct link to 4.7 Test the service">​</a></h2>
<p>Connect to the Windows Client machine, open a cmd window.</p>
<p>First, try to <strong>nslookup mysimpleservice.ziti</strong>. This should resolve to a 100.64.0.* address.</p>
<p>Then you should be able ssh to mysimpleservice.ziti.</p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="/assets/images/LocalGW15-7f3db450842c49dd16c335418490fcb9.png" width="980" height="512" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="50-http-service-configuration">5.0 http Service Configuration<a href="#50-http-service-configuration" class="hash-link" aria-label="Direct link to 5.0 http Service Configuration" title="Direct link to 5.0 http Service Configuration">​</a></h2>
<p>In the previous section, we showed how to configure a DNS based intercept via open-ziti. In this section, we going to show how to set up interception via IP address. If you followed the instruction in the <a href="#32-windows-client">3.2 Windows Client</a> section, the routing for the intercept traffic to local-tunnel node is ready set. (<em>route add 172.16.240.129 mask 255.255.255.255 172.16.31.173</em>)</p>
<p>The service configuration can be done on either the local-router or the remote-router.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="51-create-an-interceptv1-config">5.1 Create an intercept.v1 config<a href="#51-create-an-interceptv1-config" class="hash-link" aria-label="Direct link to 5.1 Create an intercept.v1 config" title="Direct link to 5.1 Create an intercept.v1 config">​</a></h2>
<p>Create intercept config on IP: 172.16.240.129 and port <strong>80</strong> for http traffic.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge login 68.183.139.122:8441 -u admin -p Test@123 -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config http-intercept-config intercept.v1 &#x27;{&quot;protocols&quot;: [&quot;tcp&quot;], &quot;addresses&quot;: [&quot;172.16.240.129&quot;], &quot;portRanges&quot;: [{&quot;low&quot;: 80, &quot;high&quot;: 80}]}&#x27;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="52-create-a-hostv1-config">5.2 Create a host.v1 config<a href="#52-create-a-hostv1-config" class="hash-link" aria-label="Direct link to 5.2 Create a host.v1 config" title="Direct link to 5.2 Create a host.v1 config">​</a></h2>
<p>Create Host config on IP: 172.16.240.129 and port <strong>8000</strong>. As you can see, we have redirected traffic intended for port 80 (from client) to port 8000 (on the host).</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create config http-host-config host.v1 &#x27;{&quot;address&quot;:&quot;172.16.240.129&quot;, &quot;protocol&quot;:&quot;tcp&quot;, &quot;port&quot;:8000}&#x27;</span><br></span></code></pre></div></div>
<p>If the command finished successfully, you will see two more configs created, their names start with &quot;http&quot;:</p>
<div class="language-buttonless codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-buttonless codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@local-gw:~$ ziti edge list configs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╭────────────────────────┬───────────────────────┬──────────────╮</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ID                     │ NAME                  │ CONFIG TYPE  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────────────────┼───────────────────────┼──────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 1QwmHB69qqvtJKMD3LaUiB │ http-host-config      │ host.v1      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 3FdpRUpQ2TYinEwURqArpD │ ssh-host-config       │ host.v1      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 3GAjRaE9CcAhdYZiRNpasa │ ssh-intercept-config  │ intercept.v1 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 7aEkSQs5eOdXRuVT8aCYDz │ http-intercept-config │ intercept.v1 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╰────────────────────────┴───────────────────────┴──────────────╯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-4 of 4</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="53-create-http-service">5.3 Create http Service<a href="#53-create-http-service" class="hash-link" aria-label="Direct link to 5.3 Create http Service" title="Direct link to 5.3 Create http Service">​</a></h2>
<p>Put these two configs into a service. We going to name the service &quot;http&quot; and assign an attribute &quot;rtrhosted&quot;</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create service http -c http-intercept-config,http-host-config -a rtrhosted</span><br></span></code></pre></div></div>
<div class="language-buttonless codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-buttonless codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziggy@local-gw:~$ ziti edge list services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╭────────────────────────┬──────┬────────────┬─────────────────────┬────────────╮</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ID                     │ NAME │ ENCRYPTION │ TERMINATOR STRATEGY │ ATTRIBUTES │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                        │      │  REQUIRED  │                     │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├────────────────────────┼──────┼────────────┼─────────────────────┼────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 2E3LsWbgwo0PiOO67ZyWEP │ http │ true       │ smartrouting        │ rtrhosted  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 48Z59WmcETzhmAwiUGpdwv │ ssh  │ true       │ smartrouting        │ rtrhosted  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">╰────────────────────────┴──────┴────────────┴─────────────────────┴────────────╯</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">results: 1-2 of 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="54-service-edge-router-policy">5.4 Service Edge Router Policy<a href="#54-service-edge-router-policy" class="hash-link" aria-label="Direct link to 5.4 Service Edge Router Policy" title="Direct link to 5.4 Service Edge Router Policy">​</a></h2>
<p>Since we used same attribute for http service as the attribute for SSH service, we don&#x27;t need another service-edge-router-policy. The original service-edge-router-policy was done in <a href="#44-create-service-edge-router-policy">this section</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="55-bind-and-dial-policies">5.5 Bind and Dial policies<a href="#55-bind-and-dial-policies" class="hash-link" aria-label="Direct link to 5.5 Bind and Dial policies" title="Direct link to 5.5 Bind and Dial policies">​</a></h2>
<p>We also do not need to create new Bind and Dial policies. Since our host identity (#hosts) and service attribute (#rtrhosted) did not change for bind policy. And our client identity (#clients) and service attribute (#rtrhosted) did not change for dial policy. You can review the policies from the <a href="#46-create-dial-policies">previous section</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="56-test-the-service">5.6 Test the service<a href="#56-test-the-service" class="hash-link" aria-label="Direct link to 5.6 Test the service" title="Direct link to 5.6 Test the service">​</a></h2>
<p>Connect to the Windows Client machine, open a web browser. Enter this address (<a href="http://172.16.240.129/hello.txt" target="_blank" rel="noopener noreferrer">http://172.16.240.129/hello.txt</a>). You should see the text we entered earlier on the <a href="#31-ubuntu-server">ubuntu server</a></p>
<p><img decoding="async" loading="lazy" alt="Diagram" src="data:image/png;base64,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" width="441" height="136" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/guides/topologies/20-gateway/router.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-06-04T11:15:07.000Z" itemprop="dateModified">Jun 4, 2025</time></b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/gateway"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Gateway</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/guides/topologies/gateway/tunneler"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Tunneler</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#10-introduction" class="table-of-contents__link toc-highlight">1.0 Introduction</a></li><li><a href="#11-network-description" class="table-of-contents__link toc-highlight">1.1 Network Description</a></li><li><a href="#12-prerequisite" class="table-of-contents__link toc-highlight">1.2 Prerequisite</a></li><li><a href="#20-set-up-routers" class="table-of-contents__link toc-highlight">2.0 Set Up Routers</a></li><li><a href="#21-set-up-the-router-for-windows-subnet" class="table-of-contents__link toc-highlight">2.1 Set Up the Router For Windows Subnet</a><ul><li><a href="#211-retrieve-auto_enroll-script-and-gather-setup-info" class="table-of-contents__link toc-highlight">2.1.1 Retrieve auto_enroll script and gather setup info</a></li><li><a href="#212-create-and-register-router" class="table-of-contents__link toc-highlight">2.1.2 Create and Register Router</a></li><li><a href="#213-check-the-installation" class="table-of-contents__link toc-highlight">2.1.3 Check the installation</a></li><li><a href="#214-set-up-ufw" class="table-of-contents__link toc-highlight">2.1.4 Set Up ufw</a></li><li><a href="#215-add-attribute-clients-to-the-identity" class="table-of-contents__link toc-highlight">2.1.5 add attribute &quot;clients&quot; to the identity</a></li></ul></li><li><a href="#22-set-up-the-router-for-ubuntu-server-subnet" class="table-of-contents__link toc-highlight">2.2 Set Up the Router For Ubuntu Server Subnet</a><ul><li><a href="#221-retrieve-auto_enroll-script-and-gather-setup-info" class="table-of-contents__link toc-highlight">2.2.1 Retrieve auto_enroll script and gather setup info</a></li><li><a href="#222-create-and-register-router" class="table-of-contents__link toc-highlight">2.2.2 Create and Register Router</a></li><li><a href="#223-check-the-installation" class="table-of-contents__link toc-highlight">2.2.3 Check the installation</a></li><li><a href="#223-set-up-ufw" class="table-of-contents__link toc-highlight">2.2.3 Set Up ufw</a></li><li><a href="#224-add-attribute-hosts-to-the-identity" class="table-of-contents__link toc-highlight">2.2.4 add attribute &quot;hosts&quot; to the identity</a></li></ul></li><li><a href="#30-set-up-client-and-server" class="table-of-contents__link toc-highlight">3.0 Set Up Client and Server</a></li><li><a href="#31-ubuntu-server" class="table-of-contents__link toc-highlight">3.1 Ubuntu Server</a></li><li><a href="#32-windows-client" class="table-of-contents__link toc-highlight">3.2 Windows Client</a></li><li><a href="#40-service-configuration" class="table-of-contents__link toc-highlight">4.0 Service Configuration</a></li><li><a href="#41-create-an-interceptv1-config" class="table-of-contents__link toc-highlight">4.1 Create an intercept.v1 config</a></li><li><a href="#42-create-a-hostv1-config" class="table-of-contents__link toc-highlight">4.2 Create a host.v1 config</a></li><li><a href="#43-create-ssh-service" class="table-of-contents__link toc-highlight">4.3 Create SSH Service</a></li><li><a href="#44-create-service-edge-router-policy" class="table-of-contents__link toc-highlight">4.4 Create Service Edge Router Policy</a></li><li><a href="#45-create-bind-policies" class="table-of-contents__link toc-highlight">4.5 Create Bind policies</a></li><li><a href="#46-create-dial-policies" class="table-of-contents__link toc-highlight">4.6 Create Dial policies</a></li><li><a href="#47-test-the-service" class="table-of-contents__link toc-highlight">4.7 Test the service</a></li><li><a href="#50-http-service-configuration" class="table-of-contents__link toc-highlight">5.0 http Service Configuration</a></li><li><a href="#51-create-an-interceptv1-config" class="table-of-contents__link toc-highlight">5.1 Create an intercept.v1 config</a></li><li><a href="#52-create-a-hostv1-config" class="table-of-contents__link toc-highlight">5.2 Create a host.v1 config</a></li><li><a href="#53-create-http-service" class="table-of-contents__link toc-highlight">5.3 Create http Service</a></li><li><a href="#54-service-edge-router-policy" class="table-of-contents__link toc-highlight">5.4 Service Edge Router Policy</a></li><li><a href="#55-bind-and-dial-policies" class="table-of-contents__link toc-highlight">5.5 Bind and Dial policies</a></li><li><a href="#56-test-the-service" class="table-of-contents__link toc-highlight">5.6 Test the service</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a class="footer__link-item" href="/policies/CODE_OF_CONDUCT">Policies</a><span class="footer__link-separator">·</span><a href="https://netfoundry.io/products/netfoundry-platform/netfoundry-cloud-for-openziti/" target="_blank" rel="noopener noreferrer" class="footer__link-item">NetFoundry Cloud</a><span class="footer__link-separator">·</span><a href="https://blog.openziti.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 NetFoundry Inc.</div></div></div></footer></div></div>
</body>
</html>