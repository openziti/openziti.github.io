<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-guides/Digital_Ocean/Router">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Create new router | OpenZiti</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.openziti.io/docs/guides/Digital_Ocean/Router"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Create new router | OpenZiti"><meta data-rh="true" name="description" content="2.1 Create a VM on Digital Ocean"><meta data-rh="true" property="og:description" content="2.1 Create a VM on Digital Ocean"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.openziti.io/docs/guides/Digital_Ocean/Router"><link data-rh="true" rel="alternate" href="https://docs.openziti.io/docs/guides/Digital_Ocean/Router" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.openziti.io/docs/guides/Digital_Ocean/Router" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EXWPKK5PV4-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OpenZiti RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OpenZiti Atom Feed">


<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-THVRRJ3GLE"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-THVRRJ3GLE",{anonymize_ip:!0})</script>




<link rel="search" type="application/opensearchdescription+xml" title="OpenZiti" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.e6cbe7a9.css">
<link rel="preload" href="/assets/js/runtime~main.f6b9540a.js" as="script">
<link rel="preload" href="/assets/js/main.afe871e3.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="root_VOM9"><span style="color:whitesmoke">Star us on GitHub </span><span style="height:20px"><span><a href="https://github.com/openziti/ziti" data-icon="octicon-star" data-show-count="true" aria-label="Star buttons/github-buttons on GitHub">Star</a></span></span></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ziti-logo-dark.svg" alt="OpenZiti Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/ziti-logo-light.svg" alt="OpenZiti Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/learn/introduction/">Documentation</a><a class="navbar__item navbar__link" href="/docs/downloads">Downloads</a><a href="https://blog.openziti.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Links</a><ul class="dropdown__menu"><li><div class="text-divider"><p>Socials</p></div></li><li><a href="https://www.youtube.com/OpenZiti" target="_blank" title="OpenZiti on YouTube"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/yt.svg">YouTube</span></a></li><li><a href="https://twitter.com/OpenZiti" target="_blank" title="OpenZiti on Twitter"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/twit.svg">Twitter</span></a></li><li><a href="https://reddit.com/r/openziti" target="_blank" title="OpenZiti Subreddit"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/reddit-logo.png">Reddit</span></a></li><li><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/ziggy.png"><a href="https://twitter.com/OpenZiggy" target="_blank" title="OpenZiggy on Twitter">Ziggy</a></span></li><li><div class="text-divider"><p>Other</p></div></li><li><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/blog-icon.png"><a href="https://blog.openziti.io/" target="_blank" title="Blog">Blog</a></span></li><li><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/oz-test-kitchen.png"><a href="https://github.com/openziti-test-kitchen" target="_blank" title="Git project for the test kitchen">Test Kitchen</a></span></li><li><a href="https://zeds.openziti.org" target="_blank" title="Developer Sandbox"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/zeds.png">ZEDS</span></a></li><li><a href="https://netfoundry.io/pricing/" target="_blank" title="NetFoundry-hosted Ziti"><span id="navbarDropdownItem"><img id="navbarDropdownImage" src="/img/nf.svg">CloudZiti</span></a></li></ul></div><a href="https://openziti.discourse.group/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discourse-link" title="Discourse"></a><a href="https://github.com/openziti/ziti" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_eExm docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 sidebar-title"><a class="menu__link" href="/docs/learn/introduction/">LEARN</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/learn/introduction/">What is OpenZiti?</a><button aria-label="Toggle the collapsible sidebar category &#x27;What is OpenZiti?&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/learn/quickstarts/network/">Quickstarts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Quickstarts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/learn/core-concepts/">Core Concepts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Core Concepts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 sidebar-title"><a class="menu__link" href="/docs/reference/">REFERENCE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/reference/tunnelers/">Tunnelers</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tunnelers&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/reference/deployments/">Deployments</a><button aria-label="Toggle the collapsible sidebar category &#x27;Deployments&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/reference/configuration/conventions">Configuration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Configuration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/reference/developer/">Developer</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/reference/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 sidebar-title"><a class="menu__link" href="/docs/guides/">GUIDES</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guides/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/digital-ocean">Digital Ocean</a><button aria-label="Toggle the collapsible sidebar category &#x27;Digital Ocean&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/Digital_Ocean/">Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/Digital_Ocean/Controller">Controller</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/guides/Digital_Ocean/Router">Router</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/Digital_Ocean/Services">Services</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/kubernetes">Kubernetes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guides/alt-server-certs">Public CA Certs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/guides/hsm/">Hardware Security Modules (HSM)</a><button aria-label="Toggle the collapsible sidebar category &#x27;Hardware Security Modules (HSM)&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/securing-apis">Securing APIs</a><button aria-label="Toggle the collapsible sidebar category &#x27;Securing APIs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/troubleshooting">Troubleshooting</a><button aria-label="Toggle the collapsible sidebar category &#x27;Troubleshooting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/digital-ocean"><span itemprop="name">Digital Ocean</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Router</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>2.0 Configure new router using open ziti</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="21-create-a-vm-on-digital-ocean">2.1 Create a VM on Digital Ocean<a href="#21-create-a-vm-on-digital-ocean" class="hash-link" aria-label="Direct link to 2.1 Create a VM on Digital Ocean" title="Direct link to 2.1 Create a VM on Digital Ocean">​</a></h2><p>Please follow <strong>Section 1.1</strong> of the <a href="/docs/guides/Digital_Ocean/Controller/">Controller Guide</a> to setup a VM to be used as Router. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="22-login-and-update-the-repo-and-apps-on-vm">2.2 Login and Update the repo and apps on VM<a href="#22-login-and-update-the-repo-and-apps-on-vm" class="hash-link" aria-label="Direct link to 2.2 Login and Update the repo and apps on VM" title="Direct link to 2.2 Login and Update the repo and apps on VM">​</a></h2><p>Once the VM is created, we can get the IP address of the droplet from the Resources screen. Login to the VM by using user &quot;root&quot; and IP address:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> root@</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">ip</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="221-apt-update">2.2.1 apt update<a href="#221-apt-update" class="hash-link" aria-label="Direct link to 2.2.1 apt update" title="Direct link to 2.2.1 apt update">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> upgrade</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="222-download-ziti_router_auto_enroll-binary">2.2.2 Download ziti_router_auto_enroll binary<a href="#222-download-ziti_router_auto_enroll-binary" class="hash-link" aria-label="Direct link to 2.2.2 Download ziti_router_auto_enroll binary" title="Direct link to 2.2.2 Download ziti_router_auto_enroll binary">​</a></h3><p><strong>ziti_router_auto_enroll</strong> is an easy way to setup your router automatically.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://github.com/netfoundry/ziti_router_auto_enroll/releases/latest/download/ziti_router_auto_enroll.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> xf ziti_router_auto_enroll.tar.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You should have a file <strong>ziti_router_auto_enroll</strong> under the directory.</p><p>For detail info on ziti_router_auto_enroll, please checkout the <a href="https://github.com/netfoundry/ziti_router_auto_enroll" target="_blank" rel="noopener noreferrer">github page</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="23-create-and-setup-router-directly-on-router-vm">2.3 Create and setup Router directly on router VM<a href="#23-create-and-setup-router-directly-on-router-vm" class="hash-link" aria-label="Direct link to 2.3 Create and setup Router directly on router VM" title="Direct link to 2.3 Create and setup Router directly on router VM">​</a></h2><p>You can setup the router directly on the router VM with one command if you did not block your controller&#x27;s edge-management port. At this time, the quickstart for setting up controller does not separate edge-management port from edge-client port, so the edge-management port has to be open. You may continue this section if you know your controller&#x27;s management password, Fabric Port (default 8440) and Management Port (default 8441).</p><p>You can also choose to create router on the controller and then register with the jwt file (created when creating the router) on the router. The procedure for this is detailed in <strong>section 2.4</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="231-info-needed-for-creating-router">2.3.1 Info needed for creating Router<a href="#231-info-needed-for-creating-router" class="hash-link" aria-label="Direct link to 2.3.1 Info needed for creating Router" title="Direct link to 2.3.1 Info needed for creating Router">​</a></h3><p>In order to create the Router, the VM needs to contact controller. We need the following information before we can continue:</p><ul><li>Controller IP</li><li>Controller Fabric Port: On the controller, issue this command <strong>echo $ZITI_CTRL_PORT</strong></li><li>Controller Management Port: On the controller, issue this command <strong>echo $ZITI_EDGE_CONTROLLER_PORT</strong></li><li>Controller Passwd: On the controller, issue this command <strong>echo $ZITI_PWD</strong></li><li>Router Name: Name for this router</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="232-info-gathered-for-creating-router">2.3.2 Info gathered for creating Router<a href="#232-info-gathered-for-creating-router" class="hash-link" aria-label="Direct link to 2.3.2 Info gathered for creating Router" title="Direct link to 2.3.2 Info gathered for creating Router">​</a></h3><p>Here is information I gathered from previous step:</p><ul><li>Controller IP: 161.35.108.218</li><li>Controller Fabric Port: 8440 <strong>(default value if following controller setup guide)</strong></li><li>Controller Management Port: 8441 <strong>(default value if following controller setup guide)</strong></li><li>Controller Passwd: Test@123</li><li>Router Name: JAMES-ER-SF</li></ul><p>We are also going to create the router without healthcheck section and metrics, so the following two options will be used to create the router:</p><ul><li>--disableHealthChecks</li><li>--disableMetrics</li></ul><p>If you choose to explore these two functionalities, you can remove the options (from command line) when creating router.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="233-create-the-router-with-link-listener">2.3.3 Create the Router with link listener<a href="#233-create-the-router-with-link-listener" class="hash-link" aria-label="Direct link to 2.3.3 Create the Router with link listener" title="Direct link to 2.3.3 Create the Router with link listener">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./ziti_router_auto_enroll -f -n --controller 161.35.108.218 --controllerFabricPort 8440 --controllerMgmtPort 8441 --adminUser admin --adminPassword Test@123 --assumePublic --disableHealthChecks --disableMetrics --routerName JAMES-ER-SF </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>output</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:44-INFO-Writing jwt file: JAMES-ER-SF_enrollment.jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:44-INFO-Version not specified, going to check with controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:45-INFO-Found version 0.27.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:45-INFO-Downloading file: https://github.com/openziti/ziti/releases/download/v0.27.7/ziti-linux-amd64-0.27.7.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Downloading: 100%|████████████████████████████████████████████████████████████████████████████████████████████| 115M/115M [00:01&lt;00:00, 67.3MiB/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:47-INFO-Successfully downloaded file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:47-INFO-Starting binary install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:50-INFO-Installing service unit file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:50-INFO-Creating config file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:50-INFO-Starting Router Enrollment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:54-INFO-Successfully enrolled Ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:54-INFO-Service ziti-router.service start successful.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created symlink /etc/systemd/system/multi-user.target.wants/ziti-router.service → /etc/systemd/system/ziti-router.service.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-05-04:07:55-INFO-Service ziti-router.service enable successful.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Alternative way of creating router</strong></p><p>Instead of passing parameters through the command line to create routers, the parameters can be specified via environmental variables. Here is example on how to accomplish that.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export CONTROLLER=&quot;161.35.108.218&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export CONTROLLERFABRICPORT=&quot;8440&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export CONTROLLERMGMTPORT=&quot;8441&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ADMINUSER=&quot;admin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ADMINPASSWORD=&quot;Test@123&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./ziti_router_auto_enroll -f -n --assumePublic --disableHealthChecks --disableMetrics --routerName JAMES-ER-SF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="234-create-the-router-with-link-listener-and-tunneler">2.3.4 Create the Router with link listener and tunneler<a href="#234-create-the-router-with-link-listener-and-tunneler" class="hash-link" aria-label="Direct link to 2.3.4 Create the Router with link listener and tunneler" title="Direct link to 2.3.4 Create the Router with link listener and tunneler">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./ziti_router_auto_enroll -f -n --controller 161.35.108.218 --controllerFabricPort 8440 --controllerMgmtPort 8441 --adminUser admin --adminPassword Test@123 --assumePublic --disableHealthChecks --disableMetrics --autoTunnelListener --routerName JAMES-ER-SF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="235-create-the-router-with-edge-listener-only-no-link-listener">2.3.5 Create the Router with edge listener only (no link listener)<a href="#235-create-the-router-with-edge-listener-only-no-link-listener" class="hash-link" aria-label="Direct link to 2.3.5 Create the Router with edge listener only (no link listener)" title="Direct link to 2.3.5 Create the Router with edge listener only (no link listener)">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./ziti_router_auto_enroll -f -n --controller 161.35.108.218 --controllerFabricPort 8440 --controllerMgmtPort 8441 --adminUser admin --adminPassword Test@123 --disableHealthChecks --disableMetrics --routerName JAMES-ER-SF </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="236-create-the-router-with-edge-listener-and-tunneler">2.3.6 Create the Router with edge listener and tunneler<a href="#236-create-the-router-with-edge-listener-and-tunneler" class="hash-link" aria-label="Direct link to 2.3.6 Create the Router with edge listener and tunneler" title="Direct link to 2.3.6 Create the Router with edge listener and tunneler">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./ziti_router_auto_enroll -f -n --controller 161.35.108.218 --controllerFabricPort 8440 --controllerMgmtPort 8441 --adminUser admin --adminPassword Test@123 --disableHealthChecks --disableMetrics --autoTunnelListener --routerName JAMES-ER-SF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="24-creating-router-on-controller-first">2.4 Creating Router on Controller first<a href="#24-creating-router-on-controller-first" class="hash-link" aria-label="Direct link to 2.4 Creating Router on Controller first" title="Direct link to 2.4 Creating Router on Controller first">​</a></h2><p><strong>If you already go through the procedure in section 2.3, you can skip to section 2.5</strong></p><p>You can create the router on the controller first then register the router on the router VM.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="241-creating-router-on-the-controller-using-zac">2.4.1 Creating Router on the controller Using ZAC<a href="#241-creating-router-on-the-controller-using-zac" class="hash-link" aria-label="Direct link to 2.4.1 Creating Router on the controller Using ZAC" title="Direct link to 2.4.1 Creating Router on the controller Using ZAC">​</a></h3><p><strong>If you prefer to create router using CLI, you can jump to next section.</strong></p><p><strong>In order to complete the procedures in this section, you need to install ZAC first and have access to the controller using the ZAC. If you have trouble using ZAC, you can use the CLI procedures to create router.</strong></p><p>From the ZAC welcome screen, choose the <strong>ROUTERS</strong></p><p><img loading="lazy" alt="Diagram" src="/assets/images/ZAC01-router-d367a52a762e51de055184325befc14f.png" width="323" height="638" class="img_ev3q"></p><p>Click on <strong>+</strong> to bring up the <strong>CREATE EDGE ROUTER</strong> widget. The <strong>NAME</strong> of Router is required, and it has to be unique. Also choose whether you want the tunneler to be enable or not on the router.  Enter other optional fields and hit <strong>SAVE</strong></p><p><img loading="lazy" alt="Diagram" src="/assets/images/ZAC02-router-0afcb807ad641c1ab3a20405f160c668.png" width="726" height="807" class="img_ev3q"></p><p>If the router is created successfully, you will be back to the <strong>MANAGE EDGE ROUTERS</strong> screen.  From the list of edge routers, you will see the <strong>JWT</strong> icon on the newly created router. You need this JWT for the registration.</p><p><img loading="lazy" alt="Diagram" src="/assets/images/ZAC03-router-57fbfd25d7c9a3714119b6abc3035798.png" width="1294" height="552" class="img_ev3q"></p><p>Click on the <strong>JWT ICON</strong>, the JWT will be downloaded to your machine. On Chrome browser, the downloaded file will appear on the bottom right corner of the browser like picture below.</p><p><img loading="lazy" alt="Diagram" src="data:image/png;base64,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" width="306" height="57" class="img_ev3q"></p><p>Open the JWT file, and copy the content.  Now you are ready for the registration.</p><p><img loading="lazy" alt="Diagram" src="/assets/images/ZAC05-router-025d44c743040a6435b796ba4b507853.png" width="1643" height="125" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="242-creating-router-on-the-controller-using-cli">2.4.2 Creating Router on the controller Using CLI<a href="#242-creating-router-on-the-controller-using-cli" class="hash-link" aria-label="Direct link to 2.4.2 Creating Router on the controller Using CLI" title="Direct link to 2.4.2 Creating Router on the controller Using CLI">​</a></h3><p><strong>If you already created router using ZAC, you can skip ahead to register the router.</strong> Otherwise, this section provides CLI commands to create routers on the controller.</p><p><strong>login to controller</strong>
login to CLI first</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">zitiLogin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To create an edge router (no tunneler)</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create edge-router JAMES-ER-SF -o JAMES-ER-SF.jwt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>output</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">New edge router JAMES-ER-SF2 created with id: BzUtjC7E.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enrollment expires at 2023-04-07T03:52:03.997Z</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To create an edge router with tunneler</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ziti edge create edge-router JAMES-ER-SF -t -o JAMES-ER-SF.jwt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Cat out the content of the jwt file. We will need to use the jwt to register router</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># cat  JAMES-ER-SF.jwt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbSI6ImVyb3R0IiwiZXhwIjoxNjgwODM5NjA4LCJpc3MiOiJodHRwczovLzE2MS4zNS4xMDguMjE4Ojg0NDEiLCJqdGkiOiJhNDg5N2Q0ZS1lZTY4LTQ1M2UtYjY1NS03MGU0YjgyZTllNDciLCJzdWIiOiJpY2JLakM3RS5QIn0.Y6DohYyWEeJQmRMe29v4cL3Y1APCnBlrv_-S_941au2OESuQdt2CS4C4djvESYzV5vbnbgZgyU5xtNvb4lW5Uv2HP3XUGQNVsWjpwZbazNoTXg1IX6hhWb7T6u1AhS4xnJ3jpoapKsdOkUSqeQNUMSiN3aeLNcGVA_XK1-utCYjVsHDC90M1ZYZqgd8C9IKziDI10XQVlKTqosv8hoJD0OKIu7WZMslweRSMBtQUA2lZ2QSkIhFr2bvtgPll-5aBnG7eo6Ka_WtEW6EikU2fxgpNaVVBEIdZs1tkdGU6dfBDA6j5wA1TBI0FZnuKlNW24bMZCWKy2B_AMqJW1a80I0qNDx-QHEy-pt8FzZ-eqXWyfhc_nYzwT9kr6hO9VJrrD81hboCeTl8G6EXZjwCi2lPbKHROtkQu08-Ns1Kps7R3GILeNMltW9tKApP746ek4DVxm2cKqiB1Axcb0tNjDWTthjyp8m40aSiiqOPIoQbwa43JLqbHcuhZOSBLQNb_bwzkxBSf34D2w5eVETWy9VX-lgHwM-uhT5SfZIWdnWtO7-Cxn-cqgz89twtOim-yc5j0p0ieAbrOArbjKFBXiQjP8yWkorQKlj5PTSk7vyb3X4q6p--RxP2Z5F8alCPQx3XiVcohvIJnrJiEP86myNIYcKhhJ4OB4r9iOr0qTc8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We also need the management port (default 8441) and fabric port (default 8440) of the controller to register the router</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># echo $ZITI_EDGE_CONTROLLER_PORT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8441</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># echo $ZITI_CTRL_PORT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8440</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="243-register-the-router-with-link-listener">2.4.3 Register the Router with link listener<a href="#243-register-the-router-with-link-listener" class="hash-link" aria-label="Direct link to 2.4.3 Register the Router with link listener" title="Direct link to 2.4.3 Register the Router with link listener">​</a></h3><p><strong>Perform this on the Router VM</strong></p><p><strong>command</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441 --assumePublic --disableHealthChecks --disableMetrics &lt;jwt content&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441 --assumePublic --disableHealthChecks --disableMetrics eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbSI6ImVyb3R0IiwiZXhwIjoxNjgwODM5NjA4LCJpc3MiOiJodHRwczovLzE2MS4zNS4xMDguMjE4Ojg0NDEiLCJqdGkiOiJhNDg5N2Q0ZS1lZTY4LTQ1M2UtYjY1NS03MGU0YjgyZTllNDciLCJzdWIiOiJpY2JLakM3RS5QIn0.Y6DohYyWEeJQmRMe29v4cL3Y1APCnBlrv_-S_941au2OESuQdt2CS4C4djvESYzV5vbnbgZgyU5xtNvb4lW5Uv2HP3XUGQNVsWjpwZbazNoTXg1IX6hhWb7T6u1AhS4xnJ3jpoapKsdOkUSqeQNUMSiN3aeLNcGVA_XK1-utCYjVsHDC90M1ZYZqgd8C9IKziDI10XQVlKTqosv8hoJD0OKIu7WZMslweRSMBtQUA2lZ2QSkIhFr2bvtgPll-5aBnG7eo6Ka_WtEW6EikU2fxgpNaVVBEIdZs1tkdGU6dfBDA6j5wA1TBI0FZnuKlNW24bMZCWKy2B_AMqJW1a80I0qNDx-QHEy-pt8FzZ-eqXWyfhc_nYzwT9kr6hO9VJrrD81hboCeTl8G6EXZjwCi2lPbKHROtkQu08-Ns1Kps7R3GILeNMltW9tKApP746ek4DVxm2cKqiB1Axcb0tNjDWTthjyp8m40aSiiqOPIoQbwa43JLqbHcuhZOSBLQNb_bwzkxBSf34D2w5eVETWy9VX-lgHwM-uhT5SfZIWdnWtO7-Cxn-cqgz89twtOim-yc5j0p0ieAbrOArbjKFBXiQjP8yWkorQKlj5PTSk7vyb3X4q6p--RxP2Z5F8alCPQx3XiVcohvIJnrJiEP86myNIYcKhhJ4OB4r9iOr0qTc8 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>output</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:49-INFO-Version not specified, going to check with controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:49-INFO-Found version 0.27.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:49-INFO-Downloading file: https://github.com/openziti/ziti/releases/download/v0.27.7/ziti-linux-amd64-0.27.7.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Downloading: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 115M/115M [00:01&lt;00:00, 68.9MiB/s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:51-INFO-Successfully downloaded file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:51-INFO-Starting binary install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:54-INFO-Installing service unit file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:55-INFO-Service ziti-router daemon-reload successful.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:55-INFO-Creating config file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:55-INFO-Starting Router Enrollment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:57-INFO-Successfully enrolled Ziti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:57-INFO-Service ziti-router.service start successful.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-04-07-01:07:57-INFO-Service ziti-router.service enable successful.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="244-register-the-router-with-link-listener-and-tunneler">2.4.4 Register the Router with link listener and tunneler<a href="#244-register-the-router-with-link-listener-and-tunneler" class="hash-link" aria-label="Direct link to 2.4.4 Register the Router with link listener and tunneler" title="Direct link to 2.4.4 Register the Router with link listener and tunneler">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441 --assumePublic --disableHealthChecks --disableMetrics --autoTunnelListener &lt;jwt content&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="245-register-the-router-with-edge-listener-only-no-link-listener">2.4.5 Register the Router with edge listener only (no link listener)<a href="#245-register-the-router-with-edge-listener-only-no-link-listener" class="hash-link" aria-label="Direct link to 2.4.5 Register the Router with edge listener only (no link listener)" title="Direct link to 2.4.5 Register the Router with edge listener only (no link listener)">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441 --disableHealthChecks --disableMetrics &lt;jwt content&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="246-register-the-router-with-edge-listener-and-tunneler">2.4.6 Register the Router with edge listener and tunneler<a href="#246-register-the-router-with-edge-listener-and-tunneler" class="hash-link" aria-label="Direct link to 2.4.6 Register the Router with edge listener and tunneler" title="Direct link to 2.4.6 Register the Router with edge listener and tunneler">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441 --disableHealthChecks --disableMetrics --autoTunnelListener &lt;jwt content&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="25-auto-start-the-router">2.5 Auto start the router<a href="#25-auto-start-the-router" class="hash-link" aria-label="Direct link to 2.5 Auto start the router" title="Direct link to 2.5 Auto start the router">​</a></h2><p>After enroll the router, a systemd service file is automatically created and enabled. To check the status of the service file, issue the following command:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl status ziti-router</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Output</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">● ziti-router.service - Ziti-Router</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Loaded: loaded (/etc/systemd/system/ziti-router.service; enabled; vendor preset: enabled)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Active: active (running) since Wed 2023-04-05 14:45:59 UTC; 4s ago</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Main PID: 18381 (ziti)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tasks: 6 (limit: 2323)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Memory: 16.5M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CPU: 222ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     CGroup: /system.slice/ziti-router.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             └─18381 /opt/ziti/ziti router run /opt/ziti/config.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the status shows <strong>active (running)</strong>, then the setup finished correctly.</p><p>On the controller, you can check the status of the routers. Please refer to the controller guide (useful command for the Router) section for more information.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="26-fix-the-resolver">2.6 Fix the resolver<a href="#26-fix-the-resolver" class="hash-link" aria-label="Direct link to 2.6 Fix the resolver" title="Direct link to 2.6 Fix the resolver">​</a></h2><p>If you run router without tunneler enabled, you can skip this section.</p><p>We need to remove the digital ocean resolver for tunnel resolver to work correctly.</p><p>Check resolver before any changes:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># resolvectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Global</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resolv.conf mode: stub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current DNS Server: 67.207.67.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       DNS Servers: 67.207.67.2 67.207.67.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Under the Global DNS servers, it should say something like &quot;67.207.67.2 67.207.67.3&quot;</p><p><strong>Now, make changes to the resolver:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /etc/systemd/resolved.conf.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> DigitalOcean.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ln</span><span class="token plain"> -s /dev/null DigitalOcean.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart systemd-resolved.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Check resolver again </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># resolvectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Global</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resolv.conf mode: stub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current DNS Server: 146.190.120.86</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       DNS Servers: 146.190.120.86</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...       </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now the Global DNS servers should be the IP address on your local interface.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/guides/Digital_Ocean/Router.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/guides/Digital_Ocean/Controller"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Controller</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/guides/Digital_Ocean/Services"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Services</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#21-create-a-vm-on-digital-ocean" class="table-of-contents__link toc-highlight">2.1 Create a VM on Digital Ocean</a></li><li><a href="#22-login-and-update-the-repo-and-apps-on-vm" class="table-of-contents__link toc-highlight">2.2 Login and Update the repo and apps on VM</a><ul><li><a href="#221-apt-update" class="table-of-contents__link toc-highlight">2.2.1 apt update</a></li><li><a href="#222-download-ziti_router_auto_enroll-binary" class="table-of-contents__link toc-highlight">2.2.2 Download ziti_router_auto_enroll binary</a></li></ul></li><li><a href="#23-create-and-setup-router-directly-on-router-vm" class="table-of-contents__link toc-highlight">2.3 Create and setup Router directly on router VM</a><ul><li><a href="#231-info-needed-for-creating-router" class="table-of-contents__link toc-highlight">2.3.1 Info needed for creating Router</a></li><li><a href="#232-info-gathered-for-creating-router" class="table-of-contents__link toc-highlight">2.3.2 Info gathered for creating Router</a></li><li><a href="#233-create-the-router-with-link-listener" class="table-of-contents__link toc-highlight">2.3.3 Create the Router with link listener</a></li><li><a href="#234-create-the-router-with-link-listener-and-tunneler" class="table-of-contents__link toc-highlight">2.3.4 Create the Router with link listener and tunneler</a></li><li><a href="#235-create-the-router-with-edge-listener-only-no-link-listener" class="table-of-contents__link toc-highlight">2.3.5 Create the Router with edge listener only (no link listener)</a></li><li><a href="#236-create-the-router-with-edge-listener-and-tunneler" class="table-of-contents__link toc-highlight">2.3.6 Create the Router with edge listener and tunneler</a></li></ul></li><li><a href="#24-creating-router-on-controller-first" class="table-of-contents__link toc-highlight">2.4 Creating Router on Controller first</a><ul><li><a href="#241-creating-router-on-the-controller-using-zac" class="table-of-contents__link toc-highlight">2.4.1 Creating Router on the controller Using ZAC</a></li><li><a href="#242-creating-router-on-the-controller-using-cli" class="table-of-contents__link toc-highlight">2.4.2 Creating Router on the controller Using CLI</a></li><li><a href="#243-register-the-router-with-link-listener" class="table-of-contents__link toc-highlight">2.4.3 Register the Router with link listener</a></li><li><a href="#244-register-the-router-with-link-listener-and-tunneler" class="table-of-contents__link toc-highlight">2.4.4 Register the Router with link listener and tunneler</a></li><li><a href="#245-register-the-router-with-edge-listener-only-no-link-listener" class="table-of-contents__link toc-highlight">2.4.5 Register the Router with edge listener only (no link listener)</a></li><li><a href="#246-register-the-router-with-edge-listener-and-tunneler" class="table-of-contents__link toc-highlight">2.4.6 Register the Router with edge listener and tunneler</a></li></ul></li><li><a href="#25-auto-start-the-router" class="table-of-contents__link toc-highlight">2.5 Auto start the router</a></li><li><a href="#26-fix-the-resolver" class="table-of-contents__link toc-highlight">2.6 Fix the resolver</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a class="footer__link-item" href="/policies/CODE_OF_CONDUCT">Policies</a><span class="footer__link-separator">·</span><a href="https://netfoundry.io/pricing/" target="_blank" rel="noopener noreferrer" class="footer__link-item">CloudZiti</a><span class="footer__link-separator">·</span><a href="https://blog.openziti.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 NetFoundry Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f6b9540a.js"></script>
<script src="/assets/js/main.afe871e3.js"></script>
</body>
</html>